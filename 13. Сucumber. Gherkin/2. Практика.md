Java_QA / 13. Сucumber. Gherkin

[![Лекция](https://img.shields.io/badge/-Лекция-ee99ff)](1.%20Лекция.md)
[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Задание](https://img.shields.io/badge/-Задание-99ffee)](3.%20Задание.md)

***

# Содержание

* []()
* []()
* []()
* []()

***

# 1. Открытие предыдущего проекта

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

Шаги:

1. Запустить **IntelliJ IDEA**.

2. Открыть проект прошлого урока в **IntelliJ IDEA**.

![New Maven Project - Open...](./_Files/2.%20New%20Project/01.jpg "New Maven Project - Open...")

***

# 2. Хуки

Хуки позволяют нам вынести какие то действия не относящие непосредственно к логиике сценария - 
подключение к БД, настройка веб драйвера, снятие скриншотов и т д.

## 2.1. Настройка драйвера

Вынесем действия по настройке драйвера в хуки.

### 2.1.1. Класс DriverHooks

***DriverHooks*** - класс, который выполняет действия по настройке драйвера.

Шаги:

1. Создать файл **DriverHooks.java** в **./src/test/java/hooks**.

![New Maven Project - DriverHooks.java](./_Files/2.%20New%20Project/02.jpg "New Project - DriverHooks.java")

2. Добавить в файл **DriverHooks.java** код.

* объявление драйвера браузера

```java
// Драйвер браузера
protected static WebDriver driver;
```

* объявление логгера

```java
// Логгер
private Logger logger = LogManager.getLogger(DriverHooks.class);
```

* метод **startDriverBeforeScenario** - действия совершаемые перед каждым сценарием

```java
// Действия совершаемые перед каждым сценарием
@Before
public void startDriverBeforeScenario() {
    // Получаем параметр запуска тестов через Maven -Dbrowser
    String browser = System
        .getProperty("browser", "chrome")
        .toLowerCase();
    // Получаем экземпляр драйвера браузера
    driver = WebDriverFactory.getDriver(BrowserName.fromString(browser));
    logger.info("Драйвер стартовал!");
}
```

* метод **stopDriverAfterScenario** - действия совершаемые после каждого сценария

```java
// Действия совершаемые после каждого сценария
@After
public void stopDriverAfterScenario() {
    // Если драйвер еще существует
    if(driver != null) {
        // Закрываем его
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

### 2.1.2. Полный код DriverHooks.java

[DriverHooks.java](_Sample_04/src/test/java/hooks/DriverHooks.java)

### 2.1.3. Класс SmartphoneSteps

Изменим реализацию шагов в **SmartphoneSteps.java**.

Шаги:

1. Открыть файл **SmartphoneSteps.java** в **./src/test/java/steps**.

2. Изменить в файле **SmartphoneSteps.java** код.

* объявление объектов страниц

```java
// Страницы
StartPage startPage;
```

* метод **startDriverAndOpenStartPage** - шаг **Дано** *Открыта Главная страница ДНС*

```java
@Дано("Открыта Главная страница ДНС")
public void startDriverAndOpenStartPage() {
    startPage = new StartPage(WebDriverFactory.getCurrentDriver());
    // Открыть страницу https://www.dns-shop.ru/
    WebDriverFactory.getCurrentDriver().get("https://www.dns-shop.ru/");
    logger.info("Открыта Стартовая страница сайта DNS");
}
```

* метод **openSmartphonesPage** - шаг **Когда** *Выполнен переход на страницу Смартфоны*

```java
@Когда("Выполнен переход на страницу Смартфоны")
public void openSmatphonesPage() {
    startPage.linkYes().click();
    startPage.linkSmartsAndGadget().focusOnLink();
    startPage.linkSmarts().click();
    logger.info("Выполнен переход на страницу Смартфоны");
}
```

* метод **assertTitle** - шаг **Тогда** *Проверить: В заголовке страницы отображается текст Смартфоны*

```java
@Тогда("Проверить: В заголовке страницы отображается текст Смартфоны")
public void assertTitle() {
    // Проверка заголовка страницы
    logger.info("Проверка заголовка страницы");
    Assertions.assertTrue(smartphonesPage.getPageTitle().contains("Смартфоны"),
        "В заголовке страницы не отображается текст Смартфоны");
}
```

### 2.1.4. Полный код SmartphoneSteps.java

[SmartphoneSteps.java](_Sample_04/src/test/java/steps/SmartphoneSteps.java)

### 2.1.5. Фича Smartphone

Шаги:

1. Открыть файл **Smartphone.feature** в **./src/test/resources/features**.

2. Изменить сценарий:

* шаг **Дано** *Открыта Главная страница ДНС*

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

  Сценарий: Просмотр страницы Смартфоны
    Дано Открыта Главная страница ДНС
    Когда Выполнен переход на страницу Смартфоны
    Тогда Проверить: В заголовке страницы отображается текст Смартфоны
```

## 2.2. Снятие скриншотов

Добавим снятие скриншотов до и после каждого шага в хуки.

### 2.2.1. Класс ScreenShotHooks

***ScreenShotHooks*** - класс, который выполняет действия по снятию скриншотов.

Шаги:

1. Создать файл **ScreenShotHooks.java** в **./src/test/java/hooks**.

![New Maven Project - ScreenShotHooks.java](./_Files/2.%20New%20Project/03.jpg "New Project - ScreenShotHooks.java")

2. Добавить в файл **ScreenShotHooks.java** код.

* объявление логгера

```java
// Логгер
private Logger logger = LogManager.getLogger(ScreenShotHooks.class);
```

* метод **takeScreenShotBeforeStep** - действия совершаемые перед каждым шагом

```java

// Действия совершаемые перед каждым шагом
@BeforeStep
public void takeScreenShotBeforeStep(Scenario scenario) {
    // Сделать скриншот видимой области веб страницы
    try {
        Screenshot screenshot = new AShot().takeScreenshot(
            WebDriverFactory.getCurrentDriver());
        String name = scenario.getName() + "-" + Timestamp.from(Instant.now()).getTime() + ".png";
        ImageIO.write(screenshot.getImage(), "png",
            new File("temp\\" + name));
        logger.info("Скриншот сохранен в файле [temp\\" + name + "]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

* метод **takeScreenShotAfterStep** - действия совершаемые после каждого шага

```java
// Действия совершаемые после каждого шага
@AfterStep
public void takeScreenShotAfterStep(Scenario scenario) {
    // Сделать скриншот видимой области веб страницы
    try {
        Screenshot screenshot = new AShot().takeScreenshot(
            WebDriverFactory.getCurrentDriver());
        String name = scenario.getName() + "-" + Timestamp.from(Instant.now()).getTime() + ".png";
        ImageIO.write(screenshot.getImage(), "png",
            new File("temp\\" + name));
        logger.info("Скриншот сохранен в файле [temp\\" + name + "]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

### 2.2.2. Полный код ScreenShotHooks.java

[ScreenShotHooks.java](_Sample_04/src/test/java/hooks/ScreenShotHooks.java)

## 2.3. Запуск тестовых сценариев

Шаги:

1. Открыть **.feature** файл **Smartphone.feature**

2. Запустить сценарий **Просмотр страницы Смартфоны**

3. Получить результаты запуска в консоли

![New Maven Project - Результаты запуска сценария](./_Files/2.%20New%20Project/04.jpg "New Project - Результаты запуска сценария")

4. Проверить сохранение скриншотов в папке **temp**

![New Maven Project - Результаты запуска сценария](./_Files/2.%20New%20Project/05.jpg "New Project - Результаты запуска сценария")

***

# 3. Предыстория

Предыстория это еще один способ вынести общие шаги.
Предыстория выполняется перед каждым сценарием, но после каждого хука идущего перед сценарием.

## 3.1. Фича Smartphone

Добавим новый сценарий

Шаги:

1. Открыть файл **Smartphone.feature** в **./src/test/resources/features**.

2. Добавить сценарий **Фильтрация и сортировка смартфонов на странице Смартфоны**:

* заголовок сценария - **Фильтрация и сортировка смартфонов на странице Смартфоны**

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
  ...
  Сценарий: Фильтрация и сортировка смартфонов на странице Смартфоны
```

* шаги сценария

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
  ...
  Сценарий: Фильтрация и сортировка смартфонов на странице Смартфоны
    Дано Открыта Главная страница ДНС
    Когда Выполнен переход на страницу Смартфоны
    И Установлена сортировка "Сначала дорогие"
    И В фильтре "Производитель" выбрано значение "Samsung"
    И В фильтре "Объем оперативной памяти" выбрано значение "10 Гб"
    И Применены выбранные фильтры
    И Выполнен переход на страницу первого товара из списка
    Тогда Проверить: В заголовке страницы отображается текст "Samsung"
```

## 3.2. Класс SmartphoneSteps

Шаги:

1. Открыть файл **SmartphoneSteps.java** в **./src/test/java/steps**.

2. Добавить в файл **SmartphoneSteps.java** код.

* метод **setSortBy** - шаг **И** *Установлена сортировка {string}*

```java
@И("Установлена сортировка {string}")
public void setSortBy(String sortBy) {
    smartphonesPage.accordeonSort().show();
    smartphonesPage.radioButtonSort(sortBy).setSelected(true);
    logger.info("Установлена сортировка" + sortBy);
}
```

* метод **setFilterBy** - шаг **И** *В фильтре {string} выбрано значение {string}*

```java
@И("В фильтре {string} выбрано значение {string}")
public void setFilterBy(String filterBy, String value) {
    JavaScriptHelper.scrollBy(0,400);
    switch (filterBy) {
        case "Производитель":
            smartphonesPage.checkBoxCompany(value).setChecked(true);
            break;
        case "Объем оперативной памяти":
            smartphonesPage.accordeonRAM().show();
            smartphonesPage.checkBoxRAM(value).setChecked(true);
            break;
    }
    logger.info("В фильтре " + filterBy + " выбрано значение " + value);
}
```

* метод **applyFilters** - шаг **И** *Применены выбранные фильтры*

```java
@И("Применены выбранные фильтры")
public void applyFilters() {
    JavaScriptHelper.scrollBy(0,400);
    smartphonesPage.buttonApply().click();
    logger.info("Применены выбранные фильтры");
}
```

* метод **selectFirstSmartphone** - шаг **И** *Выполнен переход на страницу первого товара из списка*

```java
@И("Выполнен переход на страницу первого товара из списка")
public void selectFirstSmartphone() {
    JavaScriptHelper.scrollBy(0, -600);
    smartphonesPage.linkFirstProduct().click();
    logger.info("Выполнен переход на страницу первого товара из списка");
}
```

* метод **assertTitleSmartphoneProduct** - шаг **Тогда** *Проверить: В заголовке страницы отображается текст {string}*

```java
@Тогда("Проверить: В заголовке страницы отображается текст {string}")
public void assertTitleSmartphoneProduct(String company) {
    // Проверка заголовка страницы
    logger.info("Проверка заголовка страницы");
    Assertions.assertTrue(smartphoneProductPage.getPageTitle().contains(company), "В заголовке страницы не отображается текст " + company);
}
```

## 3.3. Запуск всех тестовых сценариев

Шаги:

1. Открыть **.feature** файл **Smartphone.feature**

2. Запустить все сценарии

3. Получить результаты запуска в консоли

## 3.4. Фича Smartphone. Добавление Предыстории

Как видим у двух сценариев есть общие шаги - это контекст, который можно вынести за сценарии.

Шаги:

1. Открыть файл **Smartphone.feature** в **./src/test/resources/features**.

2. Изменить сценарий:

* предыстория

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

  Предыстория:
    Дано Открыта Главная страница ДНС
    И Выполнен переход на страницу Смартфоны
```

* сценарии


```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

  Предыстория:
    Дано Открыта Главная страница ДНС
    И Выполнен переход на страницу Смартфоны

  Сценарий: Просмотр страницы Смартфоны
    Тогда Проверить: В заголовке страницы отображается текст Смартфоны

  Сценарий: Фильтрация и сортировка смартфонов на странице Смартфоны
    Дано Установлена сортировка "Сначала дорогие"
    И В фильтре "Производитель" выбрано значение "Samsung"
    И В фильтре "Объем оперативной памяти" выбрано значение "8 Гб"
    Когда Применены выбранные фильтры
    И Выполнен переход на страницу первого товара из списка
    Тогда Проверить: В заголовке страницы отображается текст "Samsung"
```

## 3.5. Запуск всех тестовых сценариев

Шаги:

1. Открыть **.feature** файл **Smartphone.feature**

2. Запустить все сценарии

3. Получить результаты запуска в консоли (результаты такие же как и в п 3.3.)

***

# 4. Структура сценария

А что если мы захотим для второго сценария прогнать кейсы с другими параметрами фильтрации.
Для этого есть Структура сценария, которая позволяет запускать параметризованные тесты (Data Driven Testing)

## 4.1. Фича Smartphone. Добавление Структуры сценария

Шаги:

1. Открыть файл **Smartphone.feature** в **./src/test/resources/features**.

2. Изменить сценарий:

* структура сценария

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
  ...
  Структура сценария: Фильтрация и сортировка смартфонов на странице Смартфоны
```

* заменить значения параметрами

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
  ...
  Структура сценария: Фильтрация и сортировка смартфонов на странице Смартфоны
    Дано Установлена сортировка <sortBy>
    И В фильтре <filterBy1> выбрано значение <value1>
    И В фильтре <filterBy2> выбрано значение <value2>
    Когда Применены выбранные фильтры
    И Выполнен переход на страницу первого товара из списка
    Тогда Проверить: В заголовке страницы отображается текст <value1>
```

* добавить таблицу с примерами

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

  Предыстория:
    Дано Открыта Главная страница ДНС
    И Выполнен переход на страницу Смартфоны

  Сценарий: Просмотр страницы Смартфоны
    Тогда Проверить: В заголовке страницы отображается текст Смартфоны

  Структура сценария: Фильтрация и сортировка смартфонов на странице Смартфоны
    Дано Установлена сортировка <sortBy>
    И В фильтре <filterBy1> выбрано значение <value1>
    И В фильтре <filterBy2> выбрано значение <value2>
    Когда Применены выбранные фильтры
    И Выполнен переход на страницу первого товара из списка
    Тогда Проверить: В заголовке страницы отображается текст <value1>
    Примеры:
      | sortBy               | filterBy1       | value1    | filterBy2                  | value2 |
      | "Сначала дорогие"    | "Производитель" | "Samsung" | "Объем оперативной памяти" | "8 Гб" |
      | "Сначала популярные" | "Производитель" | "Samsung" | "Объем оперативной памяти" | "8 Гб" |
      | "Сначала популярные" | "Производитель" | "Apple"   | "Объем оперативной памяти" | "6 Гб" |
      | "По наименованию"    | "Производитель" | "Xiaomi"  | "Объем оперативной памяти" | "4 Гб" |
```

## 4.2. Запуск тестовых сценариев

Шаги:

1. Открыть **.feature** файл **Smartphone.feature**

2. Запустить сценарии **Фильтрация и сортировка смартфонов на странице Смартфоны**

3. Получить результаты запуска в консоли.

***

# 5. Таблицы

На практике часто намного читабельнее выглядят табличные данные, чем просто передаваемые параметры.
В **Cucumber** встроена возможность по работе с таблицами - программно они представляют собой разные объекты.
В одном случае это **List** в другом это **Map**.

## 5.1. Таблица с одной колонкой List<String>

### 5.1.1. Фича Smartphone

Шаги:

1. Открыть файл **Smartphone.feature** в **./src/test/resources/features**.

2. Добавить сценарий:

* заголовок сценария - **Таблица с одной колонкой**

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
  ...
  Сценарий: Таблица с одной колонкой
```

* шаг с использованием таблицы с одной колонкой

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
  ...
  Сценарий: Таблица с одной колонкой
    Дано Установлена сортировка "Сначала дорогие"
    И Установлены фильтры из таблицы с одной колонкой
      | Samsung |
      | 8 Гб    |
```

* остальные шаги

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
  ...
  Сценарий: Таблица с одной колонкой
    Дано Установлена сортировка "Сначала дорогие"
    И Установлены фильтры из таблицы с одной колонкой
      | Samsung |
      | 8 Гб    |
    Когда Применены выбранные фильтры
    И Выполнен переход на страницу первого товара из списка
    Тогда Проверить: В заголовке страницы отображается текст "Samsung"
```

### 5.1.2. Класс SmartphoneSteps

Шаги:

1. Открыть файл **SmartphoneSteps.java** в **./src/test/java/steps**.

2. Добавить в файл **SmartphoneSteps.java** код.

* метод **setFiltersFromTable1** - шаг **И** *Установлены фильтры из таблицы с одной колонкой*

```java
@И("Установлены фильтры из таблицы с одной колонкой")
public void setFiltersFromTable1(List<String> filters) {
    Smartphone smartphone = new Smartphone(
        new Ram(Integer.parseInt(filters.get(1).split(" ")[0])),
        new Company(filters.get(0)));
    JavaScriptHelper.scrollBy(0,400);
    smartphonesPage.checkBoxCompany(smartphone.getCompany().getCompany()).setChecked(true);
    JavaScriptHelper.scrollBy(0,400);
    smartphonesPage.accordeonRAM().show();
    smartphonesPage.checkBoxRAM(smartphone.getRam().getRam() + " Гб").setChecked(true);
}
```

## 5.1.3. Запуск тестовых сценариев

Шаги:

1. Открыть **.feature** файл **Smartphone.feature**

2. Запустить сценарии **Таблица с одной колонкой**

3. Получить результаты запуска в консоли.

# 5.2. Таблица с двумя колонками Map<String, String>

### 5.2.1. Фича Smartphone

Шаги:

1. Открыть файл **Smartphone.feature** в **./src/test/resources/features**.

2. Добавить сценарий:

* заголовок сценария - **Таблица с двумя колонками**

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
  ...
  Сценарий: Таблица с двумя колонками
```

* шаг с использованием таблицы с двумя колонками

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
  ...
  Сценарий: Таблица с двумя колонками
    Дано Установлена сортировка "Сначала дорогие"
    И Установлены фильтры из таблицы с двумя колонками
      | Производитель            | Samsung |
      | Объем оперативной памяти | 8 Гб    |
```

* остальные шаги

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
  ...
  Сценарий: Таблица с двумя колонками
    Дано Установлена сортировка "Сначала дорогие"
    И Установлены фильтры из таблицы с двумя колонками
      | Производитель            | Samsung |
      | Объем оперативной памяти | 8 Гб    |
    Когда Применены выбранные фильтры
    И Выполнен переход на страницу первого товара из списка
    Тогда Проверить: В заголовке страницы отображается текст "Samsung"
```

### 5.2.2. Класс SmartphoneSteps

Шаги:

1. Открыть файл **SmartphoneSteps.java** в **./src/test/java/steps**.

2. Добавить в файл **SmartphoneSteps.java** код.

* метод **setFiltersFromTable2** - шаг **И** *Установлены фильтры из таблицы с двумя колонками*

```java
@И("Установлены фильтры из таблицы с одной колонкой")
public void setFiltersFromTable2(Map<String, String> filters) {
    Smartphone smartphone = new Smartphone(
        new Ram(Integer.parseInt(filters.get("Объем оперативной памяти").split(" ")[0])),
        new Company(filters.get("Производитель")));
    JavaScriptHelper.scrollBy(0,400);
    smartphonesPage.checkBoxCompany(smartphone.getCompany().getCompany()).setChecked(true);
    JavaScriptHelper.scrollBy(0,400);
    smartphonesPage.accordeonRAM().show();
    smartphonesPage.checkBoxRAM(smartphone.getRam().getRam() + " Гб").setChecked(true);
}
```

## 5.2.3. Запуск тестовых сценариев

Шаги:

1. Открыть **.feature** файл **Smartphone.feature**

2. Запустить сценарии **Таблица с двумя колонками**

3. Получить результаты запуска в консоли.

## 5.3. Таблица со множеством колонок DataTable

### 5.2.1. Фича Smartphone

Шаги:

1. Открыть файл **Smartphone.feature** в **./src/test/resources/features**.

2. Добавить сценарий:

* заголовок сценария - **Таблица с тремя колонками**

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
  ...
  Сценарий: Таблица с тремя колонками
```

* шаг с использованием таблицы с тремя колонками

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
  ...
  Сценарий: Таблица с тремя колонками
    Дано Установлена сортировка и фильтры из таблицы с тремя колонками
      | Сортировка      | Производитель | Объем оперативной памяти |
      | Сначала дорогие | Samsung       | 8 Гб                     |
```

* остальные шаги

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
  ...
  Сценарий: Таблица с тремя колонками
    Дано Установлена сортировка и фильтры из таблицы с тремя колонками
      | Сортировка      | Производитель | Объем оперативной памяти |
      | Сначала дорогие | Samsung       | 8 Гб                     |
    Когда Применены выбранные фильтры
    И Выполнен переход на страницу первого товара из списка
    Тогда Проверить: В заголовке страницы отображается текст "Samsung"
```

### 5.2.2. Класс SmartphoneSteps

Шаги:

1. Открыть файл **SmartphoneSteps.java** в **./src/test/java/steps**.

2. Добавить в файл **SmartphoneSteps.java** код.

* метод **setFiltersAndSortFromTanle3** - шаг **И** *Установлена сортировка и фильтры из таблицы с тремя колонками*

```java
@Дано("Установлена сортировка и фильтры из таблицы с тремя колонками")
public void setFiltersAndSortFromTable3(DataTable dataTable) {
    List<Map<String, String>> table = dataTable.asMaps(String.class, String.class);
    String sortBy = table.get(0).get("Сортировка");
    String filterByCompany = table.get(0).get("Производитель");
    String filterByRam = table.get(0).get("Объем оперативной памяти");

    smartphonesPage.accordeonSort().show();
    smartphonesPage.radioButtonSort(sortBy).setSelected(true);
    Smartphone smartphone = new Smartphone(
        new Ram(Integer.parseInt(filterByRam.split(" ")[0])),
        new Company(filterByCompany));
    JavaScriptHelper.scrollBy(0,400);
    smartphonesPage.checkBoxCompany(smartphone.getCompany().getCompany()).setChecked(true);
    JavaScriptHelper.scrollBy(0,400);
    smartphonesPage.accordeonRAM().show();
    smartphonesPage.checkBoxRAM(smartphone.getRam().getRam() + " Гб").setChecked(true);
}
```

## 5.2.3. Запуск тестовых сценариев

Шаги:

1. Открыть **.feature** файл **Smartphone.feature**

2. Запустить сценарии **Таблица с тремя колонками**

3. Получить результаты запуска в консоли.

***

# 6. Теги

## 6.1. Фича Smartphone

Пометим сценарии тегами.
Тегирование во многих отношениях мощная штука.
С помощью тегов:
* можно настроить разные наборы тестов для запуска
* можно выполнять поиск в отчете по запуску
* можно классифицировать тесты по функциям и т д

Шаги:

1. Открыть файл **Smartphone.feature** в **./src/test/resources/features**.

2. Изменить сценарии:

* сценарий **Таблица с одной колонкой** - тег **@table1**

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

  ...
  
  @table1  
  Сценарий: Таблица с одной колонкой
    Дано Установлена сортировка "Сначала дорогие"
    И Установлены фильтры из таблицы с одной колонкой
    | Samsung |
    | 8 Гб    |
    Когда Применены выбранные фильтры
    И Выполнен переход на страницу первого товара из списка
    Тогда Проверить: В заголовке страницы отображается текст "Samsung"
```

* сценарий **Таблица с двумя колонками** - тег **@table2**

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

  ...
  
  @table2
    Сценарий: Таблица с двумя колонками
    Дано Установлена сортировка "Сначала дорогие"
    И Установлены фильтры из таблицы с двумя колонками
    | Производитель            | Samsung |
    | Объем оперативной памяти | 8 Гб    |
    Когда Применены выбранные фильтры
    И Выполнен переход на страницу первого товара из списка
    Тогда Проверить: В заголовке страницы отображается текст "Samsung"
```

* сценарий **Таблица с тремя колонками** - тег **@table3**

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

  ...

  @table3
  Сценарий: Таблица с тремя колонками
    Дано Установлена сортировка и фильтры из таблицы с тремя колонками
      | Сортировка      | Производитель | Объем оперативной памяти |
      | Сначала дорогие | Samsung       | 8 Гб                     |
    Когда Применены выбранные фильтры
    И Выполнен переход на страницу первого товара из списка
    Тогда Проверить: В заголовке страницы отображается текст "Samsung"
```

## 6.2. Класс SmartphoneSteps

Добавим вывод в лог текста, с помощью которого будем различать сценарии.

Шаги:

1. Открыть файл **SmartphoneSteps.java** в **./src/test/java/steps**.

2. Изменить в файле **SmartphoneSteps.java** код.

* метод **setFiltersFromTable1** - шаг **И** *Установлены фильтры из таблицы с одной колонкой*

```java
@И("Установлены фильтры из таблицы с одной колонкой")
public void setFiltersFromTable1(List<String> filters) {
    Smartphone smartphone = new Smartphone(
        new Ram(Integer.parseInt(filters.get(1).split(" ")[0])),
        new Company(filters.get(0)));
    JavaScriptHelper.scrollBy(0,400);
    smartphonesPage.checkBoxCompany(smartphone.getCompany().getCompany()).setChecked(true);
    JavaScriptHelper.scrollBy(0,400);
    smartphonesPage.accordeonRAM().show();
    smartphonesPage.checkBoxRAM(smartphone.getRam().getRam() + " Гб").setChecked(true);

    logger.info("***** Установлены фильтры из таблицы с одной колонкой");
}
```

* метод **setFiltersFromTable2** - шаг **И** *Установлены фильтры из таблицы с двумя колонками*

```java
@И("Установлены фильтры из таблицы с двумя колонками")
public void setFiltersFromTable2(Map<String, String> filters) {
    Smartphone smartphone = new Smartphone(
        new Ram(Integer.parseInt(filters.get("Объем оперативной памяти").split(" ")[0])),
        new Company(filters.get("Производитель")));
    JavaScriptHelper.scrollBy(0,400);
    smartphonesPage.checkBoxCompany(smartphone.getCompany().getCompany()).setChecked(true);
    JavaScriptHelper.scrollBy(0,400);
    smartphonesPage.accordeonRAM().show();
    smartphonesPage.checkBoxRAM(smartphone.getRam().getRam() + " Гб").setChecked(true);
        
    logger.info("***** Установлены фильтры из таблицы с двумя колонками");
}
```

* метод **setFiltersAndSortFromTaиle3** - шаг **Дано** *Установлена сортировка и фильтры из таблицы с тремя колонками*

```java
@Дано("Установлена сортировка и фильтры из таблицы с тремя колонками")
public void setFiltersAndSortFromTable3(DataTable dataTable) {
    List<Map<String, String>> table = dataTable.asMaps(String.class, String.class);
    String sortBy = table.get(0).get("Сортировка");
    String filterByCompany = table.get(0).get("Производитель");
    String filterByRam = table.get(0).get("Объем оперативной памяти");

    smartphonesPage.accordeonSort().show();
    smartphonesPage.radioButtonSort(sortBy).setSelected(true);
    Smartphone smartphone = new Smartphone(
        new Ram(Integer.parseInt(filterByRam.split(" ")[0])),
        new Company(filterByCompany));
    JavaScriptHelper.scrollBy(0,400);
    smartphonesPage.checkBoxCompany(smartphone.getCompany().getCompany()).setChecked(true);
    JavaScriptHelper.scrollBy(0,400);
    smartphonesPage.accordeonRAM().show();
    smartphonesPage.checkBoxRAM(smartphone.getRam().getRam() + " Гб").setChecked(true);
        
    logger.info("***** Установлена сортировка и фильтры из таблицы с тремя колонками");
}
```

## 6.3. Запуск тестовых сценариев

Шаги:

1. Открыть **.feature** файл **Smartphone.feature**

2. Запустить сценарии с тегом **@table1**

```shell
mvn clean test -Dcucumber.filter.tags=@table1
```

3. Получить результаты запуска в консоли - запуститься только сценарий помеченный тегом @table1.

4. Запустить сценарии с тегом **@table2**

```shell
mvn clean test -Dcucumber.filter.tags=@table2
```

5. Получить результаты запуска в консоли - запуститься только сценарий помеченный тегом @table2.

6. Запустить сценарии с тегом **@table3**

```shell
mvn clean test -Dcucumber.filter.tags=@table3
```

7. Получить результаты запуска в консоли - запуститься только сценарий помеченный тегом @table3.

***

# 7. Опции запуска

## 7.1. Настройка через аннотацию @CucumberOptions для JUnit 4

### 7.1.1. Класс RunCucumberTest

Данная аннотация используется совместно с раннер классом, чтобы соощить **Cucumber** как запускать сценарии

Шаги:

1. Открыть файл **RunCucumberTest.java** в **./src/test/java**

2. Добавить опции:

* *features* - список папок с feature файлами - фичи/сценарии

```java
// @RunWith
// Указание класса для запуска тестов
@RunWith(Cucumber.class)
// @CucumberOptions
// Указание опции для запуска сценариев
@CucumberOptions(
        // Список папок с feature файлами - фичи/сценарии
        features = {"src/test/resources/features"},
)
```

* *glue* - список пакетов с файлами **.java**, в которых реализации шагов и хуков

```java
// @RunWith
// Указание класса для запуска тестов
@RunWith(Cucumber.class)
// @CucumberOptions
// Указание опции для запуска сценариев
@CucumberOptions(
        // Список папок с feature файлами - фичи/сценарии
        features = {"src/test/resources/features"},
        // Спиcок пакетов с steps файлами - шаги
        glue = {"steps", "hooks"},
)
```

* *tags* - список тегов запускаемых сценариев

```java
// @RunWith
// Указание класса для запуска тестов
@RunWith(Cucumber.class)
// @CucumberOptions
// Указание опции для запуска сценариев
@CucumberOptions(
        // Список папок с feature файлами - фичи/сценарии
        features = {"src/test/resources/features"},
        // Спиcок пакетов с steps файлами - шаги
        glue = {"steps", "hooks"},
        // Спиcок тегов запускаемых сценариев
        tags = "@table1",
)
```

* *stepNotifications* - вывод шагов в окне запуска

```java
// @RunWith
// Указание класса для запуска тестов
@RunWith(Cucumber.class)
// @CucumberOptions
// Указание опции для запуска сценариев
@CucumberOptions(
        // Список папок с feature файлами - фичи/сценарии
        features = {"src/test/resources/features"},
        // Спиcок пакетов с steps файлами - шаги
        glue = {"steps", "hooks"},
        // Спиcок тегов запускаемых сценариев
        tags = "@table1",
        // Вывод шагов в окне запуска
        stepNotifications = false
)
```

### 7.1.2. Запуск тестовых сценариев

Шаги:

1. Запустить сценарии

```shell
mvn clean test
```

2. Получить результаты запуска в консоли - запуститься только сценарий помеченный тегом @table1 (из **@CucumberOptions**).

3. Запустить сценарии с тегом **@table2**

```shell
mvn clean test -Dcucumber.filter.tags=@table2
```

4. Получить результаты запуска в консоли - запуститься только сценарий помеченный тегом @table2 (из **@CucumberOptions** значение не будет приниматься).

## 7.2. Опции из cucumber.properties

### 7.2.1. Файл cucumber.properties

Шаги:

1. Создать файл **cucumber.properties** в **src/test/resources**

2. Добавить в файл опции

```properties
cucumber.features=src/test/resources/features
cucumber.glue=steps, hooks
cucumber.filter.tags=@table2
```

### 7.2.2. Класс RunCucumberTest

Шаги:

1. Открыть файл **RunCucumberTest.java** в **./src/test/java**

2. Закомментить все опции:


```java
// @RunWith
// Указание класса для запуска тестов
@RunWith(Cucumber.class)
// @CucumberOptions
// Указание опции для запуска сценариев
@CucumberOptions(
        // Список папок с feature файлами - фичи/сценарии
        //features = {"src/test/resources/features"},
        // Спиcок пакетов с steps файлами - шаги
        //glue = {"steps", "hooks"},
        // Спиcок тегов запускаемых сценариев
        //tags = "@table1",
        // Вывод шагов в окне запуска
        //stepNotifications = false
)
```

### 7.2.3. Запуск тестовых сценариев

Шаги:

1. Запустить сценарии

```shell
mvn clean test
```

2. Получить результаты запуска в консоли - запуститься только сценарий помеченный тегом @table2 (из **cucumber.properties**).

3. Запустить сценарии с тегом **@table2**

```shell
mvn clean test -Dcucumber.filter.tags=@table1
```

4. Получить результаты запуска в консоли - запуститься только сценарий помеченный тегом @table1 (из **cucumber.properties** значение не будет приниматься).

## 7.3. Опции из junit-platform.properties для JUnit 5

### 7.3.1. Файл POM.xml

Шаги:

1. Открыть файл **POM.xml**

2. Добавить новую зависимость **cucumber-junit-platform-engine**

```xml
<dependency>
    <groupId>io.cucumber</groupId>
    <artifactId>cucumber-junit-platform-engine</artifactId>
    <version>${cucumber}</version>
    <scope>test</scope>
</dependency>
```

### 7.3.2. Файл junit-platform.properties

Шаги:

1. Создать файл **junit-platform.properties** в **src/test/resources**

2. Добавить в файл опции

```properties
cucumber.features=src/test/resources/features
cucumber.glue=steps, hooks
cucumber.filter.tags=@table3
```

### 7.3.3. Файл RunCucumberJUnit5Test

***RunCucumberJUnit5Test*** - класс для запуска сценариев с **JUnit5** и **junit-platform.properties**.

Шаги:

1. Создать файл **RunCucumberJUnit5Test.java** в **./src/test/java**.

2. Добавить в файл **RunCucumberJUnit5Test.java** код.

* указание класса для запуска тестов

```java
// @Cucumber
// Указание класса для запуска тестов
@Cucumber
public class RunCucumberJUnit5Test {
}
```

### 7.3.4. Файл cucumber.properties

Шаги:

1. Открыть файл **cucumber.properties** в **src/test/resources**

2. Закомментить все опции:

```properties
#cucumber.features=src/test/resources/features
#cucumber.glue=steps, hooks
#cucumber.filter.tags=@table2
```

### 7.3.5. Запуск тестовых сценариев

Шаги:

1. Открыть файл **RunCucumberJUnit5Test.java** в **./src/test/java**.

2. Запустить сценарии нажатием кнопки запуска |>|> рядом с объявлением класса

3. Получить результаты запуска в консоли - запуститься только сценарий помеченный тегом @table3 (из **junit-platform.properties**).

***

# 8. Отчеты

После прогона автотестов хочется иметь какой то отчет для анализа результатов.
В **Cucumber** встроена такая возможность из коробки.
Для этого всего лишь нужно подключить нужный плагин в настройках.

## 8.1. Плагин html

### 8.1.1. Файл cucumber.properties

Шаги:

1. Открыть файл **cucumber.properties** в **src/test/resources**

2. Раскомментить все опции:

```properties
cucumber.features=src/test/resources/features
cucumber.glue=steps, hooks
cucumber.filter.tags=@table2
```

3. Добавить подключения плагина **html**

```properties
cucumber.plugin=html:target/cucumber-reports/report.html
```

### 8.1.2. Запуск тестовых сценариев

Шаги:

1. Запустить сценарии

```shell
mvn clean test
```

2. Получить результаты запуска в консоли - запуститься только сценарий помеченный тегом @table2 (из **cucumber.properties**).

### 8.1.3. Просмотр отчета

Шаги:

1. Перейти в папку сборки **target/cucumber-reports**

2. Открыть файл **report.html**

3. Ознакомиться с отчетом по запуску сценариев

4. Попробуйте зафейлить сценарий с помощью некорректных тестовых данных и снова посмотрите результат

## 8.2. Плагин json

### 8.2.1. Файл cucumber.properties

Шаги:

1. Открыть файл **cucumber.properties** в **src/test/resources**

2. Изменить плагин на **json**

```properties
cucumber.plugin=json:target/cucumber-reports/report.json
```

### 8.2.2. Запуск тестовых сценариев

Шаги:

1. Запустить сценарии

```shell
mvn clean test
```

2. Получить результаты запуска в консоли - запуститься только сценарий помеченный тегом @table2 (из **cucumber.properties**).

### 8.2.3. Просмотр отчета

Шаги:

1. Перейти в папку сборки **target/cucumber-reports**

2. Открыть файл **report.json**

3. Ознакомиться с отчетом по запуску сценариев

4. Попробуйте зафейлить сценарий с помощью некорректных тестовых данных и снова посмотрите результат

***

[![Лекция](https://img.shields.io/badge/-Лекция-ee99ff)](1.%20Лекция.md)
[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Задание](https://img.shields.io/badge/-Задание-99ffee)](3.%20Задание.md)