Java_QA / 03. Selenium WebDriver. Конфигурация

[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Практика](https://img.shields.io/badge/-Практика-aaffaa)](2.%20Практика.md)

***

# Содержание

* [1. Selenium WebDriver](#1-selenium-webdriver)
* [2. Драйвер браузера](#2-драйвер-браузера)
  * [2.1. Куда положить исполняемый файл?](#21-куда-положить-исполняемый-файл)
  * [2.2. Как прописать путь до файла?](#22-как-прописать-путь-до-файла)
* [3. Управление исполняемым файлом браузера](#3-управление-исполняемым-файлом-браузера)
  * [3.1. Класс DriverService](#31-класс-driverservice)
    * [3.1.1. Класс ChromeDriverService](#311-класс-chromedriverservice)
    * [3.1.2. Класс EdgeDriverService](#312-класс-edgedriverservice)
    * [3.1.3. Класс InternetExplorerDriverService](#313-класс-internetexplorerdriverservice)
    * [3.1.4. Класс FirefoxDriverService](#314-класс-firefoxdriverservice)
    * [3.1.5. Класс GeckoDriverService](#315-класс-geckodriverservice)
    * [3.1.6. Класс OperaDriverService](#316-класс-operadriverservice)
  * [3.2. Класс DriverService.Builder](#32-класс-driverservicebuilder)
    * [3.2.1. Класс ChromeDriverService.Builder](#321-класс-chromedriverservicebuilder)
    * [3.2.2. Класс EdgeDriverService.Builder](#322-класс-edgedriverservicebuilder)
    * [3.2.3. Класс InternetExplorerDriverService.Builder](#323-класс-internetexplorerdriverservicebuilder)
    * [3.2.4. Класс FirefoxDriverService.Builder](#324-класс-firefoxdriverservicebuilder)
    * [3.2.5. Класс GeckoDriverService.Builder](#325-класс-geckodriverservicebuilder)
    * [3.2.6. Класс OperaDriverService.Builder](#326-класс-operadriverservicebuilder)
  * [3.3. Совместимость драйверов и браузеров](#33-совместимость-драйверов-и-браузеров)
    * [3.3.1. Совместимость драйверов браузера Google Chrome](#331-совместимость-драйверов-браузера-google-chrome)
    * [3.3.2. Совместимость драйверов браузера Microsoft Edge](#332-совместимость-драйверов-браузера-microsoft-edge)
    * [3.3.3. Совместимость драйверов браузера Microsoft Internet Explorer](#333-совместимость-драйверов-браузера-microsoft-internet-explorer)
    * [3.3.4. Совместимость драйверов браузера Mozilla Firefo](#334-совместимость-драйверов-браузера-mozilla-firefox)
    * [3.3.5. Совместимость драйверов браузера Apple Safari](#335-совместимость-драйверов-браузера-apple-safari)
    * [3.3.6. Совместимость драйверов браузера Opera](#336-совместимость-драйверов-браузера-opera)
* [3. Библиотека WebDriverManager](#3-библиотека-webdrivermanager)
* [4. Клиентская библиотека Java](#4-клиентская-библиотека-java)
  * [4.1. Интерфейс WebDriver](#41-интерфейс-webdriver)
  * [4.2. Основные команды](#42-основные-команды)
    * [4.2.1. Открытие и закрытие браузера](#421-открытие-и-закрытие-браузера)
    * [4.2.2. Получение свойств текущей страницы](#422-получение-свойств-текущей-страницы)
    * [4.2.3. Поиск веб элементов](#423-поиск-веб-элементов)
    * [4.2.4. Свойства и настройки браузера](#424-свойства-и-настройки-браузера)
    * [4.2.5. Навигация по истории браузера](#425-навигация-по-истории-браузера)
    * [4.2.6. Переходы по вкладкам и окнам браузера](#426-переходы-по-вкладкам-и-окнам-браузера)
* [5. Инициализация экземпляра WebDriver](#5-инициализация-экземпляра-webdriver)
  * [5.1. Инициализация ChromiumDriver (Chromium)](#51-инициализация-chromiumdriver-chromium)
  * [5.2. Инициализация ChromeDriver (Google Chrome)](#52-инициализация-chromedriver-google-chrome)
  * [5.3. Инициализация EdgeDriver (Microsoft Edge)](#53-инициализация-edgedriver-microsoft-edge)
  * [5.4. Инициализация InternetExplorerDriver (Microsoft Internet Explorer)](#54-инициализация-internetexplorerdriver-microsoft-internet-explorer)
  * [5.5. Инициализация FirefoxDriver (Mozilla Firefox)](#55-инициализация-firefoxdriver-mozilla-firefox)
  * [5.6. Инициализация OperaDriver (Opera)](#56-инициализация-operadriver-opera)
* [6. Паттерн WebDriverFactory](#6-паттерн-webdriverfactory)
* [7. Зачем нужно конфигурировать браузер при старте?](#7-зачем-нужно-конфигурировать-браузер-при-старте)
* [8. Общие настройки](#8-общие-настройки)
  * [8.1. Интерфейс WebDriver.Options](#81-интерфейс-webdriveroptions)
  * [8.2. Куки](#82-куки)
  * [8.3. Логи](#83-логи)
  * [8.4. Ожидания](#84-ожидания)
  * [8.5. Окна браузера](#85-окна-браузера)
* [9. Специфичные настройки](#9-специфичные-настройки)
  * [9.1. Интерфейс Capabilities](#91-интерфейс-capabilities)
  * [9.2. Класс MutableCapabilities](#92-класс-mutablecapabilities)
  * [9.3. Класс ImmutableCapabilities](#93-класс-immutablecapabilities)
  * [9.4. Класс DesiredCapabilities](#94-класс-desiredcapabilities)
  * [9.5. Интерфейс CapabilityType](#95-интерфейс-capabilitytype)
  * [9.6. Класс AbstractDriverOptions](#96-класс-abstractdriveroptions)
    * [9.6.1. Класс ChromiumOptions](#961-класс-chromiumoptions)
    * [9.6.2. Класс ChromeOptions](#962-класс-chromeoptions)
    * [9.6.3. Класс EdgeOptions](#963-класс-edgeoptions)
    * [9.6.4. Класс FirefoxOptions](#964-класс-firefoxoptions)
    * [9.6.5. Класс OperaOptions](#965-класс-operaoptions)
  * [9.7. Перечисление Platform](#97-перечисление-platform)
* [10. Запуск с куками и без](#10-запуск-с-куками-и-без)
  * [10.1. Что такое куки?](#101-что-такое-куки)
    * [10.1.1. Для чего нужны куки?](#1011-для-чего-нужны-куки)
    * [10.1.2. Каких видов бывают куки?](#1012-каких-видов-бывают-куки)
    * [10.1.3. Какие параметры есть у куки?](#1013-какие-параметры-есть-у-куки)
    * [10.1.4. Как работают cookie?](#1014-как-работают-cookie)
  * [10.2. Зачем запускать браузер с cookie?](#102-зачем-запускать-браузер-с-cookie)
  * [10.3. Класс Cookie](#103-класс-cookie)
  * [10.4. Работа с куками](#104-работа-с-куками)
    * [10.4.1. Добавление куки](#1041-добавление-куки)
    * [10.4.2. Удаление всех cookie из браузера](#1042-удаление-всех-cookie-из-браузера)
    * [10.4.3. Удаление cookie из браузера](#1043-удаление-cookie-из-браузера)
    * [10.4.4. Удаление cookie по имени](#1044-удаление-cookie-по-имени)
    * [10.4.5. Получение cookie по имени](#1045-получение-cookie-по-имени)
    * [10.4.6. Получение всех cookie](#1046-получение-всех-cookie)
  * [10.5. Исключения](#105-исключения)
    * [10.5.1. InvalidCookieDomainException](#1051-invalidcookiedomainexception)
      * [10.5.1.1. Причины](#10511-причины)
      * [10.5.1.2. Решения](#10512-решения)
    * [10.5.2. UnableToSetCookieException](#1052-unabletosetcookieexception)
      * [10.5.2.1. Причины](#10521-причины)
      * [10.5.2.2. Решения](#10522-решения)

***

# 1. Драйвер браузера

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

***Драйвер браузера*** - специально написанная программа, 
которая предоставляет определенный набор команд для управления браузером извне.

Драйвер на самом деле является веб сервером, который запускает браузер 
и отправляет ему запросы на исполнение определенных действий пользователя, а также закрывает его. 

У каждого браузера свой драйвер, так как у каждого браузера свои отличные команды управления, 
и реализованы они по-своему. Но все драйверы предоставляют единый внешний интерфейс 
(одинаковый набор команд для управления драйвером) по протоколу, который описан в стандарте W3C.
Каждый драйвер разрабатывает производитель браузера. 

![Архитектура Selenium WebDriver](_Files/1.%20Selenium%20WebDriver/01.jpg)

Драйвер браузера поставляется в виде исполняемого файла.

## 1.1. Куда положить исполняемый файл драйвера браузера?

* в директорию, которая включена в переменную среды **%PATH%**
* в рабочую или текущую директорию (требуется указать путь до файла)
* в любое другое место (требуется указать путь до файла)

> Если же, используется **WebDriverManager**, то делать этого не нужно.

## 1.2. Как прописать путь до исполняемого файла драйвера браузера?

Если файл находится не в директории, которая включена в переменную среды **%PATH%**, 
то для того чтобы можно было взаимодействовать с драйвером браузера, необходимо прописать путь до исполняемого файла.

Сделать можно это двумя способами.

* вызвать метод **System.setProperty()** до вызова конструктора драйвера

```java
System.setProperty("webdriver.ie.driver", "src/test/resources/drivers/IEDriverServer.exe");
```

* использовать класс **DriverService** и **DriverService.Builder**, указав в **usingDriverExecutable()** путь до исполняемого файла

***

# 2. Управление исполняемым файлом драйвера браузера

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

## 2.1. Класс DriverService 

***DriverService*** - класс для управления исполняемым файлом драйвера браузера.

Методы класса **DriverService**:

| Тип                    | Метод                                                                  | Описание                               | 
|------------------------|------------------------------------------------------------------------|----------------------------------------|
| protected static void  | checkExecutable(File exe)                                              | Проверка наличия исполняемого файла    |
| void                   | close()                                                                |                                        |
| protected static File  | findExecutable(String name, String prop, String docs, String download) | Поиск исполняемого файла               |
| protected List<String> | getArgs()                                                              | Получение параметров запуска сервиса   |
| protected Map<String>  | getEnvironment()                                                       | Получение среды запуска сервиса        |
| protected OutputStream | getOutputStream()                                                      |                                        |
| protected Duration     | getTimeout()                                                           | Получение таймаута запуска сервиса     |
| URL                    | getUrl()                                                               | Получение URL                          |
| protected URL          | getUrl(int port)                                                       | Получение URL                          |
| protected boolean      | hasShutdownEndpoint()                                                  | Проверка остановки сервиса             |
| boolean                | isRunning()                                                            | Проверка запуска сервиса               |
| void                   | sendOutputTo (OutputStream outputStream)                               |                                        |
| void                   | start()                                                                | Запуск сервиса, если он еще не запущен |
| void                   | stop()                                                                 | Остановка сервиса, если он уже запущен |
| protected void         | waitUntilAvailable()                                                   |                                        |

[selenium/docs/api : DriverService](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/remote/service/DriverService.html)

### 2.1.1. Класс ChromeDriverService

***ChromeDriverService*** - класс для управления исполняемым файлом для браузера **Google Chrome**.

Данный класс наследует и расширяет класс **DriverService**.

Поля класса **ChromeDriverService**:

| Тип           | Поле                                   | Описание                                                                                      | 
|---------------|----------------------------------------|-----------------------------------------------------------------------------------------------|
| static String | CHROME_DRIVER_APPEND_LOG_PROPERTY      | Логич. сист. переменная.<br>Запись логов в существующий лог файл                              |
| static String | CHROME_DRIVER_DISABLE_BUILD_CHECK      | Сист. переменная.<br>Проверка совместимости версий драйвера и браузера                        |
| static String | CHROME_DRIVER_EXE_PROPERTY             | Сист. переменная.<br>Расположение исп. файла                                                  |
| static String | CHROME_DRIVER_LOG_PROPERTY             | Сист. переменная.<br>Расположение лог файла                                                   |
| static String | CHROME_DRIVER_SILENT_OUTPUT_PROPERTY   | Логич. сист. переменная.<br>Запуск исп. файла в автоматич режиме                              | 
| static String | CHROME_DRIVER_VERBOSE_LOG_PROPERTY     | Логич. сист. переменная.<br>Запуск исп. файла с записью в лог                                 |
| static String | CHROME_DRIVER_WHITELISTED_IPS_PROPERTY | Сист. переменная.<br>Список удаленных IPv4-адресов, которым разрешено подключаться к драйверу |

Методы класса **ChromeDriverService**:

| Тип                        | Метод                                          | Описание                                                                     | 
|----------------------------|------------------------------------------------|------------------------------------------------------------------------------|
| static ChromeDriverService | createDefaultService()                         | Настройка и создание нового ChromeDriverService с параметрами по умолчанию   |
| static ChromeDriverService | createServiceWithConfig(ChromeOptions options) | Настройка и создание нового ChromeDriverService с установленными параметрами |

[selenium/docs/api : ChromeDriverService](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/chrome/ChromeDriverService.html)

### 2.1.2. Класс EdgeDriverService

***EdgeDriverService*** - класс для управления исполняемым файлом для браузера **Microsoft Edge**.

Данный класс наследует и расширяет класс **DriverService**.

Поля класса **EdgeDriverService**:

| Тип           | Поле                               | Описание                                                                                      | 
|---------------|------------------------------------|-----------------------------------------------------------------------------------------------|
| static String | EDGE_DRIVER_DISABLE_BUILD_CHECK    | Сист. переменная.<br>Проверка совместимости версий драйвера и браузера                        |
| static String | EDGE_DRIVER_EXE_PROPERTY           | Сист. переменная.<br>Расположение исп. файла                                                  |
| static String | EDGE_DRIVER_LOG_PROPERTY           | Сист. переменная.<br>Расположение лог файла                                                   |
| static String | EDGE_DRIVER_SILENT_OUTPUT_PROPERTY | Логич. сист. переменная.<br>Запуск исп. файла в автоматич режиме                              | 
| static String | EDGE_DRIVER_VERBOSE_LOG_PROPERTY   | Логич. сист. переменная.<br>Запуск исп. файла с записью в лог                                 |
| static String | EDGE_DRIVER_ALLOWED_IPS_PROPERTY   | Сист. переменная.<br>Список удаленных IPv4-адресов, которым разрешено подключаться к драйверу |

Методы класса **EdgeDriverService**:

| Тип                      | Метод                  | Описание                                                                 | 
|--------------------------|------------------------|--------------------------------------------------------------------------|
| static EdgeDriverService | createDefaultService() | Настройка и создание нового EdgeDriverService с параметрами по умолчанию |

[selenium/docs/api : EdgeDriverService](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/edge/EdgeDriverService.html)

### 2.1.3. Класс InternetExplorerDriverService

***InternetExplorerDriverService*** - класс для управления исполняемым файлом для браузера **Microsoft Internet Explorer**.

Данный класс наследует и расширяет класс **DriverService**.

Поля класса **InternetExplorerDriverService**:

| Тип           | Поле                            | Описание                                                                                      | 
|---------------|---------------------------------|-----------------------------------------------------------------------------------------------|
| static String | IE_DRIVER_EXTRACT_PATH_PROPERTY | Сист. переменная.<br>Путь расположения извлеченной библиотеки IEDriverServer                  |
| static String | IE_DRIVER_EXE_PROPERTY          | Сист. переменная.<br>Расположение исп. файла                                                  |
| static String | IE_DRIVER_HOST_PROPERTY         | Сист. переменная.<br>Список удаленных IPv4-адресов, которым разрешено подключаться к драйверу |
| static String | IE_DRIVER_LOGFILE_PROPERTY      | Сист. переменная.<br>Расположение лог файла                                                   |
| static String | IE_DRIVER_LOGLEVEL_PROPERTY     | Логич. сист. переменная.<br>Уровень логов                                                     |
| static String | IE_DRIVER_SILENT_PROPERTY       | Логич. сист. переменная.<br>Запуск исп. файла в автоматич режиме                              |

Методы класса **InternetExplorerDriverService**:

| Тип                                  | Метод                  | Описание                                                                             | 
|--------------------------------------|------------------------|--------------------------------------------------------------------------------------|
| static InternetExplorerDriverService | createDefaultService() | Настройка и создание нового InternetExplorerDriverService с параметрами по умолчанию |

[selenium/docs/api : InternetExplorerDriverService](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/ie/InternetExplorerDriverService.html)

### 2.1.4. Класс FirefoxDriverService

***FirefoxDriverService*** - класс для управления исполняемым файлом для браузера **Mozilla Firefox**.

Данный класс наследует и расширяет класс **DriverService**.

[selenium/docs/api : FirefoxDriverService](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/firefox/FirefoxDriverService.html)

### 2.1.5. Класс GeckoDriverService

***GeckoDriverService*** - класс для управления исполняемым файлом для браузера **Mozilla Firefox**.

Данный класс наследует и расширяет класс **FirefoxDriverService**.

Поля класса **GeckoDriverService**:

| Тип           | Поле                                   | Описание                                                                                      | 
|---------------|----------------------------------------|-----------------------------------------------------------------------------------------------|
| static String | GECKO_DRIVER_EXE_PROPERTY              | Сист. переменная.<br>Расположение исп. файла                                                  |

Методы класса **GeckoDriverService**:

| Тип                       | Метод                  | Описание                                                                   | 
|---------------------------|------------------------|----------------------------------------------------------------------------|
| static GeckoDriverService | createDefaultService() | Настройка и создание нового ChromeDriverService с параметрами по умолчанию |
| protected boolean         | hasShutdownEndpoint()  | Проверка остановки сервиса                                                 | 
| protected void            | waitUntilAvailable()   |                                                                            | 

[selenium/docs/api : GeckoDriverService](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/firefox/GeckoDriverService.html)

### 2.1.6. Класс OperaDriverService

***OperaDriverService*** - класс для управления исполняемым файлом для браузера **Opera**.

Данный класс наследует и расширяет класс **DriverService**.

Поля класса **OperaDriverService**:

| Тип           | Поле                                | Описание                                                         | 
|---------------|-------------------------------------|------------------------------------------------------------------|
| static String | OPERA_DRIVER_EXE_PROPERTY           | Сист. переменная.<br>Расположение исп. файла                     |
| static String | OPERA_DRIVER_LOG_PROPERTY           | Сист. переменная.<br>Расположение лог файла                      |
| static String | OPERA_DRIVER_SILENT_OUTPUT_PROPERTY | Логич. сист. переменная.<br>Запуск исп. файла в автоматич режиме |
| static String | OPERA_DRIVER_VERBOSE_LOG_PROPERTY   | Логич. сист. переменная.<br>Запуск исп. файла с записью в лог    |

Методы класса **OperaDriverService**:

| Тип                       | Метод                  | Описание                                                                  |
|---------------------------|------------------------|---------------------------------------------------------------------------|
| static OperaDriverService | createDefaultService() | Настройка и создание нового OperaDriverService с параметрами по умолчанию |

[selenium/docs/api : OperaDriverService](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/opera/OperaDriverService.html)

## 2.2. Класс DriverService.Builder

***DriverService.Builder*** - класс для конфигурации нового инстанса **DriverService**.

Методы класса **DriverService.Builder**:

| Тип                             | Метод                                                                                                        | Описание                                        | 
|---------------------------------|--------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
| DS                              | build()                                                                                                      | Создание нового сервиса для управления сервисом |
| protected abstract List<String> | createArgs()                                                                                                 | Задание параметров                              |
| protected abstract DS           | createDriverService(File exe, int port, Duration timeout, List<String> args, Map<String,String> environment) | Создание сервиса для управления сервисом        |
| protected abstract File         | findDefaultExecutable()                                                                                      | Поиск исполняемого файла                        |
| protected Duration              | getDefaultTimeout()                                                                                          | Получение значения таймаута по умолчанию        |
| protected File                  | getLogFile()                                                                                                 | Получение лог файла                             |
| protected int                   | getPort()                                                                                                    | Получение порта                                 |
| abstract int                    | score(Capabilities capabilities)                                                                             | Проверка поддержки Capabilities                 |
| B                               | usingAnyFreePort()                                                                                           | Использование любого свободного порта           |
| B                               | usingPort(int port)                                                                                          | Использование конкретного порта                 |
| B                               | usingDriverExecutable(File file)                                                                             | Указание пути до исполняемого файла             |
| B                               | withEnvironment(Map<String, String> environment)                                                             | Указание среды запуска                          |
| B                               | withLogFile(File logFile)                                                                                    | Запись в лог файл                               |
| B                               | withTimeout(Duration timeout)                                                                                | Установка таймаута                              |

[selenium/docs/api : DriverService.Builder](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/remote/service/DriverService.Builder.html)

### 2.2.1. Класс ChromeDriverService.Builder

***ChromeDriverService.Builder*** - класс для конфигурации нового инстанса **ChromeDriverService**.

Данный класс наследует и расширяет класс **DriverService.Builder**.

Методы класса **ChromeDriverService.Builder**:

| Тип                           | Метод                                                                                                        | Описание                                                                 | 
|-------------------------------|--------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|
| protected List<String>        | createArgs()                                                                                                 | Задание параметров                                                       |
| protected ChromeDriverService | createDriverService(File exe, int port, Duration timeout, List<String> args, Map<String,String> environment) | Создание сервиса для управления сервисом                                 |
| protected File                | findDefaultExecutable()                                                                                      | Поиск исполняемого файла                                                 |
| int                           | score(Capabilities capabilities)                                                                             | Проверка поддержки Capabilities                                          |
| ChromeDriverService.Builder   | withAppendLog(boolean appendLog)                                                                             | Запись в существующий лог файл                                           | 
| ChromeDriverService.Builder   | withLogLevel(ChromeDriverLogLevel logLevel)                                                                  | Указание уровня логирования                                              | 
| ChromeDriverService.Builder   | withSilent(boolean silent)                                                                                   | Установка автоматического режима                                         | 
| ChromeDriverService.Builder   | withVerbose(boolean verbose)                                                                                 | Установка записи в лог                                                   | 
| ChromeDriverService.Builder   | withWhitelistedIps(String whitelistedIps)                                                                    | Список удаленных IPv4-адресов, которым разрешено подключаться к драйверу | 

*Пример*

```java
public class ChromeDriverTest {
    private static ChromeDriverService service;
    public static WebDriver driver;
    
    public static void createAndStartService() throws IOException {
        service = new ChromeDriverService.Builder()
            .usingDriverExecutable(new File(PATH_TO_CHROMEDRIVER_EXE))
            .usingAnyFreePort()
            .build();
        service.start();
    }
}
```

[selenium/docs/api : ChromeDriverService.Builder](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/chrome/ChromeDriverService.Builder.html)

### 2.2.2. Класс EdgeDriverService.Builder

***EdgeDriverService.Builder*** - класс для конфигурации нового инстанса **EdgeDriverService**.

Данный класс наследует и расширяет класс **DriverService.Builder**.

Методы класса **EdgeDriverService.Builder**:

| Тип                         | Метод                                                                                                        | Описание                                                                 | 
|-----------------------------|--------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|
| protected List<String>      | createArgs()                                                                                                 | Задание параметров                                                       |
| protected EdgeDriverService | createDriverService(File exe, int port, Duration timeout, List<String> args, Map<String,String> environment) | Создание сервиса для управления сервисом                                 |
| protected File              | findDefaultExecutable()                                                                                      | Поиск исполняемого файла                                                 |
| int                         | score(Capabilities capabilities)                                                                             | Проверка поддержки Capabilities                                          |
| EdgeDriverService.Builder   | withAllowedListIps(String allowedListIps)                                                                    | Список удаленных IPv4-адресов, которым разрешено подключаться к драйверу |
| EdgeDriverService.Builder   | withSilent(boolean silent)                                                                                   | Установка автоматического режима                                         |                          
| EdgeDriverService.Builder   | withVerbose(boolean verbose)                                                                                 | Установка записи в лог                                                   |

*Пример*

```java
public class EdgeDriverTest {
    private static EdgeDriverService service;
    public static WebDriver driver;
    
    public static void createAndStartService() throws IOException {
        service = new EdgeDriverService.Builder()
            .usingDriverExecutable(new File(PATH_TO_EDGEDRIVER_EXE))
            .usingAnyFreePort()
            .build();
        service.start();
    }
}
```

[selenium/docs/api : EdgeDriverService.Builder](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/edge/EdgeDriverService.Builder.html)

### 2.2.3. Класс InternetExplorerDriverService.Builder

***InternetExplorerDriverService.Builder*** - класс для конфигурации нового инстанса **InternetExplorerDriverService**.

Данный класс наследует и расширяет класс **DriverService.Builder**.

Методы класса **InternetExplorerDriverService.Builder**:

| Тип                                     | Метод                                                                                                        | Описание                                                                 | 
|-----------------------------------------|--------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|
| protected List<String>                  | createArgs()                                                                                                 | Задание параметров                                                       |
| protected InternetExplorerDriverService | createDriverService(File exe, int port, Duration timeout, List<String> args, Map<String,String> environment) | Создание сервиса для управления сервисом                                 |
| protected File                          | findDefaultExecutable()                                                                                      | Поиск исполняемого файла                                                 |
| int                                     | score(Capabilities capabilities)                                                                             | Проверка поддержки Capabilities                                          |
| InternetExplorerDriverService.Builder   | withExtractPath(File extractPath)                                                                            | Путь расположения извлеченной библиотеки IEDriverServer                  |
| InternetExplorerDriverService.Builder   | withHost(String host)                                                                                        | Список удаленных IPv4-адресов, которым разрешено подключаться к драйверу |
| InternetExplorerDriverService.Builder   | withLogLevel(InternetExplorerDriverLogLevel logLevel)                                                        | Указание уровня логирования                                              |
| InternetExplorerDriverService.Builder   | withSilent(Boolean silent)                                                                                   | Запуск исп. файла в автоматич режиме                                     |

*Пример*

```java
public class InternetExplorerDriverTest {
    private static InternetExplorerDriverService service;
    public static WebDriver driver;
    
    public static void createAndStartService() throws IOException {
        service = new InternetExplorerDriverService.Builder()
            .usingDriverExecutable(new File(PATH_TO_IEDRIVER_EXE))
            .usingAnyFreePort()
            .build();
        service.start();
    }
}
```

[selenium/docs/api : InternetExplorerDriverService.Builder](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/ie/InternetExplorerDriverService.Builder.html)

### 2.2.4. Класс FirefoxDriverService.Builder

***FirefoxDriverService.Builder*** - класс для конфигурации нового инстанса **FirefoxDriverService**.

Данный класс наследует и расширяет класс **DriverService.Builder**.

Методы класса **FirefoxDriverService.Builder**:

| Тип                                              | Метод                                | Описание  | 
|--------------------------------------------------|--------------------------------------|-----------|
| protected abstract FirefoxDriverService.Builder  | withOptions(FirefoxOptions options)  | Опции     |

### 2.2.5. Класс GeckoDriverService.Builder

***GeckoDriverService.Builder*** - класс для конфигурации нового инстанса **GeckoDriverService**.

Данный класс наследует и расширяет класс **FirefoxDriverService.Builder**.

Методы класса **GeckoDriverService.Builder**:

| Тип                                    | Метод                                                                                                        | Описание                                 | 
|----------------------------------------|--------------------------------------------------------------------------------------------------------------|------------------------------------------|
| protected List<String>                 | createArgs()                                                                                                 | Задание параметров                       |
| protected GeckoDriverService           | createDriverService(File exe, int port, Duration timeout, List<String> args, Map<String,String> environment) | Создание сервиса для управления сервисом |
| protected File                         | findDefaultExecutable()                                                                                      | Поиск исполняемого файла                 |
| int                                    | score(Capabilities capabilities)                                                                             | Проверка поддержки Capabilities          |
| GeckoDriverService.Builder             | usingFirefoxBinary(FirefoxBinary firefoxBinary)                                                              | Установка исп. файла браузера            |
| protected FirefoxDriverService.Builder | withOptions(FirefoxOptions options)                                                                          | Установка опций                          |

*Пример*

```java
public class FirefoxDriverTest {
    private static FirefoxDriverService service;
    public static WebDriver driver;
    
    public static void createAndStartService() throws IOException {
        service = new FirefoxDriverService.Builder()
            .usingDriverExecutable(new File(PATH_TO_FIREFOXDRIVER_EXE))
            .usingAnyFreePort()
            .build();
        service.start();
    }
}
```

[selenium/docs/api : FirefoxDriverService.Builder](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/firefox/FirefoxDriverService.Builder.html)

### 2.2.6. Класс OperaDriverService.Builder

***OperaDriverService.Builder*** - класс для конфигурации нового инстанса **OperaDriverService**.

Данный класс наследует и расширяет класс **DriverService.Builder**.

Методы класса **OperaDriverService.Builder**:

| Тип                          | Метод                                                                                                        | Описание                                        | 
|------------------------------|--------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
| protected List<String>       | createArgs()                                                                                                 | Задание параметров                              |
| protected OperaDriverService | createDriverService(File exe, int port, Duration timeout, List<String> args, Map<String,String> environment) | Создание сервиса для управления сервисом        |
| protected File               | findDefaultExecutable()                                                                                      | Поиск исполняемого файла                        |
| int                          | score(Capabilities capabilities)                                                                             | Проверка поддержки Capabilities                 | 
| OperaDriverService.Builder   | withSilent(boolean silent)                                                                                   | Установка автоматического режима                |                          
| OperaDriverService.Builder   | withVerbose(boolean verbose)                                                                                 | Установка записи в лог                          |

*Пример*

```java
public class OperaDriverTest {
    private static OperaDriverService service;
    public static WebDriver driver;
    
    public static void createAndStartService() throws IOException {
        service = new OperaDriverService.Builder()
            .usingDriverExecutable(new File(PATH_TO_OPERADRIVER_EXE))
            .usingAnyFreePort()
            .build();
        service.start();
    }
}
```

[selenium/docs/api : OperaDriverService.Builder](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/opera/OperaDriverService.Builder.html)

## 2.3. Совместимость драйверов и браузеров

Не все драйверы и браузеры подходят друг другу, даже в рамках одного браузера (версии могут отличаться):

### 2.3.1. Совместимость драйверов браузера Google Chrome

| Версия браузера | Версия драйвера     | Производитель драйвера    | 
|-----------------|---------------------|---------------------------|
| последняя       | последняя           | Google - **chromedriver** |
| предыдущие      | поддержка последней | Google - **chromedriver** |

### 2.3.2. Совместимость драйверов браузера Microsoft Edge

| Версия браузера | Версия драйвера     | Производитель драйвера     | 
|-----------------|---------------------|----------------------------|
| последняя       | последняя           | Microsoft - **edgedriver** |

### 2.3.3. Совместимость драйверов браузера Microsoft Internet Explorer

| Версия браузера | Версия драйвера     | Производитель драйвера     | 
|-----------------|---------------------|----------------------------|
| 9 - 11          |                     | Selenium                   | 
| <= 8            |                     | драйвер не поддерживается  | 

### 2.3.4. Совместимость драйверов браузера Mozilla Firefox

| Версия браузера | Версия драйвера     | Производитель драйвера     | 
|-----------------|---------------------|----------------------------|
| >= 49           | последняя           | Mozilla - **geckodriver**  | 
| 48              |                     | драйвер не поддерживается  |  
| 4 - 47          |                     | Selenium                   | 
| <= 3            |                     | драйвер не поддерживается  | 

### 2.3.5. Совместимость драйверов браузера Apple Safari

| Версия браузера | Версия драйвера     | Производитель драйвера     | 
|-----------------|---------------------|----------------------------|
| >= 10           | последняя           | Apple - **safaridriver**   | 
| 6 - 9           |                     | Selenium                   | 
| <= 5            |                     | драйвер не поддерживается  | 

### 2.3.6. Совместимость драйверов браузера Opera

| Версия браузера | Версия драйвера     | Производитель драйвера         | 
|-----------------|---------------------|--------------------------------|
| >= 15           | последняя           | Opera - **operchromiumdriver** | 
| 11 - 12         |                     | Opera - **operaPrestoDriver**  | 
| <= 10           |                     | драйвер не поддерживается      | 

***

# 3. Библиотека WebDriverManager

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

***WebDriverManager*** - программная библиотека решающая проблему с 
исполняемым файлом посредником и указанием его местоположения.

Возможности:

* автоматизация управление исполняемыми файлами драйвера
* загрузка соответствующих исполняемых файлов драйвера, если они еще не установлены, в локальный кеш
* загрузка последней версии исполняемыми файла драйвера, если не указано иное
* устранение необходимости хранить исполняемые файлы драйверов локально
* устранение необходимости поддерживать разные версии исполняемых файлов драйвера для разных браузеров

Все что нужно сделать, это подключить зависимость и прописать одну строчку кода.
Никаких исполняемых файлов, WebDriverManager сделает все сам - скачает и настроит исполняемый файл.

Подключение в проект **WebDriverManager**:

```xml
<dependency>
    <groupId>io.github.bonigarcia</groupId>
    <artifactId>webdrivermanager</artifactId>
    <version>4.3.1</version>
    <scope>test</scope>
</dependency>
```

Методы класса **WebDriverManager**:

| Тип  | Метод                                     | Описание                                        |
|------|-------------------------------------------|-------------------------------------------------|
| void | WebDriverManager.chromedriver().setup()   | Установка драйвера для браузера Google Chrome   |
| void | WebDriverManager.chromiumdriver().setup() | Установка драйвера для браузера Google Chromium |
| void | WebDriverManager.edgedriver().setup()     | Установка драйвера для браузера Microsoft Edge  |
| void | WebDriverManager.iedriver().setup()       | Установка драйвера для браузера Microsoft IE    |
| void | WebDriverManager.firefoxdriver().setup()  | Установка драйвера для браузера Mozilla Firefox |
| void | WebDriverManager.operadriver().setup()    | Установка драйвера для браузера Opera           |
| void | WebDriverManager.phantomjs().setup()      | Установка драйвера для браузера PhantomJS       |

Более подробную информацию по работе с **WebDriverManager** можно узнать в описании репозитория проекта.

[github.com/bonigarcia/webdrivermanager](https://github.com/bonigarcia/webdrivermanager)

***

# 4. Клиентская библиотека Java

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

## 4.1. Интерфейс WebDriver

***WebDriver*** - интерфейс для управления браузером.

**Webdriver** - самая важная сущность, ответственная за управление браузером.
Основной ход скрипта/теста строится именно вокруг экземпляра этой сущности.

Методы интерфейса **WebDriver**:

| Тип                     | Метод               | Описание                                                                     | 
|-------------------------|---------------------|------------------------------------------------------------------------------|
| void                    | get(String url)     | Загрузка новой страницы в текущем окне браузера                              |
| void                    | close()             | Закрытие текущего окна, выход из браузера (если было открыто последнее окно) |
| void                    | quit()              | Выход из драйвера, закрытие всех окон браузера                               |
| String                  | getCurrentUrl()     | Получение строки URL страницы                                                |
| String                  | getPageSource()     | Получение исходного кода страницы                                            |
| String                  | getTitle()          | Получение заголовка страницы                                                 |
| WebElement              | findElement(By by)  | Поиск элемента (возвращает первый найденный элемент)                         |
| List<WebElement>        | findElements(By by) | Поиск всех элементов (возвращает список найденных элементов)                 |
| WebDriver.Options       | manage()            | Управление свойствами и настройками браузера                                 |
| WebDriver.Navigation    | navigate()          | Управление историей браузера                                                 |
| String                  | getWindowHandle()   | Получение окна                                                               |
| Set<String>             | getWindowHandles()  | Получение всех окон                                                          |
| WebDriver.TargetLocator | switchTo()          | Управление переключением между окнами                                        |

[selenium/docs/api : WebDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/WebDriver.html)

## 4.2. Основные команды 

### 4.2.1. Открытие и закрытие браузера

*Пример*

```java
WebDriver driver = new ChromeDriver();
driver.get("https://yandex.ru/");
driver.quit();
```

### 4.2.2. Получение свойств текущей страницы

*Пример*

```java
WebDriver driver = new ChromeDriver();
driver.get("https://yandex.ru/");
String pageTitle = driver.getTitle();
String pageCurrentUrl = driver.getCurrentUrl();
String pageSource = driver.getPageSource();
```

### 4.2.3. Поиск веб элементов

*Пример*

```java
WebDriver driver = new ChromeDriver();
driver.get("https://yandex.ru/");
String xpath = ".//input[@class='input']";
WebElement input = driver.findElement(By.xpath(xpath));
input.sendKeys("search text");
```

Подробнее в [Поиск веб элементов](../04.%20Selenium%20WebDriver.%20Локаторы/1.%20Лекция.md).

### 4.2.4. Свойства и настройки браузера

*Пример*

```java
WebDriver driver = new ChromeDriver();
driver.manage().timeouts().pageLoadTimeout(60, TimeUnit.SECONDS);
driver.manage().window().fullscreen();
driver.get("https://yandex.ru/");
```

Подробнее в [Свойства и настройки браузера](../03.%20Selenium%20WebDriver.%20Конфигурация/1.%20Лекция.md).

### 4.2.5. Навигация по истории браузера

*Пример*

```java
WebDriver driver = new ChromeDriver();
driver.navigate().to("https://yandex.ru/");
driver.navigate().back();
driver.navigate().forward();
```

Подробнее в [Окна](../07.%20Selenium%20WebDriver.%20Окна/1.%20Лекция.md).

### 4.2.6. Переходы по вкладкам и окнам браузера

*Пример*

```java
WebDriver driver = new ChromeDriver();
driver.get("https://yandex.ru/");
String xpath = ".//input[@class='button']";
WebElement button = driver.findElement(By.xpath(xpath));
button.click();
Alert alertConfirm = driver.switchTo().alert();
alertConfirm.accept();
```

Подробнее в [Окна](../07.%20Selenium%20WebDriver.%20Окна/1.%20Лекция.md).

***

# 5. Инициализация экземпляра WebDriver

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

Чтобы работать с каким то из драйверов нужно в коде инициализировать соответствующий **WebDriver**.
То есть сконструировать объекта соответствующего класса, который наследует интерфейс **WebDriver**.

![Драйверы Selenium WebDriver](_Files/1.%20Selenium%20WebDriver/02.png)

Когда вызывается конструктор, он находит исполняемый файл посредник.

## 5.1. Инициализация ChromiumDriver (Chromium)

[selenium/docs/api : ChromiumDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/chromium/ChromiumDriver.html)

## 5.2. Инициализация ChromeDriver (Google Chrome)

*Пример*

```java
public class ChromeBrowser {
    public WebDriver getDriver() {
        WebDriverManager.chromedriver().setup();
        WebDriver driver = new ChromeDriver();
        return driver;
    }
}
```

[selenium/docs/api : ChromeDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/chrome/ChromeDriver.html)

## 5.3. Инициализация EdgeDriver (Microsoft Edge)

*Пример*

```java
public class EdgeBrowser {
    public WebDriver getDriver() {
        WebDriverManager.edgedriver().setup();
        WebDriver driver = new EdgeDriver();
        return driver; 
    }
}
```

[selenium/docs/api : EdgeDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/edge/EdgeDriver.html)

## 5.4. Инициализация InternetExplorerDriver (Microsoft Internet Explorer)

*Пример*

```java
public class ExplorerBrowser {
    public WebDriver getDriver() {
        WebDriverManager.iedriver().setup();
        WebDriver driver = new InternetExplorerDriver();
        return driver; 
    }
}
```

[selenium/docs/api : InternetExplorerDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/ie/InternetExplorerDriver.html)

## 5.5. Инициализация FirefoxDriver (Mozilla Firefox)

*Пример*

```java
public class FirefoxBrowser {
    public WebDriver getDriver() {
        WebDriverManager.firefoxdriver().setup();
        WebDriver driver = new FirefoxDriver(options);
        return driver;
    }
}
```

[selenium/docs/api : FirefoxDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/firefox/FirefoxDriver.html)

## 5.6. Инициализация OperaDriver (Opera)

*Пример*

```java
public class OperaBrowser {
    public WebDriver getDriver() {
        WebDriverManager.operadriver().setup();
        WebDriver driver = new OperaDriver();
        return driver; 
    }
}
```

[selenium/docs/api : OperaDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/opera/OperaDriver.html)

***

# 6. Паттерн WebDriverFactory

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

***Factory (фабрика)*** — паттерн для создания других объектов в объектно-ориентированном программировании (ООП). 

Формально **Factory** — функция или метод возвращающая объекты изменяющегося прототипа или класса из некоторого вызова метода. 
Или, простыми словами, **Factory** создает экземпляр класса без раскрытия логики его создания.

***WebDriverFactory*** - фабрика для создания объектов **WebDriver** для разных браузеров.

Для понимания того, зачем нужно его использовать, следует сначала понять проблему, который решает этот паттерн.

Для примера рассмотрим следующий код:

```java
@Test
void test(){
    ChromeDriver driver = new ChromeDriver();
    driver.get("https://otus.ru");
    Assert.assertEquals(driver.getTitle(),"Otus - онлайн образование");
}
```

Данный тест запускает Chrome, проверяет, что title страницы совпадает с ожидаемым. 
Далее создаются еще несколько таких тестов, добавляются их в скоуп тестирования для параллельного тестирования. 
И вроде, все хорошо ровно (за исключением нарушений принципов DRY и SOLID) до момента, когда встает вопрос о том, 
чтобы запускать тесты в другом браузере, запускать браузер с какими-то параметрами или с определенными расширениями.
В решении данной проблемы может помочь паттерн **Factory**.

Рассмотрим простейшую фабрику. 
Для этого нужно создать метод, который принимает на вход название браузера и возвращает соответствующий браузер 
(если браузер был указан некорректно – выбросит ошибку с соответствующим сообщением).

```java
WebDriver getWebDriver(String browserName){
    switch (browserName){
        case "chrome":
            return new ChromeDriver();
        case "firefox":
            return new FirefoxDriver();
        default:
            throw new RuntimeException("Incorrect BrowserName");
    }
}
```

Теперь в тесте будет достаточно вызвать соответствующий метод для получения **Webdriver**:

```java
@Test
void test(){
    WebDriver driver = getWebDriver("chrome");
    driver.get("https://otus.ru");
    Assert.assertEquals(driver.getTitle(),"Otus - онлайн образование");
}
```

Готово! Теперь при изменении параметров запуска браузера (к примеру, потребуется добавить Cookie), 
это можно будет сделать из одного места.

***

# 7. Зачем нужно конфигурировать браузер при старте?

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

При тестировании приложений (сайтов) в веб браузере очень часто возникает потребность в запуске браузера с определенными параметрами.
Например, запуск браузера в полноэкранном режиме или запуск в headless режиме.
**Selenium WebDriver** позволяет конфигурировать браузер при старте, а также задавать и получать некоторые параметры после запуска.

Для этого предусмотрено два типа настроек:

1. Общие для всех драйверов и браузеров
2. Специфичные для каждого драйвера и браузера

# 8. Общие настройки

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

Общие настройки:

* запуск в определенном разрешении
* запуск в полноразмерном экране
* работа с cookie
* работа с логам
* работа с ожиданиями

## 8.1. Интерфейс WebDriver.Options

***WebDriver.Options*** - интерфейс для управления общими настройками браузера.

***WebDriver.manage()*** - реализация интерфейса **WebDriver.Options**.

Данный интерфейс позволяет:

* работать с куками
* получать логи
* настраивать ожидания
* настраивать окна браузера

Методы интерфейса **WebDriver.Options**:

| Тип                | Метод                          | Описание                         | 
|--------------------|--------------------------------|----------------------------------|
| void               | addCookie(Cookie cookie)       | Добавление cookie браузеру       |
| void               | deleteAllCookies()             | Удаление всех cookie из браузера |
| void               | deleteCookie(Cookie cookie)    | Удаление cookie из браузера      |
| void               | deleteCookieNamed(String name) | Удаление cookie по имени         |
| Cookie             | getCookieNamed(String name)    | Получение cookie по имени        |
| Set<Cookie>        | getCookies()                   | Получение всех cookie            |
| Logs               | logs()                         | Получение логов                  |
| WebDriver.Timeouts | timeouts()                     | Настройка таймаутов              |
| WebDriver.Window   | window()                       | Настройка окон                   |

[selenium/docs/api : WebDriver.Options](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/WebDriver.Options.html)

## 8.2. Куки

***Ку́ки*** — небольшой фрагмент данных, отправленный веб-сервером и хранимый на компьютере пользователя.

**Веб-клиент** (обычно веб-браузер) всякий раз при попытке открыть страницу соответствующего сайта
пересылает этот фрагмент данных **веб-серверу** в составе HTTP-запроса.

![Куки](./_Files/2.%20Selenium%20WebDriver%20Config/01.jpg "Куки")

Подробнее про cookie в [# 4. Работа с куками](#4-Работа-с-куками).

## 8.3. Логи

***Лог*** - файл с записями о событиях в хронологическом порядке.

![Логи](./_Files/2.%20Selenium%20WebDriver%20Config/02.jpg "Логи")

**Логирование** важно как для разработчиков, так и для пользователей **Webdriver**.
Пользователи хотят иметь возможность быстро понять почему упал тест,
в то время как разработчик хочет получить информацию, почему **Webdriver** упал.
Хорошее логирование может сделать дебаггинг намного проще.

*Пример*

```java
WebDriver driver = new ChromeDriver();
LogEntries logEntries = driver.manage().logs().get(LogType.DRIVER);
for (LogEntry logEntry : logEntries) {
    System.out.println(logEntry.getMessage());
}
```

Подробнее про логи в [Урок 10. Протоколирование](../Урок%2010.%20Протоколирование/1.%20Лекция.md).

## 8.4. Ожидания

***Ожидание*** - промежуток времени, в течение которого **WebDriver** ожидает появление элемента
веб страницы и возможности с ним взаимодействовать.

![Ожидания](./_Files/2.%20Selenium%20WebDriver%20Config/03.jpg "Ожидания")

Настройка ожиданий нужна для синхронизации работы AUT и тестового скрипта.
Скрипт выполняется намного быстрее реакции приложения на команды,
поэтому часто в скриптах необходимо дожидаться определенного состояния приложения для дальнейшего с ним взаимодействия.

*Пример*

```java
WebDriver driver = new ChromeDriver();
driver.manage().timeouts().implicitlyWait(10, TimeUnit.SECONDS);
driver.get("http://some_url");
WebElement dynamicElement = driver.findElement(By.id("dynamicElement_id"));
```

Подробнее про ожидания в [Урок 08. Ожидания](../Урок%2008.%20Ожидания/1.%20Лекция.md).

## 8.5. Окна браузера

При запуске тестов иногда требуется отображение окна браузера в полноэкранном режиме, либо наоборот в минимизированном.

![Окна браузера](./_Files/2.%20Selenium%20WebDriver%20Config/04.jpg "Окна браузера")

*Пример*

```java
WebDriver driver = new FirefoxDriver();
driver().manage().window().maximize();
driver().manage().window().fullscreen();
```

Подробнее про окна в [Урок 09. Окна браузера](../Урок%2009.%20Окна/1.%20Лекция.md).

***

# 9. Специфичные настройки

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

Каждый браузер обладает какими либо уникальными настройками и свойствами, специфичными для конкретного браузера.

## 9.1. Интерфейс Capabilities

***Capabilities*** - интерфейс для получения настроек и свойств браузера.

Данный интерфейс реализуют классы:

* *MutableCapabilities* - изменяемые настройки и свойства браузера
* *ImmutableCapabilities* - неизменяемые настройки и свойства браузера
* *DesiredCapabilities* - желаемые настройки и свойства браузера

Методы интерфейса **Capabilities**:

| Тип         | Метод                                 | Описание                           | 
|-------------|---------------------------------------|------------------------------------|
| Object      | getCapability(String capabilityName)  | Получение свойства по имени        |
| Set<String> | getCapabilityNames()                  | Получение списка свойств           |
| String      | getBrowserName()                      | Получение имени браузера           |
| String      | getBrowserVersion()                   | Получение версии браузера          |
| Platform    | getPlatformName()                     | Получение имени платформы (ОС)     |
| boolean     | is(String capabilityName)             | Проверка наличия свойства по имени |

[selenium/docs/api : Capabilities](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Capabilities.html)

## 9.2. Класс MutableCapabilities

***MutableCapabilities*** - класс представляющий изменяемые настройки и свойства браузера.

Данный класс реализует интерфейс **Capabilities**.

Методы класса **MutableCapabilities**:

| Тип                 | Метод                                                | Описание                     | 
|---------------------|------------------------------------------------------|------------------------------|
| Object              | getCapability(String capabilityName)                 | Получение свойства по имени  |
| Set<String>         | getCapabilityNames()                                 | Получение списка свойств     |
| void                | setCapability(String key, Object value)              | Установка свойства           |
| void                | setCapability(String capabilityName, boolean value)  | Установка свойства           |
| void                | setCapability(String capabilityName, String value)   | Установка свойства           |
| void                | setCapability(String capabilityName, Platform value) | Установка свойства           |
| MutableCapabilities | merge(Capabilities extraCapabilities)                | Объединение свойств          |

[selenium/docs/api : MutableCapabilities](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/MutableCapabilities.html)

## 9.3. Класс ImmutableCapabilities

***ImmutableCapabilities*** - класс представляющий неизменяемые настройки и свойства браузера.

Данный класс реализует интерфейс **Capabilities**.

Методы класса **ImmutableCapabilities**:

| Тип                          | Метод                                | Описание                    | 
|------------------------------|--------------------------------------|-----------------------------|
| static ImmutableCapabilities | copyOf(Capabilities capabilities)    | Получение копии свойства    |
| Object                       | getCapability(String capabilityName) | Получение свойства по имени |

[selenium/docs/api : ImmutableCapabilities](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/ImmutableCapabilities.html)

## 9.4. Класс DesiredCapabilities

***DesiredCapabilities*** - класс для установки желаемых настроек и свойств браузера.

Класс **DesiredCapabilities** помогает сообщить веб драйверу, какую среду нужно использовать в тестовом сценарии.
Каждый сценарий тестирования должен выполняться в определенной среде тестирования.
Средой тестирования может быть веб-браузер, мобильное устройство, мобильный эмулятор, мобильный симулятор и т.д.

Данный класс реализует интерфейс **Capabilities**.

Данный класс наследует и расширяет класс **MutableCapabilities**.

Методы класса **DesiredCapabilities**:

| Тип                 | Метод                                               | Описание                                     | 
|---------------------|-----------------------------------------------------|----------------------------------------------|
| boolean             | acceptInsecureCerts()                               | Прием небезопасных сертификатов              |
| void                | setAcceptInsecureCerts(boolean acceptInsecureCerts) | Установка проверки просроченных сертификатов |
| void                | setJavascriptEnabled(boolean javascriptEnabled)     | Установка исполнения скриптов JS             |
| void                | setBrowserName(String browserName)                  | Установка имени браузера                     |
| void                | setVersion(String version)                          | Установка версии браузера                    |
| void                | setPlatform(Platform platform)                      | Установка платформы                          |
| DesiredCapabilities | merge(Capabilities extraCapabilities)               | Объединение свойств                          |

[selenium/docs/api : DesiredCapabilities](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/remote/DesiredCapabilities.html)

*Пример*

```java
DesiredCapabilities caps = new DesiredCapabilities();
caps.setCapability("os", "Windows");
caps.setCapability("os_version", "10");
caps.setCapability("browser", "Chrome");
caps.setCapability("browser_version", "latest");
caps.setCapability("resolution", "1920x1200");
WebDriver driver = new ChromeDriver(caps);
```

Для автоматического подбора желаемых свойств можно использовать онлайн ресурс

[Capabilities Generator](https://www.browserstack.com/automate/capabilities)

## 9.5. Интерфейс CapabilityType

***CapabilityType*** - интерфейс для обозначения типов свойств браузера.

С помощью данного интерфейса можно задавать типы свойств браузера при его конфигурировании.

Поля интерфейса **CapabilityType**:

| Тип    | Поле                        | Описание                              | 
|--------|-----------------------------|---------------------------------------|
| String | ACCEPT_INSECURE_CERTS       | Проверка сертификатов TLS             |
| String | ACCEPT_SSL_CERTS            | Проверка сертификатов SSL             |
| String | APPLICATION_NAME            |                                       |
| String | BROWSER_NAME                | Наименование браузера                 |
| String | ELEMENT_SCROLL_BEHAVIOR     | Поведение при прокрутке элемента      |
| String | ENABLE_PROFILING_CAPABILITY |                                       |
| String | HAS_NATIVE_EVENTS           |                                       |
| String | HAS_TOUCHSCREEN             | Поддержка тачскрина                   |
| String | LOGGING_PREFS               | Настройки логгирования                |
| String | OVERLAPPING_CHECK_DISABLED  |                                       |
| String | PAGE_LOAD_STRATEGY          | Стратегия загрузки страницы           |
| String | PLATFORM_NAME               | Наименование платформы                |
| String | PROXY                       | Настройки прокси                      |
| String | ROTATABLE                   | Поддержка поворота                    |
| String | STRICT_FILE_INTERACTABILITY |                                       |
| String | SUPPORTS_ALERTS             | Поддержка алертов                     |
| String | SUPPORTS_APPLICATION_CACHE  | Поддержка кеша                        |
| String | SUPPORTS_JAVASCRIPT         | Поддержка JavaScript                  |
| String | SUPPORTS_LOCATION_CONTEXT   | Поддержка местоположения              |
| String | SUPPORTS_NETWORK_CONNECTION | Поддержка сетевых соединений          |
| String | SUPPORTS_SQL_DATABASE       | Поддержка баз данных SQL              |
| String | SUPPORTS_WEB_STORAGE        | Поддержка веб хранилища               |
| String | TAKES_SCREENSHOT            | Снятие скриншотов                     |
| String | UNEXPECTED_ALERT_BEHAVIOUR  | Поведение при алертах                 |
| String | UNHANDLED_PROMPT_BEHAVIOUR  | Поведение при промтах                 |
| String | VERSION                     | Версия                                |

[selenium/docs/api : CapabilityType](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/remote/CapabilityType.html)

## 9.6. Класс AbstractDriverOptions<DO extends AbstractDriverOptions>

***AbstractDriverOptions<DO extends AbstractDriverOptions>*** - класс для установки специфичных настроек и свойств браузера.

Данный класс реализует интерфейс **Capabilities**.

Данный класс наследует и расширяет класс **MutableCapabilities**.

Методы класса **AbstractDriverOptions**:

| Тип | Метод                                                           | Описание                                | 
|-----|-----------------------------------------------------------------|-----------------------------------------|
| DO  | setAcceptInsecureCerts(boolean acceptInsecureCerts)             | Прием небезопасных сертификатов         |
| DO  | setPageLoadStrategy(PageLoadStrategy strategy)                  | Установка стратегии загрузки страницы   |
| DO  | setProxy(Proxy proxy)                                           | Установка прокси                        |
| DO  | setStrictFileInteractability(boolean strictFileInteractability) | Установка                               |
| DO  | setUnhandledPromptBehaviour(UnexpectedAlertBehaviour behaviour) | Установка                               |

[selenium/docs/api : AbstractDriverOptions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/remote/AbstractDriverOptions.html)

Непосредственно от **AbstractDriverOptions** наследуются классы **Options** для управления
специфичными настройками и свойствами конкретных браузеров.

С помощью данных классов можно:

* установить расширения в браузер
* добавить аргументы запуска браузера
* запустить браузер в *headless режиме*
* установить стратегию загрузки страницы
* настроить *capabilities*
* и т д

### 9.6.1. Класс ChromiumOptions<T extends ChromiumOptions>

***ChromiumOptions*** - класс для управления свойствами браузера **Chromium**.

Методы класса **ChromiumOptions**:

| Тип | Метод                                            | Описание                                      | 
|-----|--------------------------------------------------|-----------------------------------------------|
| T   | addArguments(String... arguments)                | Добавление параметров при запуске Chrome      |
| T   | addArguments(List<String> arguments)             | Добавление параметров при запуске Chrome      |
| T   | addEncodedExtensions(String... encoded)          | Установка расширений при запуске Chrome       |
| T   | addEncodedExtensions(List<String> encoded)       | Установка расширений при запуске Chrome       |
| T   | addExtensions(File... paths)                     | Установка расширений при запуске Chrome       |
| T   | addExtensions(List<File> paths)                  | Установка расширений при запуске Chrome       |
| T   | setBinary(File path)                             | Установка пути до исполняемого файла Chrome   |
| T   | setBinary(String path)                           | Установка пути до исполняемого файла Chrome   |
| T   | setExperimentalOption(String name, Object value) | Включение экспериментальных функций           |
| T   | setHeadless(boolean headless)                    | Запуск в "безголовом режиме"                  |

[selenium/docs/api : ChromiumOptions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/chromium/ChromiumOptions.html)

![Chromium](./_Files/2.%20Selenium%20WebDriver%20Config/05.jpg "Chromium")

### 9.6.2. Класс ChromeOptions

***ChromeOptions*** - класс для управления свойствами браузера **Google Chrome**.

Данный класс наследует и расширяет класс **ChromiumOptions**.

Методы класса **ChromeOptions**:

| Тип | Метод                                      | Описание                     | 
|-----|--------------------------------------------|------------------------------|
| T   | getLogLevel()                              | Получение уровня логирования |
| T   | setLogLevel(ChromeDriverLogLevel logLevel) | Установка уровня логирования |

[selenium/docs/api : ChromeOptions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/chrome/ChromeOptions.html)

![Chrome](./_Files/2.%20Selenium%20WebDriver%20Config/06.jpg "Chrome")

*Пример*

```java
ChromeOptions options = new ChromeOptions()
options.addExtensions(new File("/path/to/extension.crx"))
options.setBinary(new File("/path/to/chrome"));
ChromeDriver driver = new ChromeDriver(options);
```

Список доступных и наиболее часто используемых аргументов для класса **ChromeOptions**:

| Опция                  | Описание                                         |
|------------------------|--------------------------------------------------|
| start-maximized        | Открытие Chrome в режиме максимизации            |
| incognito              | Открытие Chrome в режиме инкогнито               |
| headless               | Открытие Chrome в headless режиме                |
| disable-notifications  | Отключение оповещений в Chrome                   |
| disable-extensions     | Отключение существующие расширения в Chrome      |
| disable-popup-blocking | Отключение отображения всплывающих окон в Chrome |
| disable-infobars       | Отключение отображения уведомлений в Chrome      |
| make-default-browser   | Установка браузера Chrome стандартным            |
| version                | Печать версии браузера Chrome                    |

[Опции командной строки Chromium](https://peter.sh/experiments/chromium-command-line-switches/)

[Опции командной строки Google Chrome. Список всех ключей запуска](http://manaeff.ru/forum/viewtopic.php?p=1579)

### 9.6.3. Класс EdgeOptions

***EdgeOptions*** - класс для управления различными свойствами браузера **Microsoft Edge**.

Данный класс наследует и расширяет класс **ChromiumOptions**.

[selenium/docs/api : EdgeOptions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/edge/EdgeOptions.html)

![Edge](./_Files/2.%20Selenium%20WebDriver%20Config/07.jpg "Edge")

*Пример*

```java
EdgeOptions options = new EdgeOptions()
options.addExtensions(new File("/path/to/extension.crx"))
options.setBinary(new File("/path/to/edge"));
EdgeDriver driver = new EdgeDriver(options);
```

[Опции командной строки Chromium](https://peter.sh/experiments/chromium-command-line-switches/)

### 9.6.4. Класс FirefoxOptions

***FirefoxOptions*** - класс для управления свойствами браузера **Mozilla Firefox**.

Методы класса **FirefoxOptions**:

| Тип            | Метод                                       | Описание                                       | 
|----------------|---------------------------------------------|------------------------------------------------|
| FirefoxOptions | addArguments(String... arguments)           | Добавление параметров при запуске Firefox      |
| FirefoxOptions | addArguments(List<String> arguments)        | Добавление параметров при запуске Firefox      |
| FirefoxOptions | addPreference(String key, Object value)     | Установка preferences при запуске Firefox      |
| FirefoxOptions | setBinary(String path)                      | Установка пути до исполняемого файла           |
| FirefoxOptions | setBinary(Path path)                        | Установка пути до исполняемого файла           |
| FirefoxOptions | setBinary(FirefoxBinary binary)             | Установка пути до исполняемого файла           |
| FirefoxOptions | setHeadless(boolean headless)               | Запуск в "безголовом режиме"                   |
| FirefoxOptions | setLogLevel(FirefoxDriverLogLevel logLevel) | Установка уровня логгирования                  |
| FirefoxProfile | getProfile()                                | Получения профиля Firefox                      |
| FirefoxOptions | setProfile(FirefoxProfile profile)          | Установка профиля Firefox                      |

[selenium/docs/api : FirefoxOptions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/firefox/FirefoxOptions.html)

![Firefox](./_Files/2.%20Selenium%20WebDriver%20Config/08.jpg "Firefox")

*Пример*

```java
FirefoxOptions options = new FirefoxOptions()
options.addPreference("browser.startup.page", 1)
options.addPreference("browser.startup.homepage", "https://www.google.co.uk");
FirefoxDriver driver = new FirefoxDriver(options);
```

[Опции командной строки Firefox](https://developer.mozilla.org.cach3.com/ru/docs/Mozilla/Command_Line_Options)

### 9.6.5. Класс OperaOptions

***OperaOptions*** - класс для управления свойствами браузера **Opera**.

Методы класса **OperaOptions**:

| Тип          | Метод                                            | Описание                                   | 
|--------------|--------------------------------------------------|--------------------------------------------|
| OperaOptions | addArguments(String... arguments)                | Добавление параметров при запуске Opera    |
| OperaOptions | addArguments(List<String> arguments)             | Добавление параметров при запуске Opera    |
| OperaOptions | addEncodedExtensions(String... encoded)          | Установка расширений при запуске Opera     |
| OperaOptions | addEncodedExtensions(List<String> encoded)       | Установка расширений при запуске Opera     |
| OperaOptions | addExtensions(File... paths)                     | Установка расширений при запуске Opera     |
| OperaOptions | addExtensions(List<File> paths)                  | Установка расширений при запуске Opera     |
| Object       | getExperimentalOption(String name)               | Получение экспериментальных функций        |
| OperaOptions | setBinary(File path)                             | Установка пути до исполняемого файла Opera |
| OperaOptions | setBinary(String path)                           | Установка пути до исполняемого файла Opera |
| OperaOptions | setExperimentalOption(String name, Object value) | Включение экспериментальных функций        |

[selenium/docs/api : OperaOptions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/opera/OperaOptions.html)

![Opera](./_Files/2.%20Selenium%20WebDriver%20Config/09.jpg "Opera")

*Пример*

```java
OperaOptions options = new OperaOptions()
options.addExtensions(new File("/path/to/extension.crx"))
options.setBinary(new File("/path/to/chrome"));
OperaDriver driver = new OperaDriver(options);
```

[Опции командной строки Chromium](https://peter.sh/experiments/chromium-command-line-switches/)

## 9.7. Перечисление Platform

**Platform** - перечисление определяющее типы платформы с которыми работает.

Константы перечисления *Platform*

| Тип           | Описание         | 
|---------------|------------------|
| ANDROID       | Android          |
| ANY           | Любая            |
| BIG_SUR       | macOS            |
| CATALINA      | macOS            |
| EL_CAPITAN    | macOS            |
| HIGH_SIERRA   | macOS            |
| IOS           | iOS              |
| LINUX         | Linux            |
| MAC           | macOS            |
| MAVERICKS     | macOS            |
| MOJAVE        | macOS            |
| MOUNTAIN_LION | macOS            |
| SIERRA        | macOS            |
| SNOW_LEOPARD  | macOS            |
| UNIX          | Unix             |
| VISTA         | Windows          |
| WIN10         | Windows          |
| WIN8          | Windows          |
| WIN8_1        | Windows          |
| WINDOWS       | Windows          |
| XP            | Windows          |
| YOSEMITE      | macOS            |

Методы перечисления *Platform*

| Тип      | Метод                                                   | Описание                                                 | 
|----------|---------------------------------------------------------|----------------------------------------------------------|
| Platform | extractFromSysProperty(String osName)                   | извлечение платформы (ОС) на основе системной переменной |
| Platform | extractFromSysProperty(String osName, String osVersion) | извлечение платформы (ОС) на основе системной переменной |
| Platform | family()                                                | получение семейства текущей платформы (ОС)               |
| Platform | fromString(String name)                                 | получение платформы (ОС) по имени                        |
| Platform | getCurrent()                                            | получение текущей версии платформы (ОС)                  |
| int      | getMajorVersion()                                       | получение мажорной версии платформы (ОС)                 |
| int      | getMinorVersion()                                       | получение минорной версии платформы (ОС)                 |

[selenium/docs/api : Platform](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Platform.html)

***

# 10. Запуск с куками и без

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

## 10.1. Что такое куки?

***Cookie*** — небольшой фрагмент данных, который отправляется веб-сервером и хранится на компьютере пользователя.

В техническом плане cookie представляют собой фрагменты данных, изначально отправляемых веб-сервером браузеру.
При каждом последующем посещении сайта браузер пересылает их обратно серверу.
Без cookie каждый просмотр веб-страницы является изолированным действием,
не связанным с просмотром других страниц того же сайта,
с помощью же cookie можно выявить связь между просмотром разных страниц.
Кроме отправки cookie веб-сервером, cookie могут создаваться скриптами на языках вроде JavaScript,
если они поддерживаются и включены в браузере.

### 10.1.1. Для чего нужны куки?

Применяется для сохранения данных на стороне пользователя, на практике обычно используется для:

* аутентификации пользователя
* хранения персональных предпочтений и настроек пользователя (язык, валюту или размер шрифта)
* отслеживания состояния сеанса пользователя
    * товары, которые просматривали или добавили в корзину
    * текст, который вводили на сайте раньше
* сведения статистики о пользователях
    * IP-адрес и местоположение пользователя
    * дату и время посещения сайта
    * версию ОС и браузера
    * клики и переходы

### 10.1.2. Каких видов бывают куки?

Все cookie можно разделить на несколько основных групп:

* *временные* - cookie, которые хранятся в течение одной сессии и автоматически удаляются после закрытия браузера
* *постоянные* - cookie, которые сохраняются на вашем компьютере даже после перезапуска браузера и их можно удалить вручную через настройки

* *сторонние* - cookie, которые принадлежат сторонним доменам

Например, если на сайте есть рекламный баннер с другим доменом, то браузер,
помимо основных cookie, отправит и файлы стороннего сайта. Они помогают оценить эффективность рекламы.

* *зомби-cookie* cookie, которые трудно удалить - могут храниться в других хранилищах, связанных с работой браузера

Например, cookie можно спрятать в HTTP ETag, Indexed DB, Microsoft Silverlight или в API Java.
Лучший способ защититься от таких файлов — использование только HTTPS-соединения.

### 10.1.3. Какие параметры есть у куки?

У каждого cookie есть следующие параметры:

* *name* - устанавливает имя cookie-файла
* *value* - сохраняет значение cookie, которое будет идентифицировать пользователя или содержать служебную информацию
* *expires* - и max-age определяют срок жизни cookie, по истечении которого она будет автоматически удалена

Если не указать этот параметр, или установить его значение в ноль, то cookie будут автоматически удалены при закрытии браузера.
Для параметра expires указывается конечная дата в формате Tue, 01-Sep-2020 10:50:22 GMT,
тогда как для max-age устанавливается количество секунд жизни cookie с момента установки её в браузер.

* *path* - указывает путь к директории на сервере, для которой будут доступны cookie

Если указать корневой каталог /, то cookie будут доступны всему домену.
По умолчанию значением является текущая директория, из которой cookie устанавливаются в браузер.

* *domain* - отмечает, какой домен или поддомен имеет доступ к этой cookie

Для того, чтобы сделать cookie доступными для всего домена (включая поддомены), нужно просто указать имя домена (например example.com).

* *secure* - параметр указывает браузеру, что cookie должны передаваться на сервер только по защищённому https-соединению
* *httponly* - параметр запрещает доступ к cookie посредством API document.cookie. Эта возможность была предложена в качестве меры для эффективного предотвращения краж cookie посредством XSS-атак
* *samesite* - относительно новый параметр (определённый в RFC 6265bis), который сообщает браузерам, что cookie не должны отсылаться с межсайтовыми запросами

Это в некотором роде обеспечивает защиту от межсайтовых подделок запроса (CSRF).

У этого параметра есть три состояния, которые определяют поведение cookie для различных сценариев пользования сайтом:

* samesite=*none* прямо указывает, что на передачу cookie-файлов не накладывается никаких ограничений

* samesite=*lax* разрешает передачу cookie только безопасными HTTP-методами

Согласно RFC 7231, являются GET, HEAD, OPTIONS и TRACE.

* samesite=*strict* или просто samesite является самым строгим вариантом безопасности и блокирует отправку cookie с любыми запросами от других ресурсов

Cookie будут передаваться только в пределах того домена, с которого они и были установлены.

### 10.1.4. Как работают cookie?

Технически это выглядит следующим образом.

При первом запросе:

1. В строку запроса в браузере вводится URL-адрес сайта

*Пример*

```text
http://www.example.org/index.htm
```

2. Браузер отправляет запрос на сервер сайта

*Пример*

```text
GET /index.html HTTP/1.1
Host: www.example.org
```

3. Сервер отправляет ответ браузеру

*Пример*

```text
HTTP/1.1 200 OK
Content-type: text/html
Set-Cookie: name=value
```

Там может содержаться указание браузеру сохранить cookie.

4. Браузер запоминает cookie в виде name=value (имя = значение), если есть строка Set-cookie

При каждом последующем запросе:

5. Браузер ищет на устройстве cookie

6. Если cookie найден, он отправляется в запросе на сервер сайта

*Пример*

```text
GET /spec.html HTTP/1.1
Host: www.example.org
Cookie: name=value
Accept: */*
```

7. Если cookie не найден, то он не отправляется

8. Когда сервер сайта получает данные cookie, он может их использовать

Например, идентифицирует пользователя.

## 10.2. Зачем запускать браузер с cookie?

Основная задача cookie состоит в том, чтобы сделать серфинг в Интернете более комфортным.
Пользователю не нужно постоянно вводить регистрационные данные на сайтах, которые он регулярно посещает.
При этом снижается нагрузка не сервер и повышается скорость открытия страниц.

Несколько примеров необходимости cookies:

* *автоматическая авторизация*

90% сайтов и сервисов в сети предлагают пользователям пройти регистрацию, а после входить на сайт под своим логином и паролем.
Если бы браузер не мог запоминать и хранить информацию, то юзерам приходилось бы каждый сеанс начинать с авторизации. Это муторно.
Cookie позволяют передавать сохраненные данные в фоновом режиме. Пользователь просто заходит на сайт уже авторизованным юзером.

* *коммерция в интернете*

Без cookie невозможно ни сравнить товары, ни купить их.
Корзина в онлайн-магазине использует сохраненные данные активности посетителей из cookies.txt.
для запоминания выбранной продукции. Даже если вы покинете сайт, отложенные товары сохранятся в корзине.

* *личные настройки соцсетей, поисковых систем*

Cookie помогают сохранить в настройках браузера регион проживания, язык, стиль оформления страницы и многое другое.
В противном случае настройки сбивались бы при каждом закрытии браузера.

Таким образом запуск с установленными cookie позволит воспроизвести на сайте при запуске браузера определенные условия,
необходимые для прохождения конкретного тест кейса.

## 10.3. Класс Cookie

***Cookie*** - класс, реализующий cookie.

Методы класса **Cookie**:

| Тип                 | Метод       | Описание                                       | 
|---------------------|-------------|------------------------------------------------|
| String              | getDomain() | Получение домена cookie                        |
| Date                | getExpiry() | Получение даты окончания срока действия cookie |
| String              | getName()   | Получение имени cookie                         |
| String              | getPath()   | Получение URL адреса cookie                    |
| String              | getValue()  | Получение значения cookie                      |
| Map<String, Object> | toJson()    | Преобразование в JSON объект                   |

[selenium/docs/api : Cookie](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Cookie.html)

*Пример*

```java
WebDriver driver = new ChromeDriver();
driver.manage().addCookie(new Cookie("key", "value"));
Cookie cookie = driver.manage().getCookieNamed("foo");
System.out.println(cookie.getDomain());
System.out.println(cookie.getExpiry());
System.out.println(cookie.getName());
System.out.println(cookie.getPath());
System.out.println(cookie.getValue());
```

## 10.4. Работа с куками

У интерфейса **WebDriver.Options** есть методы для работы с куками.

### 10.4.1. Добавление куки

*Пример*

```java
WebDriver driver = new ChromeDriver();
driver.manage().addCookie(new Cookie("Cookie 1", "Hello!"));
Cookie cookie = driver.manage().getCookieNamed("Cookie 1");
System.out.println(cookie.getName());
```

*Результат*

```text
Cookie 1
```

### 10.4.2. Удаление всех cookie из браузера

*Пример*

```java
WebDriver driver = new ChromeDriver();
driver.manage().addCookie(new Cookie("Cookie 1", "Hello!"));
driver.manage().addCookie(new Cookie("Cookie 1", "Hello!"));
driver.manage().addCookie(new Cookie("Cookie 2", "Hello!"));
driver.manage().addCookie(new Cookie("Cookie 3", "Hello!"));
Set<Cookie> cookiesBefore = driver.manage().getCookies();
printCookieNames(cookiesBefore);
driver.manage().deleteAllCookies();
Set<Cookie> cookiesAfter = driver.manage().getCookies();
printCookieNames(cookiesAfter);
System.out.println(cookie.getName());
```

*Результат*

```text

```

### 10.4.3. Удаление cookie из браузера

*Пример*

```java
WebDriver driver = new ChromeDriver();
Cookie cookie1 = new Cookie("Cookie 1", "Hello!"); 
driver.manage().addCookie(cookie1);
Cookie cookie2 = new Cookie("Cookie 2", "Hello!"); 
driver.manage().addCookie(cookie2);
Cookie cookie3 = new Cookie("Cookie 3", "Hello!"); 
driver.manage().addCookie(cookie3); 

Set<Cookie> cookiesBefore = driver.manage().getCookies();
printCookieNames(cookiesBefore);
driver.manage().deleteCookie(cookie1);
Set<Cookie> cookiesAfter = driver.manage().getCookies();
printCookieNames(cookiesAfter);
```

*Результат*

```text
Cookie 1
Cookie 2
Cookie 3

Cookie 2
Cookie 3
```

### 10.4.4. Удаление cookie по имени

*Пример*

```java
WebDriver driver = new ChromeDriver();
driver.manage().addCookie(new Cookie("Cookie 1", "Hello!"));
driver.manage().addCookie(new Cookie("Cookie 2", "Hello!"));
driver.manage().addCookie(new Cookie("Cookie 3", "Hello!"));
driver.manage().addCookie(cookie3);

Set<Cookie> cookiesBefore = driver.manage().getCookies();
printCookieNames(cookiesBefore);
driver.manage().deleteCookieNamed("Cookie 1");
Set<Cookie> cookiesAfter = driver.manage().getCookies();
printCookieNames(cookiesAfter);
```

*Результат*

```text
Cookie 1
Cookie 2
Cookie 3

Cookie 2
Cookie 3
```

### 10.4.5. Получение cookie по имени

*Пример*

```java
WebDriver driver = new ChromeDriver();
driver.manage().addCookie(new Cookie("Cookie 1", "Hello!"));
Cookie cookie = driver.manage().getCookieNamed("Cookie 1");
System.out.println(cookie.getName());
```

*Результат*

```text
Cookie 1
```

### 10.4.6. Получение всех cookie

*Пример*

```java
WebDriver driver = new ChromeDriver();
driver.manage().addCookie(new Cookie("Cookie 1", "Hello!"));
driver.manage().addCookie(new Cookie("Cookie 2", "Hello!"));
driver.manage().addCookie(new Cookie("Cookie 3", "Hello!"));

Set<Cookie> cookiesBefore = driver.manage().getCookies();
printCookieNames(cookiesBefore);
```

*Результат*

```text
Cookie 1
Cookie 2
Cookie 3
```

## 10.5. Исключения

### 10.5.1. InvalidCookieDomainException

***InvalidCookieDomainException*** — исключение, которое вызывается, когда куки добавляется в другой домен вместо текущего URL адреса.

[selenium/docs/api : InvalidCookieDomainException](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/InvalidCookieDomainException.html)

#### 10.5.1.1. Причины

* Добавление куки, когда страница с заданным URL еще не открыта

*Пример*

В примере ниже куки **Cookie 1** добавляется до открытия страницы **https://www.dns-shop.ru/**.

```java
@Test
public void test() {
    driver.manage().addCookie(new Cookie("Cookie 1", "This Is Cookie 1"));
    driver.get("https://www.dns-shop.ru/");
    Cookie cookie1  = driver.manage().getCookieNamed("Cookie 1");
    logger.info(String.format("Domain: %s", cookie1.getDomain()));
    logger.info(String.format("Expiry: %s",cookie1.getExpiry()));
    logger.info(String.format("Name: %s",cookie1.getName()));
    logger.info(String.format("Path: %s",cookie1.getPath()));
    logger.info(String.format("Value: %s",cookie1.getValue()));
}
```

В результате вызывается исключение **InvalidCookieDomainException**.

```text
org.openqa.selenium.InvalidCookieDomainException: invalid cookie domain
```

* Добавление куки в другой домен

*Пример*

В примере ниже куки **Cookie 1** добавляется:

* на странице **https://www.dns-shop.ru/**
* в домен **https://www.yandex.ru/**

```java
@Test
public void test() {
    driver.get("https://www.dns-shop.ru/");
    driver.manage().addCookie(
        new Cookie.Builder("Cookie 1", "This Is Cookie 1")
            .domain( "https://www.yandex.ru/")
            .build());
    Cookie cookie1  = driver.manage().getCookieNamed("Cookie 1");
    logger.info(String.format("Domain: %s", cookie1.getDomain()));
    logger.info(String.format("Expiry: %s",cookie1.getExpiry()));
    logger.info(String.format("Name: %s",cookie1.getName()));
    logger.info(String.format("Path: %s",cookie1.getPath()));
    logger.info(String.format("Value: %s",cookie1.getValue()));
}
```

В результате вызывается исключение **InvalidCookieDomainException**.

```text
org.openqa.selenium.InvalidCookieDomainException: invalid cookie domain: Cookie 'domain' mismatch
```

* Добавление куки в домен, в котором есть опечатка

*Пример*

В примере ниже куки **Cookie 1** добавляется:

* на странице **https://www.dns-shop.ru/**
* в домен **https://www.dnsshop.ru/**

```java
@Test
public void test() {
    driver.get("https://www.dns-shop.ru/");
    driver.manage().addCookie(
        new Cookie.Builder("Cookie 1", "This Is Cookie 1")
            .domain( "https://www.dnsshop.ru/")
            .build());
    Cookie cookie1  = driver.manage().getCookieNamed("Cookie 1");
    logger.info(String.format("Domain: %s", cookie1.getDomain()));
    logger.info(String.format("Expiry: %s",cookie1.getExpiry()));
    logger.info(String.format("Name: %s",cookie1.getName()));
    logger.info(String.format("Path: %s",cookie1.getPath()));
    logger.info(String.format("Value: %s",cookie1.getValue()));
}
```

В результате вызывается исключение **InvalidCookieDomainException**.

```text
org.openqa.selenium.InvalidCookieDomainException: invalid cookie domain: Cookie 'domain' mismatch
```

#### 10.5.1.2. Решения

* Проверка открытия нужной страницы перед добавлением куки

*Пример*

```java
@Test
public void test() {
    // Сперва открытие страниы
    driver.get("https://www.dns-shop.ru/");
    // Потом добавление куки
    driver.manage().addCookie(new Cookie("Cookie 1", "This Is Cookie 1"));
    Cookie cookie1  = driver.manage().getCookieNamed("Cookie 1");
    logger.info(String.format("Domain: %s", cookie1.getDomain()));
    logger.info(String.format("Expiry: %s",cookie1.getExpiry()));
    logger.info(String.format("Name: %s",cookie1.getName()));
    logger.info(String.format("Path: %s",cookie1.getPath()));
    logger.info(String.format("Value: %s",cookie1.getValue()));
}
```

* Проверка корректности домена, в который добавляется куки

*Пример*

```java
@Test
public void test() {
    driver.get("https://www.dns-shop.ru/");
    // URL домена должен быть корректным
    driver.manage().addCookie(
        new Cookie.Builder("Cookie 1", "This Is Cookie 1")
            .domain( "https://www.dns-shop.ru/")
            .build());
    Cookie cookie1  = driver.manage().getCookieNamed("Cookie 1");
    logger.info(String.format("Domain: %s", cookie1.getDomain()));
    logger.info(String.format("Expiry: %s",cookie1.getExpiry()));
    logger.info(String.format("Name: %s",cookie1.getName()));
    logger.info(String.format("Path: %s",cookie1.getPath()));
    logger.info(String.format("Value: %s",cookie1.getValue()));
}
```

Ниже пример перехвата исключения.

*Пример*

```java
@Test
public void test() {
    try {
        driver.get("https://www.dns-shop.ru/");
        driver.manage().addCookie(
            new Cookie.Builder("Cookie 1", "This Is Cookie 1")
                .domain( "https://www.dnsshop.ru/")
                .build());
        Cookie cookie1  = driver.manage().getCookieNamed("Cookie 1");
        logger.info(String.format("Domain: %s", cookie1.getDomain()));
        logger.info(String.format("Expiry: %s",cookie1.getExpiry()));
        logger.info(String.format("Name: %s",cookie1.getName()));
        logger.info(String.format("Path: %s",cookie1.getPath()));
        logger.info(String.format("Value: %s",cookie1.getValue()));
    } catch (InvalidCookieDomainException e) {
        logger.info("InvalidCookieDomainException: " + e.getRawMessage());
    }
}
```

### 10.5.2. UnableToSetCookieException

***UnableToSetCookieException*** — исключение, которое вызывается, когда **Selenium WebDriver** не может установить файл cookie.

[selenium/docs/api : UnableToSetCookieException](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/UnableToSetCookieException.html)

#### 10.5.2.1. Причины

* Установка некорректного пути до директории на сервере, для которой будут доступны куки

*Пример*

В примере ниже при создании куки **Cookie 1** указывается некорректный путь до директории на сервере, для которой будут доступны куки.

```java
@Test
public void test() {
    driver.get("https://www.dns-shop.ru/");
    driver.manage().addCookie(
        new Cookie.Builder("Cookie 1", "This Is Cookie 1")
            .path(".//")
            .build());
    Cookie cookie1  = driver.manage().getCookieNamed("Cookie 1");
    logger.info(String.format("Domain: %s", cookie1.getDomain()));
    logger.info(String.format("Expiry: %s",cookie1.getExpiry()));
    logger.info(String.format("Name: %s",cookie1.getName()));
    logger.info(String.format("Path: %s",cookie1.getPath()));
    logger.info(String.format("Value: %s",cookie1.getValue()));
}
```

В результате вызывается исключение **UnableToSetCookieException**.

```text
org.openqa.selenium.UnableToSetCookieException: unable to set cookie
```

#### 10.5.2.2. Решения

* Проверка корректности создания куки

*Пример*

```java
@Test
public void test() {
    driver.get("https://www.dns-shop.ru/");
    // Параметр path должен быть корректным
    driver.manage().addCookie(
        new Cookie.Builder("Cookie 1", "This Is Cookie 1")
            .path("/")
            .build());
    Cookie cookie1  = driver.manage().getCookieNamed("Cookie 1");
    logger.info(String.format("Domain: %s", cookie1.getDomain()));
    logger.info(String.format("Expiry: %s",cookie1.getExpiry()));
    logger.info(String.format("Name: %s",cookie1.getName()));
    logger.info(String.format("Path: %s",cookie1.getPath()));
    logger.info(String.format("Value: %s",cookie1.getValue()));
}
```

Ниже пример перехвата исключения.

*Пример*

```java
@Test
public void test() {
    try {
        driver.get("https://www.dns-shop.ru/");
        driver.manage().addCookie(
            new Cookie.Builder("Cookie 1", "This Is Cookie 1")
                .path(".//")
                .build());
        Cookie cookie1 = driver.manage().getCookieNamed("Cookie 1");
        logger.info(String.format("Domain: %s", cookie1.getDomain()));
        logger.info(String.format("Expiry: %s", cookie1.getExpiry()));
        logger.info(String.format("Name: %s", cookie1.getName()));
        logger.info(String.format("Path: %s", cookie1.getPath()));
        logger.info(String.format("Value: %s", cookie1.getValue()));
    } catch (UnableToSetCookieException e) {
        logger.info("UnableToSetCookieException: " + e.getRawMessage());
    }
}
```

***

[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Практика](https://img.shields.io/badge/-Практика-aaffaa)](2.%20Практика.md)