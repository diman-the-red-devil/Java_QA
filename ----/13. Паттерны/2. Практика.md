Java_QA / Level 2. Medium - Продвинутые темы / Урок 02. Паттерны проектирования. PageFactory

[![Назад](https://img.shields.io/badge/-%D0%9D%D0%B0%D0%B7%D0%B0%D0%B4-brightgreen)](1.%20Лекция.md)
[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](3.%20Задание.md)

***

# 1. Открытие предыдущего проекта

Шаги:

1. Запустить **IntelliJ IDEA**.

2. Открыть проект прошлого урока в **IntelliJ IDEA**.

![New Maven Project - Open...](./_Files/2.%20New%20Project/01.jpg "New Maven Project - Open...")

***

# 2. Простые классы 

## 2.1. Простой Java Объект (Plain Old Java Object (POJO))

### 2.1.1. Класс SmartphonePOJO

***SmartphonePOJO*** - класс представляющий смартфон, созданный с применением **POJO**.

Шаги:

1. Создать пакет Java **models** в папке **./src/test/java**.

![New Maven Project - models](./_Files/2.%20New%20Project/02.jpg "New Project - models")

2. Создать файл **SmartphonePOJO.java** в **./src/test/java/models**.

![New Maven Project - SmartphonePOJO.java](./_Files/2.%20New%20Project/03.jpg "New Project - SmartphonePOJO.java")

3. Добавить в файл **SmartphonePOJO.java** код.

* объявление полей класса

```java
// Оперативная память
public int ram;
// Компания
public String company;
```

* конструктор класса

```java
// Конструктор
public SmartphonePOJO(int ram, String company) {
    this.ram = ram;
    this.company = company;
}
```

### 2.1.2. Полный код SmartphonePOJO.java

[SmartphonePOJO.java](_Sample_02/src/test/java/models/SmartphonePOJO.java)

### 2.1.3. Класс SmartphonesProductPage5_Test

***SmartphonesProductPage5_Test*** - класс содержащий тесты с проверками страницы **Продукт. Смартфон**.

Класс **SmartphonesProductPage5_Test** расширяет класс **BaseTest**.

Шаги:

1. Создать файл **SmartphonesProductPage5_Test.java** в **./src/test/java/tests/smartphones**.

![New Maven Project - SmartphonesProductPage5_Test.java](./_Files/2.%20New%20Project/04.jpg "New Project - SmartphonesProductPage5_Test.java")

2. Добавить в файл **SmartphonesProductPage5_Test.java** код.

* метод **selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite** - тест

```java
@Test
// Проверка
public void selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite() {
    // 1. Arrange
    SmartphonePOJO smartphonePOJO = new SmartphonePOJO( 8, "Samsung");
    // String product = "Samsung"; // производитель
    // String ram = "8 Гб"; // объем ОП

    // 2. Act
    SmartphoneProductPage smartphoneProductPage = getProductPage(smartphonePOJO);

    // 3. Assert
    String expected = "Купить 6.7\" Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый в интернет магазине DNS. Характеристики, цена Samsung Galaxy Z Flip3 | 4845670";
    SmartphoneProductPageAssert smartphoneProductAssert = new SmartphoneProductPageAssert(smartphoneProductPage);
    smartphoneProductAssert.pageTitleEquals(expected);
}
```

* метод **getProductPage** - получение страницы с продуктом

```java
// Получение страницы с продуктом
public SmartphoneProductPage getProductPage(SmartphonePOJO smartphonePOJO) {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    // ***** Стартовая страница сайта DNS *****
    StartPageWithElements startPage = new StartPageWithElements(driver);
    // Наведение курсора мыши на ссылку "Смартфоны и гаджеты"
    startPage.linkSmartsAndGadgetsMove();
    // Нажатие на ссылку "Смартфоны"
    startPage.linkSmartsClick();

    // ***** Страница "Смартфоны" *****
    SmartphonesPageWithElements smartphonesPage = new SmartphonesPageWithElements(driver);
    // Нажатие на выпадашку "Сортировка"
    smartphonesPage.accordeonSortClick();
    // Установка сортировки "Сначала дорогие"
    smartphonesPage.rbtnExpensiveClick();
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Производитель"
    smartphonesPage.chbxCompanyClick(smartphonePOJO.company);
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на гармошку "Объем оперативной памяти"
    smartphonesPage.accordeonRAMClick();
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Объем оперативной памяти"
    smartphonesPage.chbxRAMClick(smartphonePOJO.ram + " Гб");
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на кнопку "Применить"
    smartphonesPage.btnApplyClick();
    // Прокрутка страницы вверх
    JSExec.scrollBy(0, -500);
    // Нажатие на ссылку первого продукта в списке
    smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый");
    //smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy S20 FE 128 ГБ белый");
    return new SmartphoneProductPage(driver);
}
```

### 2.1.4. Полный код SmartphonesProductPage5_Test.java

[SmartphonesProductPage5_Test.java](_Sample_02/src/test/java/tests/smartphones/SmartphonesProductPage5_Test.java)

### 2.1.5. Запуск автотеста

Шаги:

1. Запустить тест командой **mvn clean test** с параметром **-Dtest=SmartphonesProductPage5_Test**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/05.jpg "New Maven Project - Запуск теста")

2. Готово!

В результате будет выполнен тест.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/06.jpg "New Maven Project - Лог запуска")

### 2.1.5. Что изменилось и какая польза?

Теперь вместо двух переменных примитивных типов используется объект класса **SmartphonePOJO** созданный с применением **POJO**.

![New Maven Project - Что изменилось и какая польза?](./_Files/2.%20New%20Project/07.jpg "New Maven Project - Что изменилось и какая польза?")

Представьте, что в метод **getProductPage** нужно передать не 2 параметра, а 2 - 10 (заполнить от 2 до 10 разных фильтров).
Тогда нужно будет создавать новые методы и копировать логику по заполнению полей фильтров в них. 
В итоге у нас будет:

* куча дублированного кода по заполнению полей фильтров
* множество параметров с одинаковыми типами, в которых легко запутаться
* анти-паттерн **Телескопический метод** (когда в параметрах более двух аргументов)

Добавление класса **SmartphonePOJO** решает данные проблемы.

## 2.2. Паттерн Java Боб (JavaBean)

### 2.2.1. Класс SmartphoneJB

***SmartphoneJB*** - класс представляющий смартфон, созданный с применением **JavaBeans**.

Данный класс реализует интерфейс **java.io.Serializable**.

Шаги:

1. Создать файл **SmartphoneJB.java** в **./src/test/java/models**.

![New Maven Project - SmartphoneJB.java](./_Files/2.%20New%20Project/08.jpg "New Project - SmartphoneJB.java")

2. Добавить в файл **SmartphoneJB.java** код.

* объявление полей класса

```java
// Оперативная память
private int ram;
// Компания
private String company;
```

* конструктор класса по умолчанию

```java
 // Конструктор по умолчанию
public SmartphoneJB() {

}
```

* конструктор класса

```java
// Конструктор
public SmartphoneJB(int ram, String company) {
    this.ram = ram;
    this.company = company;
}
```

* cеттеры и геттеры

```java
// Сеттеры и геттеры
// Оперативная память
public void setRam(int ram) {
    this.ram = ram;
}

public int getRam() {
    return this.ram;
}
// Компания
public void setCompany(String company) {
    this.company = company;
}

public String getCompany() {
    return this.company;
}
```

### 2.2.2. Полный код SmartphoneJB.java

[SmartphoneJB.java](_Sample_02/src/test/java/models/SmartphoneJB.java)

### 2.2.3. Класс SmartphonesProductPage6_Test

***SmartphonesProductPage6_Test*** - класс содержащий тесты с проверками страницы **Продукт. Смартфон**.

Класс **SmartphonesProductPage6_Test** расширяет класс **BaseTest**.

Шаги:

1. Создать файл **SmartphonesProductPage6_Test.java** в **./src/test/java/tests/smartphones**.

![New Maven Project - SmartphonesProductPage6_Test.java](./_Files/2.%20New%20Project/09.jpg "New Project - SmartphonesProductPage6_Test.java")

2. Добавить в файл **SmartphonesProductPage6_Test.java** код.

* метод **selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite** - тест

```java
@Test
// Проверка
public void selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite() {
    // 1. Arrange
    SmartphoneJB smartphoneJB = new SmartphoneJB( 8, "Samsung");
    // String product = "Samsung"; // производитель
    // String ram = "8 Гб"; // объем ОП

    // 2. Act
    SmartphoneProductPage smartphoneProductPage = getProductPage(smartphonePOJO);

    // 3. Assert
    String expected = "Купить 6.7\" Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый в интернет магазине DNS. Характеристики, цена Samsung Galaxy Z Flip3 | 4845670";
    SmartphoneProductPageAssert smartphoneProductAssert = new SmartphoneProductPageAssert(smartphoneProductPage);
    smartphoneProductAssert.pageTitleEquals(expected);
}
```

* метод **getProductPage** - получение страницы с продуктом

```java
// Получение страницы с продуктом
public SmartphoneProductPage getProductPage(SmartphoneJB smartphoneJB) {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    // ***** Стартовая страница сайта DNS *****
    StartPageWithElements startPage = new StartPageWithElements(driver);
    // Наведение курсора мыши на ссылку "Смартфоны и гаджеты"
    startPage.linkSmartsAndGadgetsMove();
    // Нажатие на ссылку "Смартфоны"
    startPage.linkSmartsClick();

    // ***** Страница "Смартфоны" *****
    SmartphonesPageWithElements smartphonesPage = new SmartphonesPageWithElements(driver);
    // Нажатие на выпадашку "Сортировка"
    smartphonesPage.accordeonSortClick();
    // Установка сортировки "Сначала дорогие"
    smartphonesPage.rbtnExpensiveClick();
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Производитель"
    smartphonesPage.chbxCompanyClick(smartphoneJB.getCompany());
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на гармошку "Объем оперативной памяти"
    smartphonesPage.accordeonRAMClick();
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Объем оперативной памяти"
    smartphonesPage.chbxRAMClick(smartphoneJB.getRam() + " Гб");
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на кнопку "Применить"
    smartphonesPage.btnApplyClick();
    // Прокрутка страницы вверх
    JSExec.scrollBy(0, -500);
    // Нажатие на ссылку первого продукта в списке
    smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый");
    //smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy S20 FE 128 ГБ белый");
    return new SmartphoneProductPage(driver);
}
```

### 2.2.4. Полный код SmartphonesProductPage6_Test.java

[SmartphonesProductPage6_Test.java](_Sample_02/src/test/java/tests/smartphones/SmartphonesProductPage6_Test.java)

### 2.2.5. Запуск автотеста

Шаги:

1. Запустить тест командой **mvn clean test** с параметром **-Dtest=SmartphonesProductPage6_Test**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/10.jpg "New Maven Project - Запуск теста")

2. Готово!

В результате будет выполнен тест.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/11.jpg "New Maven Project - Лог запуска")

### 2.2.6. Что изменилось и какая польза?

Теперь вместо объекта класса **SmartphonePOJO** используется объект класса **SmartphoneJB** созданный с использованием **JavaBeans**.

![New Maven Project - Что изменилось и какая польза?](./_Files/2.%20New%20Project/12.jpg "New Maven Project - Что изменилось и какая польза?")

Допустим в тестах нужно будет выполнить серию проверок с разными тестовыми данными.
К примеру, у вас есть параметризованный тест с 20 комбинациями входных данных.
Тогда придется хранить тестовые данные в коде в виде списка или массива объектов.
Можно написать метод, который будет отдавать список или массив с этими данными.
А что если будет множество проверок на множестве тестовых данных?
Вероятно, со временем вам захочется хранить тестовые данные отдельно от самих тестов (**DDT (Data Driven Testing)**)
в виде файлов **XLS**, **JSON**, **CSV**, **XML** либо в другом формате (база данных например).

Для работы библиотек преобразователей объектов в форматы **XLS**, **JSON**, **CSV**, **XML** и др, классы **Java** 
должны следовать определенным правилам и соглашениям - геттеры, сеттеры, пустой конструктор. 
Это как раз и прописано в **JavaBeans**.

Написание класса **SmartphoneJB** позволяет хранить тестовые данные вне кода тестов в виде **JSON**, **CSV** файлов.

Класс **SmartphoneJB** следует соглашениям **JavaBeans**, что дает множество преимуществ:

* использование инструментов для работы с объектами **Java**
* подключение к источникам данных
* внедрение зависимостей / инверсия управления

## 2.3. Паттерн Объект Значение (Value Object (VO))

### 2.3.1. Класс Ram

***Ram*** - класс представляющий объект-значение ОП.

Данный класс реализует интерфейс **java.io.Serializable**.

Шаги:

1. Создать пакет Java **valueobjects** в папке **./src/test/java/models**.

![New Maven Project - valueobjects](./_Files/2.%20New%20Project/13.jpg "New Project - valueobjects")

2. Создать файл **Ram.java** в **./src/test/java/models/valueobjects**.

![New Maven Project - Ram.java](./_Files/2.%20New%20Project/14.jpg "New Project - Ram.java")

3. Добавить в файл **Ram.java** код.

* объявление полей класса

```java
// ОП
private int ram;
```

* конструктор класса по умолчанию

```java
// Конструктор по умолчанию
public Ram() {

}
```

* конструктор класса с проверкой

```java
// Конструктор с проверкой
public Ram(int ram) {
    // Если задано значение меньше 0, то выбросить исключение
    if (ram > 0)
        this.ram = ram;
    else
        throw new IllegalArgumentException("ОП не может быть меньше 0");
}
```

* геттеры

```java
// Геттер
public int getRam() {
    return this.ram;
}
```

* переопределенный метод сравнения

```java
// Переопределенный метод сравнения
public boolean equals(Ram otherRam) {
    return this.ram == otherRam.ram;
}
```

### 2.3.2. Полный код Ram.java

[Ram.java](_Sample_02/src/test/java/models/valueobjects/Ram.java)

### 2.3.3. Класс Company

***Company*** - класс представляющий объект-значение Производитель.

Данный класс реализует интерфейс **java.io.Serializable**.

Шаги:

1. Создать файл **Company.java** в **./src/test/java/models/valueobjects**.

![New Maven Project - Company.java](./_Files/2.%20New%20Project/15.jpg "New Project - Company.java")

2. Добавить в файл **Company.java** код.

* объявление полей класса

```java
// Производитель
private String company;
```

* конструктор класса по умолчанию

```java
// Конструктор по умолчанию
public Company() {

}
```

* конструктор класса с проверкой

```java
// Конструктор с проверкой
public Company(String company) {
    if (!company.isBlank() || !company.isEmpty())
        this.company = company;
    else
        throw new IllegalArgumentException("Наименование производителя не может быть пустым!");
}
```

* геттеры

```java
// Геттер
public String getCompany() {
    return this.company;
}
```

* переопределенный метод сравнения

```java
// Переопределенный метод сравнения
public boolean equals(Company otherCompany) {
    return this.company.equals(otherCompany.company);
}
```

### 2.3.4. Полный код Company.java

[Company.java](_Sample_02/src/test/java/models/valueobjects/Company.java)

### 2.3.5. Класс SmartphoneVO

***SmartphoneVO*** - класс представляющий смартфон, созданный с применением **JavaBeans** и **ValueObject**.

Данный класс реализует интерфейс **java.io.Serializable**.

Шаги:

1. Создать файл **SmartphoneVO.java** в **./src/test/java/models**.

![New Maven Project - SmartphoneVO.java](./_Files/2.%20New%20Project/16.jpg "New Project - SmartphoneVO.java")

2. Добавить в файл **SmartphoneVO.java** код.

* объявление полей класса

```java
// Оперативная память
private Ram ram;
// Компания
private Company company;
```

* конструктор класса по умолчанию

```java
// Конструктор по умолчанию
public SmartphoneVO() {

}
```

* конструктор класса

```java
// Конструктор
public SmartphoneVO(Ram ram, Company company) {
    this.ram = ram;
    this.company = company;
}
```

* cеттеры и геттеры

```java
// Сеттеры и геттеры
// Оперативная память
public void setRam(Ram ram) {
    this.ram = ram;
}

public Ram getRam() {
    return this.ram;
}
// Компания
public void setCompany(Company company) {
    this.company = company;
}

public Company getCompany() {
    return this.company;
}
```

### 2.3.6. Полный код SmartphoneVO.java

[SmartphoneVO.java](_Sample_02/src/test/java/models/SmartphoneVO.java)

### 2.3.7. Класс SmartphonesProductPage7_Test

***SmartphonesProductPage7_Test*** - класс содержащий тесты с проверками страницы **Продукт. Смартфон**.

Класс **SmartphonesProductPage7_Test** расширяет класс **BaseTest**.

Шаги:

1. Создать файл **SmartphonesProductPage7_Test.java** в **./src/test/java/tests/smartphones**.

![New Maven Project - SmartphonesProductPage7_Test.java](./_Files/2.%20New%20Project/17.jpg "New Project - SmartphonesProductPage7_Test.java")

2. Добавить в файл **SmartphonesProductPage7_Test.java** код.

* метод **selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite** - тест

```java
@Test
// Проверка
public void selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite() {
    // 1. Arrange
    String product = "Samsung"; // производитель
    int ram = 8; // объем ОП
    SmartphoneVO smartphoneVO = new SmartphoneVO(
        new Ram(ram),
        new Company(product)
    );

    // 2. Act
    SmartphoneProductPage smartphoneProductPage = getProductPage(smartphoneVO);

    // 3. Assert
    String expected = "Купить 6.7\" Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый в интернет магазине DNS. Характеристики, цена Samsung Galaxy Z Flip3 | 4845670";
    SmartphoneProductPageAssert smartphoneProductAssert = new SmartphoneProductPageAssert(smartphoneProductPage);
    smartphoneProductAssert.pageTitleEquals(expected);
}
```

* метод **getProductPage** - получение страницы с продуктом

```java
// Получение страницы с продуктом
public SmartphoneProductPage getProductPage(SmartphoneVO smartphoneVO) {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    // ***** Стартовая страница сайта DNS *****
    StartPageWithElements startPage = new StartPageWithElements(driver);
    // Наведение курсора мыши на ссылку "Смартфоны и гаджеты"
    startPage.linkSmartsAndGadgetsMove();
    // Нажатие на ссылку "Смартфоны"
    startPage.linkSmartsClick();

    // ***** Страница "Смартфоны" *****
    SmartphonesPageWithElements smartphonesPage = new SmartphonesPageWithElements(driver);
    // Нажатие на выпадашку "Сортировка"
    smartphonesPage.accordeonSortClick();
    // Установка сортировки "Сначала дорогие"
    smartphonesPage.rbtnExpensiveClick();
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Производитель"
    smartphonesPage.chbxCompanyClick(smartphoneVO.getCompany().getCompany());
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на гармошку "Объем оперативной памяти"
    smartphonesPage.accordeonRAMClick();
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Объем оперативной памяти"
    smartphonesPage.chbxRAMClick(smartphoneVO.getRam().getRam() + " Гб");
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на кнопку "Применить"
    smartphonesPage.btnApplyClick();
    // Прокрутка страницы вверх
    JSExec.scrollBy(0, -500);
    // Нажатие на ссылку первого продукта в списке
    smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый");
    //smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy S20 FE 128 ГБ белый");
    return new SmartphoneProductPage(driver);
}
```

### 2.3.8. Полный код SmartphonesProductPage7_Test.java

[SmartphonesProductPage7_Test.java](_Sample_02/src/test/java/tests/smartphones/SmartphonesProductPage7_Test.java)

### 2.3.9. Запуск автотеста

Шаги:

1. Запустить тест командой **mvn clean test** с параметром **-Dtest=SmartphonesProductPage7_Test**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/18.jpg "New Maven Project - Запуск теста")

2. Готово!

В результате будет выполнен тест.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/19.jpg "New Maven Project - Лог запуска")

### 2.3.10. Что изменилось и какая польза?

Теперь вместо объекта класса **SmartphoneJB** используется объект класса **SmartphoneVO**.
В классе **SmartphoneVO** вместо примитивных типов используются объекты значения (**Value Object (VO)**) - 
классы **Ram** и **Company**.

![New Maven Project - Что изменилось и какая польза?](./_Files/2.%20New%20Project/20.jpg "New Maven Project - Что изменилось и какая польза?")

Использование примитивных типов имеет несколько минусов:

* отсутствие проверки входного значения

Например, в фильтре ОП есть конкретные значения - 1, 2, 3, 4, 6, 8 и т д.
То есть нет смысла пытаться задать фильтр 5 или 7 Гб, а уж тем более -10 Гб.
Автотест просто не выполниться - **Selenium WebDriver** не найдет такого фильтра на странице.
Аналогично и для наименования производителя - не может быть наименования без букв.
Такие проверки не относятся к тестовым сценариям поиска и выбора смартфона.

* смешивание параметров

Кроме фильтра ОП есть фильтр Встроенной памяти.
Если задать эти параметры примитивными типами данных, то есть вероятность их перепутать.
Когда два таких параметра то еще ничего страшного не случится.
А если их станет намного больше двух?

* дублирование кода проверок

А теперь допустим у нас много тест кейсов, где нужно задавать много фильтров.
С примитивными типами данных нам придется везде копипастить проверки входных данных.

Создав отдельные классы объекты значения **Ram** и **Company** можно решить выше указанные проблемы.

***

# 3. Порождающие паттерны

## 3.1. Паттерн Простая Фабрика (SimpleFactory)

### 3.1.1. Фабрика веб драйверов (WebDriverFactory)

С паттерном фабрика Вы уже знакомы. Давайте закрепим пройденный материал.

#### 3.1.1.1. Перечисление BrowserName

***BrowserName*** - перечисление для хранения имен браузеров,
которые будут передаваться в качестве параметров при запуске.

Шаги:

1. Создать пакет Java **webdriverfactory** в папке **./src/test/java**.

![New Maven Project - webdriverfactory](./_Files/2.%20New%20Project/21.jpg "New Project - webdriverfactory")

2. Создать файл **BrowserName.java** в **./src/test/java/webdriverfactory**.

При создании класса выбрать **Enum** (Перечисление).

![New Maven Project - BrowserName.java](./_Files/2.%20New%20Project/22.jpg "New Project - BrowserName.java")

3. Добавить в файл **BrowserName.java** код.

* константы, определяющие названия браузеров

```java
// Имена браузеров
CHROME("chrome"),   // Google Chrome
FIREFOX("firefox"), // Mozilla Firefox
EDGE("edge");       // Microsoft Edge
```

* переменная для хранения строкового значения константы

```java
private String browserName; // Имя браузера
```

* приватный конструктор

```java
// Приватный конструктор
private BrowserName(String browserName) {
    this.browserName = browserName;
}
```

* переопределенный метод **toString**

```java
// Переопределенный метод toString()
@Override
public String toString() {
    return String.valueOf(this.browserName);
}
```

* метод **fromString** - возврат константы по строковому значению константы

```java
// Возврат значения константы по строковому значению константы
public static BrowserName fromString(String browserName) {
    if (browserName != null) {
        for(BrowserName b : BrowserName.values()) {
            if (browserName.equalsIgnoreCase(b.browserName)) {
                return b;
            }
        }
    }
    return null;
}
```

* метод **getBrowserName** - получение имени браузера

```java
// Получение имени браузера
public String getBrowserName() {
    return this.browserName;
}
```

#### 3.1.1.2. Полный код BrowserName.java

[BrowserName.java](_Sample_02/src/test/java/webdriverfactory/BrowserName.java)

#### 3.1.1.3. Класс ChromeBrowser

***ChromeBrowser*** - класс для создания и настройки экземпляра веб драйвера **Goggle Chrome**.

Шаги:

1. Создать файл **ChromeBrowser.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - ChromeBrowser.java](./_Files/2.%20New%20Project/23.jpg "New Project - ChromeBrowser.java")

2. Добавить в файл **ChromeBrowser.java** код.

* метод **getDriver** - получение экземпляра драйвера браузера **Google Chrome**

```java
// Получение экземпляра драйвера браузера "Google Chrome"
public WebDriver getDriver() {
    // Настройка исполняемого файла драйвера
    WebDriverManager.chromedriver().setup();
    
    // Опции драйвера:
    ChromeOptions options = new ChromeOptions();
    // - поведение при появлении алертов "Игнорирование"
    options.setCapability(CapabilityType.UNEXPECTED_ALERT_BEHAVIOUR, UnexpectedAlertBehaviour.IGNORE);
    // - стратегия загрузки страницы "NORMAL"
    options.setCapability(CapabilityType.PAGE_LOAD_STRATEGY, PageLoadStrategy.NORMAL);
    // - режим "Инкогнито"
    options.addArguments("--incognito");
    // - режим "Полный экран"
    options.addArguments("--start-fullscreen");
    
    // Новый экземпляр драйвера
    return new ChromeDriver(options);
}
```

#### 3.1.1.4. Полный код ChromeBrowser.java

[ChromeBrowser.java](_Sample_02/src/test/java/webdriverfactory/ChromeBrowser.java)

#### 3.1.1.5. Класс FirefoxBrowser

***FirefoxBrowser*** - класс для создания и настройки экземпляра веб драйвера **Mozilla Firefox**.

Шаги:

1. Создать файл **FirefoxBrowser.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - FirefoxBrowser.java](./_Files/2.%20New%20Project/24.jpg "New Project - FirefoxBrowser.java")

2. Добавить в файл **FirefoxBrowser.java** код.

* метод **getDriver** - получение экземпляра драйвера браузера **Mozilla Firefox**

```java
// Получение экземпляра драйвера браузера "Mozilla Firefox"
public static WebDriver getDriver() {
    // Настройка исполняемого файла драйвера
    WebDriverManager.firefoxdriver().setup();
    
    // Опции драйвера:
    FirefoxOptions options = new FirefoxOptions();
    // - поведение при появлении алертов "Игнорирование"
    options.setCapability(CapabilityType.UNEXPECTED_ALERT_BEHAVIOUR, UnexpectedAlertBehaviour.IGNORE);
    // - стратегия загрузки страницы "NORMAL"
    options.setCapability(CapabilityType.PAGE_LOAD_STRATEGY, PageLoadStrategy.NORMAL);
    // - режим "Инкогнито"
    options.addArguments("-private");
    // - режим "Полный экран"
    options.addArguments("-kiosk");
    
    // Новый экземпляр драйвера
    return new FirefoxDriver(options);
}
```

#### 3.1.1.6. Полный код FirefoxBrowser.java

[FirefoxBrowser.java](_Sample_02/src/test/java/webdriverfactory/FirefoxBrowser.java)

#### 3.1.1.7. Класс EdgeBrowser

***EdgeBrowser*** - класс для создания и настройки экземпляра веб драйвера **Microsoft Edge**.

Шаги:

1. Создать файл **EdgeBrowser.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - EdgeBrowser.java](./_Files/2.%20New%20Project/25.jpg "New Project - EdgeBrowser.java")

2. Добавить в файл **EdgeBrowser.java** код.

* метод **getDriver** - получение экземпляра драйвера браузера **Microsoft Edge**

```java
// Получение экземпляра драйвера браузера "Microsoft Edge"
public static WebDriver getDriver() {
    // Настройка исполняемого файла драйвера
    WebDriverManager.edgedriver().setup();
    
    // Опции драйвера:
    EdgeOptions options = new EdgeOptions();
    // - поведение при появлении алертов "Игнорирование"
    options.setCapability(CapabilityType.UNEXPECTED_ALERT_BEHAVIOUR, UnexpectedAlertBehaviour.IGNORE);
    // - стратегия загрузки страницы "NORMAL"
    options.setCapability(CapabilityType.PAGE_LOAD_STRATEGY, PageLoadStrategy.NORMAL);
    // - режим "Инкогнито"
    options.addArguments("--incognito");
    // - режим "Полный экран"
    options.addArguments("--start-fullscreen");
    
    // Новый экземпляр драйвера
    return new EdgeDriver(options);
}
```

#### 3.1.1.8. Полный код EdgeBrowser.java

[EdgeBrowser.java](_Sample_02/src/test/java/webdriverfactory/EdgeBrowser.java)

#### 3.1.1.9. Класс WebDriverFactory

***WebDriverFactory*** - класс реализующий паттерн фабрика, фабрика по созданию экземпляров веб драйверов.

Шаги:

1. Создать файл **WebDriverFactory.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - WebDriverFactory.java](./_Files/2.%20New%20Project/26.jpg "New Project - WebDriverFactory.java")

2. Добавить в файл **WebDriverFactory.java** код.

* объявление логгера

```java
// Логгер
private static Logger logger = LogManager.getLogger(WebDriverFactory.class);
```

* метод **getDriver** - получение экземпляра драйвера по имени

```java
// Получение экземпляра драйвера по имени
public static WebDriver getDriver(BrowserName name) {
    switch (name) {
        // Драйвер браузера Google Chrome
        case CHROME:
            logger.info("Драйвер браузера Google Chrome");
            return ChromeBrowser.getDriver();
        // Драйвер браузера Mozilla Firefox
        case FIREFOX:
            logger.info("Драйвер браузера Mozilla Firefox");
            return FirefoxBrowser.getDriver();
        // Драйвер браузера Microsoft Edge
        case EDGE:
            logger.info("Драйвер браузера Microsoft Edge");
            return EdgeBrowser.getDriver();
        // По умолчанию
        default:
            throw new RuntimeException("Некорректное наименование браузера");
    }
}
```

#### 3.1.1.10. Полный код WebDriverFactory.java

[WebDriverFactory.java](_Sample_02/src/test/java/webdriverfactory/WebDriverFactory.java)

#### 3.1.1.11. Класс BaseTest2

***BaseTest2*** - базовый класс с фабрикой драйверов для всех классов с тестами.
Содержит ссылку на экземпляр драйвера и общие для всех тестов методы, которые выполняются до и после каждого теста.

От данного класса наследуются все классы с тестами.

Шаги:

1. Создать файл **BaseTest2.java** в **./src/test/java/tests**.

![New Maven Project - BaseTest2.java](./_Files/2.%20New%20Project/27.jpg "New Project - BaseTest2.java")

3. Добавить в файл **BaseTest2.java** код.

* объявление драйвера

```java
// Драйвер браузера
protected static WebDriver driver;
```

* объявление логгера

```java
// Логгер
private Logger logger = LogManager.getLogger(BaseTest2.class);
```

* **setUp** - действия перед каждым тестом (аннотация **@BeforeEach**)

```java
// Перед каждым тестом
@BeforeEach
public void setUp() {
    // Получаем параметр запуска тестов через Maven -Dbrowser
    String browser = System
        .getProperty("browser", "chrome")
        .toLowerCase();
    // Получаем экземпляр драйвера браузера
    driver = WebDriverFactory.getDriver(BrowserName.fromString(browser));
    logger.info("Драйвер стартовал!");
}
```

* **setDown** - действия после каждого теста (аннотация **@AfterEach**)

```java
// После каждого теста
@AfterEach
public void setDown() {
    // Если драйвер еще существует
    if(driver != null) {
        // Закрываем его
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

#### 3.1.1.12. Полный код BaseTest2.java

[BaseTest2.java](_Sample_02/src/test/java/tests/BaseTest2.java)

#### 3.1.1.13. Класс SmartphonesProductPage8_Test

***SmartphonesProductPage8_Test*** - класс содержащий тесты с проверками страницы **Продукт. Смартфон**.

Класс **SmartphonesProductPage8_Test** расширяет класс **BaseTest2**.

Шаги:

1. Создать файл **SmartphonesProductPage8_Test.java** в **./src/test/java/tests/smartphones**.

![New Maven Project - SmartphonesProductPage8_Test.java](./_Files/2.%20New%20Project/28.jpg "New Project - SmartphonesProductPage8_Test.java")

2. Добавить в файл **SmartphonesProductPage8_Test.java** код.

* метод **selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite** - тест

```java
@Test
// Проверка
public void selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite() {
    // 1. Arrange
    String product = "Samsung"; // производитель
    int ram = 8; // объем ОП
    SmartphoneVO smartphoneVO = new SmartphoneVO(
        new Ram(ram),
        new Company(product)
    );

    // 2. Act
    SmartphoneProductPage smartphoneProductPage = getProductPage(smartphoneVO);

    // 3. Assert
    String expected = "Купить 6.7\" Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый в интернет магазине DNS. Характеристики, цена Samsung Galaxy Z Flip3 | 4845670";
    SmartphoneProductPageAssert smartphoneProductAssert = new SmartphoneProductPageAssert(smartphoneProductPage);
    smartphoneProductAssert.pageTitleEquals(expected);
}
```

* метод **getProductPage** - получение страницы с продуктом

```java
// Получение страницы с продуктом
public SmartphoneProductPage getProductPage(SmartphoneVO smartphoneVO) {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    // ***** Стартовая страница сайта DNS *****
    StartPageWithElements startPage = new StartPageWithElements(driver);
    // Наведение курсора мыши на ссылку "Смартфоны и гаджеты"
    startPage.linkSmartsAndGadgetsMove();
    // Нажатие на ссылку "Смартфоны"
    startPage.linkSmartsClick();

    // ***** Страница "Смартфоны" *****
    SmartphonesPageWithElements smartphonesPage = new SmartphonesPageWithElements(driver);
    // Нажатие на выпадашку "Сортировка"
    smartphonesPage.accordeonSortClick();
    // Установка сортировки "Сначала дорогие"
    smartphonesPage.rbtnExpensiveClick();
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Производитель"
    smartphonesPage.chbxCompanyClick(smartphoneVO.getCompany().getCompany());
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на гармошку "Объем оперативной памяти"
    smartphonesPage.accordeonRAMClick();
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Объем оперативной памяти"
    smartphonesPage.chbxRAMClick(smartphoneVO.getRam().getRam() + " Гб");
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на кнопку "Применить"
    smartphonesPage.btnApplyClick();
    // Прокрутка страницы вверх
    JSExec.scrollBy(0, -500);
    // Нажатие на ссылку первого продукта в списке
    smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый");
    //smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy S20 FE 128 ГБ белый");
    return new SmartphoneProductPage(driver);
}
```

#### 3.1.1.14. Полный код SmartphonesProductPage8_Test.java

[SmartphonesProductPage8_Test.java](_Sample_02/src/test/java/tests/smartphones/SmartphonesProductPage8_Test.java)

#### 3.1.1.15. Запуск автотеста

Шаги:

1. Запустить тест командой **mvn clean test** с параметром **-Dtest=SmartphonesProductPage8_Test**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/29.jpg "New Maven Project - Запуск теста")

2. Готово!

В результате будет выполнен тест.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/30.jpg "New Maven Project - Лог запуска")

#### 3.1.1.16. Что изменилось и какая польза?

В класс фабрику **WebDriverFactory** была вынесена логика по инициализации и настройке драйверов браузера.
В классе **BaseTest2** поменяв всего один параметр можно запустить тесты на другом драйвере браузера.

### 3.1.2. Фабрика страниц (PageFactory)

#### 3.1.2.1. Перечисление PageName

***PageName*** - перечисление для хранения имен страниц (пейдж обджектов).

Шаги:

1. Создать файл **PageName.java** в **./src/test/java/pages**.

При создании класса выбрать **Enum** (Перечисление).

![New Maven Project - PageName.java](./_Files/2.%20New%20Project/31.jpg "New Project - PageName.java")

3. Добавить в файл **PageName.java** код.

* константы, определяющие названия страниц (пейдж обджектов)

```java
// Имена страниц (пейдж обджектов)
START_PAGE("Стартовая страница"),
SMARTPHONES_PAGE("Страница \"Смартфоны\""),
SMARTPHONE_PRODUCT_PAGE("Страница \"Продукт. Смартфон\"");
```

* переменная для хранения строкового значения константы

```java
private String pageName; // Имя страницы (пейдж обджекта)
```

* приватный конструктор

```java
// Приватный конструктор
private PageName(String pageName) {
    this.pageName = pageName;
}
```

* переопределенный метод **toString**

```java
// Переопределенный метод toString()
@Override
public String toString() {
    return String.valueOf(this.pageName);
}
```

* метод **fromString** - возврат константы по строковому значению константы

```java
// Возврат значения константы по строковому значению константы
public static PageName fromString(String pageName) {
    if (pageName != null) {
        for(PageName p : PageName.values()) {
            if (pageName.equalsIgnoreCase(p.pageName)) {
                 return p;
            }
        }
    }
    return null;
}
```

* метод **getPageName** - получение имени страницы (пейдж обджекта)

```java
// Получение имени страницы (пейдж обджекта)
public String getPageName() {
    return this.pageName;
}
```

#### 3.1.2.2. Полный код PageName.java

[PageName.java](_Sample_02/src/test/java/pages/PageName.java)

#### 3.1.2.3. Класс PageFactory

***PageFactory*** - класс реализующий паттерн фабрика, фабрика по созданию экземпляров страниц (пейдж обджектов).

Шаги:

1. Создать файл **PageFactory.java** в **./src/test/java/pages**.

![New Maven Project - PageFactory.java](./_Files/2.%20New%20Project/32.jpg "New Project - PageFactory.java")

2. Добавить в файл **PageFactory.java** код.

* объявление логгера

```java
// Логгер
private static Logger logger = LogManager.getLogger(PageFactory.class);
```

* метод **getPage** - получение экземпляра страницы (пейдж обджекта)

```java
// Получение экземпляра страницы (пейдж обджекта)
public static BasePage getPage(WebDriver driver, PageName name) {
    switch (name) {
        // Стартовая страница
        case START_PAGE:
            logger.info("Стартовая страница");
            StartPageWithElements startPageWithElements =
            new StartPageWithElements(driver);
            // Инициализация некоторых элементов страницы
            return startPageWithElements;
        // Страница "Смартфоны"
        case SMARTPHONES_PAGE:
            logger.info("Страница \"Смартфоны\"");
            SmartphonesPageWithElements smartphonesPageWithElements =
            new SmartphonesPageWithElements(driver);
            // Инициализация некоторых элементов страницы
            return smartphonesPageWithElements;
        // Страница "Продукт. Смартфон"
        case SMARTPHONE_PRODUCT_PAGE:
            logger.info("Страница \"Продукт. Смартфон\"");
            SmartphoneProductPage smartphoneProductPage =
            new SmartphoneProductPage(driver);
            // Инициализация некоторых элементов страницы
            return smartphoneProductPage;
        // По умолчанию
        default:
            throw new RuntimeException("Некорректное наименование страницы (пейдж обджекта)");
    }
}
```

#### 3.1.2.4. Полный код PageFactory.java

[PageFactory.java](_Sample_02/src/test/java/pages/PageFactory.java)

#### 3.1.2.5. Что изменилось и какая польза?

В класс фабрику **PageFactory** была вынесена логика по инициализации пейдж обджектов.
На первый взгляд ни какого профита нет, но вместо комментария *Инициализация некоторых элементов страницы* можно
добавить некоторый код по созданию веб элементов страницы - так сказать ленивую инициализацию.
В библиотеке **Selenium WebDriver** есть стандартный класс **PageFactory** в котором данный паттерн реализован 
покрасивее и универсальнее через рефлексию и аннотации **@FindBy**.

Однако есть ряд минусов:

1. Через аннотацию **@FindBy** нельзя задать динамический локатор.
То есть когда часть локатора может быть изменена.
Из за этого придется создавать кучу объектов **WebElement** или 
в код самих тестов вставлять локаторы и логику по поиску элементов.

2. Проблема с динамическими веб элементами. 
Опять же проблема из за статичных локаторов. Если использовать **PageFactory** из коробки, то придется завязываться
на какой нибудь верхнеуровневый элемент и далее внутри него уже проводить перебор.

Вывод: использовать **PageFactory** из библиотеки **Selenium WebDriver** или 
использовать паттерн **PageFactory** вообще - это дело вкуса. 
В Интернете можно найти два противоположных мнения на счет этого.

## 3.2. Паттерн Строитель (Builder)

### 3.2.1. Билдер тестовых данных

#### 3.2.1.1. Класс Smartphone

***Smartphone*** - класс представляющий смартфон, созданный с применением **JavaBeans** и **ValueObject**.

Данный класс реализует интерфейс **java.io.Serializable**.
Это такой же класс, что был раннее в практике, с тем лишь отличием, 
что были добавлены два поля и соответствующие геттеры и сеттеры.

Шаги:

1. Создать файл **Smartphone.java** в **./src/test/java/models**.

![New Maven Project - Smartphone.java](./_Files/2.%20New%20Project/33.jpg "New Project - Smartphone.java")

2. Добавить в файл **Smartphone.java** код.

* объявление полей класса

```java
// Оперативная память
private Ram ram;
// Внутренняя память
private int rom;
// Производитель
private Company company;
// Модель
private String model;
```

* конструктор класса по умолчанию

```java
// Конструктор по умолчанию
public Smartphone() {

}
```

* конструктор класса

```java
// Конструктор
public Smartphone(Ram ram, Company company) {
    this.ram = ram;
    this.company = company;
}
```

* cеттеры и геттеры

```java
// Сеттеры и геттеры
// Оперативная память
public void setRam(Ram ram) {
    this.ram = ram;
}

public Ram getRam() {
    return this.ram;
}
// Внутренняя память
public void setRom(int rom) {
    this.rom = rom;
}

public int getRom() {
    return rom;
}
// Производитель
public void setCompany(Company company) {
    this.company = company;
}

public Company getCompany() {
    return this.company;
}
// Модель
public void setModel(String model) {
    this.model = model;
}

public String getModel() {
    return model;
}
```

#### 3.2.1.2. Полный код Smartphone.java

[Smartphone.java](_Sample_02/src/test/java/models/Smartphone.java)

#### 3.2.1.3. Класс SmartphoneBuilder

***SmartphoneBuilder*** - класс строитель объекта **Smartphone**.

Шаги:

1. Создать файл **SmartphoneBuilder.java** в **./src/test/java/models**.

![New Maven Project - SmartphoneBuilder.java](./_Files/2.%20New%20Project/34.jpg "New Project - SmartphoneBuilder.java")

2. Добавить в файл **SmartphoneBuilder.java** код.

* объявление полей класса аналогично полям класса **Smartphone**

```java
// Оперативная память
private Ram ram;
// Внутренняя память
private int rom = 256; // значение заданное по умолчанию - 256
// Производитель
private Company company;
// Модель
private String model = "Galaxy S20"; // значение заданное по умолчанию - Galaxy S20
```

* конструктор с параметрами 

```java
// Конструктор
public SmartphoneBuilder(Ram ram, Company company) {
    this.ram = ram;
    this.company = company;
}
```

* методы установки значений полей класса **Smartphone**

```java
// Установка значения поля "Внутренняя память"
public SmartphoneBuilder setRom(int rom) {
    this.rom = rom;
    return this;
}

// Установка значения поля "Модель"
public SmartphoneBuilder setModel(String model) {
    this.model = model;
    return this;
}
```

* метод создания объекта класса **Smartphone**

```java
// Создание объекта "Смартфон"
public Smartphone build() {
    Smartphone smartphone = new Smartphone();
    smartphone.setRam(this.ram);
    smartphone.setRom(this.rom);
    smartphone.setCompany(this.company);
    smartphone.setModel(this.model);
    return smartphone;
}
```

#### 3.2.1.4. Полный код SmartphoneBuilder.java

[SmartphoneBuilder.java](_Sample_02/src/test/java/models/SmartphoneBuilder.java)

#### 3.2.1.5. Класс SmartphonesProductPage9_Test

***SmartphonesProductPage9_Test*** - класс содержащий тесты с проверками страницы **Продукт. Смартфон**.

Класс **SmartphonesProductPage9_Test** расширяет класс **BaseTest2**.

Шаги:

1. Создать файл **SmartphonesProductPage9_Test.java** в **./src/test/java/tests/smartphones**.

![New Maven Project - SmartphonesProductPage9_Test.java](./_Files/2.%20New%20Project/35.jpg "New Project - SmartphonesProductPage9_Test.java")

2. Добавить в файл **SmartphonesProductPage9_Test.java** код.

* метод **selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite** - тест

```java
@Test
// Проверка
public void selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite() {
    // 1. Arrange
    SmartphoneBuilder builder = new SmartphoneBuilder(
        new Ram(8),                          // Оперативная память
        new Company("Samsung"))              // Производитель
        .setRom(256)                         // Внутренняя память
        .setModel("S20");                    // Модель
    Smartphone smartphone = builder.build(); // Создание объекта

    // 2. Act
    SmartphoneProductPage smartphoneProductPage = getProductPage(smartphone);

    // 3. Assert
    String expected = "Купить 6.7\" Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый в интернет магазине DNS. Характеристики, цена Samsung Galaxy Z Flip3 | 4845670";
    SmartphoneProductPageAssert smartphoneProductAssert = new SmartphoneProductPageAssert(smartphoneProductPage);
    smartphoneProductAssert.pageTitleEquals(expected);
}
```

* метод **getProductPage** - получение страницы с продуктом

```java
// Получение страницы с продуктом
public SmartphoneProductPage getProductPage(Smartphone smartphone) {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    // ***** Стартовая страница сайта DNS *****
    StartPageWithElements startPage = new StartPageWithElements(driver);
    // Наведение курсора мыши на ссылку "Смартфоны и гаджеты"
    startPage.linkSmartsAndGadgetsMove();
    // Нажатие на ссылку "Смартфоны"
    startPage.linkSmartsClick();

    // ***** Страница "Смартфоны" *****
    SmartphonesPageWithElements smartphonesPage = new SmartphonesPageWithElements(driver);
    // Нажатие на выпадашку "Сортировка"
    smartphonesPage.accordeonSortClick();
    // Установка сортировки "Сначала дорогие"
    smartphonesPage.rbtnExpensiveClick();
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Производитель"
    smartphonesPage.chbxCompanyClick(smartphone.getCompany().getCompany());
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на гармошку "Объем оперативной памяти"
    smartphonesPage.accordeonRAMClick();
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Объем оперативной памяти"
    smartphonesPage.chbxRAMClick(smartphone.getRam().getRam() + " Гб");
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на кнопку "Применить"
    smartphonesPage.btnApplyClick();
    // Прокрутка страницы вверх
    JSExec.scrollBy(0, -500);
    // Нажатие на ссылку первого продукта в списке
    smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый");
    //smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy S20 FE 128 ГБ белый");
    return new SmartphoneProductPage(driver);
}
```

#### 3.2.1.6. Полный код SmartphonesProductPage9_Test.java

[SmartphonesProductPage9_Test.java](_Sample_02/src/test/java/tests/smartphones/SmartphonesProductPage9_Test.java)

#### 3.2.1.7. Запуск автотеста

Шаги:

1. Запустить тест командой **mvn clean test** с параметром **-Dtest=SmartphonesProductPage9_Test**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/36.jpg "New Maven Project - Запуск теста")

2. Готово!

В результате будет выполнен тест.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/37.jpg "New Maven Project - Лог запуска")

#### 3.2.1.8. Что изменилось и какая польза?

Экземпляр класса **Smartphone** создается через объект Строитель.

Некоторые классы могут содержать очень много полей (намного больше 2 или 3). И не все эти поля являются обязательными. 
Например, нам необязательно во всех кейсах устанавливать все фильтры и потом проверять эти значения на странице продукта (смартфона).
А что тогда делать в этом случае? Создавать +100500 телескопических конструкторов на все случаи жизни?

Нет, для это есть паттерн Строитель (**Builder**), который позволяет нам собирать объект по частям.
Строго говоря в самом простом случае можно было бы обойтись и без него используя дефолтный конструктор и сеттеры.
Но паттерн Строитель - это не просто вызов сеттеров. Следует понимать, что иногда есть строгая последовательность шагов 
по инициализации полей класса и есть поля которые нужно обязательно инициализировать, и вот тут уже видны преимущества паттерна Строитель. 
Ответственность по инициализации полей возлагается на Строителя, а не на клиентский код.

***

# 4. Структурные паттерны

## 4.1. Паттерн Фасад (Facade)

### 4.1.1. Фасад страниц

#### 4.1.1.1. Класс StartPageSteps

***StartPageSteps*** - класс описывающий шаги по взаимодействию со страницей "Стартовая".

Шаги:

1. Создать пакет Java **steps** в папке **./src/test/java**.

![New Maven Project - steps](./_Files/2.%20New%20Project/38.jpg "New Project - steps")

2. Создать файл **StartPageSteps.java** в **./src/test/java/steps**.

![New Maven Project - StartPageSteps.java](./_Files/2.%20New%20Project/39.jpg "New Project - StartPageSteps.java")

3. Добавить в файл **StartPageSteps.java** код.

* объявление логгера

```java
// Логгер
private static Logger logger = LogManager.getLogger(StartPageSteps.class);
```

* объявление ссылки на объект класса **StartPageWithElements**

```java
// Ссылка на объект класса StartPageWithElements
private StartPageWithElements startPage;
```

* конструктор

```java
// Конструктор
public StartPageSteps(StartPageWithElements startPage) {
    // ***** Стартовая страница сайта DNS *****
    this.startPage = startPage;
    logger.info("Открыта страница [Стартовая страница DNS]");
}
```

* метод **clickLinkSmarts** - нажатие на ссылку "Смартфоны"

```java
// Нажатие на ссылку "Смартфоны"
public void clickLinkSmarts() {
    // Наведение курсора мыши на ссылку "Смартфоны и гаджеты"
    startPage.linkSmartsAndGadgetsMove();
    // Нажатие на ссылку "Смартфоны"
    startPage.linkSmartsClick();
}
```

#### 4.1.1.2. Полный код StartPageSteps.java

[StartPageSteps.java](_Sample_02/src/test/java/steps/StartPageSteps.java)

#### 4.1.1.3. Класс SmartphonesPageSteps

***SmartphonesPageSteps*** - класс описывающий шаги по взаимодействию со страницей "Смартфоны".

Шаги:

1. Создать файл **SmartphonesPageSteps.java** в **./src/test/java/steps**.

![New Maven Project - SmartphonesPageSteps.java](./_Files/2.%20New%20Project/40.jpg "New Project - SmartphonesPageSteps.java")

2. Добавить в файл **SmartphonesPageSteps.java** код.

* объявление логгера

```java
// Логгер
private static Logger logger = LogManager.getLogger(StartPageSteps.class);
```

* объявление ссылки на объект класса **StartPageWithElements**

```java
// Ссылка на объект класса SmartphonesPageWithElements
private SmartphonesPageWithElements smartphonesPage;
```

* конструктор

```java
// Конструктор
public SmartphonesPageSteps(SmartphonesPageWithElements smartphonesPage) {
    // ***** Страница "Смартфоны" *****
    this.smartphonesPage = smartphonesPage;
    logger.info("Открыта страница [Смартфоны]");
}
```

* метод **orderByExpensiveFirst** - установка сортировки "Сначала дорогие"

```java
// Установка сортировки "Сначала дорогие"
public void orderByExpensiveFirst() {
    // Нажатие на выпадашку "Сортировка"
    smartphonesPage.accordeonSortClick();
    // Установка сортировки "Сначала дорогие"
    smartphonesPage.rbtnExpensiveClick();
}
```

* метод **filterByCompany** - установка фильтра "Производитель"

```java
// Установка фильтра "Производитель"
public void filterByCompany(Company company) {
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Производитель"
    smartphonesPage.chbxCompanyClick(company.getCompany());
}
```

* метод **filterByRAM** - установка фильтра "Объем оперативной памяти"

```java
// Установка фильтра "Объем оперативной памяти"
public void filterByRAM(Ram ram) {
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на гармошку "Объем оперативной памяти"
    smartphonesPage.accordeonRAMClick();
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Объем оперативной памяти"
    smartphonesPage.chbxRAMClick(ram.getRam() + " Гб");
}
```

* метод **clickButtonApply** - нажатие на кнопку "Применить"

```java
// Нажатие на кнопку "Применить"
public void clickButtonApply() {
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на кнопку "Применить"
    smartphonesPage.btnApplyClick();
}
```

* метод **clickLinkFirstProduct** - нажатие на ссылку первого продукта в списке

```java
// Нажатие на ссылку первого продукта в списке
public void clickLinkFirstProduct(String product) {
    // Прокрутка страницы вверх
    JSExec.scrollBy(0, -500);
    // Нажатие на ссылку первого продукта в списке
    smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый");
    //smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy S20 FE 128 ГБ белый");
}
```

#### 4.1.1.4. Полный код SmartphonesPageSteps.java

[SmartphonesPageSteps.java](_Sample_02/src/test/java/steps/SmartphonesPageSteps.java)

#### 4.1.1.5. Класс SmartphoneProductPageSteps

***SmartphoneProductPageSteps*** - класс описывающий шаги по взаимодействию со страницей "Смартфоны".

Шаги:

1. Создать файл **SmartphoneProductPageSteps.java** в **./src/test/java/steps**.

![New Maven Project - SmartphoneProductPageSteps.java](./_Files/2.%20New%20Project/41.jpg "New Project - SmartphoneProductPageSteps.java")

2. Добавить в файл **SmartphoneProductPageSteps.java** код.

* объявление логгера

```java
// Логгер
private static Logger logger = LogManager.getLogger(SmartphoneProductPageSteps.class);
```

* объявление ссылки на объект класса **SmartphoneProductPage**

```java
// Ссылка на объект класса SmartphoneProductPage
private SmartphoneProductPage smartphoneProductPage;
```

* конструктор

```java
// Конструктор
public SmartphoneProductPageSteps(SmartphoneProductPage smartphoneProductPage) {
    // ***** Страница "Продукт. Смартфон" *****
    this.smartphoneProductPage = smartphoneProductPage;
    logger.info("Открыта страница [Продукт. Смартфон]");
}
```

* метод **pageTitle** - получение заголовка текущей страницы

```java
// Получение заголовка текущей страницы
public String pageTitle() {
return smartphoneProductPage.getPageTitle();
}
```

#### 4.1.1.6. Полный код SmartphoneProductPageSteps.java

[SmartphoneProductPageSteps.java](_Sample_02/src/test/java/steps/SmartphoneProductPageSteps.java)

#### 4.1.1.7. Класс SmartphoneProductPageAssert2

***SmartphoneProductPageAssert2*** - класс матчер.

Шаги:

1. Создать файл **SmartphoneProductPageAssert2.java** в **./src/test/java/tests/smartphones**.

![New Maven Project - SmartphoneProductPageAssert2.java](./_Files/2.%20New%20Project/42.jpg "New Project - SmartphoneProductPageAssert2.java")

2. Добавить в файл **SmartphoneProductPageAssert2.java** код.

* объявление ссылки на объект класса с описанием шагов на странице "Продукт. Смартфон"

```java
// Шаги на странице "Продукт. Смартфон"
SmartphoneProductPageSteps smartphoneProductPageSteps;
```

* конструктор

```java
// Конструктор
public SmartphoneProductPageAssert2(SmartphoneProductPageSteps smartphoneProductPageSteps) {
    this.smartphoneProductPageSteps = smartphoneProductPageSteps;
}
```

* метод **pageTitleEquals** - проверка (матчер) соответствия заголовка страницы

```java
// Проверка / Утверждение (Матчер)
public void pageTitleEquals(String expected) {
    String actual = smartphoneProductPageSteps.pageTitle();
    Assertions.assertEquals(expected, actual, "Ошибка! Заголовок страницы не соответствует ожидаемому!");
}
```

#### 4.1.1.8. Полный код SmartphoneProductPageAssert2.java

[SmartphoneProductPageAssert.java](_Sample_02/src/test/java/tests/smartphones/SmartphoneProductPageAssert2.java)

#### 4.1.1.9. Класс SmartphonesProductPage10_Test

***SmartphonesProductPage10_Test*** - класс содержащий тесты с проверками страницы **Продукт. Смартфон**.

Класс **SmartphonesProductPage10_Test** расширяет класс **BaseTest2**.

Шаги:

1. Создать файл **SmartphonesProductPage10_Test.java** в **./src/test/java/tests/smartphones**.

![New Maven Project - SmartphonesProductPage10_Test.java](./_Files/2.%20New%20Project/43.jpg "New Project - SmartphonesProductPage10_Test.java")

2. Добавить в файл **SmartphonesProductPage10_Test.java** код.

* метод **selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite** - тест

```java
@Test
// Проверка
public void selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite() {
    // 1. Arrange
    SmartphoneBuilder builder = new SmartphoneBuilder(
        new Ram(8),                          // Оперативная память
        new Company("Samsung"))              // Производитель
        .setRom(256)                         // Внутренняя память
        .setModel("S20");                    // Модель
    Smartphone smartphone = builder.build(); // Создание объекта

    // 2. Act
    SmartphoneProductPage smartphoneProductPage = getProductPage(smartphone);

    // 3. Assert
    String expected = "Купить 6.7\" Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый в интернет магазине DNS. Характеристики, цена Samsung Galaxy Z Flip3 | 4845670";
    SmartphoneProductPageAssert2 smartphoneProductAssert = new SmartphoneProductPageAssert2(smartphoneProductPageSteps);
    smartphoneProductAssert.pageTitleEquals(expected);
}
```

* метод **getProductPage** - получение страницы с продуктом

```java
// Получение страницы с продуктом
public SmartphoneProductPageSteps getProductPage(Smartphone smartphone) {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    
    // ***** Стартовая страница сайта DNS *****
    StartPageSteps startPageSteps = new StartPageSteps(new StartPageWithElements(driver));
    // Нажатие на ссылку "Смартфоны"
    startPageSteps.clickLinkSmarts();
    
    // ***** Страница "Смартфоны" *****
    SmartphonesPageSteps smartphonesPageSteps = new SmartphonesPageSteps(new SmartphonesPageWithElements(driver));
    // Установка сортировки "Сначала дорогие"
    smartphonesPageSteps.orderByExpensiveFirst();
    // Установка фильтра "Производитель"
    smartphonesPageSteps.filterByCompany(smartphone.getCompany());
    // Установка фильтра "Объем оперативной памяти"
    smartphonesPageSteps.filterByRAM(smartphone.getRam());
    // Нажатие на кнопку "Применить"
    smartphonesPageSteps.clickButtonApply() ;
    // Нажатие на ссылку первого продукта в списке
    smartphonesPageSteps.clickLinkFirstProduct("Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый");
    //smartphonesPageSteps.clickLinkFirstProduct("Смартфон Samsung Galaxy S20 FE 128 ГБ белый");
        
    // ***** Страница "Продукт. Смартфон" *****
    return new SmartphoneProductPageSteps(new SmartphoneProductPage(driver));
}
```

#### 4.1.1.10. Полный код SmartphonesProductPage10_Test.java

[SmartphonesProductPage10_Test.java](_Sample_02/src/test/java/tests/smartphones/SmartphonesProductPage10_Test.java)

#### 4.1.1.11. Запуск автотеста

Шаги:

1. Запустить тест командой **mvn clean test** с параметром **-Dtest=SmartphonesProductPage10_Test**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/44.jpg "New Maven Project - Запуск теста")

2. Готово!

В результате будет выполнен тест.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/45.jpg "New Maven Project - Лог запуска")

#### 4.1.1.12. Что изменилось и какая польза?

Шаги по выполнению тестовых кейсов вынесены в отдельные классы.
Данные классы реализуют паттерн Фасад (**Facade**).

Какой профит получили?

1. Разделение бизнес логики и технических деталей.
Классы-фасады скрывают технические подробности взаимодействия со страницей, оставляя бизнес логику.
В этот класс мы можем также перенести вывод логов из классов объектов-страниц.
Можно еще больше абстрагироваться создав метод по фильтрации внутри которого будут скрыты подробности выбора фильтров.

2. Переиспользование шагов
Все шаги можно повторно использовать в других кейсах не дублируя весь код с тех реализацией шагов.

***

Задание [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](3.%20Задание.md)