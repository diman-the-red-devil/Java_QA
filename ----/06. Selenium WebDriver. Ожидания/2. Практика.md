Java_QA / 06. Selenium WebDriver. Ожидания

[![Лекция](https://img.shields.io/badge/-Лекция-ee99ff)](1.%20Лекция.md)
[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Задание](https://img.shields.io/badge/-Задание-99ffee)](3.%20Задание.md)

***

# Содержание

***

# 1. Открытие предыдущего проекта

Шаги:

1. Запустить **IntelliJ IDEA**.

2. Открыть проект прошлого урока в **IntelliJ IDEA**.

![New Maven Project - Open...](./_Files/5.%20New%20Project/01.jpg "New Maven Project - Open...")

3. Удалить все файлы .java из папки **./src/test/java** кроме **WebDriverFactory.java**

***

# 2. Стратегии загрузки страницы (PageLoadStrategy)

## 2.1. Стратегия загрузки страницы NORMAL

Шаги:

1. Создать файл **PageLoadStrategyTest.java** в **./src/test/java**.

![New Maven Project - PageLoadStrategyTest.java](./_Files/5.%20New%20Project/02.jpg "New Maven Project - PageLoadStrategyTest.java")

2. Добавить в файл **PageLoadStrategyTest.java** код.

* метод **pageLoadStrategyNormalTest** - стратегия загрузки страницы **NORMAL**

```java
@Test
public void pageLoadStrategyNormalTest() {
    WebDriverManager.edgedriver().setup();
    logger.info("Драйвер для браузера MS Edge");
    EdgeOptions options = new EdgeOptions();
    options.addArguments("--start-maximized");
    // Устанавливаем стратегию загрузки страницы - NORMAL
    options.setPageLoadStrategy(PageLoadStrategy.NORMAL);
    WebDriver driver = new EdgeDriver(options);

    long start = System.currentTimeMillis();
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница DNS - https://www.dns-shop.ru/");
    WebElement element = driver.findElement(By.xpath("//a[text()=\"Магазины\"]"));
    element.click();
    long finish = System.currentTimeMillis();
    long time = finish - start;
    logger.info("Затраченное время: " + (time / 1000) + " секунд");

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }

    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=PageLoadStrategyTest#pageLoadStrategyNormalTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/03.jpg "New Maven Project - Запуск теста")

4. Готово!
   
В результате драйвер дождется полной загрузки страницы 
(то есть, момент, когда свойство **document.readyState** примет значение **complete**), 
прежде чем будет выполнен клик по ссылке. 
На это будет потрачено примерно 12 секунд.

В консоли будет выведен лог запуска. 

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/04.jpg "New Maven Project - Лог запуска")

## 2.2. Стратегия загрузки страницы EAGER

Шаги:

1. Открыть файл **PageLoadStrategyTest.java** в **./src/test/java**.

2. Добавить в файл **PageLoadStrategyTest.java** код.

* метод **pageLoadStrategyEagerTest** - стратегия загрузки страницы **EAGER**

```java
@Test
public void pageLoadStrategyEagerTest() {
    WebDriverManager.edgedriver().setup();
    logger.info("Драйвер для браузера MS Edge");
    EdgeOptions options = new EdgeOptions();
    options.addArguments("--start-maximized");
    // Устанавливаем стратегию загрузки страницы - EAGER
    options.setPageLoadStrategy(PageLoadStrategy.EAGER);
    WebDriver driver = new EdgeDriver(options);

    long start = System.currentTimeMillis();
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница DNS - https://www.dns-shop.ru/");
    WebElement element = driver.findElement(By.xpath("//a[text()=\"Магазины\"]"));
    element.click();
    long finish = System.currentTimeMillis();
    long time = finish - start;
    logger.info("Затраченное время: " + (time / 1000) + " секунд");

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }

    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=PageLoadStrategyTest#pageLoadStrategyEagerTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/05.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате драйвер дождется частичной загрузки страницы 
(то есть, момент, когда свойство **document.readyState** примет значение **interactive**), 
прежде чем будет выполнен клик по ссылке.
На это будет потрачено примерно 5 секунд. То есть в два раза быстрее, чем при загрузке страницы со стратегией **NORMAL**.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/06.jpg "New Maven Project - Лог запуска")

## 2.3. Стратегия загрузки страницы NONE

Шаги:

1. Открыть файл **PageLoadStrategyTest.java** в **./src/test/java**.

2. Добавить в файл **PageLoadStrategyTest.java** код.

* метод **pageLoadStrategyNoneTest** - стратегия загрузки страницы **NONE**

```java
@Test
public void pageLoadStrategyNoneTest() {
    WebDriverManager.edgedriver().setup();
    logger.info("Драйвер для браузера MS Edge");
    EdgeOptions options = new EdgeOptions();
    options.addArguments("--start-maximized");
    // Устанавливаем стратегию загрузки страницы - NONE
    options.setPageLoadStrategy(PageLoadStrategy.NONE);
    WebDriver driver = new EdgeDriver(options);

    try {
        long start = System.currentTimeMillis();
        driver.get("https://www.dns-shop.ru/");
        logger.info("Открыта страница DNS - https://www.dns-shop.ru/");
        WebElement element = driver.findElement(By.xpath("//a[text()=\"Магазины\"]"));
        element.click();
        long finish = System.currentTimeMillis();
        long time = finish - start;
        logger.info("Затраченное время: " + (time / 1000) + " секунд");
    } catch (Exception e) {
        logger.info("Возникло исключение: " + e.getClass());
        if(driver != null) {
            driver.quit();
            logger.info("Драйвер остановлен!");
        }
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=PageLoadStrategyTest#pageLoadStrategyNoneTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/07.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате драйвер не будет ждать загрузки страницы вообще, прежде чем будет выполнен клик по ссылке.
Но так как на странице еще нет ссылки, то будет выброшено исключение **NoSuchElementException**.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/08.jpg "New Maven Project - Лог запуска")

## 2.4. Полный код PageLoadStrategyTest.java

[PageLoadStrategyTest.java](_Sample/src/test/java/PageLoadStrategyTest.java)

***

# 3. Неявные ожидания (Implicit Waits)

## 3.1. implicitlyWait(Duration duration)

Шаги:

1. Создать файл **ImplicitWaitsTest.java** в **./src/test/java**.

![New Maven Project - ImplicitWaitsTest.java](./_Files/5.%20New%20Project/09.jpg "New Maven Project - ImplicitWaitsTest.java")

2. Добавить в файл код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(ImplicitWaitsTest.class);
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* метод **implicitlyWaitTest** - неявное ожидание появления элемента на странице

```java
@Test
public void implicitlyWaitTest() {
    // Установить неявное ожидание до появления элемента на странице
    driver.manage().timeouts().implicitlyWait(Duration.ofSeconds(10));
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница DNS - https://www.dns-shop.ru/");
    // Нажать на ссылку Магазины
    WebElement linkShops = driver.findElement(By.xpath("//a[text()=\"Магазины\"]"));
    linkShops.click();
    logger.info("Нажата ссылка Магазины");
    // Нажать на выпадашку Каталог
    WebElement spanCatalog = driver.findElement(By.xpath("//span[@class=\"catalog-spoiler \"]"));
    spanCatalog.click();
    logger.info("Нажата выпадашка Каталог");
    // Нажать на ссылку Бытовая техника
    WebElement linkAppliances = driver.findElement(By.xpath("//a[text()=\"Бытовая техника\"]"));
    linkAppliances.click();
    logger.info("Нажата ссылка Бытовая техника");
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ImplicitWaitsTest#implicitlyWaitTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/10.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате клик по ссылке в выпадашке выполниться успешно.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/11.jpg "New Maven Project - Лог запуска")

5. Поменять код теста

* в методе **implicitlyWaitTest** установить неявное ожидание появления элемента в 1 миллисекунду

```java
@Test
public void implicitlyWaitTest() {
    // Установить неявное ожидание до появления элемента на странице
    driver.manage().timeouts().implicitlyWait(Duration.ofMillis(1));
    ...
}
```

6. Запустить тест командой **mvn clean test** с параметром **-Dtest=ImplicitWaitsTest#implicitlyWaitTest**.

7. Готово!

В результате при попытке выполнить клик по ссылке в выпадашке возникнет исключение **NoSuchElementException**.
Так как по истечению 1 миллисекунды ссылка в выпадашке не успела появиться.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/12.jpg "New Maven Project - Лог запуска")

## 3.2. pageLoadTimeout(Duration duration)

Шаги:

1. Открыть файл **ImplicitWaitsTest.java** в **./src/test/java**.

2. Добавить в файл **ImplicitWaitsTest.java** код.

* метод **pageLoadTimeoutTest** - неявное ожидание завершения загрузки страницы

```java
@Test
public void pageLoadTimeoutTest() {
    // Установить неявное ожидание до завершения загрузки страницы
    driver.manage().timeouts().pageLoadTimeout(Duration.ofSeconds(100));
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница DNS - https://www.dns-shop.ru/");
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ImplicitWaitsTest#pageLoadTimeoutTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/13.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате клик по ссылке в выпадашке выполниться успешно.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/14.jpg "New Maven Project - Лог запуска")

5. Поменять код теста

* в метод **pageLoadTimeoutTest** установить неявное ожидание завершения загрузки страницы в 1 секунду

```java
@Test
public void pageLoadTimeoutTest() {
    // Установить неявное ожидание до завершения загрузки страницы
    driver.manage().timeouts().pageLoadTimeout(Duration.ofSeconds(1));
    ...
}
```

6. Запустить тест командой **mvn clean test** с параметром **-Dtest=ImplicitWaitsTest#pageLoadTimeoutTest**.

7. Готово!

В результате при попытке загрузить страницу возникнет исключение **TimeoutException**.
Так как по истечению 1 секунды страница загрузиться не успела.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/15.jpg "New Maven Project - Лог запуска")

## 3.3. setScriptTimeout(Duration duration)

Шаги:

1. Открыть файл **ImplicitWaitsTest.java** в **./src/test/java**.

2. Добавить в файл **ImplicitWaitsTest.java** код.

* метод **setScriptTimeoutTest** - неявное ожидание завершения выполнения асинхронного сценария

```java
@Test
public void setScriptTimeoutTest() {
    // Установить неявное ожидание до завершения выполнения асинхронного сценария
    driver.manage().timeouts().setScriptTimeout(Duration.ofSeconds(1));
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница DNS - https://www.dns-shop.ru/");
    ((JavascriptExecutor) driver).executeAsyncScript("window.setTimeout(arguments[arguments.length - 1], 500);");
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ImplicitWaitsTest#setScriptTimeoutTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/16.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скрипт выполниться успешно.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/17.jpg "New Maven Project - Лог запуска")

5. Поменять код теста

* в метод **setScriptTimeoutTest** установить неявное ожидание завершения выполнения асинхронного сценария в 0 секунд

```java
@Test
public void implicitlyWaitTest() {
    // Установить неявное ожидание до завершения загрузки страницы
    driver.manage().timeouts().setScriptTimeout(Duration.ofSeconds(0));
    ...
}
```

6. Запустить тест командой **mvn clean test** с параметром **-Dtest=ImplicitWaitsTest#setScriptTimeoutTest**.

7. Готово!

В результате при выполнении асинхронного скрипта возникнет исключение **ScriptTimeoutException**.
Так как за 0 секунд асинхронный скрипт не успеет выполниться.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/18.jpg "New Maven Project - Лог запуска")

## 3.4. Полный код ImplicitWaitsTest.java

[ImplicitWaitsTest.java](_Sample/src/test/java/ImplicitWaitsTest.java)

***

# 4. Явные ожидания (Explicit Waits)

## 4.1. Атрибуты и свойства элементов

Шаги:

1. Создать файл **ExplicitWaitsTest.java** в **./src/test/java**.

![New Maven Project - ExplicitWaitsTest.java](./_Files/5.%20New%20Project/19.jpg "New Maven Project - ExplicitWaitsTest.java")

2. Добавить в файл код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(ExplicitWaitsTest.class);
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* метод **elementAttributeExpectedConditionTest**

```java
@Test
public void elementAttributeExpectedConditionTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/Accordion/index.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/Accordion/index.html");
    // Раскрыть гармошку
    // Кликнуть на кнопку [Manual Testing]
    By btnManualTestingXpath = By.xpath("//button[text()=\"Manual Testing\"]");
    WebElement btnManualTesting = driver.findElement(btnManualTestingXpath);
    btnManualTesting.click();
    // Подождать пока не покажется блок с текстом
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    By divManualTestingXpath = By.xpath("//button[text()=\"Manual Testing\"]/following-sibling::div[1]");
    WebElement divManualTesting = driver.findElement(divManualTestingXpath);
    wait.until(ExpectedConditions.attributeToBe(divManualTesting, "style", "max-height: 70px;"));
    logger.info("Гармошка раскрыта!");

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ExplicitWaitsTest#elementAttributeExpectedConditionTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/20.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате клик по гармошке выполниться успешно.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/21.jpg "New Maven Project - Лог запуска")

## 4.2. Состояние элементов

Шаги:

1. Открыть файл **ExplicitWaitsTest.java** в **./src/test/java**.

2. Добавить в файл **ExplicitWaitsTest.java** код.

* метод **elementStateExpectedConditionTest**

```java
@Test
public void elementStateExpectedConditionTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/Dropdown-Checkboxes-RadioButtons/index.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/Dropdown-Checkboxes-RadioButtons/index.html");
    // Подождать пока чекбокс [Option 1] не станет кликабельным
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    By chbOption1Xpath = By.xpath("//label[text()=\"Option 1\"]");
    WebElement chbOption1 = driver.findElement(chbOption1Xpath);
    wait.until(ExpectedConditions.elementToBeClickable(chbOption1));
    // Проставить чекбокс [Option 1]
    chbOption1.click();
    logger.info("Чекбокс проставлен!");

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ExplicitWaitsTest#elementStateExpectedConditionTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/22.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате проставится чекбокс *Option 1*.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/23.jpg "New Maven Project - Лог запуска")

## 4.3. Количество элементов

Шаги:

1. Открыть файл **ExplicitWaitsTest.java** в **./src/test/java**.

2. Добавить в файл **ExplicitWaitsTest.java** код.

* метод **elementsNumberExpectedConditionTest**

```java
@Test
public void elementsNumberExpectedConditionTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/Dropdown-Checkboxes-RadioButtons/index.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/Dropdown-Checkboxes-RadioButtons/index.html");
    // Подождать пока количество чекбоксов имеющих текст [Option] не будет 4
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    By chbOptionXpath = By.xpath("//label[contains(text(),\"Option\")]");
    wait.until(ExpectedConditions.numberOfElementsToBe(chbOptionXpath, 4));
    // Подсчитать количество чекбоксов имеющих текст [Option]
    List<WebElement> chbOption = driver.findElements(chbOptionXpath);
    int count = chbOption.size();
    logger.info("Чекбоксов имеющих текст [Option]: " + count);

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ExplicitWaitsTest#elementsNumberExpectedConditionTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/24.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет подсчитано количество чекбоксов имеющих текст *Option*.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/25.jpg "New Maven Project - Лог запуска")

## 4.4. Наличие элементов

Шаги:

1. Открыть файл **ExplicitWaitsTest.java** в **./src/test/java**.

2. Добавить в файл **ExplicitWaitsTest.java** код.

* метод **elementPresenceExpectedConditionTest**

```java
@Test
public void elementPresenceExpectedConditionTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/Autocomplete-TextField/autocomplete-textfield.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/Autocomplete-TextField/autocomplete-textfield.html");
    // Ввести текст в поле ввода [Food Item]
    By tbxFoodItemXpath = By.xpath("//div[@class=\"autocomplete\"]/input");
    WebElement tbxFoodItem = driver.findElement(tbxFoodItemXpath);
    tbxFoodItem.sendKeys("Ca");
    // Подождать пока отобразятся подсказки
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    By divAutoCompleteXpath = By.xpath("//div/input[@type=\"hidden\"]");
    wait.until(ExpectedConditions.presenceOfAllElementsLocatedBy(divAutoCompleteXpath));
    // Вывести в лог содержимое подсказок
    List<WebElement> divAutoComplete = driver.findElements(divAutoCompleteXpath);
    for (WebElement element : divAutoComplete) {
    logger.info("Подсказка: " + element.getAttribute("value"));
    }

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ExplicitWaitsTest#elementPresenceExpectedConditionTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/26.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате отобразятся все подсказки.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/27.jpg "New Maven Project - Лог запуска")

## 4.5. Отсутствие элементов

Шаги:

1. Открыть файл **ExplicitWaitsTest.java** в **./src/test/java**.

2. Добавить в файл **ExplicitWaitsTest.java** код.

* метод **elementStalenessExpectedConditionTest**

```java
@Test
public void elementStalenessExpectedConditionTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/Autocomplete-TextField/autocomplete-textfield.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/Autocomplete-TextField/autocomplete-textfield.html");
    // Ввести текст в поле ввода [Food Item]
    By tbxFoodItemXpath = By.xpath("//div[@class=\"autocomplete\"]/input");
    WebElement tbxFoodItem = driver.findElement(tbxFoodItemXpath);
    tbxFoodItem.sendKeys("Ca");
    // Подождать пока отобразятся подсказки
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    By divCabbageXpath = By.xpath("//input[@value=\"Cabbage\"]//parent::div");
    wait.until(ExpectedConditions.presenceOfElementLocated(divCabbageXpath));
    // Найти подсказку Cabbage
    WebElement divCabbage = driver.findElement(divCabbageXpath);
    divCabbage.click();
    // Очистить поле ввода [Food Item]
    tbxFoodItem.clear();
    // Ввести текст в поле ввода [Food Item]
    tbxFoodItem.sendKeys("Ba");
    // Подождать отсутствие подсказки Cabbage
    wait.until(ExpectedConditions.stalenessOf(divCabbage));
    
    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ExplicitWaitsTest#elementStalenessExpectedConditionTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/28.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате среди подсказок не будет подсказки *Cabbage*.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/29.jpg "New Maven Project - Лог запуска")

## 4.6. Видимость элементов

Шаги:

1. Открыть файл **ExplicitWaitsTest.java** в **./src/test/java**.

2. Добавить в файл **ExplicitWaitsTest.java** код.

* метод **elementVisibilityExpectedConditionTest**

```java
@Test
public void elementVisibilityExpectedConditionTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/Dropdown-Checkboxes-RadioButtons/index.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/Dropdown-Checkboxes-RadioButtons/index.html");
    // Нажать на выпадашку [JAVA]
    By selProgLangsXpath = By.xpath("//h2[text()=\"Dropdown Menu(s)\"]/following-sibling::div/select[1]");
    WebElement selProgLangs = driver.findElement(selProgLangsXpath);
    selProgLangs.click();
    logger.info("Нажата выпадашка [JAVA]");
    // Подождать пока отобразится вариант для выбора [Python] в выпадашке [JAVA]
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    By optJavaXpath = By.xpath("//h2[text()=\"Dropdown Menu(s)\"]/following-sibling::div/select[1]/option[@value=\"python\"]");
    wait.until(ExpectedConditions.visibilityOfElementLocated(optJavaXpath));
    logger.info("Отображается вариант для выбора [Python]");
    // Выбрать вариант для выбора [Python]
    WebElement optJava = driver.findElement(optJavaXpath);
    optJava.click();
    logger.info("Выбран вариант для выбора [Python]");

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ExplicitWaitsTest#elementVisibilityExpectedConditionTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/30.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате клик по варианту *Python* выполниться успешно.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/31.jpg "New Maven Project - Лог запуска")

## 4.7. Невидимость элементов

Шаги:

1. Открыть файл **ExplicitWaitsTest.java** в **./src/test/java**.

2. Добавить в файл **ExplicitWaitsTest.java** код.

* метод **elementInvisibilityExpectedConditionTest**

```java
@Test
public void elementInvisibilityExpectedConditionTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/Hidden-Elements/index.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/Hidden-Elements/index.html");
    // Подождать что не отобразится элемент [Not Displayed]
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    By divSpanXpath = By.xpath("//div/span[1]");
    wait.until(ExpectedConditions.invisibilityOfElementLocated(divSpanXpath));
    logger.info("Не отображается элемент [Not Displayed]");

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ExplicitWaitsTest#elementInvisibilityExpectedConditionTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/32.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате не отображается элемент *Not Displayed*.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/33.jpg "New Maven Project - Лог запуска")

## 4.8. Текстовое содержимое элементов

Шаги:

1. Открыть файл **ExplicitWaitsTest.java** в **./src/test/java**.

2. Добавить в файл **ExplicitWaitsTest.java** код.

* метод **elementTextExpectedConditionTest**

```java
@Test
public void elementTextExpectedConditionTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/Accordion/index.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/Accordion/index.html");
    // Вывести текст в блоке с @id="text-appear-box"
    By divPXpath = By.xpath("//div[@id=\"text-appear-box\"]/p");
    WebElement divP = driver.findElement(divPXpath);
    logger.info("Текст в блоке @id=\"text-appear-box\": " + divP.getText());
    // Подождать пока смениться текст в блоке
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    wait.until(ExpectedConditions.textToBe(divPXpath, "LOADING COMPLETE."));
    // Вывести текст в блоке с @id="text-appear-box"
    logger.info("Текст в блоке @id=\"text-appear-box\": " + divP.getText());
    
    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ExplicitWaitsTest#elementTextExpectedConditionTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/34.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате отображается текст *LOADING COMPLETE.*.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/35.jpg "New Maven Project - Лог запуска")

## 4.9. Работа со страницей

Шаги:

1. Открыть файл **ExplicitWaitsTest.java** в **./src/test/java**.

2. Добавить в файл **ExplicitWaitsTest.java** код.

* метод **pageExpectedConditionTest**

```java
@Test
public void pageExpectedConditionTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/index.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/index.html");
    // Подождать пока появится заголовок страницы
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    wait.until(ExpectedConditions.titleContains("WebDriverUniversity.com"));
    // Вывести текст в блоке с @id="text-appear-box"
    logger.info("Заголовок страницы: " + driver.getTitle());

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ExplicitWaitsTest#pageExpectedConditionTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/36.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате отображается страница.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/37.jpg "New Maven Project - Лог запуска")

## 4.10. Работа с алертами

Шаги:

1. Открыть файл **ExplicitWaitsTest.java** в **./src/test/java**.

2. Добавить в файл **ExplicitWaitsTest.java** код.

* метод **alertExpectedConditionTest**

```java
@Test
public void alertExpectedConditionTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/Popup-Alerts/index.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/Popup-Alerts/index.html");
    // Нажать на кнопку [CLICK ME!] в блоке [JavaScript Alert]
    By spanJSAlertXpath = By.xpath("//h2[text()=\"JavaScript Alert\"]/following-sibling::div/span");
    WebElement spanJSAlert = driver.findElement(spanJSAlertXpath);
    spanJSAlert.click();
    logger.info("Нажата кнопка [CLICK ME!] в блоке [JavaScript Alert]");
    // Подождать пока появится алерт
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    wait.until(ExpectedConditions.alertIsPresent());
    logger.info("Алерт отобразился!");

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ExplicitWaitsTest#alertExpectedConditionTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/38.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате отображается алерт.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/39.jpg "New Maven Project - Лог запуска")

## 4.11. Работа с фреймами

Шаги:

1. Открыть файл **ExplicitWaitsTest.java** в **./src/test/java**.

2. Добавить в файл **ExplicitWaitsTest.java** код.

* метод **frameExpectedConditionTest**

```java
@Test
public void frameExpectedConditionTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/IFrame/index.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/IFrame/index.html");
    // Подождать доступность фрейма и переключиться на него
    By iframeXpath = By.xpath("//iframe");
    WebElement iframe = driver.findElement(iframeXpath);
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    wait.until(ExpectedConditions.frameToBeAvailableAndSwitchToIt(iframe));
    logger.info("Выполнено переключение на фрейм");

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ExplicitWaitsTest#frameExpectedConditionTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/40.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет выполнено переключение на фрейм.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/41.jpg "New Maven Project - Лог запуска")

## 4.12. Работа с окнами

Шаги:

1. Открыть файл **ExplicitWaitsTest.java** в **./src/test/java**.

2. Добавить в файл **ExplicitWaitsTest.java** код.

* метод **windowsExpectedConditionTest**

```java
@Test
public void windowsExpectedConditionTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/index.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/index.html");
    // Подождать когда будет открыто одно окно
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    wait.until(ExpectedConditions.numberOfWindowsToBe(1));
    logger.info("Открыто одно окно");

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ExplicitWaitsTest#windowsExpectedConditionTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/42.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет открыто одно окно.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/43.jpg "New Maven Project - Лог запуска")

## 4.13. Работа с JS скриптом

Шаги:

1. Открыть файл **ExplicitWaitsTest.java** в **./src/test/java**.

2. Добавить в файл **ExplicitWaitsTest.java** код.

* метод **jsScriptExpectedConditionTest**

```java
@Test
public void jsScriptExpectedConditionTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/index.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/index.html");
    // Подождать выполнения JS скрипта
    String jsScript = "window.setTimeout(arguments[arguments.length - 1], 500);";
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    wait.until(ExpectedConditions.javaScriptThrowsNoExceptions(jsScript));
    logger.info("Выполнение JS скрипта успешно");

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ExplicitWaitsTest#jsScriptExpectedConditionTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/44.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет выполнен JS скрипт без вызова исключений.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/45.jpg "New Maven Project - Лог запуска")

## 4.14. Работа с логическими функциями

Шаги:

1. Открыть файл **ExplicitWaitsTest.java** в **./src/test/java**.

2. Добавить в файл **ExplicitWaitsTest.java** код.

* метод **logicalExpectedConditionTest**

```java
@Test
public void logicalExpectedConditionTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/IFrame/index.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/IFrame/index.html");
    // Подождать доступность фрейма и переключиться на него
    By iframeXpath = By.xpath("//iframe");
    WebElement iframe = driver.findElement(iframeXpath);
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    wait.until(ExpectedConditions.and(
        ExpectedConditions.numberOfWindowsToBe(1),
        ExpectedConditions.frameToBeAvailableAndSwitchToIt(iframe)));
    logger.info("Открыто одно окно и выполнено переключение на фрейм");

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ExplicitWaitsTest#logicalExpectedConditionTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/46.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет открыто одно окно и выполнено переключение на фрейм.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/47.jpg "New Maven Project - Лог запуска")

## 4.15. Полный код ExplicitWaitsTest.java

[ExplicitWaitsTest.java](_Sample/src/test/java/ExplicitWaitsTest.java)

***

# 5. Кастомные условия ожидания (ExpectedCondition)

## 5.1. Именованный класс 

Шаги:

1. Создать файл **CustomExpectedConditionTest.java** в **./src/test/java**.

![New Maven Project - CustomExpectedConditionTest.java](./_Files/5.%20New%20Project/48.jpg "New Maven Project - CustomExpectedConditionTest.java")

2. Добавить в файл код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(CustomExpectedConditionTest.class);
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* вложенный класс **AlertExpectedCondition**, реализующий интерфейс **ExpectedCondition**

```java
class AlertExpectedCondition implements ExpectedCondition<Alert>  {
    // Переопределение метода apply
    // Пробуем переключиться на алерт
    @Override
    public Alert apply(WebDriver driver) {
        try {
            return driver.switchTo().alert();
        } catch (NoAlertPresentException e) {
            return null;
        }
    }
}
```

* метод **namedClassTest** - неявное ожидание появления элемента на странице

```java
@Test
public void namedClassTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/Popup-Alerts/index.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/Popup-Alerts/index.html");
    // Нажать на кнопку [CLICK ME!] в блоке [JavaScript Alert]
    By spanJSAlertXpath = By.xpath("//h2[text()=\"JavaScript Alert\"]/following-sibling::div/span");
    WebElement spanJSAlert = driver.findElement(spanJSAlertXpath);
    spanJSAlert.click();
    logger.info("Нажата кнопка [CLICK ME!] в блоке [JavaScript Alert]");
    // Подождать пока появится алерт
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    wait.until(new AlertExpectedCondition());
    logger.info("Алерт отобразился!");

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=CustomExpectedConditionTest#namedClassTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/49.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет выполнено переключение на фрейм.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/50.jpg "New Maven Project - Лог запуска")

## 5.2. Анонимный класс

Шаги:

1. Открыть файл **CustomExpectedConditionTest.java** в **./src/test/java**.

2. Добавить в файл **CustomExpectedConditionTest.java** код.

* метод **anonymousClassTest**

```java
@Test
public void anonymousClassTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/Popup-Alerts/index.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/Popup-Alerts/index.html");
    // Нажать на кнопку [CLICK ME!] в блоке [JavaScript Alert]
    By spanJSAlertXpath = By.xpath("//h2[text()=\"JavaScript Alert\"]/following-sibling::div/span");
    WebElement spanJSAlert = driver.findElement(spanJSAlertXpath);
    spanJSAlert.click();
    logger.info("Нажата кнопка [CLICK ME!] в блоке [JavaScript Alert]");
    // Подождать пока появится алерт
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
    wait.until(
        // Анонимный класс new ExpectedCondition<Alert>()          
        new ExpectedCondition<Alert>() {
        @Override
        public Alert apply(WebDriver input) {
            try {
                return driver.switchTo().alert();
            } catch (NoAlertPresentException e) {
                return null;
            }
        }
    });
    logger.info("Алерт отобразился!");

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=CustomExpectedConditionTest#anonymousClassTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/51.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет выполнено переключение на фрейм.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/52.jpg "New Maven Project - Лог запуска")

## 5.3. Полный код CustomExpectedConditionTest.java

[CustomExpectedConditionTest.java](_Sample/src/test/java/CustomExpectedConditionTest.java)

***

# 6. Fluent Wait

## 6.1. Ожидание Fluent Wait

Шаги:

1. Создать файл **FluentWaitTest.java** в **./src/test/java**.

![New Maven Project - CustomExpectedConditionTest.java](./_Files/5.%20New%20Project/53.jpg "New Maven Project - FluentWaitTest.java")

2. Добавить в файл код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(FluentWaitTest.class);
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* метод **fluentWaitTest** - неявное ожидание появления элемента на странице

```java
@Test
public void fluentWaitTest() {
    // Открыть страницу webdriveruniversity.com
    driver.get("https://webdriveruniversity.com/Popup-Alerts/index.html");
    logger.info("Открыта страница webdriveruniversity.com - https://webdriveruniversity.com/Popup-Alerts/index.html");
    // Нажать на кнопку [CLICK ME!] в блоке [JavaScript Alert]
    By spanJSAlertXpath = By.xpath("//h2[text()=\"JavaScript Alert\"]/following-sibling::div/span");
    WebElement spanJSAlert = driver.findElement(spanJSAlertXpath);
    spanJSAlert.click();
    logger.info("Нажата кнопка [CLICK ME!] в блоке [JavaScript Alert]");
    // Подождать пока появится алерт
    FluentWait<WebDriver> wait = new FluentWait<WebDriver>(driver)
        .withTimeout(Duration.ofSeconds(10))
        .pollingEvery(Duration.ofMillis(100))
        .ignoring(NoSuchElementException.class);
    wait.until(ExpectedConditions.alertIsPresent());
    logger.info("Алерт отобразился!");
    
    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=FluentWaitTest#fluentWaitTest**.

![New Maven Project - Запуск теста](./_Files/5.%20New%20Project/54.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет выполнено переключение на фрейм.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/5.%20New%20Project/55.jpg "New Maven Project - Лог запуска")

## 6.2. Полный код FluentWaitTest.java

[FluentWaitTest.java](_Sample/src/test/java/FluentWaitTest.java)

***

[![Лекция](https://img.shields.io/badge/-Лекция-ee99ff)](1.%20Лекция.md)
[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Задание](https://img.shields.io/badge/-Задание-99ffee)](3.%20Задание.md)