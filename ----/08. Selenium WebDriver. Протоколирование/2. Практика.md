Java_QA / Level 1. Easy - Основы / 1.1. Selenium WebDriver / Урок 10. Протоколирование

[![Назад](https://img.shields.io/badge/-%D0%9D%D0%B0%D0%B7%D0%B0%D0%B4-brightgreen)](1. Лекция.md)
[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](3. Задание.md)

***

# 1. Открытие предыдущего проекта

Шаги:

1. Запустить **IntelliJ IDEA**.

2. Открыть проект прошлого урока в **IntelliJ IDEA**.

![New Maven Project - Open...](./_Files/2.%20New%20Project/01.jpg "New Maven Project - Open...")

3. Удалить все файлы .java из папки **./src/test/java** кроме **WebDriverFactory.java**

***

# 2. Чтение логов

## 2.1. Доступные типы логов

Шаги:

1. Создать файл **LogsTest.java** в **./src/test/java**.

![New Maven Project - LogsTest.java](./_Files/2.%20New%20Project/02.jpg "New Maven Project - LogsTest.java")

2. Добавить в файл **LogsTest.java** код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(LogsTest.class);
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* метод **availableLogTypesTest** - получение доступных типов логов

```java
@Test
public void availableLogTypesTest() {
    // Получение доступных типов логов
    Set<String> availableLogTypes = driver.manage().logs().getAvailableLogTypes();
    for (String s : availableLogTypes)
        logger.info("Log Type:  " + s);
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=LogsTest#availableLogTypesTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/03.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет выведен список доступных типов логов.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/04.jpg "New Maven Project - Лог запуска")

## 2.2. Получение логов заданного типа

Шаги:

1. Открыть файл **WebDriverFactory.java** в **./src/test/java**.
   
2. Изменить в файле **WebDriverFactory.java** код.

* метод **getDriver** - инициализация драйвера для браузера **Microsoft Edge**

```java
case "edge" :
    WebDriverManager.edgedriver().setup();
    logger.info("Драйвер для браузера Microsoft Edge");
    EdgeOptions edgeOptions = new EdgeOptions();
    edgeOptions.addArguments("--start-maximized");
    return new EdgeDriver(edgeOptions);
```

3. Открыть файл **LogsTest.java** в **./src/test/java**.

4. Изменить в файле **LogsTest.java** код.

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("edge");
    logger.info("Драйвер стартовал!");
}
```

Добавить в файл **LogsTest.java** код.

* метод **logsByTypeTest** - получение логов заданного типа (BROWSER)

```java
@Test
public void logsByTypeTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Получить логи
    Logs logs = driver.manage().logs();
    LogEntries logsEntries = logs.get(LogType.BROWSER);
    List<LogEntry> logsEntriesList = logsEntries.getAll();
    for (LogEntry logsEntry : logsEntriesList) {
        logger.info(Date.from(Instant.ofEpochSecond(logsEntry.getTimestamp())) + " " +
            logsEntry.getLevel() + " " + logsEntry.getMessage());
    }
}
```

5. Запустить тест командой **mvn clean test** с параметром **-Dtest=LogsTest#logsByTypeTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/05.jpg "New Maven Project - Запуск теста")

6. Готово!

В результате будут получены логи заданного типа (BROWSER).

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/06.jpg "New Maven Project - Лог запуска")

## 2.3. Получение логов заданного типа и уровня

Шаги:

1. Открыть файл **LogsTest.java** в **./src/test/java**.

2. Добавить в файл **LogsTest.java** код.

* метод **logsByTypeAndLevelTest** - получение логов заданного типа (BROWSER) и уровня (SEVERE)

```java
@Test
public void logsByTypeAndLevelTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Получить логи
    Logs logs = driver.manage().logs();
    LogEntries logsEntries = logs.get(LogType.BROWSER);
    List<LogEntry> logsEntriesList = logsEntries.getAll().stream()
        .filter(a -> a.getLevel() == Level.SEVERE)
        .collect(Collectors.toList());
    for (LogEntry logsEntry : logsEntriesList) {
        logger.info(Date.from(Instant.ofEpochMilli(logsEntry.getTimestamp())) + " " +
            logsEntry.getLevel() + " " + logsEntry.getMessage());
    }
}
```

5. Запустить тест командой **mvn clean test** с параметром **-Dtest=LogsTest#logsByTypeAndLevelTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/07.jpg "New Maven Project - Запуск теста")

6. Готово!

В результате будут получены логи заданного типа (BROWSER) и уровня (SEVERE).

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/08.jpg "New Maven Project - Лог запуска")

## 2.4. Полный код LogsTest.java

[LogsTest.java](_Sample_10/src/test/java/LogsTest.java)

***

# 3. Снятие скриншотов

## 3.1. Снятие скриншотов с помощью TakeScreenshot

### 3.1.1. Скриншот видимой области веб страницы

Шаги:

1. Создать файл **ScreenShotsTest.java** в **./src/test/java**.

![New Maven Project - ScreenShotsTest.java](./_Files/2.%20New%20Project/09.jpg "New Maven Project - ScreenShotsTest.java")

2. Добавить в файл **ScreenShotsTest.java** код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(ScreenShotsTest.class);
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* метод **takesScreenshotViewablePageTest** - скриншот видимой области веб страницы

```java
@Test
public void takesScreenshotViewablePageTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сделать скриншот видимой области веб страницы
    try {
        File file = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);
        BufferedImage linkYesImage = ImageIO.read(file);
        ImageIO.write(linkYesImage, "png", new File("temp\\TSViewablePage.png"));
        logger.info("Скриншот сохранен в файле [temp\\TSViewablePage.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#takesScreenshotViewablePageTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/10.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот видимой области веб страницы будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/11.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/12.jpg "New Maven Project - Лог запуска")

### 3.1.2. Скриншот веб элемента

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **takesScreenshotElementTest** - скриншот веб элемента

```java
@Test
public void takesScreenshotElementTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сделать скриншот веб элемента
    try {
        By divSubcategoryXPath = By.xpath("//div[@class=\"subcategory\"]");
        WebElement divSubcategory = driver.findElement(divSubcategoryXPath);
        File file = divSubcategory.getScreenshotAs(OutputType.FILE);
        BufferedImage viewablePageImage = ImageIO.read(file);
        ImageIO.write(viewablePageImage, "png", new File("temp\\TSElement.png"));
        logger.info("Скриншот сохранен в файле [temp\\TSElement.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#takesScreenshotElementTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/13.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот веб элемента будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/14.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/15.jpg "New Maven Project - Лог запуска")

### 3.1.3. Скриншот веб элемента вырезанный из видимой области веб страницы

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **takesScreenshotElementFromViewablePageTest** - скриншот веб элемента вырезанный из видимой области веб страницы

```java
@Test
public void takesScreenshotElementFromViewablePageTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сделать скриншот веб элемента вырезанный из видимой области веб страницы
    try {
        By divSubcategoryXPath = By.xpath("//div[@class=\"subcategory\"]");
        WebElement divSubcategory = driver.findElement(divSubcategoryXPath);
        Point location = divSubcategory.getLocation();
        Dimension size = divSubcategory.getSize();
        File file = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);
        BufferedImage viewablePageImage = ImageIO.read(file);
        BufferedImage linkYesImage = viewablePageImage.getSubimage(
            location.getX() - 50, location.getY() - 50,
            size.getWidth() + 200, size.getHeight() + 100);
        ImageIO.write(linkYesImage, "png", new File("temp\\TSElementFromViewablePage.png"));
        logger.info("Скриншот сохранен в файле [temp\\TSElementFromViewablePage.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#takesScreenshotElementFromViewablePageTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/16.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот веб элемента вырезанный из видимой области веб страницы будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/17.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/18.jpg "New Maven Project - Лог запуска")

## 3.2. Снятие скриншотов с помощью AShot

## 3.2.1. Утилита Яндекса для захвата скриншотов - AShot

В POM.xml добавить следующую зависимость в раздел **dependencies**

```xml
<dependency>
    <groupId>ru.yandex.qatools.ashot</groupId>
    <artifactId>ashot</artifactId>
    <version>1.5.4</version>
    <scope>test</scope>
</dependency>
```

### 3.2.2. Скриншот видимой области веб страницы

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **aShotViewablePageTest** - скриншот видимой области веб страницы

```java
@Test
public void aShotViewablePageTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сделать скриншот видимой области веб страницы
    try {
        Screenshot screenshot = new AShot().takeScreenshot(driver);
        ImageIO.write(screenshot.getImage(), "png", new File("temp\\ASViewablePage.png"));
        logger.info("Скриншот сохранен в файле [temp\\ASViewablePage.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#aShotViewablePageTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/19.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот видимой области веб страницы будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/20.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/21.jpg "New Maven Project - Лог запуска")

### 3.2.3. Скриншот всей веб страницы

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **aShotFullPageTest** - скриншот всей веб страницы

```java
@Test
public void aShotFullPageTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сделать скриншот всей веб страницы
    try {
        Screenshot screenshot = new AShot()
            .shootingStrategy(ShootingStrategies.viewportPasting(100))
            .takeScreenshot(driver);
        ImageIO.write(screenshot.getImage(), "png", new File("temp\\ASFullPage.png"));
        logger.info("Скриншот сохранен в файле [temp\\ASFullPage.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#aShotFullPageTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/22.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот всей веб страницы будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/23.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/24.jpg "New Maven Project - Лог запуска")

### 3.2.4. Скриншот веб элемента

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **aShotElementTest** - скриншот веб элемента

```java
@Test
public void aShotElementTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сделать скриншот веб элемента
    try {
        By divSubcategoryXPath = By.xpath("//div[@class=\"subcategory\"]");
        WebElement divSubcategory = driver.findElement(divSubcategoryXPath);
        Screenshot screenshot = new AShot()
            .coordsProvider(new WebDriverCoordsProvider())
            .takeScreenshot(driver, divSubcategory);
        ImageIO.write(screenshot.getImage(), "png", new File("temp\\ASElement.png"));
        logger.info("Скриншот сохранен в файле [temp\\ASElement.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#aShotElementTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/25.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот веб элемента будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/26.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/27.jpg "New Maven Project - Лог запуска")

### 3.2.5. Сравнение скриншота с образцом

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **aShotCompareImagesTest** - сравнение скриншота с образцом

```java
@Test
public void aShotCompareImagesTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сравнить скриншот с образцом
    try {
        BufferedImage actualImage = new AShot().takeScreenshot(driver).getImage();
        BufferedImage expectedImage = ImageIO.read(new File("temp\\ASCompareImagesExpectedImage.png"));
        ImageDiffer imageDiffer = new ImageDiffer();
        ImageDiff diff = imageDiffer.makeDiff(actualImage, expectedImage);
        if (diff.hasDiff()) {
            logger.info("Изображения одинаковые");
        } else {
            logger.info("Изображения разные");
        }
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#aShotCompareImagesTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/28.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет выполнено сравнение скриншота с образцом.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/29.jpg "New Maven Project - Лог запуска")

### 3.2.6. Скриншот с эффектом

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **aShotPrettifyTest** - скриншот веб элемента с эффектом

```java
@Test
public void aShotPrettifyTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сделать скриншот с эффектом
    try {
        By divSubcategoryXPath = By.xpath("//div[@class=\"subcategory\"]");
        WebElement divSubcategory = driver.findElement(divSubcategoryXPath);
        Screenshot screenshot = new AShot()
            .imageCropper(new IndentCropper()
                .addIndentFilter(new BlurFilter()))
            .takeScreenshot(driver, divSubcategory);
        ImageIO.write(screenshot.getImage(), "png", new File("temp\\ASPrettify.png"));
        logger.info("Скриншот сохранен в файле [temp\\ASPrettify.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#aShotPrettifyTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/30.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот с эффектом будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/31.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/32.jpg "New Maven Project - Лог запуска")

## 3.3. Полный код ScreenShotsTest.java

[ScreenShotsTest.java](_Sample_10/src/test/java/ScreenShotsTest.java)

***

# 4. Запись видео

## 4.1. Запись видео с помощью Monte

### 4.1.1. Библиотека для записи видео - Monte 

В POM.xml добавить следующую зависимость в раздел **dependencies**

```xml
<dependency>
    <groupId>com.github.stephenc.monte</groupId>
    <artifactId>monte-screen-recorder</artifactId>
    <version>0.7.7.0</version>
    <scope>test</scope>
</dependency>
```

### 4.1.2. Запись видео

Шаги:

1. Создать файл **VideoRecordsTest.java** в **./src/test/java**.

![New Maven Project - VideoRecordsTest.java](./_Files/2.%20New%20Project/33.jpg "New Maven Project - VideoRecordsTest.java")

2. Добавить в файл **VideoRecordsTest.java** код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(VideoRecordsTest.class);
```

* объявление рекордера, конфигуратора графики и путь к файлу

```java
private ScreenRecorder screenRecorder;              // Рекордер видео
private GraphicsConfiguration gc;                   // Конфигурация графики
private final String RECORD_DIRECTORY = "temp\\";   // Путь до каталога с выходным файлом
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
    // Конфигурация графики
    GraphicsConfiguration gc = GraphicsEnvironment
        .getLocalGraphicsEnvironment()
        .getDefaultScreenDevice()
        .getDefaultConfiguration();

    try {
        File dir = new File(RECORD_DIRECTORY);
        screenRecorder = new ScreenRecorder(
            // Конфигурация графики
            gc,
            // Формат выходного файла
            new Format(
                MediaTypeKey, MediaType.FILE,
                MimeTypeKey, MIME_AVI),
            // Формат видео кадра
            new Format(
                MediaTypeKey, MediaType.VIDEO,
                EncodingKey, ENCODING_AVI_TECHSMITH_SCREEN_CAPTURE,
                CompressorNameKey, ENCODING_AVI_TECHSMITH_SCREEN_CAPTURE,
                DepthKey, 24,
                FrameRateKey, Rational.valueOf(15),
                QualityKey, 1.0f,
                KeyFrameIntervalKey, 15 * 60),
            // Формат курсора мыши
            new Format(
                MediaTypeKey, MediaType.VIDEO,
                EncodingKey, "black",
                FrameRateKey, Rational.valueOf(30)),
            // Формат аудио
            null);
        screenRecorder.start(); // Старт записи видео
    } catch (Exception e) {
        e.printStackTrace();
    }
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    try {
        screenRecorder.stop(); // Стоп записи видео
        // Сохранение файла под заданным именем
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd HH.mm.ss");
        File newFileName = new File(String.format("%s %s.avi", RECORD_DIRECTORY, dateFormat.format(new Date())));
        screenRecorder.getCreatedMovieFiles().get(0).renameTo(newFileName);
    } catch (Exception e) {
        System.out.println(e);
    }
    
    if (driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* метод **monteVideoRecorderTest** - запись видео

```java
@Test
public void monteVideoRecorderTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=VideoRecordsTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/34.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот с эффектом будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/35.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/36.jpg "New Maven Project - Лог запуска")

## 4.2. Полный код VideoRecordsTest.java

[VideoRecordsTest.java](_Sample_10/src/test/java/VideoRecordsTest.java)

***

# 5. Перехват трафика

## 5.1. Перехват трафика с помощью BrowserMob Proxy

### 5.1.1. Библиотека прокси для перехвата трафика - Monte

В POM.xml добавить следующие зависимости в раздел **dependencies**

```xml
<dependency>
    <groupId>net.lightbody.bmp</groupId>
    <artifactId>browsermob-core</artifactId>
    <version>2.1.5</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>com.google.guava</groupId>
    <artifactId>guava</artifactId>
    <version>30.1.1-jre</version>
</dependency>
```

### 5.1.2. Перехват трафика

Шаги:

1. Создать файл **HttpCaptureTest.java** в **./src/test/java**.

![New Maven Project - HttpCaptureTest.java](./_Files/2.%20New%20Project/37.jpg "New Maven Project - HttpCaptureTest.java")

2. Добавить в файл **HttpCaptureTest.java** код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(HttpCaptureTest.class);
```

* объявление прокси

```java
private static BrowserMobProxyServer proxy;
private static Proxy seleniumProxy;
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    // Запуск прокси BrowserMob Proxy
    proxy = new BrowserMobProxyServer();
    proxy.setTrustAllServers(true);
    proxy.setHarCaptureTypes(CaptureType.REQUEST_CONTENT, CaptureType.RESPONSE_CONTENT);
    proxy.enableHarCaptureTypes(CaptureType.REQUEST_CONTENT, CaptureType.RESPONSE_CONTENT);
    proxy.start(8080);

    // Настройка прокси Selenium
    seleniumProxy = ClientUtil.createSeleniumProxy(proxy);
    try {
        String hostIp = Inet4Address.getLocalHost().getHostAddress();
        seleniumProxy.setHttpProxy(hostIp + ":" + proxy.getPort());
        seleniumProxy.setSslProxy(hostIp + ":" + proxy.getPort());
    } catch (UnknownHostException e) {
        e.printStackTrace();
    }

    // Конфигурирование драйвера Selenium WebDriver для прокси
    WebDriverManager.chromedriver().setup();
    logger.info("Драйвер для браузера Google Chrome");
    DesiredCapabilities capabilities = new DesiredCapabilities();
    capabilities.setCapability(CapabilityType.PROXY, seleniumProxy);
    capabilities.setCapability(CapabilityType.ACCEPT_SSL_CERTS, true);
    ChromeOptions chromeOptions = new ChromeOptions();
    chromeOptions.merge(capabilities);
    chromeOptions.addArguments("--start-maximized");
    chromeOptions.addArguments("--disable-web-security");
    chromeOptions.addArguments("--allow-insecure-localhost");
    chromeOptions.addArguments("--ignore-urlfetcher-cert-requests");
    chromeOptions.addArguments("--ignore-certificate-errors");
    driver = new ChromeDriver(chromeOptions);
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        proxy.stop();
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* метод **httpCaptureTest** - перехват трафика

```java
    @Test
public void httpCaptureTest() {
    proxy.newHar("dns-shop.ru");
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");

    // Чтение данных прокси
    Har har = proxy.getHar();
    File harFile = new File("dns-shop.har");
    try {
        har.writeTo(harFile);
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=HttpCaptureTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/38.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот с эффектом будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/39.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/40.jpg "New Maven Project - Лог запуска")

## 5.2. Полный код HttpCaptureTest.java

[HttpCaptureTest.java](_Sample_10/src/test/java/HttpCaptureTest.java)

***

# 6. Отслеживание событий

## 6.1. Отслеживание событий в Selenium 3

Шаги:

1. Создать файл **Selenium3Listener.java** в **./src/test/java**.

![New Maven Project - Selenium3Listener.java](./_Files/2.%20New%20Project/41.jpg "New Maven Project - Selenium3Listener.java")

2. Наследовать абстрактный класс **AbstractWebDriverEventListener**.

```java
public class Selenium3Listener extends AbstractWebDriverEventListener {

}
```

3. Добавить в файл **Selenium3Listener.java** код.

* объявление логгера

```java
private Logger logger = LogManager.getLogger(Selenium3Listener.class);
```

* переопределение методов абстрактного класса **AbstractWebDriverEventListener**
                                                       
```java
@Override
public void beforeFindBy(By by, WebElement element, WebDriver driver) {
    logger.info("Before Find Element " + by);
}

@Override
public void afterFindBy(By by, WebElement element, WebDriver driver) {
    logger.info("After Find Element " + by + " An Element <" + element.getTagName() + ">");
}

@Override
public void beforeClickOn(WebElement element, WebDriver driver) {
    logger.info("Before Click On Element <" + element.getTagName() + ">");
}

@Override
public void afterClickOn(WebElement element, WebDriver driver) {
    logger.info("After Click On Element <" + element.getTagName() + ">");
}
```

4. Создать файл **ListenersTest.java** в **./src/test/java**.

![New Maven Project - ListenersTest.java](./_Files/2.%20New%20Project/42.jpg "New Maven Project - ListenersTest.java")

5. Добавить в файл **ListenersTest.java** код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(ListenersTest.class);
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* метод **listenerSelenium3Test** - слушатель Selenium 3

```java
@Test
public void listenerSelenium3Test() {
    Selenium3Listener listener = new Selenium3Listener();
    EventFiringWebDriver eventFiringWebDriver = new EventFiringWebDriver(driver);
    eventFiringWebDriver.register(listener);

    // Открыть страницу https://www.dns-shop.ru/
    eventFiringWebDriver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = eventFiringWebDriver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
}
```

6. Запустить тест командой **mvn clean test** с параметром **-Dtest=ListenersTest#listenerSelenium3Test**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/43.jpg "New Maven Project - Запуск теста")

7. Готово!

В результате до и после выполнения каждой команды поиска и нажатия на элемент будет выводиться лог.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/44.jpg "New Maven Project - Лог запуска")

## 6.2. Полный код Selenium3Listener.java

[Selenium3Listener.java](_Sample_10/src/test/java/Selenium3Listener.java)

## 6.3. Отслеживание событий в Selenium 4

Шаги:

1. Создать файл **Selenium4Listener.java** в **./src/test/java**.

![New Maven Project - Selenium4Listener.java](./_Files/2.%20New%20Project/45.jpg "New Maven Project - Selenium4Listener.java")

2. Реализовать интерфейс **WebDriverListener**

```java
public class Selenium4Listener implements WebDriverListener {
    
}
```

3. Добавить в файл **Selenium4Listener.java** код.

* объявление логгера

```java
private Logger logger = LogManager.getLogger(Selenium4Listener.class);
```

* переопределение методов интерфейса **WebDriverListener**

```java
@Override
public void beforeFindElement(WebDriver driver, By locator) {
    logger.info("Before Find Element " + locator);
}

@Override
public void afterFindElement(WebDriver driver, By locator, WebElement result) {
    logger.info("After Find Element " + locator + " An Element <" + result.getTagName() + ">");
}

@Override
public void beforeClick(WebElement element) {
    logger.info("Before Click On Element <" + element.getTagName() + ">");
}

@Override
public void afterClick(WebElement element) {
    logger.info("After Click On Element <" + element.getTagName() + ">");
}
```

4. Открыть файл **ListenersTest.java** в **./src/test/java**.

5. Добавить в файл **ListenersTest.java** код.

* метод **listenerSelenium4Test** - слушатель Selenium 4

```java
@Test
public void listenerSelenium4Test() {
    Selenium4Listener listener = new Selenium4Listener();
    WebDriver eventFiringWebDriver = new EventFiringDecorator(listener).decorate(driver);

    // Открыть страницу https://www.dns-shop.ru/
    eventFiringWebDriver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = eventFiringWebDriver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
}
```

6. Запустить тест командой **mvn clean test** с параметром **-Dtest=ListenersTest#listenerSelenium4Test**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/46.jpg "New Maven Project - Запуск теста")

7. Готово!

В результате до и после выполнения каждой команды поиска и нажатия на элемент будет выводиться лог.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/47.jpg "New Maven Project - Лог запуска")

## 6.4. Полный код Selenium4Listener.java

[Selenium4Listener.java](_Sample_10/src/test/java/Selenium4Listener.java)

## 6.5. Полный код ListenersTest.java

[ListenersTest.java](_Sample_10/src/test/java/ListenersTest.java)

***

Задание [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](3.%20Задание.md)