Java_QA / 08. Selenium WebDriver. Протоколирование

[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Практика](https://img.shields.io/badge/-Практика-aaffaa)](2.%20Практика.md)

***

# Содержание

* [1. Для чего нужно протоколирование?](#1-для-чего-нужно-протоколирование?)
  * [1.1. Чтение логов](#11-чтение-логов)
    * [1.1.1. Чем полезны логи в автотестах Selenium WebDriver?](#111-чем-полезны-логи-в-автотестах-selenium-webdriver)
    * [1.1.2. Как можно получить логи в Selenium WebDriver?](#112-как-можно-получить-логи-в-selenium-webdriver)
  * [1.2. Снятие скриншотов](#12-снятие-скриншотов)
    * [1.2.1. Чем полезны скриншоты в автотестах Selenium WebDriver?](#121-чем-полезны-скриншоты-в-автотестах-selenium-webdriver)
    * [1.2.2. Как можно снять скриншоты в Selenium WebDriver?](#122-как-можно-снять-скриншоты-в-selenium-webdriver)
  * [1.3. Запись видео](#13-запись-видео)
    * [1.3.1. Чем полезна запись видео в автотестах Selenium WebDriver?](#131-чем-полезна-запись-видео-в-автотестах-selenium-webdriver)
    * [1.3.2. Как можно записать видео в Selenium WebDriver?](#132-как-можно-записать-видео-в-selenium-webdriver)
  * [1.4. Перехват трафика](#14-перехват-трафика)
    * [1.4.1. Чем полезен прокси сервер и перехват трафика в автотестах Selenium WebDriver?](#141-чем-полезен-прокси-сервер-и-перехват-трафика-в-автотестах-selenium-webdriver)
    * [1.4.2. Как можно настроить прокси сервер и перехват трафика в Selenium WebDriver?](#142-как-можно-настроить-прокси-сервер-и-перехват-трафика-в-selenium-webdriver)
  * [1.5. Отслеживание событий](#15-отслеживание-событий)
    * [1.5.1. Чем полезно отслеживание событий в автотестах Selenium WebDriver?](#151-чем-полезно-отслеживание-событий-в-автотестах-selenium-webdriver)
    * [1.5.2. Как можно отслеживать события в Selenium WebDriver?](#152-как-можно-отслеживать-события-в-selenium-webdriver)
* [2. Чтение логов](#2-чтение-логов)
  * [2.1. Интерфейс WebDriver.Options](#21-интерфейс-webdriveroptions)
  * [2.2. Интерфейс Logs](#22-интерфейс-logs)
  * [2.3. Класс LogType](#23-класс-logtype)
  * [2.4. Класс Level](#24-класс-level)
  * [2.5. Класс LogEntries](#25-класс-logentries)
  * [2.6. Класс LogEntry](#26-класс-logentry)
* [3. Конфигурация логгирования](#3-конфигурация-логгирования)
  * [3.1. Класс LoggingPreferences](#31-класс-loggingpreferences)
* [4. Снятие скриншотов с помощью Selenium WebDriver](#4-снятие-скриншотов-с-помощью-selenium-webdriver)
  * [4.1. Интерфейс TakesScreenshot](#41-интерфейс-takesscreenshot)
    * [4.1.1. Скриншот видимой области веб страницы](#411-скриншот-видимой-области-веб-страницы)
    * [4.1.2. Скриншот веб элемента](#412-скриншот-веб-элемента)
    * [4.1.3. Скриншот веб элемента вырезанный из видимой области веб страницы](#413-скриншот-веб-элемента-вырезанный-из-видимой-области-веб-страницы)
  * [4.2. Интерфейс OutputType](#42-интерфейс-outputtype)
  * [4.3. Исключения](#43-исключения)
    * [4.3.1. WebDriverException](#431-webdriverexception)
    * [4.3.2. UnsupportedOperationException](#432-unsupportedoperationexception)
    * [4.3.3. ScreenshotException](#433-screenshotexception)
      * [4.3.3.1. Причины](#4331-причины)
      * [4.3.3.2. Решение](#4332-решение)
* [5. Снятие скриншотов с помощью AShot](#5-снятие-скриншотов-с-помощью-ashot)
  * [5.1. Как скачать и настроить Ashot?](#51-как-скачать-и-настроить-ashot)
  * [5.2. Класс AShot](#52-класс-ashot)
    * [5.2.1. Скриншот видимой области страницы](#521-скриншот-видимой-области-страницы)
    * [5.2.2. Скриншот всей страницы](#522-скриншот-всей-страницы)
    * [5.2.3. Скриншот веб элемента](#523-скриншот-веб-элемента)
    * [5.2.4. Сравнение изображений](#524-сравнение-изображений)
    * [5.2.5. Скриншот с применением эффекта](#525-скриншот-с-применением-эффекта)
* [6. Запись видео с помощью Monte Screen Recorder](#6-запись-видео-с-помощью-monte-screen-recorder)
* [7. Настройка прокси](#7-настройка-прокси)
  * [7.1. Класс Proxy](#71-класс-proxy)
  * [7.2. Перечисление Proxy.ProxyType](#72-перечисление-proxyproxytype)
* [8. Перехват трафика с помощью BrowserMob Proxy](#8-перехват-трафика-с-помощью-browsermob-proxy)
* [9. Отслеживание событий в Selenium 3](#9-отслеживание-событий-в-selenium-3)
  * [9.1. Интерфейс WebDriverEventListner](#91-интерфейс-webdrivereventlistner)
  * [9.2. Класс EventFiringWebDriver](#92-класс-eventfiringwebdriver)
* [10. Отслеживание событий в Selenium 4](#10-отслеживание-событий-в-selenium-4)
  * [10.1. Интерфейс WebDriverListener](#101-интерфейс-webdriverlistener)
  * [10.2. Класс EventFiringDecorator](#102-класс-eventfiringdecorator)

***

# 1. Для чего нужно протоколирование?

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

После выполнения автотеста с использованием **Selenium WevDriver** необходимо проанализировать результаты, 
а если тест оказался провален, то нужно еще и выяснить причину. 

Проанализировать результаты и понять, почему возникла ошибка при выполнении теста можно с помощью:

* чтения логов приложения
* снятия скриншотов
* записи видео
* перехвата сетевого трафика
* отслеживания событий **Selenium WebDriver**

Собранная информация в дальнейшем может быть приложена к отчету ()[].

## 1.1. Чтение логов

***Логи*** — файлы (обычно текстовые), в которые вносятся определённые действия пользователя 
или данные о работе программы (сервера, веб приложения и т д).

Логи - это как запись черного ящика на самолетах.

Логи состоят из записей, каждая из которых содержит

* *время (Log Timestamp)*

* *уровень (Log Level)*

***Уровень логирования*** - разделение логов по приоритетам и степени важности.

Предназначение уровней логгирования - предоставление пользователю способа фильтрации сообщений лога
в зависимости от уровня интереса пользователя.

Например, если цель логгирования - дебаггинг, то практически все сообщения будут нужны,
в то время как при общем мониторинге понадобится меньше информации.

* *сообщение (Log Message)*

Сообщение содержит основную информацию о действиях пользователя или о работе программы.

### 1.1.1. Чем полезны логи в автотестах Selenium WebDriver?

Логи позволяют:

* получить данные отправленные в запросах фронтом в бек (нажатие кнопки)
* получить данные полученные из запросов фронтом от бека (заполнение блоков)
* получить данные работы драйвера, браузера, удаленного сервера

### 1.1.2. Как можно получить логи в Selenium WebDriver?

Логи можно получить:

* с помощью встроенных классов и интерфейсов **Selenium WebDriver**
* с помощью систем логирования и поиска логов (стек **ELK**)

## 1.2. Снятие скриншотов

***Скриншот*** - изображение, полученное устройством и показывающее в точности то,
что видит пользователь на экране монитора или другого визуального устройства вывода.

### 1.2.1. Чем полезны скриншоты в автотестах Selenium WebDriver?

Скриншоты позволяют:

* получить состояние веб-страницы или ее части до выполнения кого либо действия или события на странице
* получить состояние веб-страницы или ее части после выполнения кого либо действия или события на странице
* сравнить отображение страниц и поведение приложения в разных браузерах

Скриншоты особенно полезны при выполнении headless-тестов, где не виден графический интерфейс приложения.

### 1.2.2. Как можно снять скриншоты в Selenium WebDriver?

Скриншот можно снять:

* с помощью стандартных средств **Selenium WebDriver** (интерфейс **TakesScreenshot**)
* с помощью сторонних библиотек для снятия скриншотов (библиотека **AShot**)

## 1.3. Запись видео

### 1.3.1. Чем полезна запись видео в автотестах Selenium WebDriver?

Видео позволяют запечатлеть весь процесс прохождения автотеста от начала до конца.

### 1.3.2. Как можно записать видео в Selenium WebDriver?

В **Selenium WebDriver** нет стандартных средств для записи видео.

Видео можно записать:

* с помощью склеивания набора скриншотов
* с помощью сторонних библиотек (библиотеки **Monte Screen Recorder**, **FFmpeg**)

***Monte Screen Recorder*** - библиотека Java для записи видео.

[Monte Screen Recorder - MonteMedia 0.7.7](http://www.randelshofer.ch/monte/javadoc/index.html)

***FFmpeg*** — набор свободных библиотек с открытым исходным кодом, которые позволяют записывать, конвертировать и передавать
цифровые аудио- и видеозаписи в различных форматах.

[FFmpeg](https://ffmpeg.org/)

***Video Recorder*** - обертка поверх **FFmpeg**.

[Video Recorder](https://github.com/SergeyPirogov/video-recorder-java)

* с помощью Selenoid (запись видео из коробки в контейнерах)

## 1.4. Перехват трафика

***Перехват трафика*** - процесс перехвата пакетов данных, передаваемых по сети. 
Это может быть сделано с помощью специализированного программного обеспечения или оборудования.

***Прокси-сервер*** — промежуточный сервер (комплекс программ) в компьютерных сетях, выполняющий роль посредника
между пользователем и целевым сервером (при этом о посредничестве могут как знать, так и не знать обе стороны),
позволяющий клиентам как выполнять косвенные запросы (принимая и передавая их через прокси-сервер)
к другим сетевым службам, так и получать ответы.

Как работает прокси-сервер?

1. Клиент подключается к прокси-серверу
2. Клиент запрашивает какой-либо ресурс (например e-mail), расположенный на другом сервере
3. Прокси-сервер

*  либо подключается к указанному серверу и получает ресурс у него
*  либо возвращает ресурс из собственного кэша (в случаях, если прокси имеет свой кэш).

В некоторых случаях запрос клиента или ответ сервера может быть изменён прокси-сервером в определённых целях.

Прокси-сервер действует как посредник для запросов между клиентом и сервером.
Проще говоря, трафик проходит через прокси-сервер на пути к запрошенному адресу и обратно.

### 1.4.1. Чем полезен прокси сервер и перехват трафика в автотестах Selenium WebDriver?

Прокси-сервер может быть полезен для:

* перехвата сетевого трафика
* имитация бэкэнд-вызовов, совершаемых веб-сайтом
* доступ к требуемому веб-сайту при сложной топологии сети или строгих корпоративных ограничениях / политиках
* блокировки лишнего контента при тестировании
* увеличения скорости загрузки страниц
  
>Если вы находитесь в корпоративной среде и браузеру не удается подключиться к URL-адресу,
> это, скорее всего, связано с тем, что для доступа к среде требуется прокси-сервер.

Перехват трафика позволяет получить доступ к уходящим и приходящим запросам.

### 1.4.2. Как можно настроить прокси сервер и перехват трафика в Selenium WebDriver?

Прокси сервер можно настроить с помощью стандартных средств **Selenium WebDriver** (интерфейс **Proxy**).

Трафик можно перехватить с помощью сторонних библиотек (библиотека **BrowserMob Proxy**).

## 1.5. Отслеживание событий

***Событие*** - любое действие, выполняемое с элементами веб-страницы, с помощью **Selenium WebDriver** (поиск элемента,
щелчок по элементу, переход к URL-адресу, изменение значения в поле и т д).

***Слушатели событий*** - методы, ожидающие наступления события и выполняющие определенные действия (до или после события).

### 1.5.1. Чем полезно отслеживание событий в автотестах Selenium WebDriver?

Отслеживание событий позволяет настраивать действия (настроить логирование или снятие скриншотов) 
на определенные события драйвера (например, событие нажатия кнопки).

### 1.5.2. Как можно отслеживать события в Selenium WebDriver?

События можно отслеживать с помощью стандартных средств **Selenium WebDriver**:

* в **Seleniim 3** - WebDriverEventListner и EventFiringWebDriver
* в **Seleniim 4** - WebDriverListener и EventFiringDecorator

***

# 2. Чтение логов

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

## 2.1. Интерфейс WebDriver.Options

Доступ к логам можно получить с помощью **WebDriver.Options**.

***WebDriver.manage()*** - реализация интерфейса **WebDriver.Options**.

Методы интерфейса **WebDriver.Options** для доступа к логам:

| Тип  | Метод  | Описание       | 
|------|--------|----------------|
| Logs | logs() | Доступ к логам |

[selenium/docs/api : WebDriver.Options](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/WebDriver.Options.html)

*Пример*

```java
Logs logs = driver.manage().logs();
```

## 2.2. Интерфейс Logs

***Logs*** - интерфейс предоставляющий методы получения логов.

Методы интерфейса **Logs**:

| Тип         | Метод                  | Описание                        | 
|-------------|------------------------|---------------------------------|
| Set<String> | getAvailableLogTypes() | Получение доступных типов логов |
| LogEntries  | get(String logType)    | Получение логов заданного типа  |

[selenium/docs/api : Logs](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/logging/Logs.html)

*Пример*

```java
Set<String> availableLogTypes = driver().manage().logs().getAvailableLogTypes();
Logs logs = driver.manage().logs();
LogEntries logsEntries = logs.get(LogType.BROWSER);
```

## 2.3. Класс LogType

***LogType*** - класс представляющий типы логов **Selenium WebDriver**.

Константы класса **LogType**:

| Тип           | Константа   | Описание                                          | Пример                     | 
|---------------|-------------|---------------------------------------------------|----------------------------|
| static String | CLIENT      | Логи от клиентской части Selenium Webdriver       | Логи Java Bindings         |
| static String | SERVER      | Логи от серверной части Selenium Webdriver        | Логи Selenium Grid         |
| static String | DRIVER      | Логи от драйвера                                  | Логи FirefoxDriver         |
| static String | BROWSER     | Логи от браузера                                  | Логи JavaScript консоли    |
| static String | PERFORMANCE | Логи относящиеся к производительности на странице | Тайминги загрузки ресурсов |
| static String | PROFILER    | Логи относящиеся к таймингу производительности    |                            |

[selenium/docs/api : LogType](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/logging/LogType.html)

В целом, при дебагинге определенной конфигурации было бы полезно получить 
доступ к логам каждого отдельного компонента конфигурации:

* *CLIENT* - клиент
* *SERVER* - сервер
* *DRIVER* - драйвер
* *BROWSER* - браузер

Все же логи всех компонентов не могут быть доступны во всех конфигурациях. 
Логи также могут не поддерживаться или их невозможно будет получить из-за браузера. 
В придачу к этому, иногда могут быть доступны и некоторые другие типы логов. 
Например, могут быть доступны логи, предназначенные для сбора данных о производительности на стороне клиента.

*Пример*

```java
Logs logs = driver.manage().logs();
LogEntries logsEntries = logs.get(LogType.BROWSER);
```

## 2.4. Класс Level

***Level*** - класс представляющий уровни логгирования.

Методы класса **Level**:

| Тип          | Метод              | Описание                                                                   | 
|--------------|--------------------|----------------------------------------------------------------------------|
| String       | getLocalizedName() | Получение локализованного наименования уровня логгирования                 |
| String       | getName()          | Получение нелокализованного наименования уровня логгирования               |
| int          | intValue()         | Получение численного значения уровня логгирования                          |
| static Level | parse(String name) | Преобразование строкового представления уровня логгирования в объект Level |

Константы класса **Level**: 

Для **Selenium Webdriver** существуют следующие уровни логгирования (в порядке возрастания детализированности):

| Тип           | Константа | Описание                             | Пример                                          |
|---------------|-----------|--------------------------------------|-------------------------------------------------|
| static Level  | OFF       | Отключение логгирования              | Отключение логгирования                         |
| static Level  | SEVERE    | Сообщения об ошибках                 | Неизвестные команды **Selenium Webdriver**      |
| static Level  | WARNING   | Сообщения предупреждающего характера | Перехваченное исключение **Selenium Webdriver** |
| static Level  | INFO      | Сообщения информативного характера   | Полученные команды **Selenium Webdriver**       |
| static Level  | DEBUG     | Сообщения для дебаггинга             | Информация о состоянии драйвера                 |
| static Level  | ALL       | Все сообщения                        | Все сообщения независимо от уровня              |

[javase/7/docs/api : Level](https://docs.oracle.com/javase/7/docs/api/java/util/logging/Level.html)

*Пример*

```java
Logs logs = driver.manage().logs();
LogEntries logsEntries = logs.get(LogType.BROWSER);
List<LogEntry> logsEntriesList = logsEntries.getAll().stream()
    .filter(a -> a.getLevel() == Level.SEVERE)
    .collect(Collectors.toList());
```

## 2.5. Класс LogEntries

***LogEntries*** - класс представляющий пул логов.

Методы класса **LogEntries**:

| Тип                | Метод      | Описание                                | 
|--------------------|------------|-----------------------------------------|
| List<LogEntry>     | getAll()   | Получение всех логов                    |
| Iterator<LogEntry> | iterator() | Получение итератора для доступа к логам |

[selenium/docs/api : LogEntries](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/logging/LogEntries.html)

*Пример*

```java
Logs logs = driver.manage().logs();
LogEntries logEntries = logs.get(LogType.BROWSER);
List<LogEntry> logEntriesList = logEntries.getAll()
```

## 2.6. Класс LogEntry

***LogEntry*** - класс представляющий запись лога.

Методы класса **LogEntry**:

| Тип    | Метод          | Описание                                 | 
|--------|----------------|------------------------------------------|
| Level  | getLevel()     | Получение уровня логгирования            |
| String | getMessage()   | Получение сообщения в логе               |
| long   | getTimestamp() | Получение временной метки (миллисекунды) |

[selenium/docs/api : LogEntry](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/logging/LogEntry.html)

*Пример*

```java
Logs logs = driver.manage().logs();
LogEntries logEntries = logs.get(LogType.DRIVER);
List<LogEntry> logEntriesList = logEntries.getAll()
for (LogEntry logEntry : logEntriesList) {
    System.out.println(logEntry.getLevel());
    System.out.println(logEntry.getMessage());
    System.out.println(logEntry.getTimestamp());
}
```

# 3. Конфигурация логгирования

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

Бывают ситуации, когда логирование необходимо полностью отключить, или сделать минимальным количество сообщений.
Например, в случае, когда драйвер работает на устройстве с ограниченными ресурсами.
Для поддержки таких ситуаций есть возможность конфигурировать логирование как отдельной настройкой в **Selenium WebDriver**.
Реализовано это путем передачи драйверу списка пар **тип лога - уровень логирования**.
В большинстве реализаций клиентской части это сделано через **DesiredCapabilities** класс.

## 3.1. Класс LoggingPreferences

***LoggingPreferences*** - класс представляющий настройки логов.

Методы класса **LoggingPreferences**:

| Тип                | Метод                                    | Описание                                           | 
|--------------------|------------------------------------------|----------------------------------------------------|
| Level              | getLevel()                               | Получение уровня логгирования                      |
| LoggingPreferences | addPreferences(LoggingPreferences prefs) | Добавление настроек логгирования                   |
| void               | enable(String logType, Level level)      | Включение логгирования определенного типа и уровня |
| Set<String>        | getEnabledLogTypes()                     | Получение логгируемых типов логов                  |

[selenium/docs/api : LoggingPreferences](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/logging/LoggingPreferences.html)

*Пример*

```java
DesiredCapabilities caps = DesiredCapabilities.firefox();
LoggingPreferences logs = new LoggingPreferences();
logs.enable(LogType.BROWSER, Level.OFF);
logs.enable(LogType.CLIENT, Level.SEVERE);
logs.enable(LogType.DRIVER, Level.WARNING);
logs.enable(LogType.PERFORMANCE, Level.INFO);
logs.enable(LogType.SERVER, Level.ALL);
WebDriver driver = new FirefoxDriver(caps);
```

***

# 4. Снятие скриншотов с помощью Selenium WebDriver

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

В **Selenium WebDriver** встроены возможности для снятия скриншотов без подключения сторонних библиотек.
Однако функционал снятия скриншотов несколько ограничен.

## 4.1. Интерфейс TakesScreenshot

***TakeScreenshot*** - интерфейс предоставляющий методы для снятия скриншотов.
                     
Методы интерфейса:

| Тип   | Метод                                 | Описание         |
|-------|---------------------------------------|------------------|
| <X> X | getScreenshotAs(OutputType<X> target) | Снятие скриншота |

В качестве параметра он принимает значение, которое влияет на тип возвращаемого методом результата:

* *BASE64* — получить скриншот в формате данных base64
* *BYTES* — получить скриншот как набор байт
* *FILE* — получить скриншот, сохраненный во временный файл, который будет удален после завершения работы JVM 
  (разработчик должен самостоятельно сделать копию этого файла)

[selenium/docs/api : TakesScreenshot](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/TakesScreenshot.html)

### 4.1.1. Скриншот видимой области веб страницы

Чтобы снять скриншот видимой области веб страницы, необходимо вызвать метод **getScreenshotAs** на экземпляре драйвера.

*Пример*

```java
File file = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);
BufferedImage image = ImageIO.read(file);
ImageIO.write(image, "png", new File("screenshot.png"));
```

### 4.1.2. Скриншот веб элемента

Чтобы снять скриншот веб элемента, необходимо вызвать метод **getScreenshotAs** на веб элементе.

*Пример*

```java
File file = driver.findElement(By.xpath("//div"))
        .getScreenshotAs(OutputType.FILE);
BufferedImage image = ImageIO.read(file);
ImageIO.write(image, "png", new File("screenshot.png"));
```

### 4.1.3. Скриншот веб элемента вырезанный из видимой области веб страницы

Чтобы снять скриншот веб элемента вырезанный из видимой области веб страницы, 
необходимо вызвать метод **getScreenshotAs** 
на экземпляре драйвера и вырезать область с интересующим веб элементом.

*Пример*

```java
WebElement element = driver.findElement(By.xpath("//div"));
Point l = element.getLocation();
Dimension s = element.getSize();
File file = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);
BufferedImage image1 = ImageIO.read(file);
BufferedImage image2 = image1.getSubimage(l.getX() - 50, l.getY() - 50, s.getWidth() + 200, s.getHeight() + 100);
ImageIO.write(image2, "png", new File("screenshot.png"));
```

## 4.2. Интерфейс OutputType<T>

***OutputType<T>*** - интерфейс представляющий формат сохранения файла скриншота.

Методы интерфейса **OutputType<T>**:

| Тип | Метод                                  | Описание                                                 | 
|-----|----------------------------------------|----------------------------------------------------------|
| T   | convertFromBase64Png(String base64Png) | Преобразование заданного base64 png в запрошенный формат |
| T   | convertFromPngBytes(byte[] png)        | Преобразование заданного png в запрошенный формат        |

Константы интерфейса **OutputType<T>**:

| Тип                        | Константа | Описание                                   | 
|----------------------------|-----------|--------------------------------------------|
| static OutputType<String>  | BASE64    | Сохранение скриншота в формате Base64      |
| static OutputType<byte[]>  | BYTES     | Сохранение скриншота в виде массива байтов |
| static OutputType<File>    | FILE      | Сохранение скриншота в файле               |

[selenium/docs/api : OutputType](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/OutputType.html)

## 4.3. Исключения

### 4.3.1. WebDriverException 

***WebDriverException*** - исключение, возникающее при сбоях в работе драйвера.

### 4.3.2. UnsupportedOperationException

***UnsupportedOperationException*** - исключение, возникающее в случае если объект не поддерживает снятие скриншотов.

### 4.3.3. ScreenshotException

***ScreenshotException*** — исключение, которое вызывается, когда невозможно снять скриншот.

[selenium/docs/api : ScreenshotException](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/remote/ScreenshotException.html)

#### 4.3.3.1. Причины

* Наличие ограничений на создание снимков экрана в целях безопасности (пароли, банковские данные)

#### 4.3.3.2. Решение

* Проверка возможности на создание снимков экрана

Ниже пример перехвата исключения.

*Пример*

```java
@Test
public void test() {
    driver.get("https://www.dns-shop.ru/");
    try {
        TakesScreenshot ts = (TakesScreenshot) driver;
        File file = ts.getScreenshotAs(OutputType.FILE);
        FileUtils.copyFile(file, new File("./screenshot.png"));
    } catch (ScreenshotException e) {
        logger.info("JavascriptException: " + e.getRawMessage());
    } catch (IOException e) {
        logger.info("IOException: " + e.getMessage());
    }
}
```

***

# 5. Снятие скриншотов с помощью AShot

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

Интерфейс **TakesScreenshot** позволяет делать скриншоты страницы и скриншоты веб элемента. 
Однако возможности его ограничены.

***AShot*** — сторонняя утилита Яндекса для захвата скриншотов в **Selenium WebDriver**. 

**AShot** обеспечивает следующие возможности:

* скриншоты отдельного веб-элемента
* скриншоты видимой части страницы
* скриншоты всей страницы
* сравнение скриншотов
* украшение скриншотов
  
[aShot](https://github.com/pazone/ashot)

## 5.1. Как скачать и настроить Ashot?

Есть два способа настроить **Ashot**:

1. Использование **Maven** (https://mvnrepository.com/artifact/ru.yandex.qatools.ashot/ashot)
2. Вручную без использования какого-либо инструмента

## 5.2. Класс AShot

***AShot*** — класс для снятия скриншотов.

[aShot : AShot](https://www.mvndoc.com/c/ru.yandex.qatools.ashot/ashot/ru/yandex/qatools/ashot/AShot.html)

Методы класса **AShot**:

| Тип        | Метод                                                             | Описание                                                                                           | 
|------------|-------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
| AShot      | addIgnoredArea(Coords area)                                       | Добавление игнорируемой области                                                                    |
| AShot      | ignoredAreas(Set<Coords> ignoredAreas)                            | Установка набора игнорируемых областей                                                             |
| AShot      | addIgnoredElement(By selector)                                    | Добавление игнорируемого элемента                                                                  |
| AShot      | ignoredElements(Set<By> ignoredElements)                          | Установка набора игнорируемых элементов                                                            |
| AShot      | coordsProvider(CoordsProvider coordsProvider)                     | Установка координат                                                                                |
| AShot      | imageCropper(ImageCropper cropper)                                | Установка режима обрезки                                                                           |
| AShot      | shootingStrategy(ShootingStrategy strategy)                       | Установка режима создания снимков экрана                                                           |
| Screenshot | takeScreenshot(WebDriver driver, Collection<WebElement> elements) | Делает снимок экрана данных элементов. Если элементы не найдены, возвращается снимок всей страницы |
| Screenshot | takeScreenshot(WebDriver driver, WebElement element)              | Делает снимок экрана данного элемента                                                              |
| Screenshot | takeScreenshot(WebDriver driver)                                  | Делает снимок экрана всей страницы                                                                 |

### 5.2.1. Скриншот видимой области страницы

Чтобы снять скриншот видимой области веб страницы, необходимо вызвать метод **takeScreenshot** на экземпляре драйвера.

*Пример*

```java
Screenshot screenshot = new AShot()
        .takeScreenshot(driver);
ImageIO.write(screenshot.getImage(), "png", new File("screenshot.png"));
```

### 5.2.2. Скриншот всей страницы

Чтобы снять скриншот всей области веб страницы, необходимо вызвать метод **shootingStrategy** 
(указав способ снятия скриншота) и метод **takeScreenshot** на экземпляре драйвера.

*Пример*

```java
Screenshot screenshot = new AShot()
        .shootingStrategy(ShootingStrategies.viewportPasting(100))
        .takeScreenshot(driver);
ImageIO.write(screenshot.getImage(), "png", new File("screenshot.png"));
```

### 5.2.3. Скриншот веб элемента

Чтобы снять скриншот веб элемента, необходимо вызвать метод **takeScreenshot** на веб элементе.

*Пример*

```java
WebElement element = driver.findElement(By.xpath("//div"));
Screenshot screenshot = new AShot()
        .coordsProvider(new WebDriverCoordsProvider())
        .takeScreenshot(driver, element);
ImageIO.write(screenshot.getImage(), "png", new File("screenshot.png"));
```

### 5.2.4. Сравнение изображений

Чтобы сравнить скриншоты, необходимо вызвать метод **makeDiff** класса **ImageDiffer**.

*Пример*

```java
BufferedImage actualImage = new AShot().takeScreenshot(driver).getImage();
BufferedImage expectedImage = ImageIO.read(new File("expectedImage.png"));
ImageDiffer imageDiffer = new ImageDiffer();
ImageDiff diff = imageDiffer.makeDiff(actualImage, expectedImage);
if (diff.hasDiff()) {
    logger.info("Изображения одинаковые");
} else {
    logger.info("Изображения разные");
}
```

### 5.2.5. Скриншот с применением эффекта

Чтобы снять скриншот с эффекта, необходимо вызвать метод **imageCropper** и применить фильтр **addIndentFilter**.

*Пример*

```java
WebElement element = driver.findElement(By.xpath("//div"));
Screenshot screenshot = new AShot()
    .imageCropper(new IndentCropper()
        .addIndentFilter(new BlurFilter()))
    .takeScreenshot(driver, element);
ImageIO.write(screenshot.getImage(), "png", new File("screenshot.png"));
```

***

# 6. Запись видео с помощью Monte Screen Recorder

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

***Monte Media Library*** - библиотека для обработки мультимедийных данных. 
Поддерживаемые форматы мультимедиа включают картинки, видео, аудио и метаданные.

***Monte Screen Recorder*** - библиотека для записи видео.

Недостаток данного рекордера в том, что для просмотра видео вам 
понадобится установленный на компьютере кодек [TSC](https://www.techsmith.com/products.html).

*Пример*

```java
public class VideoRecorder {
    private ScreenRecorder screenRecorder;
 
    public void startRecording() {
        try {
            GraphicsConfiguration gc = GraphicsEnvironment
                .getLocalGraphicsEnvironment()
                .getDefaultScreenDevice()
                .getDefaultConfiguration();
 
            this.screenRecorder = new ScreenRecorder(
                    // Конфигурация графики
                    gc, 
                    // Формат выходного файла
                    new Format(
                            MediaTypeKey, MediaType.FILE, 
                            MimeTypeKey, MIME_AVI), 
                    // Формат видео кадра
                    new Format(
                            MediaTypeKey, MediaType.VIDEO, 
                            EncodingKey, ENCODING_AVI_TECHSMITH_SCREEN_CAPTURE, 
                            CompressorNameKey, ENCODING_AVI_TECHSMITH_SCREEN_CAPTURE, 
                            DepthKey, 24, 
                            FrameRateKey, Rational.valueOf(15), 
                            QualityKey, 1.0f, 
                            KeyFrameIntervalKey, 15 * 60), 
                    // Формат курсора мыши
                    new Format(
                            MediaTypeKey, MediaType.VIDEO, 
                            EncodingKey, "black", 
                            FrameRateKey, Rational.valueOf(30)), 
                    // Формат аудио
                    null);
            this.screenRecorder.start();
        } catch (Exception e) {
            System.out.println(e);
        }
    }
 
    public void stopRecording() {
        try {
            this.screenRecorder.stop();
        } catch (Exception e) {
            System.out.println(e);
        }
    }
}
```

***

# 7. Настройка прокси

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

## 7.1. Класс Proxy

***Proxy*** - класс представляющий настройки используемых прокси.

Методы класса **Proxy**:

| Тип             | Метод                                              | Описание                                     | 
|-----------------|----------------------------------------------------|----------------------------------------------|
| Proxy           | extractFrom(Capabilities capabilities)             | Получение прокси из настроек браузера        |
| String          | getFtpProxy()                                      | Получение FTP прокси                         |
| String          | getHttpProxy()                                     | Получение HTTP  прокси                       |
| String          | getNoProxy()                                       | Получение адреса обхода прокси (Noproxy)     |
| String          | getProxyAutoconfigUrl()                            | Получение автосконфигурированного url прокси |
| Proxy.ProxyType | getProxyType()                                     | Получение типа прокси                        |
| String          | getSocksPassword()                                 | Получение пароля SOCKS прокси                |
| String          | getSocksProxy()                                    | Получение SOCKS прокси                       |
| String          | getSocksUsername()                                 | Получение имени пользователя SOCKS прокси    |
| String          | getSocksVersion()                                  | Получение версии SOCKS                       |
| String          | getSslProxy()                                      | Получение SSL прокси                         |
| boolean         | isAutodetect()                                     | Проверка автоматической настройки прокси     |
| Proxy           | setAutodetect(boolean autodetect)                  | Установка автоматической настройки прокси    |
| Proxy           | setFtpProxy(String ftpProxy)                       | Установка FTP прокси                         |
| Proxy           | setHttpProxy(String httpProxy)                     | Установка HTTP прокси                        |
| Proxy           | setNoProxy(String noProxy)                         | Установка адреса обхода прокси (Noproxy)     |
| Proxy           | setProxyAutoconfigUrl(String proxyAutoconfigUrl)   | Установка автосконфигурированного url прокси |
| Proxy           | setProxyType(Proxy.ProxyType proxyType)            | Установка типа прокси                        |
| Proxy           | setSocksPassword(String password)                  | Установка пароля SOCKS прокси                |
| Proxy           | setSocksProxy(String socksProxy)                   | Установка SOCKS прокси                       |
| Proxy           | setSocksUsername(String username)                  | Установка имени пользователя SOCKS прокси    |
| Proxy           | setSocksVersion(Integer socksVersion)              | Установка версии SOCKS                       |
| Proxy           | setSslProxy(String sslProxy)                       | Установка SSL прокси                         |

[selenium/docs/api : Proxy](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Proxy.html)

*Пример*

```java
Proxy proxy = new Proxy();
proxy.setHttpProxy("<HOST:PORT>");
ChromeOptions options = new ChromeOptions();
options.setCapability("proxy", proxy);

WebDriver driver = new ChromeDriver(options);
driver.get("https://www.google.com/");
driver.manage().window().maximize();
driver.quit();
```

## 7.2. Перечисление Proxy.ProxyType

***Proxy.ProxyType*** - перечисление определяющее типы прокси.

Константы перечисления **Proxy.ProxyType**

| Тип         | Описание         | 
|-------------|------------------|
| AUTODETECT  |                  |
| DIRECT      |                  |
| MANUAL      |                  |
| PAC         |                  |
| RESERVED_1  |                  |
| SYSTEM      |                  |
| UNSPECIFIED |                  |

[selenium/docs/api : Proxy.ProxyType](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Proxy.ProxyType.html)

# 8. Перехват трафика с помощью BrowserMob Proxy

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

***BrowserMob Proxy*** - бесплатная утилита, которая позволяет собирать данные о производительности веб-сайтов и браузеров. 
Обычно используется вместе с инструментальными средствами автоматизации, такими как **Selenium** или **Watir**. 

**BrowserMob Proxy** позволяет:

* управлять поведением браузера
* имитировать сетевой трафик и задержки 
* изменять HTTP запросы и ответы 
* использовать **черный** и **белый** списки 

**BrowserMob Proxy** применяется для:

* блокировки загрузки сторонних сайтов, не относящихся к тестированию веб-приложения (тем самым повышая скорость тестов)
* автоматизации доступа к сайтам, требующим Basic авторизацию

**Browser Mob Proxy** может собирать данные о производительности и сохранять их в формате HAR.

***HAR (HTTP Archive Specification)*** - архив, содержащий данные о навигации по world wide web (или AUT), 
в том числе и данные о клиентской производительности, в формате JSON определенной структуры.

[github.com/lightbody/browsermob-proxy](https://github.com/lightbody/browsermob-proxy)

*Пример*

```java
// Запуск прокси сервера
ProxyServer server = new ProxyServer(4444);
server.autoBasicAuthorization("example.com", "username", "password");
server.start();
// Получение Selenium proxy
Proxy proxy = server.seleniumProxy();
// Конфигурация FirefoxDriver для использования прокси
DesiredCapabilities capabilities = new DesiredCapabilities();
capabilities.setCapability(CapabilityType.PROXY, proxy);
WebDriver driver = new FirefoxDriver(capabilities);
// Создание HAR с меткой
server.newHar("mypage.ru");
// Открытие страницы
driver.get("http://example.com/index");
// Получение данных HAR
Har har = server.getHar();
// Обработка полученных данных
// Например, сохранение в файл
proxy.getHar().writeTo(new File("D://Test.har"));
driver.quit();
server.stop();
```

*Результат*

Вывод в консоль свидетельствует об успешном запуске и остановке прокси-сервера на 4444 порту:

```text
HttpSer~ - Version Jetty/5.1.x
Contain~ - Started HttpContext[/,/]
SocketL~ - Started SocketListener on 0.0.0.0:4444
Contain~ - Started net.lightbody.bmp.proxy.jetty.jetty.Server@133321d6
Threade~ - Stopping Acceptor ServerSocket[addr=0.0.0.0/0.0.0.0,port=0,localport=4444]
SocketL~ - Stopped SocketListener on 0.0.0.0:4444
Contain~ - Stopped HttpContext[/,/]
Contain~ - Stopped net.lightbody.bmp.proxy.jetty.jetty.Server@133321d6
```

Полученный **HAR** файл содержит JSON данные, которые можно использовать как текстовую информацию, 
либо просмотреть в удобном представлении, используя один из существующих инструментов для визуализации (HAR viewer). 
Например, по адресу [Har Viewer](http://www.softwareishard.com/har/viewer/)

Получить информацию можно и без сохранения **HAR** файла. 
Java класс **net.lightbody.bmp.core.har.HarLog** предоставляет набор методов для выборочного получения нужной информации.

*Пример*

```java
Har har = proxy.getHar();
// Получить информацию о браузере
System.out.println(har.getLog().getBrowser().getName());
System.out.println(har.getLog().getBrowser().getVersion());
// Список всех обработанных запросов
for (HarEntry entry : har.getLog().getEntries()) {
  System.out.println(entry.getRequest().getUrl());
  // Время ожидания ответа от сервера в миллисекундах
  System.out.println(entry.getTimings().getWait());
  // Время чтения ответа от сервера в миллисекундах
  System.out.println(entry.getTimings().getReceive());
}
```

***

# 9. Отслеживание событий в Selenium 3

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

Для отслеживания событий, библиотека **Selenium WebDriver** версии 3 предоставляет интерфейс **WebDriverEventListener**.
Интерфейс работает в паре с **EventFiringWebDriver**, который представляет собой обертку для любой реализации веб-драйвера и
позволяет регистрировать объект **WebDriverEventListener**.

## 9.1. Интерфейс WebDriverEventListner

***WebDriverEventListner*** - интерфейс для отслеживания событий драйвера.

Методы класса **WebDriverEventListner**:

| Тип      | Метод                                                                                | Описание                                                                                                                 |
|----------|--------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| void     | afterAlertAccept(WebDriver driver)                                                   | После Alert.accept()                                                                                                     |
| void     | afterAlertDismiss(WebDriver driver)                                                  | После Alert.dismiss()                                                                                                    |
| void     | afterChangeValueOf(WebElement element, WebDriver driver, CharSequence[] keysToSend)  | После WebElement.clear(), WebElement.sendKeys(...)                                                                       |
| void     | afterClickOn(WebElement element, WebDriver driver)                                   | После WebElement.click()                                                                                                 |
| void     | afterFindBy(By by, WebElement element, WebDriver driver)                             | После WebDriver.findElement(...), WebDriver.findElements(...), WebElement.findElement(...), WebElement.findElements(...) |
| <X> void | afterGetScreenshotAs(OutputType<X> target, X screenshot)                             | После TakesScreenshot.getScreenshotAs(OutputType)                                                                        |
| void     | afterGetText(WebElement element, WebDriver driver, String text)                      | После WebElement.getText()                                                                                               |
| void     | afterNavigateBack(WebDriver driver)                                                  | После WebDriver.navigate().back()                                                                                        |
| void     | afterNavigateForward(WebDriver driver)                                               | После WebDriver.navigate().forward()                                                                                     |
| void     | afterNavigateRefresh(WebDriver driver)                                               | После WebDriver.navigate().refresh()                                                                                     |
| void     | afterNavigateTo(String url, WebDriver driver)                                        | После WebDriver.get(String url), WebDriver.navigate().to(String url)                                                     |
| void     | afterScript(String script, WebDriver driver)                                         | После RemoteWebDriver.executeScript(String, Object...)                                                                   |
| void     | afterSwitchToWindow(String windowName, WebDriver driver)                             | После WebDriver.TargetLocator.window(String)                                                                             |
| void     | beforeAlertAccept(WebDriver driver)                                                  | Перед Alert.accept()                                                                                                     |
| void     | beforeAlertDismiss(WebDriver driver)                                                 | Перед Alert.dismiss()                                                                                                    |
| void     | beforeChangeValueOf(WebElement element, WebDriver driver, CharSequence[] keysToSend) | Перед WebElement.clear(), WebElement.sendKeys(...)                                                                       |
| void     | beforeClickOn(WebElement element, WebDriver driver)                                  | Перед WebElement.click()                                                                                                 |
| void     | beforeFindBy(By by, WebElement element, WebDriver driver)                            | Перед WebDriver.findElement(...), WebDriver.findElements(...), WebElement.findElement(...), WebElement.findElements(...) |
| <X> void | beforeGetScreenshotAs(OutputType<X> target)                                          | Перед TakesScreenshot.getScreenshotAs(OutputType)                                                                        |
| void     | beforeGetText(WebElement element, WebDriver driver)                                  | Перед WebElement.getText() method is being called                                                                        |
| void     | beforeNavigateBack(WebDriver driver)                                                 | Перед WebDriver.navigate().back()                                                                                        |
| void     | beforeNavigateForward(WebDriver driver)                                              | Перед WebDriver.navigate().forward()                                                                                     |
| void     | beforeNavigateRefresh(WebDriver driver)                                              | Перед WebDriver.navigate().refresh()                                                                                     |
| void     | beforeNavigateTo(String url, WebDriver driver)                                       | Перед WebDriver.get(String url), WebDriver.navigate().to(String url)                                                     |
| void     | beforeScript(String script, WebDriver driver)                                        | Перед RemoteWebDriver.executeScript(String, Object...)                                                                   |
| void     | beforeSwitchToWindow(String windowName, WebDriver driver)                            | Перед WebDriver.TargetLocator.window(String)                                                                             |
| void     | onException(Throwable throwable, WebDriver driver)                                   | Called whenever an exception would be thrown                                                                             |

[selenium/docs/api : WebDriverListener](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/support/events/WebDriverListener.html)

***AbstractWebDriverEventListener*** - абстрактный класс реализующий интерфейс **WebDriverEventListner**.

[selenium/docs/api : AbstractWebDriverEventListener](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/support/events/AbstractWebDriverEventListener.html)

Создать собственный слушатель событий драйвера можно двумя способами:

* реализовать интерфейс **WebDriverEventListener**
* наследоваться от класса **AbstractWebDriverEventListener**

*Пример*

```java
public class WebDriverLogger extends AbstractWebDriverEventListener {
    private static final Logger LOGGER = LoggerFactory.getLogger(WebDriverLogger.class);
    
    @Override
    public void afterNavigateTo(String url, WebDriver driver) {
        LOGGER.info("WebDriver navigated to '" + url + "'");
    }
    
    @Override
    public void beforeClickOn(WebElement element, WebDriver driver) {
        LOGGER.info("WebDriver click on element - " + elementDescription(element));
    }
    
    @Override
    public void beforeChangeValueOf(WebElement element, WebDriver driver) {
        LOGGER.info("WebDriver will change value for element - " + elementDescription(element));
    }
    
    @Override
    public void afterChangeValueOf(WebElement element, WebDriver driver) {
        LOGGER.info("WebDriver changed value for element - " + elementDescription(element));
    }
    
    private String elementDescription(WebElement element) {
        String description = "tag:" + element.getTagName();
        if (element.getAttribute("id") != null) {
            description += " id: " + element.getAttribute("id");
        }
        else if (element.getAttribute("name") != null) {
            description += " name: " + element.getAttribute("name");
    }
    
    description += " ('" + element.getText() + "')";
    return description;
    }
}
```

## 9.2. Класс EventFiringWebDriver

***EventFiringWebDriver*** - класс обертка вокруг **WebDriver**, добавляющий методы для регистрации слушателя (Listener).

Методы класса **EventFiringWebDriver**:

| Тип                  | Метод                                            | Описание                                     | 
|----------------------|--------------------------------------------------|----------------------------------------------|
| EventFiringWebDriver | register(WebDriverEventListener eventListener)   | Добавление слушателя (WebDriverEventListner) |
| EventFiringWebDriver | unregister(WebDriverEventListener eventListener) | Удаление слушателя (WebDriverEventListner)   |

*Пример*

```java
EventFiringWebDriver eventDriver = new EventFiringWebDriver(new FirefoxDriver());
eventDriver.register(listener);
eventDriver.get("http://automation-remarks.com");
WebElement element = eventDriver.findElement(By.id("target"));
element.click();
```

*Результат*

```text
DEBUG com.home.custom.listeners.WDriverEventListener beforeFindBy - Should be By.name: banner
DEBUG com.home.custom.listeners.WDriverEventListener beforeFindBy - Should be By.name: banner
DEBUG com.home.custom.listeners.WDriverEventListener afterFindBy - Element found
DEBUG com.home.custom.listeners.WDriverEventListener beforeFindBy - Should be By.id: ibm-banner-welcome
DEBUG com.home.custom.listeners.WDriverEventListener beforeFindBy - Should be By.id: ibm-banner-welcome
DEBUG com.home.custom.listeners.WDriverEventListener afterFindBy - Element found
```

# 10. Отслеживание событий в Selenium 4

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

Для отслеживания событий, библиотека **Selenium WebDriver** версии 4 предоставляет интерфейс **WebDriverListener**.
Интерфейс работает в паре с **EventFiringDecorator**, который представляет собой обертку для любой реализации веб-драйвера и
позволяет регистрировать объект **WebDriverListener**.

## 10.1. Интерфейс WebDriverListener 

***WebDriverListener*** - интерфейс для отслеживания событий драйвера.

Методы класса **WebDriverListener**:

| Тип          | Метод                                                                                                |
|--------------|------------------------------------------------------------------------------------------------------|
| default void | afterAccept(Alert alert)                                                                             |
| default void | afterAddCookie(WebDriver.Options options, Cookie cookie)                                             |
| default void | afterAnyAlertCall(Alert alert, Method method, Object[] args, Object result)                          |
| default void | afterAnyCall(Object target, Method method, Object[] args, Object result)                             |
| default void | afterAnyNavigationCall(WebDriver.Navigation navigation, Method method, Object[] args, Object result) | 	 
| default void | afterAnyOptionsCall(WebDriver.Options options, Method method, Object[] args, Object result)          |
| default void | afterAnyTimeoutsCall(WebDriver.Timeouts timeouts, Method method, Object[] args, Object result)       |
| default void | afterAnyWebDriverCall(WebDriver driver, Method method, Object[] args, Object result)                 |
| default void | afterAnyWebElementCall(WebElement element, Method method, Object[] args, Object result)              |
| default void | afterAnyWindowCall(WebDriver.Window window, Method method, Object[] args, Object result)             |
| default void | afterBack(WebDriver.Navigation navigation)                                                           |
| default void | afterClear(WebElement element)                                                                       |
| default void | afterClick(WebElement element)                                                                       |
| default void | afterClose(WebDriver driver)                                                                         |
| default void | afterDeleteAllCookies(WebDriver.Options options)                                                     |
| default void | afterDeleteCookie(WebDriver.Options options, Cookie cookie)                                          |
| default void | afterDeleteCookieNamed(WebDriver.Options options, String name)                                       |
| default void | afterDismiss(Alert alert)                                                                            |
| default void | afterExecuteAsyncScript(WebDriver driver, String script, Object[] args, Object result)               |
| default void | afterExecuteScript(WebDriver driver, String script, Object[] args, Object result)                    | 
| default void | afterFindElement(WebDriver driver, By locator, WebElement result)                                    |
| default void | afterFindElement(WebElement element, By locator, WebElement result)                                  |
| default void | afterFindElements(WebDriver driver, By locator, List<WebElement> result)                             |
| default void | afterFindElements(WebElement element, By locator, List<WebElement> result)                           |
| default void | afterForward(WebDriver.Navigation navigation)                                                        |
| default void | afterFullscreen(WebDriver.Window window)                                                             |
| default void | afterGet(WebDriver driver, String url)                                                               |
| default void | afterGetAttribute(WebElement element, String name, String result)                                    |
| default void | afterGetCookieNamed(WebDriver.Options options, String name, Cookie result)                           |
| default void | afterGetCookies(WebDriver.Options options, Set<Cookie> result)                                       |
| default void | afterGetCssValue(WebElement element, String propertyName, String result)                             |
| default void | afterGetCurrentUrl(String result, WebDriver driver)                                                  |
| default void | afterGetLocation(WebElement element, Point result)                                                   |
| default void | afterGetPageSource(WebDriver driver, String result)                                                  |
| default void | afterGetPosition(WebDriver.Window window, Point result)                                              |
| default void | afterGetSize(WebDriver.Window window, Dimension result)                                              |	 
| default void | afterGetSize(WebElement element, Dimension result)                                                   |
| default void | afterGetTagName(WebElement element, String result)                                                   |
| default void | afterGetText(Alert alert, String result)                                                             |
| default void | afterGetText(WebElement element, String result)                                                      |
| default void | afterGetTitle(WebDriver driver, String result)                                                       |
| default void | afterGetWindowHandle(WebDriver driver, String result)                                                |
| default void | afterGetWindowHandles(WebDriver driver, Set<String> result)                                          | 
| default void | afterImplicitlyWait(WebDriver.Timeouts timeouts, Duration duration)                                  | 
| default void | afterIsDisplayed(WebElement element, boolean result)                                                 |
| default void | afterIsEnabled(WebElement element, boolean result)                                                   |
| default void | afterIsSelected(WebElement element, boolean result)                                                  |
| default void | afterMaximize(WebDriver.Window window)                                                               |
| default void | afterPageLoadTimeout(WebDriver.Timeouts timeouts, Duration duration)                                 |
| default void | afterPerform(WebDriver driver, Collection<Sequence> actions)                                         |
| default void | afterQuit(WebDriver driver)                                                                          |
| default void | afterRefresh(WebDriver.Navigation navigation)                                                        |
| default void | afterResetInputState(WebDriver driver)                                                               |
| default void | afterSendKeys(Alert alert, String text)                                                              |
| default void | afterSendKeys(WebElement element, CharSequence... keysToSend)                                        |
| default void | afterSetPosition(WebDriver.Window window, Point position)                                            |
| default void | afterSetScriptTimeout(WebDriver.Timeouts timeouts, Duration duration)                                |
| default void | afterSetSize(WebDriver.Window window, Dimension size)                                                |
| default void | afterSubmit(WebElement element)                                                                      |
| default void | afterTo(WebDriver.Navigation navigation, String url)                                                 |
| default void | afterTo(WebDriver.Navigation navigation, java.net.URL url)                                           |
| default void | beforeAccept(Alert alert)                                                                            |
| default void | beforeAddCookie(WebDriver.Options options, Cookie cookie)                                            |
| default void | beforeAnyAlertCall(Alert alert, Method method, Object[] args)                                        |
| default void | beforeAnyCall(Object target, Method method, Object[] args)                                           |
| default void | beforeAnyNavigationCall(WebDriver.Navigation navigation, Method method, Object[] args)               |
| default void | beforeAnyOptionsCall(WebDriver.Options options, Method method, Object[] args)                        | 
| default void | beforeAnyTimeoutsCall(WebDriver.Timeouts timeouts, Method method, Object[] args)                     |
| default void | beforeAnyWebDriverCall(WebDriver driver, Method method, Object[] args)                               |
| default void | beforeAnyWebElementCall(WebElement element, Method method, Object[] args)                            |
| default void | beforeAnyWindowCall(WebDriver.Window window, Method method, Object[] args)                           |
| default void | beforeBack(WebDriver.Navigation navigation)                                                          |
| default void | beforeClear(WebElement element)                                                                      |
| default void | beforeClick(WebElement element)                                                                      |
| default void | beforeClose(WebDriver driver)                                                                        |
| default void | beforeDeleteAllCookies(WebDriver.Options options)                                                    |
| default void | beforeDeleteCookie(WebDriver.Options options, Cookie cookie)                                         |
| default void | beforeDeleteCookieNamed(WebDriver.Options options, String name)                                      | 
| default void | beforeDismiss(Alert alert)                                                                           |
| default void | beforeExecuteAsyncScript(WebDriver driver, String script, Object[] args)                             | 
| default void | beforeExecuteScript(WebDriver driver, String script, Object[] args)                                  |
| default void | beforeFindElement(WebDriver driver, By locator)                                                      |
| default void | beforeFindElement(WebElement element, By locator)                                                    |
| default void | beforeFindElements(WebDriver driver, By locator)                                                     |
| default void | beforeFindElements(WebElement element, By locator)                                                   |
| default void | beforeForward(WebDriver.Navigation navigation)                                                       |
| default void | beforeFullscreen(WebDriver.Window window)                                                            |
| default void | beforeGet(WebDriver driver, String url)                                                              |
| default void | beforeGetAttribute(WebElement element, String name)                                                  |
| default void | beforeGetCookieNamed(WebDriver.Options options, String name)                                         | 
| default void | beforeGetCookies(WebDriver.Options options)                                                          |
| default void | beforeGetCssValue(WebElement element, String propertyName)                                           |
| default void | beforeGetCurrentUrl(WebDriver driver)                                                                |
| default void | beforeGetLocation(WebElement element)                                                                |
| default void | beforeGetPageSource(WebDriver driver)                                                                |
| default void | beforeGetPosition(WebDriver.Window window)                                                           |
| default void | beforeGetSize(WebDriver.Window window)                                                               |
| default void | beforeGetSize(WebElement element)                                                                    |
| default void | beforeGetTagName(WebElement element)                                                                 |
| default void | beforeGetText(Alert alert)                                                                           |
| default void | beforeGetText(WebElement element)                                                                    |
| default void | beforeGetTitle(WebDriver driver)                                                                     |
| default void | beforeGetWindowHandle(WebDriver driver)                                                              |
| default void | beforeGetWindowHandles(WebDriver driver)                                                             |
| default void | beforeImplicitlyWait(WebDriver.Timeouts timeouts, Duration duration)                                 |
| default void | beforeIsDisplayed(WebElement element)                                                                |
| default void | beforeIsEnabled(WebElement element)                                                                  |
| default void | beforeIsSelected(WebElement element)                                                                 |
| default void | beforeMaximize(WebDriver.Window window)                                                              |
| default void | beforePageLoadTimeout(WebDriver.Timeouts timeouts, Duration duration)                                |
| default void | beforePerform(WebDriver driver, Collection<Sequence> actions)                                        |
| default void | beforeQuit(WebDriver driver)                                                                         |
| default void | beforeRefresh(WebDriver.Navigation navigation)                                                       |
| default void | beforeResetInputState(WebDriver driver)                                                              |
| default void | beforeSendKeys(Alert alert, String text)                                                             |
| default void | beforeSendKeys(WebElement element, CharSequence... keysToSend)                                       |
| default void | beforeSetPosition(WebDriver.Window window, Point position)                                           |
| default void | beforeSetScriptTimeout(WebDriver.Timeouts timeouts, Duration duration)                               |
| default void | beforeSetSize(WebDriver.Window window, Dimension size)                                               |
| default void | beforeSubmit(WebElement element)                                                                     |
| default void | beforeTo(WebDriver.Navigation navigation, String url)                                                |
| default void | beforeTo(WebDriver.Navigation navigation, java.net.URL url)                                          |
| default void | onError(Object target, Method method, Object[] args, InvocationTargetException e)                    |

[selenium/docs/api : WebDriverListener](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/support/events/WebDriverListener.html)

## 10.2. Класс EventFiringDecorator

***EventFiringDecorator*** - класс обертка вокруг экземпляра **WebDriver**, добавляющий методы для регистрации слушателя (Listener).

Слушатели должны реализовать **WebDriverListener**. 
Он поддерживает три типа событий:

* *before* событие, когда метод будет вызван
* *after* событие, когда метод был успешно вызван и вернул некоторый результат
* *error* событие, когда метод был вызван и возникла исключительная ситуация

Экземпляр **WebDriver**, созданный декоратором, реализует все те же интерфейсы, что и исходный драйвер.

Слушатель может подписаться на **конкретные** или **общие** события (или на то и другое). 
**Конкретное** событие соответствует одному конкретному методу, **общее** событие соответствует любому методу, 
вызываемому в классе или в любом классе.

Чтобы подписаться на **конкретное** событие, слушатель должен реализовать метод с именем, 
производным от целевого метода, за которым нужно наблюдать. 
Методы слушателя для событий **before** получают параметры, переданные декорированному методу. 
Методы слушателя для событий **after** получают параметры, переданные декорированному методу, 
а также результат, возвращаемый этим методом.

Методы класса **EventFiringDecorator**:

| Тип     | Метод                                                                                   | Описание                                     | 
|---------|-----------------------------------------------------------------------------------------|----------------------------------------------|
| void    | afterCall(Decorated<?> target, Method method, Object[] args, Object result)             |                                              |
| void    | beforeCall(Decorated<?> target, Method method, Object[] args)                           |                                              |
| Object  | onError(Decorated<?> target, Method method, Object[] args, InvocationTargetException e) |                                              |

[selenium/docs/api : WebDriverDecorator](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/support/decorators/WebDriverDecorator.html)

```java
WebDriverListener listener = new MyListener(); 
WebDriver decorated = new EventFiringDecorator(listener).decorate(original); 
decorated.get("http://example.com/"); 
WebElement header = decorated.findElement(By.tagName("h1")); 
String headerText = header.getText();
```

***

[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Практика](https://img.shields.io/badge/-Практика-aaffaa)](2.%20Практика.md)