# Java_QA / Level 1. Easy - Основы / 1.1. Selenium WebDriver / Урок 04. Веб драйвер 1. Основы

[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](2.%20Практика.md)

***

**Selenium WebDriver, или просто WebDriver** – это драйвер браузера, то есть не имеющая пользовательского интерфейса программная библиотека, 
которая позволяет различным другим программам взаимодействовать с браузером, управлять его поведением, 
получать от браузера какие-то данные и заставлять браузер выполнять какие-то команды.

Для работы с Selenium Webdriver необходимо 3 основных компонента:

* **браузер** (браузер, работу которого нужно автоматизировать) 

Это реальный браузер определенной версии, установленный на определенной ОС и имеющий свои настройки (по умолчанию или кастомные). 
На самом деле Webdriver может работать и с ненастоящими браузерами, но подробно о них позже.

* **драйвер браузера** (программа для управления браузером) 

Это специально написанная программа, которая предоставляет определенный набор команд для управления браузером извне.
Драйвер на самом деле является веб сервером, который запускает браузер и отправляет ему запросы на исполнение определенных действий пользователя, а также закрывает его. 
У каждого браузера свой драйвер, так как у каждого браузера свои отличные команды управления и реализованы они по-своему. 
Найти список доступных драйверов и ссылки для скачивания можно на официальном сайте Selenium проекта.

* **скрипт/тест** (набор команд на определенном языке программирования для драйвера браузера) 

Это программа написанная для выполнения последовательности действий в браузере. 
Для этого в программе используют специальные готовые клиентские библиотеки, которые доступны пользователям на различных языках.

***

## 1. Драйверы браузеров

У каждого браузера есть свой драйвер, с которым данный браузер взаимодействует, так как каждый браузер предоставляет свой собственный интерфейс для управления. 
Но все драйверы предоставляют одинаковый набор команд - единый внешний интерфейс по протоколу, который описан в стандарте W3C.
Каждый драйвер разрабатывает производитель браузера.

### 1.1. Вспомогательный исполняемый файл

Помимо библиотеки Selenium WebDriver, необходимы наличие и запуск специального исполняемого файла драйвера.

#### Куда положить файл?

* В директорию, которая включена в переменную среды **%PATH%**
* В рабочую или текущую директорию (требуется указать путь до файла)
* в любое другое место (требуется указать путь до файла)

> Если же, используется **WebDriverManager**, то делать этого не нужно.

#### Как прописать путь до файла?

Если файл находится не в директории, которая включена в переменную среды **%PATH%**, 
то для того чтобы можно было взаимодействовать с драйвером браузера, необходимо прописать путь до исполняемого файла.

Сделать можно это двумя способами.

* вызвать метод System.setProperty() до вызова конструктора драйвера

```java
System.setProperty("webdriver.ie.driver", "src/test/resources/drivers/IEDriverServer.exe");
```

* использовать класс ChromeDriverService, укзаав в usingDriverExecutable() путь до файла

**ChromeDriverService** - класс для управления исполняемым файлом.

**ChromeDriverService.Builder** - класс для конфигурации нового инстанса ChromeDriverService.

```java
public class ChromeDriverTest {
    private static ChromeDriverService service;
    public static WebDriver driver;
    
    public static void createAndStartService() throws IOException {
        service = new ChromeDriverService.Builder()
            .usingDriverExecutable(new File(PATH_TO_CHROMEDRIVER_EXE))
            .usingAnyFreePort()
            .build();
        service.start();
        driver = new ChromeDriver(service);
    }
}
```

Аналогичные сервис-билдеры есть и у других классов для управления исполняемыми файлами остальных браузеров. Подробнее о них будет рассказано далее.

### 1.2. WebDriverManager

**WebDriverManager** - программная библиотека решающая проблему с исполняемым файлом посредником и указанием его местоположения.

Все что нужно сделать, это подключить зависимость и прописать одну строчку кода. Никаких исполняемых файлов.

```xml
<dependency>
    <groupId>io.github.bonigarcia</groupId>
    <artifactId>webdrivermanager</artifactId>
    <version>4.3.1</version>
    <scope>test</scope>
</dependency>
```

| Браузер         | Код                                        |
|-----------------|--------------------------------------------|
| Google Chrome   | WebDriverManager.chromedriver().setup();   |
| Google Chromium | WebDriverManager.chromiumdriver().setup(); |
| Microsoft Edge  | WebDriverManager.edgedriver().setup();     |
| Microsoft IE    | WebDriverManager.iedriver().setup();       |
| Mozilla Firefox | WebDriverManager.firefoxdriver().setup();  |
| Opera           | WebDriverManager.operadriver().setup();    |
| PhantomJS       | WebDriverManager.phantomjs().setup();      |

Более подробную информацию по работе с **WebDriverManager** можно узнать в описании репозитория проекта.

[Ссылка на GitHub проекта](https://github.com/bonigarcia/webdrivermanager)

### 1.3. Совместимость драйверов и браузеров

Не все драйверы и браузеры подходят друг другу, даже в рамках одного  браузера (версии могут отличаться)

* **Google Chrome**

| Версия браузера | Версия драйвера     | Производитель драйвера    | 
|-----------------|---------------------|---------------------------|
| последняя       | последняя           | Google - **chromedriver** |
| предыдущие      | поддержка последней | Google - **chromedriver** |

* **Microsoft Edge**

| Версия браузера | Версия драйвера     | Производитель драйвера     | 
|-----------------|---------------------|----------------------------|
| последняя       | последняя           | Microsoft - **edgedriver** |

* **Microsoft Intenet Explorer/Edge**

| Версия браузера | Версия драйвера     | Производитель драйвера     | 
|-----------------|---------------------|----------------------------|
| 9 - 11          |                     | Selenium                   | 
| <= 8            |                     | драйвер не поддерживается  | 

* **Mozilla Firefox**

| Версия браузера | Версия драйвера     | Производитель драйвера     | 
|-----------------|---------------------|----------------------------|
| >= 49           | последняя           | Mozilla - **geckodriver**  | 
| 48              |                     | драйвер не поддерживается  |  
| 4 - 47          |                     | Selenium                   | 
| <= 3            |                     | драйвер не поддерживается  | 
    
* **Apple Safari**

| Версия браузера | Версия драйвера     | Производитель драйвера     | 
|-----------------|---------------------|----------------------------|
| >= 10           | последняя           | Apple - **safaridriver**   | 
| 6 - 9           |                     | Selenium                   | 
| <= 5            |                     | драйвер не поддерживается  | 

* **Opera**

| Версия браузера | Версия драйвера     | Производитель драйвера         | 
|-----------------|---------------------|--------------------------------|
| >= 15           | последняя           | Opera - **operchromiumdriver** | 
| 11 - 12         |                     | Opera - **operaPrestoDriver**  | 
| <= 10           |                     | драйвер не поддерживается      | 

***

## 2. Интерфейс WebDriver

**WebDriver** - интерфейс для удаленного управления браузером.

### 2.1. Основные команды веб драйвера

| Тип  | Метод           | Описание                                                                     | 
|------|-----------------|------------------------------------------------------------------------------|
| void | close()         | закрытие текущего окна, выход из браузера (если было открыто последнее окно) |
| void | get​(String url) | загрузка новой страницы в текущем окне браузера                              |
| void | quit()          | выход из драйвера, закрытие всех окон браузера                               |

### 2.2. Команды веб драйвера для поиска веб элементов

| Тип              | Метод               | Описание                                                     | 
|------------------|---------------------|--------------------------------------------------------------|
| WebElement       | findElement​(By by)  | поиск элемента (возвращает первый найденный элемент)         |
| List<WebElement> | findElements​(By by) | поиск всех элементов (возвращает список найденных элементов) |

### 2.3. Команды веб драйвера для получения свойств текущей страницы веб элементов

| Тип    | Метод           | Описание                          | 
|--------|-----------------|-----------------------------------|
| String | getCurrentUrl() | получение строки URL страницы     |
| String | getPageSource() | получение исходного кода страницы |
| String | getTitle()      | получение заголовка страницы      |

### 2.4. Команды веб драйвера для навигации

| Тип                     | Метод              | Описание                              | 
|-------------------------|--------------------|---------------------------------------|
| String                  | getWindowHandle()  | получение окна                        |
| Set<String>             | getWindowHandles() | получение всех окон                   |
| WebDriver.TargetLocator | switchTo()         | управление переключением между окнами |
| WebDriver.Navigation    | navigate()         | управление историей браузера          |

### 2.5. Команды веб драйвера для управления свойствами и настройками браузера

| Тип               | Метод    | Описание                                     | 
|-------------------|----------|----------------------------------------------|
| WebDriver.Options | manage() | управление свойствами и настройками браузера |

[WebDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/WebDriver.html)

***

## 3. Запуск браузеров

### 3.1. Инициализация WebDriver

Чтобы работать с каким то из драйверов нужно в коде инициализировать соответствующий WebDriver.
То есть сконструировать объекта соответствующего класса, который наследует интерфейс WebDriver.
Когда вызывается конструктор, он находит файл посредник.

#### ChromiumDriver

**ChromiumDriver** - класс для управления браузерами на основе Chromium.

Реализует интерфейс WebDriver.

[ChromiumDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/chromium/ChromiumDriver.html)

#### ChromeDriver

**ChromeDriver** - класс для управления браузером Google Chrome.

```java
public class ChromeBrowser {
    public WebDriver getDriver() {
        WebDriverManager.chromedriver().setup();
        WebDriver driver = new ChromeDriver();
        return driver;
    }
}
```

[ChromeDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/chrome/ChromeDriver.html)

#### EdgeDriver

**EdgeDriver** - класс для управления браузером Microsoft Edge.

```java
public class EdgeBrowser {
    public WebDriver getDriver() {
        WebDriverManager.edgedriver().setup();
        WebDriver driver = new EdgeDriver();
        return driver; 
    }
}
```

[EdgeDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/edge/EdgeDriver.html)

#### InternetExplorerDriver

**InternetExplorerDriver** - класс для управления браузером Microsoft Internet Explorer.

Реализует интерфейс WebDriver.

```java
public class ExplorerBrowser {
    public WebDriver getDriver() {
        WebDriverManager.iedriver().setup();
        WebDriver driver = new InternetExplorerDriver();
        return driver; 
    }
}
```

[InternetExplorerDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/ie/InternetExplorerDriver.html)

#### FirefoxDriver

**FirefoxDriver** - класс для управления браузером Mozilla Firefox.

Реализует интерфейс WebDriver.

```java
public class FirefoxBrowser {
    public WebDriver getDriver() {
        WebDriverManager.firefoxdriver().setup();
        WebDriver driver = new FirefoxDriver(options);
        return driver;
    }
}
```

[FirefoxDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/firefox/FirefoxDriver.html)

#### OperaDriver

**OperaDriver** - класс для управления браузером Opera.

Реализует интерфейс WebDriver.

```java
public class FirefoxBrowser {
    public WebDriver getDriver() {
        WebDriverManager.operadriver().setup();
        WebDriver driver = new OperaDriver();
        return driver; 
    }
}
```

[OperaDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/opera/OperaDriver.html)

***

### 3.2. WebDriverFactory

**WebDriverFactory** - паттерн


***

Практика [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](2.%20Практика.md)