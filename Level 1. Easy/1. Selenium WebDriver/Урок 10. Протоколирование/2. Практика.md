# Java_QA / Level 1. Easy - Основы / 1.1. Selenium WebDriver / Урок 10. Протоколирование

[![Назад](https://img.shields.io/badge/-%D0%9D%D0%B0%D0%B7%D0%B0%D0%B4-brightgreen)](1.%20Лекция.md)
[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](3.%20Задание.md)

***

# 1. Открытие предыдущего проекта

Шаги:

1. Запустить **IntelliJ IDEA**.

2. Открыть проект прошлого урока в **IntelliJ IDEA**.

![New Maven Project - Open...](./_Files/2.%20New%20Project/01.jpg "New Maven Project - Open...")

3. Удалить все файлы .java из папки **./src/test/java** кроме **WebDriverFactory.java**

***

# 2. Логи

## 2.1. Доступные типы логов

Шаги:

1. Создать файл **LogsTest.java** в **./src/test/java**.

![New Maven Project - LogsTest.java](./_Files/2.%20New%20Project/02.jpg "New Maven Project - LogsTest.java")

2. Добавить в файл **LogsTest.java** код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(LogsTest.class);
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* метод **availableLogTypesTest** - получение доступных типов логов

```java
@Test
public void availableLogTypesTest() {
    // Получение доступных типов логов
    Set<String> availableLogTypes = driver.manage().logs().getAvailableLogTypes();
    for (String s : availableLogTypes)
        logger.info("Log Type:  " + s);
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=LogsTest#availableLogTypesTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/03.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет выведен список доступных типов логов.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/04.jpg "New Maven Project - Лог запуска")

## 2.2. Получение логов заданного типа

Шаги:

1. Открыть файл **WebDriverFactory.java** в **./src/test/java**.
   
2. Изменить в файле **WebDriverFactory.java** код.

* метод **getDriver** - инициализация драйвера для браузера **Microsoft Edge**

```java
...
    case "edge" :
        WebDriverManager.edgedriver().setup();
        logger.info("Драйвер для браузера Microsoft Edge");
        EdgeOptions edgeOptions = new EdgeOptions();
        edgeOptions.addArguments("--start-maximized");
        return new EdgeDriver(edgeOptions);
...   
```

3. Открыть файл **LogsTest.java** в **./src/test/java**.

4. Изменить в файле **LogsTest.java** код.

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("edge");
    logger.info("Драйвер стартовал!");
}
```

Добавить в файл **LogsTest.java** код.

* метод **logsByTypeTest** - получение логов заданного типа (BROWSER)

```java
@Test
public void logsByTypeTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница devqa.io - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Получить логи
    Logs logs = driver.manage().logs();
    LogEntries logsEntries = logs.get(LogType.BROWSER);
    List<LogEntry> logsEntriesList = logsEntries.getAll();
    for (LogEntry logsEntry : logsEntriesList) {
        logger.info(Date.from(Instant.ofEpochSecond(logsEntry.getTimestamp())) + " " +
            logsEntry.getLevel() + " " + logsEntry.getMessage());
    }
}
```

5. Запустить тест командой **mvn clean test** с параметром **-Dtest=LogsTest#logsByTypeTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/05.jpg "New Maven Project - Запуск теста")

6. Готово!

В результате будут получены логи заданного типа (BROWSER).

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/06.jpg "New Maven Project - Лог запуска")


## 2.3. Получение логов заданного типа и уровня

Шаги:

1. Открыть файл **LogsTest.java** в **./src/test/java**.

2. Добавить в файл **LogsTest.java** код.

* метод **logsByTypeAndLevelTest** - получение логов заданного типа (BROWSER) и уровня (SEVERE)

```java
@Test
public void logsByTypeAndLevelTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница devqa.io - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Получить логи
    Logs logs = driver.manage().logs();
    LogEntries logsEntries = logs.get(LogType.BROWSER);
    List<LogEntry> logsEntriesList = logsEntries.getAll().stream()
        .filter(a -> a.getLevel() == Level.SEVERE)
        .collect(Collectors.toList());
    for (LogEntry logsEntry : logsEntriesList) {
        logger.info(Date.from(Instant.ofEpochMilli(logsEntry.getTimestamp())) + " " +
            logsEntry.getLevel() + " " + logsEntry.getMessage());
    }
}
```

5. Запустить тест командой **mvn clean test** с параметром **-Dtest=LogsTest#logsByTypeAndLevelTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/07.jpg "New Maven Project - Запуск теста")

6. Готово!

В результате будут получены логи заданного типа (BROWSER) и уровня (SEVERE).

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/08.jpg "New Maven Project - Лог запуска")

## 2.4. Конфигурация логгирования

Шаги:

1. Открыть файл **LogsTest.java** в **./src/test/java**.

2. Изменить в файле **WebDriverFactory.java** код.

* метод **getDriver** - инициализация драйвера для браузера **Microsoft Edge**

```java
...
    case "edge" :
        WebDriverManager.edgedriver().setup();
        logger.info("Драйвер для браузера Microsoft Edge");
        LoggingPreferences edgeLogPrefs = new LoggingPreferences();
        edgeLogPrefs.enable(LogType.BROWSER, Level.ALL);
        edgeLogPrefs.enable(LogType.CLIENT, Level.ALL);
        edgeLogPrefs.enable(LogType.DRIVER, Level.ALL);
        edgeLogPrefs.enable(LogType.PERFORMANCE, Level.ALL);
        edgeLogPrefs.enable(LogType.SERVER, Level.ALL);
        DesiredCapabilities edgeCaps = new DesiredCapabilities();
        edgeCaps.setCapability(CapabilityType.LOGGING_PREFS, edgeLogPrefs);
        EdgeOptions edgeOptions = new EdgeOptions();
        edgeOptions.addArguments("--start-maximized");
        edgeOptions.merge(edgeCaps);
        return new EdgeDriver(edgeOptions);
...   
```

3. Добавить в файл **LogsTest.java** код.

* метод **logsByTypeAndLevelTest** - получение логов заданного типа (BROWSER) и уровня (SEVERE)

```java
@Test
public void logsByTypeAndLevelTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница devqa.io - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Получить логи
    Logs logs = driver.manage().logs();
    LogEntries logsEntries = logs.get(LogType.BROWSER);
    List<LogEntry> logsEntriesList = logsEntries.getAll().stream()
        .filter(a -> a.getLevel() == Level.SEVERE)
        .collect(Collectors.toList());
    for (LogEntry logsEntry : logsEntriesList) {
        logger.info(Date.from(Instant.ofEpochMilli(logsEntry.getTimestamp())) + " " +
            logsEntry.getLevel() + " " + logsEntry.getMessage());
    }
}
```

5. Запустить тест командой **mvn clean test** с параметром **-Dtest=LogsTest#logsByTypeAndLevelTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/07.jpg "New Maven Project - Запуск теста")

6. Готово!

В результате будут получены логи заданного типа (BROWSER) и уровня (SEVERE).

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/08.jpg "New Maven Project - Лог запуска")

***

Задание [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](3.%20Задание.md)