# Java_QA / Level 1. Easy - Основы / 1.1. Selenium WebDriver / Урок 10. Протоколирование

[![Назад](https://img.shields.io/badge/-%D0%9D%D0%B0%D0%B7%D0%B0%D0%B4-brightgreen)](1.%20Лекция.md)
[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](3.%20Задание.md)

***

# 1. Открытие предыдущего проекта

Шаги:

1. Запустить **IntelliJ IDEA**.

2. Открыть проект прошлого урока в **IntelliJ IDEA**.

![New Maven Project - Open...](./_Files/2.%20New%20Project/01.jpg "New Maven Project - Open...")

3. Удалить все файлы .java из папки **./src/test/java** кроме **WebDriverFactory.java**

***

# 2. Логи

## 2.1. Доступные типы логов

Шаги:

1. Создать файл **LogsTest.java** в **./src/test/java**.

![New Maven Project - LogsTest.java](./_Files/2.%20New%20Project/02.jpg "New Maven Project - LogsTest.java")

2. Добавить в файл **LogsTest.java** код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(LogsTest.class);
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* метод **availableLogTypesTest** - получение доступных типов логов

```java
@Test
public void availableLogTypesTest() {
    // Получение доступных типов логов
    Set<String> availableLogTypes = driver.manage().logs().getAvailableLogTypes();
    for (String s : availableLogTypes)
        logger.info("Log Type:  " + s);
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=LogsTest#availableLogTypesTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/03.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет выведен список доступных типов логов.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/04.jpg "New Maven Project - Лог запуска")

## 2.2. Получение логов заданного типа

Шаги:

1. Открыть файл **WebDriverFactory.java** в **./src/test/java**.
   
2. Изменить в файле **WebDriverFactory.java** код.

* метод **getDriver** - инициализация драйвера для браузера **Microsoft Edge**

```java
...
    case "edge" :
        WebDriverManager.edgedriver().setup();
        logger.info("Драйвер для браузера Microsoft Edge");
        EdgeOptions edgeOptions = new EdgeOptions();
        edgeOptions.addArguments("--start-maximized");
        return new EdgeDriver(edgeOptions);
...   
```

3. Открыть файл **LogsTest.java** в **./src/test/java**.

4. Изменить в файле **LogsTest.java** код.

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("edge");
    logger.info("Драйвер стартовал!");
}
```

Добавить в файл **LogsTest.java** код.

* метод **logsByTypeTest** - получение логов заданного типа (BROWSER)

```java
@Test
public void logsByTypeTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Получить логи
    Logs logs = driver.manage().logs();
    LogEntries logsEntries = logs.get(LogType.BROWSER);
    List<LogEntry> logsEntriesList = logsEntries.getAll();
    for (LogEntry logsEntry : logsEntriesList) {
        logger.info(Date.from(Instant.ofEpochSecond(logsEntry.getTimestamp())) + " " +
            logsEntry.getLevel() + " " + logsEntry.getMessage());
    }
}
```

5. Запустить тест командой **mvn clean test** с параметром **-Dtest=LogsTest#logsByTypeTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/05.jpg "New Maven Project - Запуск теста")

6. Готово!

В результате будут получены логи заданного типа (BROWSER).

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/06.jpg "New Maven Project - Лог запуска")


## 2.3. Получение логов заданного типа и уровня

Шаги:

1. Открыть файл **LogsTest.java** в **./src/test/java**.

2. Добавить в файл **LogsTest.java** код.

* метод **logsByTypeAndLevelTest** - получение логов заданного типа (BROWSER) и уровня (SEVERE)

```java
@Test
public void logsByTypeAndLevelTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Получить логи
    Logs logs = driver.manage().logs();
    LogEntries logsEntries = logs.get(LogType.BROWSER);
    List<LogEntry> logsEntriesList = logsEntries.getAll().stream()
        .filter(a -> a.getLevel() == Level.SEVERE)
        .collect(Collectors.toList());
    for (LogEntry logsEntry : logsEntriesList) {
        logger.info(Date.from(Instant.ofEpochMilli(logsEntry.getTimestamp())) + " " +
            logsEntry.getLevel() + " " + logsEntry.getMessage());
    }
}
```

5. Запустить тест командой **mvn clean test** с параметром **-Dtest=LogsTest#logsByTypeAndLevelTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/07.jpg "New Maven Project - Запуск теста")

6. Готово!

В результате будут получены логи заданного типа (BROWSER) и уровня (SEVERE).

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/08.jpg "New Maven Project - Лог запуска")

***

# 3. Скриншоты

## 3.1. Скриншоты с помощью TakeScreenshot

### 3.1.1. Скриншот видимой области страницы

Шаги:

1. Создать файл **ScreenShotsTest.java** в **./src/test/java**.

![New Maven Project - ScreenShotsTest.java](./_Files/2.%20New%20Project/09.jpg "New Maven Project - ScreenShotsTest.java")

2. Добавить в файл **ScreenShotsTest.java** код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(LogsTest.class);
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* метод **takesScreenshotViewablePageTest** - скриншот видимой области страницы

```java
@Test
public void takesScreenshotViewablePageTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на ссылку "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    linkYes.click();
    logger.info("Нажата ссылка \"Да\"");
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сделать скриншот всей страницы
    File file = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);
    try {
        FileUtils.copyFile(file, new File("temp\\screenshot.png"));
        logger.info("Скриншот сохранен в файле [temp\\screenshot.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }    
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#takesScreenshotViewablePageTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/10.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет скриншот будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/11.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/12.jpg "New Maven Project - Лог запуска")

### 3.1.2. Скриншот веб элемента

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **takesScreenshotElementTest** - скриншот веб элемента

```java
@Test
public void takesScreenshotElementTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Сделать скриншот ссылки "Да"
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    File file = linkYes.getScreenshotAs(OutputType.FILE);
    try {
        FileUtils.copyFile(file, new File("temp\\screenshot.png"));
        logger.info("Скриншот сохранен в файле [temp\\screenshot.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }    
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#takesScreenshotElementTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/13.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет скриншот будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/14.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/15.jpg "New Maven Project - Лог запуска")

### 3.1.3. Скриншот веб элемента вырезанный из видимой области

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **takesScreenshotElementFromViewablePageTest** - скриншот веб элемента

```java
@Test
public void takesScreenshotElementFromViewablePageTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Найти элемент
    By linkYesXPath = By.xpath("//a[text()=\"Да\"]");
    WebElement linkYes = driver.findElement(linkYesXPath);
    // Получить координаты и размеры элемента
    Point location = linkYes.getLocation();
    Dimension size = linkYes.getSize();
    // Сделать скриншот всей страницы
    File file = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);
    // Сделать скриншот ссылки "Да"
    try {
        BufferedImage viewablePageImage = ImageIO.read(file);
        BufferedImage linkYesImage = viewablePageImage.getSubimage(
            location.getX() - 50, location.getY() - 50,
            size.getWidth() + 200, size.getHeight() + 100);
        ImageIO.write(linkYesImage, "png", file);
        FileUtils.copyFile(file, new File("temp\\screenshot.png"));
        logger.info("Скриншот сохранен в файле [temp\\screenshot.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#takesScreenshotElementFromViewablePageTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/16.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет скриншот будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/17.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/18.jpg "New Maven Project - Лог запуска")


***



Задание [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](3.%20Задание.md)