Java_QA / Level 1. Easy - Основы / 1.1. Selenium WebDriver / Урок 12. Нестандартные задачи

[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](2.%20Практика.md)

***

# 1. Нестандартные задачи

## 1.1. Какие нестандартные задачи бывают?

Кроме обычного взаимодействия с UI (нажатие кнопок, переход по ссылкам и т д) 
в автоматизации тестирования встречаются много других интересных задач.

К ним можно отнести:

* отправка и сохранение файла
* авторизация BasicAuth
* отображение скрытых веб элементов страницы
* изменение параметров веб элементов страницы
* сравнение изображений страницы
* работа с разного типа файлами (.pdf, .xls)
* работа с веб хранилищем  
* эмуляция геолокации

и т д

## 1.2. Каким образом можно решить нестандартные задачи?

Нестандартные задачи можно решить несколькими способами:

* с помощью классов и интерфейсов **Selenium WebDriver**
* c помощью выполнения скрипта на **JavaScript**
* c помощью возможностей предоставляемых **DevTools**
* с помощью сторонних либ

***

# 2. Классы и интерфейсы Selenium WebDriver

В **Selenium WebDriver** существуют классы для

* представления цветов
* печати страницы в PDF
* работы с веб хранилищем
* представления геолокации

***

# 3. Стандартные команды Selenium

## 3.1. Класс WebDriver

### 3.1.1. Авторизация BasicAuth

***BasicAuth (Basic авторизация)*** - самый простой способ ограничения доступа к веб-приложениям и документам,
предусмотренный стандартом протокола HTTP. При попытке обращения к таким ресурсам браузер формирует диалоговое окно,
в котором предлагается ввести свой логин и пароль,
после чего запрос выполняется повторно с предоставлением серверу данных для идентификации.

Cайты, использующие **BasicAuth**, встречаются нечасто, чаще это веб-приложения,
используемые для административных или корпоративных целей.

Основная проблема при тестировании таких приложений это нативные диалоговые окна, при появлении которых,
также как и алертов, дальнейшее управление браузером с помощью Selenium становится просто невозможным.

Одним из способов избежать появления диалогового окна может быть использование
специального URL формата **http://username:password@example.com/** для передачи учетных данных.
Эта конструкция все еще поддерживается некоторыми браузерами, однако такое решение является официально устаревшим и
иногда может отрицательно влиять на корректное выполнение дальнейших запросов на странице.

*Пример*

```java
driver.get("https://<username>:<password>@www.example.com/index.html");
```

## 3.2. Класс WebElement

### 3.2.1. Отправление файла

Отправление (upload) файла обычно является довольно простой задачей.
Она сводится к нахождению input элемента с атрибутом **type = "file"**.
Далее нужно ввести путь к файлу и нажать кнопку **submit**.

*Пример*

```java
WebElement element = driver.findElement(By.id("upload"));
element.sendKeys("/image.png");
```

***

# 4. Цвета

***Цветовая модель*** — математическая модель описания представления цветов в виде кортежей чисел 
(обычно из трёх, реже — четырёх значений), называемых цветовыми компонентами или цветовыми координатами. 
Все возможные значения цветов, задаваемые моделью, определяют **цветовое пространство**.

***RGB (red, green, blue — красный, зелёный, синий) или КЗС*** — аддитивная цветовая модель, 
описывающая способ кодирования цвета для цветовоспроизведения с помощью трёх цветов, которые принято называть основными. 
Выбор основных цветов обусловлен особенностями физиологии восприятия цвета сетчаткой человеческого глаза.

**RGB**-модель является аддитивной, где цвета получаются путём добавления к чёрному цвету. 
При отсутствии излучения — нет никакого цвета — чёрный, смешение всех трёх в определённой пропорции — даёт белый.

Изображение в данной цветовой модели состоит из трёх каналов. 
При смешении основных излучений, например, 
* синего (B) и красного (R), получается пурпурный (M, magenta), 
* зелёного (G) и красного (R) — жёлтый (Y, yellow), 
* зелёного (G) и синего (B) — циановый (С, cyan). 
При смешении всех трёх основных излучений получается белый цвет (W, white).

*Пример*

```text
255,255,255
0,0,0
```

***RGBA (red, green, blue, alpha — красный, зеленый, синий + альфа-канал)*** - трехканальная цветовая модель **RGB**,
дополненная четвертым альфа-каналом. Альфа указывает, насколько непрозрачен каждый пиксель, и позволяет комбинировать изображение с другими,
используя альфа-композицию, с прозрачными областями и сглаживанием краев непрозрачных областей.

*Пример*

```text
255,255,255,0
0,0,0,1
```

***HEX*** - представление цвета в виде трёх пар шестнадцатеричных цифр, где каждая пара отвечает за свой цвет:
* две первые цифры — *красный*
* две в середине — *зелёный*
* две последние цифры — *синий*

*Пример*

```text
#FFFFFF
#000000
```

## 4.1. Класс Color

***Color*** - класс представляющий цвет.

Методы класса **Color**:

| Тип          | Метод                      | Описание                           | 
|--------------|----------------------------|------------------------------------|
| String       | asHex()                    | Представление цвета в HEX системе  |
| String       | asRgb()                    | Представление цвета в RGB системе  |
| String       | asRgba()                   | Представление цвета в RGBa системе |
| static Color | fromString(String value)   | Создание объекта из строки         |
| Color        | getColor()                 | Получение объекта                  |
| void         | setOpacity(double alpha)   | Установка прозрачности             |

[selenium/docs/api : Color](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/support/Color.html)

*Пример*

```java
private final Color HEX_COLOUR = Color.fromString("#2F7ED8");
private final Color RGB_COLOUR = Color.fromString("rgb(255, 255, 255)");
private final Color RGB_COLOUR = Color.fromString("rgb(40%, 20%, 40%)");
private final Color RGBA_COLOUR = Color.fromString("rgba(255, 255, 255, 0.5)");
private final Color RGBA_COLOUR = Color.fromString("rgba(40%, 20%, 40%, 0.5)");
private final Color HSL_COLOUR = Color.fromString("hsl(100, 0%, 50%)");
private final Color HSLA_COLOUR = Color.fromString("hsla(100, 0%, 50%, 0.5)");
private final Color TRANSPARENT = Color.fromString("transparent");
```

### 4.1.1. Проверка цвета веб элемента

*Пример*

```java
private final Color BLACK = Color.fromString("black");
private final Color CHOCOLATE = Color.fromString("chocolate");
private final Color HOTPINK = Color.fromString("hotpink");

Color loginButtonColour = Color
        .fromString(driver.findElement(By.id("login"))
        .getCssValue("color"));
Color loginButtonBackgroundColour = Color
        .fromString(driver.findElement(By.id("login"))
        .getCssValue("background-color"));

Assertions.assertTrue(loginButtonBackgroundColour.equals(HOTPINK));
Assertions.assertTrue(loginButtonBackgroundColour.asHex().equals("#ff69b4");
Assertions.assertTrue(loginButtonBackgroundColour.asRgba().equals("rgba(255, 105, 180, 1)");
Assertions.assertTrue(loginButtonBackgroundColour.asRgb().equals("rgb(255, 105, 180)");        
```

## 4.2. Перечисление Colors

***Colors*** - перечисление представляющее значения цветов.

Константы перечисления **Colors**:

| Константа      | Константа      | Константа   | Константа            | Константа         | Константа     | Константа   | Константа   |
|----------------|----------------|-------------|----------------------|-------------------|---------------|-------------|-------------|
| ALICEBLUE	     | CYAN           | DEEPPINK    | INDIGO               | LIGHTSTEELBLUE    | NAVAJOWHITE   | RED         | TOMATO      |
| ANTIQUEWHITE	 | DARKBLUE       | DEEPSKYBLUE | IVORY                | LIGHTYELLOW       | NAVY          | ROSYBROWN   | TRANSPARENT |
| AQUA	         | DARKCYAN       | DIMGRAY     | KHAKI                | LIMEGREEN         | OLDLACE       | ROYALBLUE   | TURQUOISE   |
| AQUAMARINE	 | DARKGOLDENROD  | DIMGREY     | LAVENDER             | LIME              | OLIVE         | SADDLEBROWN | VIOLET      |
| AZURE	         | DARKGRAY       | DODGERBLUE  | LAVENDERBLUSH        | LINEN             | OLIVEDRAB     | SALMON      | WHEAT       |
| BEIGE	         | DARKGREEN      | FIREBRICK   | LAWNGREEN            | MAGENTA           | ORANGE        | SANDYBROWN  | WHITE       |
| BISQUE	     | DARKGREY       | FLORALWHITE | LEMONCHIFFON         | MAROON            | ORANGERED     | SEAGREEN    | WHITESMOKE  |
| BLACK	         | DARKKHAKI      | FORESTGREEN | LIGHTBLUE            | MEDIUMAQUAMARINE  | ORCHID        | SEASHELL    | YELLOW      |
| BLANCHEDALMOND | DARKMAGENTA    | FUCHSIA     | LIGHTCORAL           | MEDIUMBLUE        | PALEGOLDENROD | SIENNA      | YELLOWGREEN |
| BLUE	         | DARKOLIVEGREEN | GAINSBORO   | LIGHTCYAN            | MEDIUMORCHID      | PALEGREEN     | SILVER      |             |
| BLUEVIOLET	 | DARKORANGE     | GHOSTWHITE  | LIGHTGOLDENRODYELLOW | MEDIUMPURPLE      | PALETURQUOISE | SKYBLUE     |             |
| BROWN	         | DARKORCHID     | GOLD        | LIGHTGRAY            | MEDIUMSEAGREEN    | PALEVIOLETRED | SLATEBLUE   |             |
| BURLYWOOD	     | DARKRED        | GOLDENROD   | LIGHTGREEN           | MEDIUMSLATEBLUE   | PAPAYAWHIP    | SLATEGRAY   |             |
| CADETBLUE	     | DARKSALMON     | GRAY        | LIGHTGREY            | MEDIUMSPRINGGREEN | PEACHPUFF     | SLATEGREY   |             |
| CHARTREUS      | DARKSEAGREEN   | GREEN       | LIGHTPINK            | MEDIUMTURQUOISE   | PERU          | SNOW        |             |
| CHOCOLATE	     | DARKSLATEBLUE  | GREENYELLOW | LIGHTSALMON          | MEDIUMVIOLETRED   | PINK          | SPRINGGREEN |             |
| CORAL	         | DARKSLATEGRAY  | GREY        | LIGHTSEAGREEN        | MIDNIGHTBLUE      | PLUM          | STEELBLUE   |             |
| CORNFLOWERBLUE | DARKSLATEGREY  | HONEYDEW    | LIGHTSKYBLUE         | MINTCREAM         | POWDERBLUE    | TAN         |             |
| CORNSILK	     | DARKTURQUOISE  | HOTPINK     | LIGHTSLATEGRAY       | MISTYROSE         | PURPLE        | TEAL        |             |
| CRIMSON	     | DARKVIOLET     | INDIANRED   | LIGHTSLATEGREY       | MOCCASIN          | REBECCAPURPLE | THISTLE     |             |

Методы перечисления **Colors**:

| Тип             | Метод                | Описание                      | 
|-----------------|----------------------|-------------------------------|
| Color           | getColorValue()      | Получение значение цвета      | 
| static Colors   | valueOf(String name) | Получение константы из строки | 
| static Colors[] | values()             | Получение констант            | 

[selenium/docs/api : Colors](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/support/Colors.html)

***

# 5. Печать страницы в PDF

## 5.1. Интерфейс PrintsPage

***PrintsPage*** - интерфейс для сохранения страницы в **PDF**.

Методы интерфейса **Platform**:

| Тип | Метод                            | Описание                  | 
|-----|----------------------------------|---------------------------|
| Pdf | print(PrintOptions printOptions) | Сохранение страницы в PDF |

[selenium/docs/api : PrintsPage](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/PrintsPage.html)

### 5.1.1. Печать страницы в PDF в формате Base64 

*Пример*

```java
driver.get("https://www.selenium.dev");
PrintsPage printer = (PrintsPage) driver;
PrintOptions printOptions = new PrintOptions();
printOptions.setPageRanges("1-2");
Pdf pdf = printer.print(printOptions);
String content = pdf.getContent();
```

### 5.1.2. Печать страницы в PDF в файл

*Пример*

```java
driver.get("https://www.selenium.dev");
PrintsPage printer = (PrintsPage) driver;
PrintOptions printOptions = new PrintOptions();
printOptions.setPageRanges("1-2");
Pdf pdf = printer.print(printOptions);
byte[] decoded = java.util.Base64.getDecoder().decode(pdf.getContent());
try {
  FileOutputStream fos = new FileOutputStream("pdf.pdf");
  fos.write(decoded);
  fos.flush();
  fos.close();
} catch (IOException e) {
    e.printStackTrace();
}
```

## 5.2. Интерфейс Pdf

***Pdf*** - интерфейс для получения файла **PDF** в формате Base64.

Методы интерфейса **Pdf**:

| Тип    | Метод        | Описание                             | 
|--------|--------------|--------------------------------------|
| String | getContent() | Получение файла PDF в формате Base64 |

[selenium/docs/api : Pdf](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Pdf.html)

## 5.3. Класс PrintOptions

***PrintOptions*** - класс представляющий опции **PDF** при сохранении файла.

Методы класса **PrintOptions**:

| Тип                      | Метод                                                | Описание                      | 
|--------------------------|------------------------------------------------------|-------------------------------|
| boolean                  | getBackground()	                                  | Получение фона страницы       | 
| PrintOptions.Orientation | getOrientation()	                                  | Получение ориентации страницы | 
| PageMargin               | getPageMargin()	                                  | Получение отступов страницы   | 
| String[]                 | getPageRanges()	                                  | Получение номеров страницы    | 
| PageSize                 | getPageSize()	                                      | Получение размеров страницы   | 
| double                   | getScale()	                                          | Получение масштаба страницы   | 
| boolean                  | getShrinkToFit()	                                  |                               | 
| void                     | setBackground(boolean background)	                  | Установка фона страницы       | 
| void                     | setOrientation(PrintOptions.Orientation orientation) | Установка ориентации страницы | 
| void                     | setPageMargin(PageMargin margin)	                  | Установка отступов страницы   | 
| void                     | setPageRanges(String firstRange, String... ranges)   | Установка номеров страницы    | 
| void                     | setPageSize(PageSize pageSize)	                      | Установка размеров страницы   | 
| void                     | setScale(double scale)	                              | Установка масштаба страницв   | 
| void                     | setShrinkToFit(boolean value)                        |                               | 

[selenium/docs/api : PrintOptions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/print/PrintOptions.html)


*Пример*

```java
driver.get("https://www.selenium.dev");
PrintsPage printer = (PrintsPage) driver;
PrintOptions printOptions = new PrintOptions();
printOptions.setBackground(true);
printOptions.setPageRanges("1-2");
printOptions.setScale(2.0);
Pdf pdf = printer.print(printOptions);
pdf.getContent();
```

## 5.4. Перечисление PrintOptions.Orientation

***PrintOptions.Orientation*** - перечисление представляющее ориентацию страницы.

Константы перечисления **PrintOptions.Orientation**:

| Тип           | Описание   | 
|---------------|------------|
| LANDSCAPE     | Альбомная  |
| PORTRAIT      | Портретная |

Методы перечисления **PrintOptions.Orientation**:

| Тип                               | Метод                | Описание                              | 
|-----------------------------------|----------------------|---------------------------------------|
| static PrintOptions.Orientation	| valueOf(String name) | Константа из строкового представления |
| static PrintOptions.Orientation[]	| values()             | Массив констант                       |

[selenium/docs/api : PrintOptions.Orientation](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/print/PrintOptions.Orientation.html)

## 5.5. Класс PageMargin

***PageMargin*** - класс представляющий отступы страницы.

Методы класса *PrintOptions.Orientation*

| Тип    | Метод       | Описание          | 
|--------|-------------|-------------------|
| double | getBottom() | От нижней границы |
| double | getLeft()   | От левой границы  |
| double | getRight()  | От правой границы |
| double | getTop()    | От верхней границы|

[selenium/docs/api : PageMargin](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/print/PageMargin.html)

## 5.6. Класс PageSize

***PageSize*** - класс представляющий размеры страницы.

Методы класса **PrintOptions.Orientation**

| Тип    | Метод       | Описание | 
|--------|-------------|----------|
| double | getHeight() | Высота   | 
| double | getWidth()  | Ширина   | 

[selenium/docs/api : PageSize](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/print/PageSize.html)

***

# 6. Веб хранилище

***Веб-хранилище (Web Storage, DOM-хранилище)*** - набор механизмов, которые используются для хранения данных локально
в веб-браузере пользователя в виде пары ключ/значение. Другими словами, это специально отведенное место в браузере
(похоже на небольшую базу данных), в котором мы можем работать с данными - записывать, читать и удалять их.

Существуют два основных типа веб-хранилища:

* *сессионное хранилище (sessionStorage)*

***Сессионное хранилище*** - это объект sessionStorage, который позволяет хранить данные для каждого домена, 
доступные на протяжении сессии, пока открыт браузер, и даже в том случае, если была осуществлена перезагрузка страницы. 
Однако закрытие вкладки браузера, самого браузера или перезагрузка компьютера приводит к удалению данных из sessionStorage.

Объект sessionStorage используется гораздо реже, чем localStorage.

* *локальное хранилище (localStorage)*
  
***Локальное хранилище*** - это объект localStorage, который позволяет хранить данные для каждого домена 
в течение неограниченного времени (после закрытия вкладки браузера, самого браузера, перезагрузки компьютера), 
а точнее пока пользователь самостоятельно не удалит данные.

Каждый домен имеет доступ к своему хранилищу данных localStorage. 
Например, localStorage, используемый для, https://osipenkov.ru является отдельным от localStorage, 
используемым для https://coobiq.com. 

Субдомены (поддомены) и различные протоколы HTTP (HTTP и HTTPS) имеют независимые друг от друга хранилища данных. 
Например, localStorage https://gtm.osipenkov.ru используется полностью отдельно от https://osipenkov.ru. 
Точно так же localStorage https://osipenkov.ru используется отдельно от http://osipenkov.ru.

Некоторые браузеры блокируют localStorage в режиме инкогнито. localStorage работает даже с отключенными cookie.

Объекты веб-хранилища **localStorage** и **sessionStorage** позволяют хранить пары ключ/значение в браузере.

Что в них важно – данные, которые в них записаны, сохраняются

* после обновления страницы (в случае sessionStorage)
* после перезапуска браузера (при использовании localStorage).

Преимущества веб хранилища перед куки:

* больший объем хранимых данных (между 5 и 10 МБайт на каждый домен)
* данные хранятся между загрузками страницы и посещениями сайта (даже после выключения и включения компьютера)
* объекты веб-хранилища не отправляются на сервер при каждом запросе.
* сервер не может манипулировать объектами хранилища через HTTP-заголовки
* хранилище привязано к источнику (домен/протокол/порт) 
* разные протоколы или поддомены определяют разные объекты хранилища, и они не могут получить доступ к данным друг друга

Объекты хранилища localStorage и sessionStorage предоставляют одинаковые методы и свойства:

* *setItem(key, value)* – сохранить пару ключ/значение.
* *getItem(key)* – получить данные по ключу key.
* *removeItem(key)* – удалить данные с ключом key.
* *clear()* – удалить всё.
* *key(index)* – получить ключ на заданной позиции.
* *length* – количество элементов в хранилище.

## 6.1. Интерфейс WebStorage

***WebStorage*** - интерфейс представляющее доступ к веб хранилищу.

Методы интерфейса **WebStorage**:

| Тип            | Метод               | Описание                       | 
|----------------|---------------------|--------------------------------|
| LocalStorage   | getLocalStorage()   | Доступ к локальному хранилищу  |
| SessionStorage | getSessionStorage() | Доступ к сессионному хранилищу |

[selenium/docs/api : WebStorage](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/html5/WebStorage.html)

## 6.2. Интерфейс LocalStorage

***LocalStorage*** - интерфейс представляющий локальное хранилище.

Методы интерфейса **LocalStorage**:

| Тип         | Метод                             | Описание                      | 
|-------------|-----------------------------------|-------------------------------|
| void        | clear()                           | Очистка локального хранилища  |
| String      | getItem(String key)               | Получение элемента по ключу   |
| Set<String> | keySet()                          | Получение набора ключей       |
| String      | removeItem(String key)            | Удаление элемента по ключу    |
| void        | setItem(String key, String value) | Добавление элемента           |
| int         | size()                            | Получение размера             |

[selenium/docs/api : LocalStorage](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/html5/LocalStorage.html)

### 6.2.1. Работа с локальным хранилищем

*Пример*

```java
// Получить доступ к локальному хранилищу
WebStorage webStorage = (WebStorage) driver;
LocalStorage localStorage = webStorage.getLocalStorage();
// Получить данные локального хранилища
Set<String> keySet = localStorage.keySet();
// Добавить данные в локальное хранилище
localStorage.setItem("item1", "item1");
// Удалить данные из локального хранилища
localStorage.removeItem("item1");
```

## 6.3. Интерфейс SessionStorage

***SessionStorage*** - интерфейс представляющий сессионное хранилище.

Методы интерфейса **SessionStorage**:

| Тип         | Метод                             | Описание                      | 
|-------------|-----------------------------------|-------------------------------|
| void        | clear()                           | Очистка сессионного хранилища |
| String      | getItem(String key)               | Получение элемента по ключу   |
| Set<String> | keySet()                          | Получение набора ключей       |
| String      | removeItem(String key)            | Удаление элемента по ключу    |
| void        | setItem(String key, String value) | Добавление элемента           |
| int         | size()                            | Получение размера             |

[selenium/docs/api : SessionStorage](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/html5/SessionStorage.html)

### 6.2.1. Работа с сессионным хранилищем

*Пример*

```java
// Получить доступ к сессионному хранилищу
WebStorage webStorage = (WebStorage) driver;
SessionStorage sessionStorage = webStorage.getSessionStorage();
// Получить данные сессионного хранилища
Set<String> keySet = sessionStorage.keySet();
// Добавить данные в сессионное хранилище
sessionStorage.setItem("item1", "item1");
// Удалить данные из локального хранилища
sessionStorage.removeItem("item1");
```

***

# 7. Выполнение JS скрипта

## 7.1. Интерфейс JavascriptExecutor

***JavascriptExecutor*** - интерфейс позволяющий **Selenium WebDriver** выполнять **JS** скрипт в браузере.

Методы интерфейса **JavascriptExecutor**:

| Тип                    | Метод                                             | Описание                            | 
|------------------------|---------------------------------------------------|-------------------------------------|
| Object                 | executeAsyncScript(String script, Object... args) | Выполнение асинхронного скрипта     | 
| Object                 | executeScript(String script, Object... args)      | Выполнение синхронного скрипта      | 
| default Object         | executeScript(ScriptKey key, Object... args)      | Выполнение сохраненного скрипта     | 
| default Set<ScriptKey> | getPinnedScripts()                                | Получение сохраненных скриптов      | 
| default ScriptKey      | pin(String script)                                | Сохранение скрипта в текущей сессии |
| default void           | unpin(ScriptKey key)                              | Удаление скрипта из текущий сессии  | 

[selenium/docs/api : JavascriptExecutor](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/JavascriptExecutor.html)

### 7.1.1. Клик на веб элемент

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor)driver;
WebElement button = driver.findElement(By.name("btnLogin"));
js.executeScript("arguments[0].click();", button);
```

### 7.1.2. Получение текста веб элемента

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor)driver;
WebElement button = driver.findElement(By.name("btnLogin"));
String text = (String) js.executeScript("return arguments[0].innerText", button);
```

### 7.1.3. Скроллинг страницы

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor)driver;		
js.executeScript("window.scrollBy(0,600)");
```

### 7.1.4. Отображение скрытых элементов

Изменение прозрачности элемента.

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor) driver;	
WebElement element = driver.findElement("//input[@type='button']");
String script = "arguments[0].style.opacity=1;" +
        "arguments[0].style['transform']='translate(0px, 0px) scale(1)';" +
        "arguments[0].style['MozTransform']='translate(0px, 0px) scale(1)';" +
        "arguments[0].style['WebkitTransform']='translate(0px, 0px) scale(1)';" +
        "arguments[0].style['msTransform']='translate(0px, 0px) scale(1)';" +
        "arguments[0].style['OTransform']='translate(0px, 0px) scale(1)';" +
        "return true;";
js.executeScript(script, element);
```

Изменение видимости элемента.

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor) driver;
String script = "arguments[0].style.visibility='visible';";
js.executeScript(script, divVisibilityHidden);
```

Изменение отображения элемента.

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor) driver;
String script = "arguments[0].style.display='block';";
js.executeScript(script, divDisplayNone);
```

### 7.1.5. Создание цветов

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor) driver;
String script = "document.getElementById('button1').style.backgroundColor = 'HotPink';";
js.executeScript(script, divDisplayNone);
```

***

# 8. DevTools

***Инструменты разработчика (Development Tools или сокращённо DevTools)*** ─ программы, позволяющие создавать, 
тестировать и отлаживать (debug) программное обеспечение.

Современные браузеры, Safari, Firefox, Microsoft Edge, Chrome, Яндекс 
и другие, имеют встроенные инструменты разработчика, 
позволяющие просмотреть исходный код сайта. Отдельно устанавливать их не требуется. 
С их помощью можно просматривать и отлаживать HTML сайта, его CSS и Javascript. 
Также можно проверить сетевой трафик, потребляемый сайтом, его быстродействие и много других параметров.

***Chrome DevTools*** - набор инструментов веб-разработчика, встроенных непосредственно в браузер Google Chrome.

В **Selenium 4** добавили долгожданную встроенную поддержку протокола **Chrome DevTools** через интерфейс **DevTools**. 

https://www.selenium.dev/documentation/en/support_packages/chrome_devtools/
https://habr.com/ru/post/548898/

## 8.1. Класс DevTools

***DevTools*** - класс представляющий DevTools. 

Методы класса **DevTools**:

| Тип         | Метод                                            | Описание                      | 
|-------------|--------------------------------------------------|-------------------------------|
| <X> void    | addListener(Event<X> event, Consumer<X> handler) | Добавление слушателя события  |
| void        | clearListeners()                                 | Удаление слушателей событий   |
| void        | close()                                          | Закрытие DevTools             |
| void        | createSession()                                  |                               |
| void        |	createSessionIfThereIsNotOne()                   |                               |
| SessionID   | getCdpSession()                                  | Получение сессии              |
| Domains     | getDomains()                                     | установка геолокации          |
| <X> X       | send(Command<X> command)                         | Отправка                      |

[selenium/docs/api : DevTools](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/devtools/DevTools.html)

*Пример*

```java
ChromeDriver driver = new ChromeDriver();
DevTools devTools = driver.getDevTools();
devTools.createSession();
devTools.send(Performance.enable(Optional.empty()));
List<Metric> metricList = devTools.send(Performance.getMetrics());

driver.get("https://google.com");
driver.quit();

for(Metric m : metricList) {
    System.out.println(m.getName() + " = " + m.getValue());
}
```

### Simulating Device Mode

Most of the applications we build today are responsive to cater to the needs of the end
users coming from a variety of platforms, devices like phones, tablets, wearable devices, desktops  and orientations.

As testers, we might want to place our application in various dimensions to trigger the responsiveness of the application.

How can we use Selenium’s new CDP functionality to accomplish this?

The CDP command to modify the device’s metrics is Emulation.setDeviceMetricsOverride,
and this command requires input of width, height, mobile, and deviceScaleFactor.
These four keys are mandatory for this scenario, but there are several optional ones as well.

In our Selenium tests, we could use the DevTools::send() method using the built-in setDeviceMetricsOverride() command,
however, this Selenium API accepts 12 arguments – the 4 that are required as well as 8 optional ones.
For any of the 8 optional arguments that we don’t need to send, we can pass Optional.empty().

However, to streamline this a bit by only passing the required parameters,
I’m going to use the raw executeCdpCommand() instead as shown in the code below.

*Пример*

```java
ChromeDriver driver;
driver = new ChromeDriver();

DevTools devTools = driver.getDevTools();
devTools.createSession();
Map deviceMetrics = new HashMap()
{{
    put("width", 600);
    put("height", 1000);
    put("mobile", true);
    put("deviceScaleFactor", 50);
}};
driver.executeCdpCommand("Emulation.setDeviceMetricsOverride", deviceMetrics);
driver.get("https://www.google.com");
```

### Simulate Network Speed

Many users access web applications via handheld devices which are connected to wifi or cellular networks.
It’s not uncommon to reach a weak network signal, and therefore a slower internet connection.

It may be important to test how your application behaves under such conditions
where the internet connection is slow (2G) or goes offline intermittently.

The CDP command to fake a network connection is Network.emulateNetworkConditions.
Information on the required and optional parameters for this command can be found in the documentation.

With access to Chrome DevTools, it becomes possible to simulate these scenarios. Lets see how.

*Пример*

```java
ChromeDriver driver;
driver = new ChromeDriver();

DevTools devTools = driver.getDevTools();
devTools.createSession();
devTools.send(Network.enable(Optional.empty(), Optional.empty(), Optional.empty()));
devTools.send(Network.emulateNetworkConditions(
    false,
    20,
    20,
    50,
    Optional.of(ConnectionType.CELLULAR2G)
));
driver.get("https://www.google.com");
```

### Mocking Geolocation

Testing the location-based functionality of applications such as different offers, currencies, taxation rules,
freight charges and date/time format for various geolocations is difficult  because setting up the infrastructure
for all of these physical geolocations is not a feasible solution.

With mocking the geolocation, we could cover all the aforementioned scenarios and more.

The CDP command to fake a geolocation is Emulation.setGeolocationOverride.
Information on the required and optional parameters for this command can be found in the documentation.

How can we achieve this with Selenium? Let’s walk through the sample code.

*Пример*

```java
ChromeDriver driver = new ChromeDriver();

DevTools devTools = driver.getDevTools();
devTools.createSession();
devTools.send(Emulation.setGeolocationOverride(
    Optional.of(35.8235),
    Optional.of(-78.8256),
    Optional.of(100)));
driver.get("https://mycurrentlocation.net/");
```

### Capture HTTP Requests

With DevTools we can capture the HTTP requests the application is invoking and access the method, data, headers and lot more.

Lets see how to capture the HTTP requests, the URI and the request method with the sample code.

*Пример*

```java
driver = new ChromeDriver();
chromeDevTools = driver.getDevTools();
chromeDevTools.createSession();

chromeDevTools.send(Network.enable(Optional.empty(), Optional.empty(), Optional.empty()));
chromeDevTools.addListener(Network.requestWillBeSent(),
entry -> {
System.out.println("Request URI : " + entry.getRequest().getUrl()+"\n"
+ " With method : "+entry.getRequest().getMethod() + "\n");
entry.getRequest().getMethod();
});
driver.get("https://www.google.com");
chromeDevTools.send(Network.disable());
```

### Access Console logs

We all rely on logs for debugging and analysing the failures.
While testing and working on an application with specific data or specific conditions,
logs help us in debugging and capturing the error messages,
giving more insights that are published in the Console tab of the Chrome DevTools.

We can capture the console logs through our Selenium scripts by calling the CDP Log commands as demonstrated below.

*Пример*

```java
driver = new ChromeDriver();
chromeDevTools = driver.getDevTools();
chromeDevTools.createSession();

chromeDevTools.send(Log.enable());
chromeDevTools.addListener(Log.entryAdded(),
logEntry -> {
System.out.println("log: "+logEntry.getText());
System.out.println("level: "+logEntry.getLevel());
});
driver.get("https://testersplayground.herokuapp.com/console-5d63b2b2-3822-4a01-8197-acd8aa7e1343.php");

```

### Capturing Performance Metrics

In today’s fast world while we are iteratively building software at such a fast pace,
we should aim to detect performance bottlenecks iteratively too.
Poor performing websites and slower loading pages make unhappy customers.

Can we validate these metrics along with our functional regression on every build? Yes, we can!

The CDP command to capture performance metrics is Performance.enable.
Information for this command can be found in the documentation.

Lets see how it’s done with Selenium 4 and Chrome DevTools APIs.

*Пример*

```java
ChromeDriver driver = new ChromeDriver();
DevTools devTools = driver.getDevTools();
devTools.createSession();
devTools.send(Performance.enable());

driver.get("https://www.google.org");

List<Metric> metrics = devTools.send(Performance.getMetrics());
List<String> metricNames = metrics.stream()
.map(o -> o.getName())
.collect(Collectors.toList());

devTools.send(Performance.disable());

List<String> metricsToCheck = Arrays.asList(
"Timestamp", "Documents", "Frames", "JSEventListeners",
"LayoutObjects", "MediaKeySessions", "Nodes",
"Resources", "DomContentLoaded", "NavigationStart");

metricsToCheck.forEach( metric -> System.out.println(metric +
" is : " + metrics.get(metricNames.indexOf(metric)).getValue()));

```

### Basic Authentication

Interacting with browser popups is not supported in Selenium, as it is only able to engage with DOM elements.
This poses a challenge for pop-ups such as authentication dialogs.

We can bypass this by using the CDP APIs to handle the authentication directly with DevTools.
The CDP command to set additional headers for the requests is Network.setExtraHTTPHeaders.

Here’s how to invoke this command in Selenium 4.

*Пример*

```java
ChromeDriver driver = new ChromeDriver();

//Create DevTools session and enable Network
DevTools chromeDevTools = driver.getDevTools();
chromeDevTools.createSession();
chromeDevTools.send(Network.enable(Optional.empty(), Optional.empty(), Optional.empty()));

//Open website
driver.get("https://jigsaw.w3.org/HTTP/");

//Send authorization header
Map<String, Object> headers = new HashMap<>();
String basicAuth ="Basic " + new String(new Base64().encode(String.format("%s:%s", USERNAME, PASSWORD).getBytes()));
headers.put("Authorization", basicAuth);
chromeDevTools.send(Network.setExtraHTTPHeaders(new Headers(headers)));

//Click authentication test - this normally invokes a browser popup if unauthenticated
driver.findElement(By.linkText("Basic Authentication test")).click();

String loginSuccessMsg = driver.findElement(By.tagName("html")).getText();
if(loginSuccessMsg.contains("Your browser made it!")){
System.out.println("Login successful");
}else{
System.out.println("Login failed");
}

driver.quit();
```

### URL Filtering

*Пример*

```java
//enable Network
chromeDevTools.send(Network.enable(Optional.empty(), Optional.empty(), Optional.empty()));

//set blocked URL patterns
chromeDevTools.send(Network.setBlockedURLs(ImmutableList.of("*.css", "*.png")));

//add event listener to verify that css and png are blocked
chromeDevTools.addListener(Network.loadingFailed(), loadingFailed -> {

    if (loadingFailed.getResourceType().equals(ResourceType.Stylesheet)) {
        Assert.assertEquals(loadingFailed.getBlockedReason(), BlockedReason.inspector);
    }

    else if (loadingFailed.getResourceType().equals(ResourceType.Image)) {
        Assert.assertEquals(loadingFailed.getBlockedReason(), BlockedReason.inspector);
    }

});

chromeDriver.get("https://apache.org");
```

### Adding Custom Headers

*Пример*

```java
//enable Network
chromeDevTools.send(Network.enable(Optional.empty(), Optional.empty(), Optional.empty()));

//set custom header
chromeDevTools.send(Network.setExtraHTTPHeaders(ImmutableMap.of("customHeaderName", "customHeaderValue")));

//add event listener to verify that requests are sending with the custom header
chromeDevTools.addListener(Network.requestWillBeSent(), requestWillBeSent -> Assert
.assertEquals(requestWillBeSent.getRequest().getHeaders().get("customHeaderName"),
"customHeaderValue"));

chromeDriver.get("https://apache.org");
```

### Intercepting requests

*Пример*

```java
//enable Network
chromeDevTools.send(Network.enable(Optional.empty(), Optional.empty(), Optional.empty()));

//add listener to intercept request and continue
chromeDevTools.addListener(Network.requestIntercepted(),
requestIntercepted -> chromeDevTools.send(
Network.continueInterceptedRequest(requestIntercepted.getInterceptionId(),
Optional.empty(),
Optional.empty(),
Optional.empty(), Optional.empty(),
Optional.empty(),
Optional.empty(), Optional.empty())));

//set request interception only for css requests
RequestPattern requestPattern = new RequestPattern("*.css", ResourceType.Stylesheet, InterceptionStage.HeadersReceived);
chromeDevTools.send(Network.setRequestInterception(ImmutableList.of(requestPattern)));

chromeDriver.get("https://apache.org");
```

### Listen To Console Logs

*Пример*

```java
String consoleMessage = "Hello Selenium 4";

//enable Console
chromeDevTools.send(Console.enable());

//add listener to verify the console message
chromeDevTools.addListener(Console.messageAdded(), consoleMessageFromDevTools ->
Assert.assertEquals(true, consoleMessageFromDevTools.getText().equals(consoleMessage)));

chromeDriver.get("https://apache.org");

//execute JS - write console message
chromeDriver.executeScript("console.log('" + consoleMessage + "');");
```

### IgnoreCertificateErrors

*Пример*

```java
//enable Security
chromeDevTools.send(Security.enable());

//set ignore certificate errors
chromeDevTools.send(Security.setIgnoreCertificateErrors(true));

//load insecure website
chromeDriver.get("https://expired.badssl.com/");

//verify that the page was loaded
Assert.assertEquals(true, chromeDriver.getPageSource().contains("expired"));
```

### Command

*Пример*

```java
chromeDevTools.send(new Command<>("Browser.crash", ImmutableMap.of()));
```

### Переопределение UserAgent

До Selenium 4 UserAgent устанавливался только через capabilities, до создания объекта драйвера.
Network.setUserAgentOverride задает новое значение UserAgent на лету.

*Пример*

```java
devTools.send(Network.setUserAgentOverride("aqa-agent", Optional.empty(), Optional.empty(), Optional.empty()));
```

### Предоставление прав

Для некоторых операций, браузер запрашивает разрешение пользователя, например, для доступа к буферу обмена или микрофону. Предоставить права можно при помощи Browser.grantPermissions передавая перечень необходимых PermissionType.

Для примера разрешим браузеру захват звука.

*Пример*

```java
driver.executeCdpCommand("Browser.grantPermissions", Map.of("permissions", asList("audioCapture")));
```

### Добавление заголовков в запросы

Network.setExtraHTTPHeaders позволяет добавить кастомные заголовки к запросам.

*Пример*

```java
devTools.send(Network.enable(empty(),empty(),empty()));
devTools.send(Network.setExtraHTTPHeaders(new Headers(Map.of("aqa-header", "John Wick"))));
```

### Перехват и модификация запросов

Fetch.enable включает перехват, каждый запрос будет остановлен пока клиент не вызовет failRequest, fulfillRequest или continueRequest.
Перехватывать можно все запросы и модифицировать по условию, либо работать только с целевыми, указав для этого RequestPattern, ниже приведены оба варианта.

Модифицируем URL, например перенаправим запросы /v1/users на новую версию бэкенда /v2/users.

*Пример*

```java
devTools.send(Fetch.enable(empty(), empty()));
devTools.addListener(Fetch.requestPaused(), request -> {

String url = request.getRequest().getUrl().contains("/v1/users")
? request.getRequest().getUrl().replace("/v1/users", "/v2/users")
: request.getRequest().getUrl();

devTools.send(Fetch.continueRequest(
request.getRequestId(),
Optional.of(url),
Optional.of(request.getRequest().getMethod()),
request.getRequest().getPostData(),
request.getResponseHeaders()));
});
```

Аналогичным способом эмулируется неудачный запрос. Например для тестирования работы приложения с отвалившейся интеграцией.

*Пример*

```java
Optional<List<RequestPattern>> patterns = Optional.of(asList(new RequestPattern(of("*.dropbox.*"), empty(), empty())));
devTools.send(Fetch.enable(patterns, empty()));
devTools.addListener(Fetch.requestPaused(), r -> devTools.send(Fetch.failRequest(r.getRequestId(), FAILED)));
```

### Эмуляция интернет соединения

Network.emulateNetworkConditions позволяет задавать параметры соединения, например для тестирования поведения при слабом 3G или отсутствии сети.

*Пример*

```java
devTools.send(Network.enable(empty(), empty(), empty()));
devTools.send(Network.emulateNetworkConditions(false, 100, 1000, 1000, of(ConnectionType.CELLULAR3G)));
```

### Очистка кэша
Network.clearBrowserCache очистит кэш браузера.

*Пример*

```java
devTools.send(Network.clearBrowserCache());
```

### Блокировка загрузки ресурсов

Через Network.setBlockedURLs можно ограничишь загрузку ресурсов по паттерну. Например, заблокируем скачивание .svg

*Пример*

```java
devTools.send(Network.enable(empty(), empty(), empty()));
devTools.send(Network.setBlockedURLs(List.of("*.svg")));
Установка TimeZone и Geolocation Position
Emulation.setTimezoneOverride переопределяет TimeZone браузера, а Emulation.setGeolocationOverride геопозицию.

devTools.send(Emulation.setTimezoneOverride("America/New_York"));
devTools.send(Emulation.setGeolocationOverride(Optional.of(40.730610), Optional.of(-73.935242), Optional.of(1)));
```

### Обход ограничений безопасности

Security.setIgnoreCertificateErrors позволит обойти проблемы с SSL сертификатом. Отмечу, что не призываю к таким действиям, а показываю наличие возможности.

*Пример*

```java
devTools.send(Security.enable());
devTools.send(Security.setIgnoreCertificateErrors(true));
```

###  Метрики

Performance.enable включает сбор метрик (Resources, Documents, JSHeapUsedSize etc.), а Performance.getMetrics возвращает текущие значения.

*Пример*

```java
devTools.send(Performance.enable(empty()));
        List<Metric> send = devTools.send(Performance.getMetrics());

***

# 9. Сторонние либы



***

# 10. Работа с файлом формата PDF

## 10.1. Библиотека Apache PdfBox

***Apache PDFBox*** - библиотека **Java** с открытым исходным кодом для работы с документами **PDF**.

Возможности:

* создание новых документов **PDF**
* создание документов **PDF** из текстового файла
* редактирование существующих документов **PDF**
* печатать **PDF**
* извлечение контента (текста) из документов **PDF**
* объединение документов **PDF**
* шифрование / дешифрование документов **PDF**
  и т д.

Apache PDFBox также включает в себя несколько утилит командной строки.

[Apache PDFBox](https://pdfbox.apache.org/)

[PDFBox API](https://pdfbox.apache.org/docs/2.0.13/javadocs/)

### 

*Пример*

```java
// Открытие файла PDF
File file = new File("C:/new.pdf");
PDDocument document = PDDocument.load(file);
// Извлечение текста из документа PDF
PDFTextStripper pdfStripper = new PDFTextStripper();
String text = pdfStripper.getText(document);
System.out.println(text);
// Закрытие файла PDF
document.close();
````

## 11.2. Библиотека iText

***iText*** - библиотека на **Java**, предназначенная для работы с **pdf**.

Начиная с версии 5.0.0 свободно распространяется по лицензии **AGPL**
(обязывающая предоставлять пользователям возможность получения исходного кода), но также есть и коммерческая версия.

[iText PDF](https://itextpdf.com/en)

[iText API](https://itextpdf.com/en/resources/api-documentation)

###

*Пример*

```java
// Открытие файла PDF
PdfReader reader = new PdfReader("C:/new.pdf");
// Извлечение текста из документа PDF (нумерация страниц в PDF начинается с единицы)
for (int i = 1; i <= reader.getNumberOfPages(); ++i) {
    TextExtractionStrategy strategy = new SimpleTextExtractionStrategy();
    String text = PdfTextExtractor.getTextFromPage(reader, i, strategy);
    System.out.println(text);
}
// Закрытие файла PDF
reader.close();
````

***

# 12. Работа с файлами формата Excel

## 12.1.


## 12.2. 

***

Практика [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](2.%20Практика.md)
