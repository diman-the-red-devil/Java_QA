Java_QA / Level 1. Easy - Основы / 1.1. Selenium WebDriver / Урок 12. Нестандартные задачи

[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](2.%20Практика.md)

***

# 1. Выполнение JS скрипта

## 1.1. Интерфейс JavascriptExecutor

***JavascriptExecutor*** - интерфейс позволяющий **Selenium WebDriver** выполнять JS скрипт в браузере.

Методы интерфейса **JavascriptExecutor**:

| Тип                    | Метод                                             | Описание                            | 
|------------------------|---------------------------------------------------|-------------------------------------|
| Object                 | executeAsyncScript(String script, Object... args) | Выполнение асинхронного скрипта     | 
| Object                 | executeScript(String script, Object... args)      | Выполнение синхронного скрипта      | 
| default Object         | executeScript(ScriptKey key, Object... args)      | Выполнение сохраненного скрипта     | 
| default Set<ScriptKey> | getPinnedScripts()                                | Получение сохраненных скриптов      | 
| default ScriptKey      | pin(String script)                                | Сохранение скрипта в текущей сессии |
| default void           | unpin(ScriptKey key)                              | Удаление скрипта из текущий сессии  | 

[selenium/docs/api : JavascriptExecutor](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/JavascriptExecutor.html)

### 1.1.1. Клик на кнопку

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor)driver;
WebElement button = driver.findElement(By.name("btnLogin"));
js.executeScript("arguments[0].click();", button);
String text = (String) js.executeScript("return arguments[0].innerText", button);
js.executeScript("console.log('hello world')");
```

### 1.1.1. Скроллинг

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor)driver;		
js.executeScript("window.scrollBy(0,600)");
```

### 1.1.2. Загрузка файлов

### 1.1.3. Видеоплеер

### 1.1.4. Веб сторадже

***

# 2. BasicAuth

***

# 3. Цвета

## 3.1. Класс Color

***Color*** - класс

Методы класса **Color**:

| Тип          | Метод                      | Описание                      | 
|--------------|----------------------------|-------------------------------|
| String       | asHex()                    |  |
| String       | asRgb()                    |  |
| String       | asRgba()                   |  |
| boolean      | equals(Object other)       |  |
| static Color | fromString(String value)   |  |
| Color        | getColor()                 |  |
| int          | hashCode()                 |  |
| void         | setOpacity(double alpha)   |  |
| String       | toString()                 |  |

[selenium/docs/api : Color](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/support/Color.html)

*Пример*

```java
private final Color HEX_COLOUR = Color.fromString("#2F7ED8");
private final Color RGB_COLOUR = Color.fromString("rgb(255, 255, 255)");
private final Color RGB_COLOUR = Color.fromString("rgb(40%, 20%, 40%)");
private final Color RGBA_COLOUR = Color.fromString("rgba(255, 255, 255, 0.5)");
private final Color RGBA_COLOUR = Color.fromString("rgba(40%, 20%, 40%, 0.5)");
private final Color HSL_COLOUR = Color.fromString("hsl(100, 0%, 50%)");
private final Color HSLA_COLOUR = Color.fromString("hsla(100, 0%, 50%, 0.5)");
private final Color TRANSPARENT = Color.fromString("transparent");
```

## 3.2. Перечисление Colors

***Colors*** - перечисление

Методы перечисления *Colors*

| Тип             | Метод                | Описание                      | 
|-----------------|----------------------|-------------------------------|
| Color           | getColorValue()      | | 
| static Colors   | valueOf(String name) | Returns the enum constant of this type with the specified name.| 
| static Colors[] | values()             | | 

[selenium/docs/api : Colors](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/support/Colors.html)

***

Select select = new Select(<WebElement object>);
selectByVisibleText()
selectByIndex()
selectByValue()

deselectByVisibleText()
deselectByIndex()
deselectByValue()
deselectAll()

getOptions()
getAllSelectedOptions()
getFirstSelectedOption()

***

# 4. Печать

## Интерфейс PrintsPage

***PrintsPage*** - интерфейс

Методы интерфейса **Platform**:

| Тип | Метод                            | Описание                      | 
|-----|----------------------------------|-------------------------------|
| Pdf | print(PrintOptions printOptions) |                               |

[selenium/docs/api : PrintsPage](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/PrintsPage.html)

*Пример*

```java
driver.get("https://www.selenium.dev");
printer = (PrintsPage) driver;
```

## Класс PrintOptions

***PrintOptions*** - класс

Методы класса *Platform*

| Тип                      | Метод                                                        | Описание    | 
|--------------------------|--------------------------------------------------------------|-------------|
| boolean                  | getBackground()	                                          |             | 
| PrintOptions.Orientation | getOrientation()	                                          |             | 
| PageMargin               | getPageMargin()	                                          |             | 
| String[]                 | getPageRanges()	                                          |             | 
| PageSize                 | getPageSize()	                                              |             | 
| double                   | getScale()	                                                  |             | 
| boolean                  | getShrinkToFit()	                                          |             | 
| void                     | setBackground(boolean background)	                          |             | 
| void                     | setOrientation(PrintOptions.Orientation orientation)	      |             | 
| void                     | setPageMargin(PageMargin margin)	                          |             | 
| void                     | setPageRanges(String firstRange, String... ranges) |             | 
| void                     | setPageSize(PageSize pageSize)	                              |             | 
| void                     | setScale(double scale)	                                      |             | 
| void                     | setShrinkToFit(boolean value)                                |             | 

[selenium/docs/api : PrintOptions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/print/PrintOptions.html)

*Пример*

```java
driver.get("https://www.selenium.dev");
printer = (PrintsPage) driver;

PrintOptions printOptions = new PrintOptions();
printOptions.setPageRanges("1-2");
```

## Перечисление PrintOptions.Orientation

***PrintOptions.Orientation*** - перечисление

Константы перечисления *PrintOptions.Orientation*

| Тип           | Описание         | 
|---------------|------------------|
| LANDSCAPE     |              |
| PORTRAIT      |              |

Методы перечисления *PrintOptions.Orientation*

| Тип                               | Метод                | Описание                      | 
|-----------------------------------|----------------------|-------------------------------|
| static PrintOptions.Orientation	| valueOf(String name) | Returns the enum constant of this type with the specified name.
| static PrintOptions.Orientation[]	| values()             | Returns an array containing the constants of this enum type, in the order they are declared.

[selenium/docs/api : PrintOptions.Orientation](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/print/PrintOptions.Orientation.html)

## Класс PageMargin

***PageMargin*** - класс

Методы класса *PrintOptions.Orientation*

| Тип    | Метод       | Описание                      | 
|--------|-------------|-------------------------------|
| double | getBottom() | |
| double | getLeft()   | |
| double | getRight()  | |
| double | getTop()    | |

[selenium/docs/api : PageMargin](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/print/PageMargin.html)

## Класс PageSize

***PageSize*** - класс

Методы класса *PrintOptions.Orientation*

| Тип    | Метод       | Описание                      | 
|--------|-------------|-------------------------------|
| double | getHeight() | | 
| double | getWidth()  | | 

[selenium/docs/api : PageSize](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/print/PageSize.html)

## Pdf

***Pdf*** - интерфейс

Методы интерфейса **Pdf**:

| Тип    | Метод        | Описание                      | 
|--------|--------------|-------------------------------|
| String | getContent() |                               |

[selenium/docs/api : Pdf](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Pdf.html)

*Пример*

```java
driver.get("https://www.selenium.dev");
printer = (PrintsPage) driver;

PrintOptions printOptions = new PrintOptions();
printOptions.setPageRanges("1-2");

Pdf pdf = printer.print(printOptions);
String content = pdf.getContent();
```

***

# 5

## Интерфейс Rotatable

***Rotatable*** - интерфейс

Represents rotation of the browser view for orientation-sensitive devices. 
When using this with a real device, the device should not be moved so that the built-in sensors do not interfere.

Методы интерфейса **Rotatable**:

| Тип               | Метод        | Описание                      | 
|-------------------|--------------|-------------------------------|
| ScreenOrientation	| getOrientation() | | 
| void	            | rotate(DeviceRotation rotation) | Changes the rotation of the browser window.| 
| void	            | rotate(ScreenOrientation orientation) | Changes the orientation of the browser window.| 
| DeviceRotation    | rotation() | | 

[selenium/docs/api : Pdf](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Rotatable.html)

*Пример*

```java
driver.get("https://www.selenium.dev");
printer = (PrintsPage) driver;

PrintOptions printOptions = new PrintOptions();
printOptions.setPageRanges("1-2");

Pdf pdf = printer.print(printOptions);
String content = pdf.getContent();
```

## Перечисление ScreenOrientation

***ScreenOrientation*** - перечисление

Константы перечисления *ScreenOrientation*

| Тип           | Описание         | 
|---------------|------------------|
| LANDSCAPE     |               |
| PORTRAIT      |               |

Методы перечисления *PrintOptions.Orientation*:

| Тип                        | Метод                | Описание                      | 
|----------------------------|----------------------|-------------------------------|
| String                     | value()              | | 
| static ScreenOrientation	 | valueOf(String name) | Returns the enum constant of this type with the specified name.  | 
| static ScreenOrientation[] | values()             | Returns an array containing the constants of this enum type, in the order they are declared. | 

[selenium/docs/api : ScreenOrientation](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/DeviceRotation.html)

## Класс DeviceRotation

***DeviceRotation*** - класс

Методы класса *DeviceRotation*:

| Тип                  | Метод            | Описание                      | 
|----------------------|------------------|-------------------------------|
| boolean              | equals(Object o) | | 
| int                  | getX()	          | | 
| int                  | getY()	          | | 
| int                  | getZ()	          | | 
| int                  | hashCode()	      | | 
| Map<String, Integer> | parameters()     | | 

[selenium/docs/api : DeviceRotation](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/DeviceRotation.html)

***

# Storage

## LocalStorage

LocalStorage - интерфейс

| Тип         | Метод                             | Описание                      | 
|-------------|-----------------------------------|-------------------------------|
| void        | clear()                           |  |
| String      | getItem(String key)               |  |
| Set<String> | keySet()                          |  |
| String      | removeItem(String key)            |  |
| void        | setItem(String key, String value) |  |
| int         | size()                            |  |

[selenium/docs/api : LocalStorage](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/html5/LocalStorage.html)

https://chercher.tech/java/browser-webstorage-selenium
https://medium.com/@jonashavers/accessing-sessionstorage-and-localstorage-with-selenium-remotewebdriver-f3935d8d7d9b

## SessionStorage

SessionStorage - интерфейс

| Тип         | Метод                             | Описание                      | 
|-------------|-----------------------------------|-------------------------------|
| void        | clear()                           |  |
| String      | getItem(String key)               |  |
| Set<String> | keySet()                          |  |
| String      | removeItem(String key)            |  |
| void        | setItem(String key, String value) |  |
| int         | size()                            |  |

[selenium/docs/api : SessionStorage](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/html5/SessionStorage.html)

https://medium.com/@jonashavers/accessing-sessionstorage-and-localstorage-with-selenium-remotewebdriver-f3935d8d7d9b

# Location

##

Location

| Тип    | Метод          | Описание                      | 
|--------|----------------|-------------------------------|
| double | getAltitude()  | |
| double | getLatitude()  | |
| double | getLongitude() | |
| String | toString()     | |

[selenium/docs/api : Location](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/html5/Location.html)


***

Иногда в тестировании появляется необходимость сравнивать изображения. 
Например, для для проверки загруженных иконок и изображений на сайте или для сравнения базового лэйаута на странице с текущим.

Webdriver обладает функционалом для снятия скриншотов, однако он не может сравнивать изображения. 
Для этого надо писать собственные расширения. В качестве примера рассмотрим следующий вспомогательный класс:

```java
import java.awt.Image;
import java.awt.Toolkit;
import java.awt.image.PixelGrabber;

public class CompareUtil {
    public enum Result {
        Matched,
        SizeMismatch,
        PixelMismatch
    };
    static Result CompareImage(String baseFile, String actualFile) {
        Result compareResult = Result.PixelMismatch;
        Image baseImage = Toolkit.getDefaultToolkit().getImage(baseFile);
        Image actualImage = Toolkit.getDefaultToolkit().
        getImage(actualFile);
        try {
            PixelGrabber baseImageGrab = new PixelGrabber(baseImage, 0, 0, -1, -1, false);
            PixelGrabber actualImageGrab = new PixelGrabber(actualImage, 0, 0, -1, -1, false);
            int[] baseImageData = null;
            int[] actualImageData = null;
            if (baseImageGrab.grabPixels()) {
                int width = baseImageGrab.getWidth();
                int height = baseImageGrab.getHeight();
                baseImageData = new int[width * height];
                baseImageData = (int[]) baseImageGrab.getPixels();
            }
            if (actualImageGrab.grabPixels()) {
                int width = actualImageGrab.getWidth();
                int height = actualImageGrab.getHeight();
                actualImageData = new int[width * height];
                actualImageData = (int[]) actualImageGrab.getPixels();
            }
            System.out.println(baseImageGrab.getHeight() + "<>" +
                actualImageGrab.getHeight());
            System.out.println(baseImageGrab.getWidth() + "<>" +
                actualImageGrab.getWidth());
            if ((baseImageGrab.getHeight() != actualImageGrab.getHeight()) || (baseImageGrab.getWidth() != actualImageGrab.getWidth())) {
                compareResult = Result.SizeMismatch;
            } else if (java.util.Arrays.equals(baseImageData, actualImageData)) {
                compareResult = Result.Matched;
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        return compareResult;
    }
}
```

Пример теста с использованием этого класса:

```java
import org.openqa.selenium.firefox.FirefoxDriver;
import org.openqa.selenium.*;
import org.apache.commons.io.FileUtils;
import org.junit.*;
import static org.junit.Assert.*;
import java.io.File;

public class ScreenShotTest {
    public WebDriver driver;
    private StringBuffer verificationErrors = new StringBuffer();

    @Before
    public void setUp() throws Exception {
        // Create a new instance of the Firefox driver
        driver = new FirefoxDriver();
    }

    @Test
    public void imageCompareTest() throws Exception {
        String scrFile = "FILE_PATH";
        String baseScrFile = "BASE_FILE_PATH";
        // Заходим на страницу
        driver.get(URL);
        File screenshotFile = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);
        FileUtils.copyFile(screenshotFile, new File(scrFile));
        try {
            //Сравниваем изображение с базовым
            assertEquals(CompareUtil.Result.Matched, CompareUtil.CompareImage(baseScrFile, scrFile));
        } catch (Error e) {
            // Сохраняем ошибки в переменную
            verificationErrors.append(e.toString());
        }
    }

    @After
    public void tearDown() throws Exception {
        //Закрываем браузер
        driver.quit();
        String verificationErrorString = verificationErrors.toString();
        if (!"".equals(verificationErrorString)) {
            fail(verificationErrorString);
        }
    }
}
```

## Platform

**Platform** - перечисление определяющее типы платформ.

Константы перечисления *Platform*

| Тип           | Описание         | 
|---------------|------------------|
| ANDROID       | Android          |
| ANY           | Любая            |
| BIG_SUR       | macOS            |
| CATALINA      | macOS            |
| EL_CAPITAN    | macOS            |
| HIGH_SIERRA   | macOS            |
| IOS           | iOS              |
| LINUX         | Linux            |
| MAC           | macOS            |
| MAVERICKS     | macOS            |
| MOJAVE        | macOS            |
| MOUNTAIN_LION | macOS            |
| SIERRA        | macOS            |
| SNOW_LEOPARD  | macOS            |
| UNIX          | Unix             |
| VISTA         | Windows          |
| WIN10         | Windows          |
| WIN8          | Windows          |
| WIN8_1        | Windows          |
| WINDOWS       | Windows          |
| XP            | Windows          |
| YOSEMITE      | macOS            |

Методы перечисления *Platform*

| Тип      | Метод                                                   | Описание                                                 | 
|----------|---------------------------------------------------------|----------------------------------------------------------|
| Platform | extractFromSysProperty(String osName)                   | извлечение платформы (ОС) на основе системной переменной |
| Platform | extractFromSysProperty(String osName, String osVersion) | извлечение платформы (ОС) на основе системной переменной |
| Platform | family()                                                | получение семейства текущей платформы (ОС)               |
| Platform | fromString(String name)                                 | получение платформы (ОС) по имени                        |
| Platform | getCurrent()                                            | получение текущей версии платформы (ОС)                  |
| int      | getMajorVersion()                                       | получение мажорной версии платформы (ОС)                 |
| int      | getMinorVersion()                                       | получение минорной версии платформы (ОС)                 |

[selenium/docs/api : Platform](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Platform.html)

***

Практика [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](2.%20Практика.md)
