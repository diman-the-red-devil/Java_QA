Java_QA / Level 1. Easy - Основы / 1.1. Selenium WebDriver / Урок 04. Основы

[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](2.%20Практика.md)

***

# 1. Драйвер браузера

***Selenium WebDriver или просто WebDriver*** – программная библиотека для управления браузером.

WebDriver представляет собой:

* *драйверы браузеров* для различных браузеров 

Драйверы реализованы для браузеров Chrome, Edge, InternetExplorer, Firefox, Opera, Safari.
Найти список доступных драйверов и ссылки для скачивания можно на официальном сайте Selenium проекта.

![Браузеры](_Files/1.%20Selenium%20WebDriver/01.jpg)

* *клиентские библиотеки* на разных языках программирования, предназначенные для управления этими драйверами

Клиентские библиотеки WebDriver доступны на языках Java, .Net (C#), Python, Ruby, JavaScript.

![Языки программирования](_Files/1.%20Selenium%20WebDriver/02.jpg)

## 1.1. Вспомогательный исполняемый файл

***Драйвер браузера*** - специально написанная программа, которая предоставляет определенный набор команд для управления браузером извне.

Драйвер на самом деле является веб сервером, который запускает браузер и отправляет ему запросы на исполнение определенных действий пользователя, а также закрывает его. 

У каждого браузера свой драйвер, так как у каждого браузера свои отличные команды управления,и реализованы они по-своему. 
Но все драйверы предоставляют единый внешний интерфейс (одинаковый набор команд для управления драйвером) по протоколу, который описан в стандарте W3C.
Каждый драйвер разрабатывает производитель браузера. 

![Архитектура Selenium WebDriver](_Files/1.%20Selenium%20WebDriver/03.jpg)

Драйвер браузера поставляется в виде исполняемого файла.

### 1.1.1. Куда положить исполняемый файл?

* в директорию, которая включена в переменную среды **%PATH%**
* в рабочую или текущую директорию (требуется указать путь до файла)
* в любое другое место (требуется указать путь до файла)

> Если же, используется **WebDriverManager**, то делать этого не нужно.

### 1.1.2. Как прописать путь до файла?

Если файл находится не в директории, которая включена в переменную среды **%PATH%**, 
то для того чтобы можно было взаимодействовать с драйвером браузера, необходимо прописать путь до исполняемого файла.

Сделать можно это двумя способами.

* вызвать метод **System.setProperty()** до вызова конструктора драйвера

```java
System.setProperty("webdriver.ie.driver", "src/test/resources/drivers/IEDriverServer.exe");
```

* использовать класс **DriverService** и **DriverService.Builder**, указав в **usingDriverExecutable()** путь до исполняемого файла

## 1.2. Класс DriverService и DriverService.Builder

***DriverService*** - класс для управления исполняемым файлом.

Методы класса **DriverService**

| Тип     | Метод       | Описание                               | 
|---------|-------------|----------------------------------------|
| boolean | isRunning() | Проверка запуска сервиса               |
| void    | start()     | Запуск сервиса, если он еще не запущен |
| void    | stop()      | Остановка сервиса, если он уже запущен |

[selenium/docs/api : DriverService](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/remote/service/DriverService.html)

***DriverService.Builder*** - класс для конфигурации нового инстанса **DriverService**.

Методы класса **DriverService.Builder**

| Тип | Метод                            | Описание                                        | 
|-----|----------------------------------|-------------------------------------------------|
| DS  | build()                          | Создание нового сервиса для управления сервисом |
| B   | usingAnyFreePort()               | Использование любого свободного порта           |
| B   | usingPort(int port)              | Использование конкретного порта                 |
| B   | usingDriverExecutable(File file) | Указание пути до исполняемого файла             |

[selenium/docs/api : DriverService.Builder](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/remote/service/DriverService.Builder.html)

Для исполняемого файла каждого браузера есть свои классы, которые наследуются от **DriverService** и **DriverService.Builder**:

* *Google Chrome*

```java
public class ChromeDriverTest {
    private static ChromeDriverService service;
    public static WebDriver driver;
    
    public static void createAndStartService() throws IOException {
        service = new ChromeDriverService.Builder()
            .usingDriverExecutable(new File(PATH_TO_CHROMEDRIVER_EXE))
            .usingAnyFreePort()
            .build();
        service.start();
    }
}
```

[selenium/docs/api : ChromeDriverService](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/chrome/ChromeDriverService.html)

[selenium/docs/api : ChromeDriverService.Builder](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/chrome/ChromeDriverService.Builder.html)

* *Microsoft Edge*

```java
public class EdgeDriverTest {
    private static EdgeDriverService service;
    public static WebDriver driver;
    
    public static void createAndStartService() throws IOException {
        service = new EdgeDriverService.Builder()
            .usingDriverExecutable(new File(PATH_TO_EDGEDRIVER_EXE))
            .usingAnyFreePort()
            .build();
        service.start();
    }
}
```

[selenium/docs/api : EdgeDriverService](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/edge/EdgeDriverService.html)

[selenium/docs/api : EdgeDriverService.Builder](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/edge/EdgeDriverService.Builder.html)

* *Microsoft Internet Explorer*

```java
public class InternetExplorerDriverTest {
    private static InternetExplorerDriverService service;
    public static WebDriver driver;
    
    public static void createAndStartService() throws IOException {
        service = new InternetExplorerDriverService.Builder()
            .usingDriverExecutable(new File(PATH_TO_IEDRIVER_EXE))
            .usingAnyFreePort()
            .build();
        service.start();
    }
}
```

[selenium/docs/api : InternetExplorerDriverService](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/ie/InternetExplorerDriverService.html)

[selenium/docs/api : InternetExplorerDriverService.Builder](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/ie/InternetExplorerDriverService.Builder.html)

* *Mozilla Firefox*

```java
public class FirefoxDriverTest {
    private static FirefoxDriverService service;
    public static WebDriver driver;
    
    public static void createAndStartService() throws IOException {
        service = new FirefoxDriverService.Builder()
            .usingDriverExecutable(new File(PATH_TO_FIREFOXDRIVER_EXE))
            .usingAnyFreePort()
            .build();
        service.start();
    }
}
```

[selenium/docs/api : FirefoxDriverService](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/firefox/FirefoxDriverService.html)

[selenium/docs/api : FirefoxDriverService.Builder](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/firefox/FirefoxDriverService.Builder.html)

* *Opera*

```java
public class OperaDriverTest {
    private static OperaDriverService service;
    public static WebDriver driver;
    
    public static void createAndStartService() throws IOException {
        service = new OperaDriverService.Builder()
            .usingDriverExecutable(new File(PATH_TO_OPERADRIVER_EXE))
            .usingAnyFreePort()
            .build();
        service.start();
    }
}
```

[selenium/docs/api : OperaDriverService](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/opera/OperaDriverService.html)

[selenium/docs/api : OperaDriverService.Builder](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/opera/OperaDriverService.Builder.html)

## 1.3. WebDriverManager

***WebDriverManager*** - программная библиотека решающая проблему с исполняемым файлом посредником и указанием его местоположения.

Все что нужно сделать, это подключить зависимость и прописать одну строчку кода. Никаких исполняемых файлов.

Подключение в проект **WebDriverManager**

```xml
<dependency>
    <groupId>io.github.bonigarcia</groupId>
    <artifactId>webdrivermanager</artifactId>
    <version>4.3.1</version>
    <scope>test</scope>
</dependency>
```

Методы класса **WebDriverManager**

| Тип  | Метод                                     | Описание                                        |
|------|-------------------------------------------|-------------------------------------------------|
| void | WebDriverManager.chromedriver().setup()   | Установка драйвера для браузера Google Chrome   |
| void | WebDriverManager.chromiumdriver().setup() | Установка драйвера для браузера Google Chromium |
| void | WebDriverManager.edgedriver().setup()     | Установка драйвера для браузера Microsoft Edge  |
| void | WebDriverManager.iedriver().setup()       | Установка драйвера для браузера Microsoft IE    |
| void | WebDriverManager.firefoxdriver().setup()  | Установка драйвера для браузера Mozilla Firefox |
| void | WebDriverManager.operadriver().setup()    | Установка драйвера для браузера Opera           |
| void | WebDriverManager.phantomjs().setup()      | Установка драйвера для браузера PhantomJS       |

Более подробную информацию по работе с **WebDriverManager** можно узнать в описании репозитория проекта.

[Ссылка на GitHub проекта](https://github.com/bonigarcia/webdrivermanager)

## 1.4. Совместимость драйверов и браузеров

Не все драйверы и браузеры подходят друг другу, даже в рамках одного браузера (версии могут отличаться)

* *Google Chrome*

| Версия браузера | Версия драйвера     | Производитель драйвера    | 
|-----------------|---------------------|---------------------------|
| последняя       | последняя           | Google - **chromedriver** |
| предыдущие      | поддержка последней | Google - **chromedriver** |

* *Microsoft Edge*

| Версия браузера | Версия драйвера     | Производитель драйвера     | 
|-----------------|---------------------|----------------------------|
| последняя       | последняя           | Microsoft - **edgedriver** |

* *Microsoft Internet Explorer*

| Версия браузера | Версия драйвера     | Производитель драйвера     | 
|-----------------|---------------------|----------------------------|
| 9 - 11          |                     | Selenium                   | 
| <= 8            |                     | драйвер не поддерживается  | 

* *Mozilla Firefox*

| Версия браузера | Версия драйвера     | Производитель драйвера     | 
|-----------------|---------------------|----------------------------|
| >= 49           | последняя           | Mozilla - **geckodriver**  | 
| 48              |                     | драйвер не поддерживается  |  
| 4 - 47          |                     | Selenium                   | 
| <= 3            |                     | драйвер не поддерживается  | 
    
* *Apple Safari*

| Версия браузера | Версия драйвера     | Производитель драйвера     | 
|-----------------|---------------------|----------------------------|
| >= 10           | последняя           | Apple - **safaridriver**   | 
| 6 - 9           |                     | Selenium                   | 
| <= 5            |                     | драйвер не поддерживается  | 

* *Opera*

| Версия браузера | Версия драйвера     | Производитель драйвера         | 
|-----------------|---------------------|--------------------------------|
| >= 15           | последняя           | Opera - **operchromiumdriver** | 
| 11 - 12         |                     | Opera - **operaPrestoDriver**  | 
| <= 10           |                     | драйвер не поддерживается      | 

***

# 2. Интерфейс WebDriver

***WebDriver*** - интерфейс для удаленного управления браузером.

## 2.1. Команды веб драйвера

Методы интерфейса **WebDriver**

* *Основные*

| Тип  | Метод           | Описание                                                                     | 
|------|-----------------|------------------------------------------------------------------------------|
| void | close()         | Закрытие текущего окна, выход из браузера (если было открыто последнее окно) |
| void | get(String url) | Загрузка новой страницы в текущем окне браузера                              |
| void | quit()          | Выход из драйвера, закрытие всех окон браузера                               |

* *Поиск веб элементов*

| Тип              | Метод               | Описание                                                     | 
|------------------|---------------------|--------------------------------------------------------------|
| WebElement       | findElement(By by)  | Поиск элемента (возвращает первый найденный элемент)         |
| List<WebElement> | findElements(By by) | Поиск всех элементов (возвращает список найденных элементов) |

* *Свойства текущей страницы*

| Тип    | Метод           | Описание                          | 
|--------|-----------------|-----------------------------------|
| String | getCurrentUrl() | Получение строки URL страницы     |
| String | getPageSource() | Получение исходного кода страницы |
| String | getTitle()      | Получение заголовка страницы      |

* *Навигация*

| Тип                     | Метод              | Описание                              | 
|-------------------------|--------------------|---------------------------------------|
| String                  | getWindowHandle()  | Получение окна                        |
| Set<String>             | getWindowHandles() | Получение всех окон                   |
| WebDriver.TargetLocator | switchTo()         | Управление переключением между окнами |
| WebDriver.Navigation    | navigate()         | Управление историей браузера          |

* *Свойства и настройки браузера*

| Тип               | Метод    | Описание                                     | 
|-------------------|----------|----------------------------------------------|
| WebDriver.Options | manage() | Управление свойствами и настройками браузера |

[selenium/docs/api : WebDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/WebDriver.html)

## 2.2. Инициализация WebDriver

Чтобы работать с каким то из драйверов нужно в коде инициализировать соответствующий **WebDriver**.
То есть сконструировать объекта соответствующего класса, который наследует интерфейс **WebDriver**.
Когда вызывается конструктор, он находит файл посредник.

* *Chromium* 

[selenium/docs/api : ChromiumDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/chromium/ChromiumDriver.html)

* *Google Chrome*

```java
public class ChromeBrowser {
    public WebDriver getDriver() {
        WebDriverManager.chromedriver().setup();
        WebDriver driver = new ChromeDriver();
        return driver;
    }
}
```

[selenium/docs/api : ChromeDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/chrome/ChromeDriver.html)

* *Microsoft Edge*

```java
public class EdgeBrowser {
    public WebDriver getDriver() {
        WebDriverManager.edgedriver().setup();
        WebDriver driver = new EdgeDriver();
        return driver; 
    }
}
```

[selenium/docs/api : EdgeDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/edge/EdgeDriver.html)

* *Microsoft Internet Explorer*

```java
public class ExplorerBrowser {
    public WebDriver getDriver() {
        WebDriverManager.iedriver().setup();
        WebDriver driver = new InternetExplorerDriver();
        return driver; 
    }
}
```

[selenium/docs/api : InternetExplorerDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/ie/InternetExplorerDriver.html)

* *Mozilla Firefox*

```java
public class FirefoxBrowser {
    public WebDriver getDriver() {
        WebDriverManager.firefoxdriver().setup();
        WebDriver driver = new FirefoxDriver(options);
        return driver;
    }
}
```

[selenium/docs/api : FirefoxDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/firefox/FirefoxDriver.html)

* *Opera*

```java
public class FirefoxBrowser {
    public WebDriver getDriver() {
        WebDriverManager.operadriver().setup();
        WebDriver driver = new OperaDriver();
        return driver; 
    }
}
```

[selenium/docs/api : OperaDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/opera/OperaDriver.html)

***

# 3. WebDriverFactory

***Factory (фабрика)*** — это объект для создания других объектов в объектно-ориентированном программировании (ООП). 

Формально **Factory** — это функция или метод возвращающая объекты изменяющегося прототипа или класса из некоторого вызова метода, 
который считается «новым». Или, простыми словами, **Factory** создает экземпляр класса без раскрытия логики его создания.

***WebDriverFactory*** - *фабрика* для создания объектов **WebDriver** для разных браузеров.

Для понимания того, зачем нужно его использовать, следует сначала понять проблему, который решает этот паттерн.

Для примера рассмотрим следующий код:

```java
@Test
void test(){
    ChromeDriver driver = new ChromeDriver();
    driver.get("https://otus.ru");
    Assert.assertEquals(driver.getTitle(),"Otus - онлайн образование");
}
```

Данный тест запускает Chrome, проверяет, что title страницы совпадает с ожидаемым. 
Далее создаются еще несколько таких тестов, добавляются их в скоуп тестирования для параллельного тестирования. 
И вроде, все хорошо ровно (за исключением нарушений принципов DRY и SOLID) до момента, 
когда встает вопрос о том, чтобы запускать тесты в другом браузере, запускать браузер с какими-то параметрами или с определенными расширениями.
В решении данной проблемы может помочь паттерн **Factory**.

Рассмотрим простейшую фабрику. 
Для этого нужно создать метод, который принимает на вход название браузера и возвращает соответствующий браузер 
(если браузер был указан некорректно – выбросит ошибку с соответствующим сообщением).

```java
WebDriver getWebDriver(String browserName){
    switch (browserName){
        case "chrome":
            return new ChromeDriver();
        case "firefox":
            return new FirefoxDriver();
        default:
            throw new RuntimeException("Incorrect BrowserName");
    }
}
```

Теперь в тесте будет достаточно вызвать соответствующий метод для получения **Webdriver**:

```java
@Test
void test(){
    WebDriver driver = getWebDriver("chrome");
    driver.get("https://otus.ru");
    Assert.assertEquals(driver.getTitle(),"Otus - онлайн образование");
}
```

Готово! Теперь при изменении параметров запуска браузера (к примеру, требуется добавить Cookie), это можно будет сделать из одного места.

***

Практика [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](2.%20Практика.md)