# Java_QA / Level 1. Easy - Основы / 1.1. Selenium WebDriver / Урок 05. Веб драйвер 2. Конфигурация

[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](2.%20Практика.md)

***

## 1. Зачем нужно конфигурировать браузер при старте?

Вот несколько типовых случаев когда нужно конфигурировать браузер:

* запуск в определенном разрешении (для отладки резинового дизайна)
* запуск в полноразмерном экране
* работа с куки
* логгирование
* конфигурирование ожиданий (page load, execute javascript, implicity)
* специфические вещи (режим эмулятора,)

***

## 2. Интерфейс WebDriver.Options

***WebDriver.Options*** - интерфейс для управления настройками браузера.

***WebDriver.manage()*** - реализация интерфейса WebDriver.Options.

Данный интерфейс позволяет:

* работать с куками
* получать логи
* настраивать ожидания
* настраивать окна браузера

Методы интерфейса **WebDriver.Options**

| Тип                | Метод                          | Описание                      | 
|--------------------|--------------------------------|-------------------------------|
| void               | addCookie(Cookie cookie)       | добавление куки браузеру      |
| void               | deleteAllCookies()             | удаление всех куки из браузера|
| void               | deleteCookie(Cookie cookie)    | удаление куки из браузера     |
| void               | deleteCookieNamed(String name) | удаление куки по имени        |
| Cookie             | getCookieNamed(String name)    | получение куки по имени       |
| Set<Cookie>        | getCookies()                   | получение всех куки           |
| Logs               | logs()                         | получение логов               |
| WebDriver.Timeouts | timeouts()                     | настройка таймаутов           |
| WebDriver.Window   | window()                       | настройка окон                |

[selenium/docs/api : WebDriver.Options](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/WebDriver.Options.html)

### 2.1. Куки

***Ку́ки*** (англ. cookie, буквально — печенье) — небольшой фрагмент данных, отправленный веб-сервером и хранимый на компьютере пользователя.
*Веб-клиент* (обычно веб-браузер) всякий раз при попытке открыть страницу соответствующего сайта пересылает этот фрагмент данных *веб-серверу* в составе HTTP-запроса.

![Куки](./_Files/1.%20Selenium%20WebDriver%20Config/01.jpg "Куки")

Куки применяется для сохранения данных на стороне пользователя, на практике обычно используется для:

* аутентификации пользователя
* хранения персональных предпочтений и настроек пользователя (язык, валюту или размер шрифта)
* отслеживания состояния сеанса пользователя
  * товары, которые просматривали или добавили в корзину 
  * текст, который вводили на сайте раньше
* сведения статистики о пользователях
  * IP-адрес и местоположение пользователя 
  * дату и время посещения сайта
  * версию ОС и браузера
  * клики и переходы

#### Класс Cookie

***Cookie*** - класс, реализующий куки.

Методы класса **Cookie**

| Тип                 | Метод       | Описание                                     | 
|---------------------|-------------|----------------------------------------------|
| String              | getDomain() | получение домена куки                        |
| Date                | getExpiry() | получение даты окончания срока действия куки |
| String              | getName()   | получение имени куки                         |
| String              | getPath()   | получение URL адреса куки                    |
| String              | getValue()  | получение значения куки                      |
| Map<String, Object> | toJson()    | преобразование в JSON объект                 |

[selenium/docs/api : Cookie](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Cookie.html)

```java
WebDriver driver = new ChromeDriver();
driver.manage().addCookie(new Cookie("key", "value"));
Cookie cookie = driver.manage().getCookieNamed("foo");
System.out.println(cookie.getDomain());
System.out.println(cookie.getExpiry());
System.out.println(cookie.getName());
System.out.println(cookie.getPath());
System.out.println(cookie.getValue());
driver.manage().getCookies(); 
driver.manage().deleteCookieNamed("test1"); 
```

### 2.2. Логи

***Лог*** - файл с записями о событиях в хронологическом порядке.

![Логи](./_Files/1.%20Selenium%20WebDriver%20Config/02.jpg "Логи")

**Логирование** важно как для разработчиков, так и для пользователей Webdriver.
Пользователи хотят иметь возможность быстро понять почему упал тест, 
в то время как разработчик хочет получить информацию, почему Webdriver упал.
Хорошее логирование может сделать дебаггинг намного проще.

```java
WebDriver driver = new ChromeDriver();
Logs logs = driver.manage().logs();
LogEntries logEntries = logs.get(LogType.DRIVER);
for (LogEntry logEntry : logEntries) {
System.out.println(logEntry.getMessage());
}
```

Подробнее про логгирование в []().

### 2.3. Ожидания

***Ожидание*** - промежуток времени, в течение которого WebDriver ожидает появление элемента веб страницы и возможности с ним взаимодействовать.

![Ожидания](./_Files/1.%20Selenium%20WebDriver%20Config/03.jpg "Ожидания")

Настройка ожиданий нужна для синхронизации работы AUT и тестового скрипта.
Скрипт выполняется намного быстрее реакции приложения на команды,
поэтому часто в скриптах необходимо дожидаться определенного состояния приложения для дальнейшего с ним взаимодействия.

```java
WebDriver driver = new ChromeDriver();
driver.manage().timeouts().implicitlyWait(10, TimeUnit.SECONDS);
driver.get("http://some_url");
WebElement dynamicElement = driver.findElement(By.id("dynamicElement_id"));
```

Подробнее про ожидания в []().

#### 2.4. Окна браузера

При запуске тестов иногда требуется отображение окна браузера в полноэкранном режиме, либо наоборот в минимизированном.

![Окна браузера](./_Files/1.%20Selenium%20WebDriver%20Config/04.jpg "Окна браузера")

```java
WebDriver driver = new FirefoxDriver();
driver().manage().window().maximize();
driver().manage().window().fullscreen();
```

Подробнее про окна в []().

***

## 3. Интерфейс Capabilities

Каждый браузер обладает какими либо свойствами, отличными от других браузеров.
Для настройки специфичных свойств существуют специальные интерфейсы и классы под каждый браузер.

***Capabilities*** - интерфейс для получения свойств браузера.

Методы интерфейса **Capabilities**

| Тип         | Метод                                 | Описание                       | 
|-------------|---------------------------------------|--------------------------------|
| Object      | getCapability(String capabilityName)  | получение свойства по имени    |
| Set<String> | getCapabilityNames()                  | получение списка свойств       |
| String      | getBrowserName()                      | получение имени браузера       |
| String      | getBrowserVersion()                   | получение версии браузера      |
| Platform    | getPlatformName()                     | получение имени платформы (ОС) |
| boolean	  | is(String capabilityName)             | проверка свойства по имени     |

[selenium/docs/api : Capabilities](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Capabilities.html)

### 3.1. Класс MutableCapabilities

***MutableCapabilities*** - класс представляющий изменяемые свойства браузера.

Данный класс реализует интерфейс **Capabilities**.

Методы класса **MutableCapabilities**

| Тип                 | Метод                                                | Описание                     | 
|---------------------|------------------------------------------------------|------------------------------|
| Object              | getCapability(String capabilityName)                 | получение свойства по имени  |
| Set<String>         | getCapabilityNames()                                 | получение списка свойств     |
| MutableCapabilities | merge(Capabilities extraCapabilities)                | мерж свойств                 |
| void                | setCapability(String key, Object value)              | установка свойства           |
| void                | setCapability(String capabilityName, boolean value)  | установка свойства           |
| void                | setCapability(String capabilityName, String value)   | установка свойства           |
| void                | setCapability(String capabilityName, Platform value) | установка свойства           |
| Map<String, Object> | toJson()                                             | преобразование в JSON объект |

[selenium/docs/api : MutableCapabilities](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/MutableCapabilities.html)

### 3.2. Класс ImmutableCapabilities 

***ImmutableCapabilities*** - класс представляющий неизменяемые свойства браузера.

Данный класс реализует интерфейс **Capabilities**.

Методы класса **ImmutableCapabilities**

| Тип                          | Метод                                | Описание                    | 
|------------------------------|--------------------------------------|-----------------------------|
| static ImmutableCapabilities | copyOf(Capabilities capabilities)    | получение копии свойства    |
| Object                       | getCapability(String capabilityName) | получение свойства по имени |

[selenium/docs/api : ImmutableCapabilities](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/ImmutableCapabilities.html)

### 3.3. Класс DesiredCapabilities

***DesiredCapabilities*** - класс для установки желаемых свойств браузера.

Класс **DesiredCapabilities** помогает сообщить веб драйверу, какую среду нужно использовать в тестовом сценарии. 
Каждый сценарий тестирования должен выполняться в определенной среде тестирования. 
Средой тестирования может быть веб-браузер, мобильное устройство, мобильный эмулятор, мобильный симулятор и т.д.

Данный класс реализует интерфейс **Capabilities**.

Данный класс наследует и расширяет класс **MutableCapabilities**.

Методы класса **DesiredCapabilities**

| Тип                 | Метод                                               | Описание                                     | 
|---------------------|-----------------------------------------------------|----------------------------------------------|
| boolean             | acceptInsecureCerts()                               | проверка просроченных сертификатов           |
| DesiredCapabilities | merge(Capabilities extraCapabilities)               | мерж свойств                                 |
| void                | setAcceptInsecureCerts(boolean acceptInsecureCerts) | установка проверки просроченных сертификатов |
| void                | setBrowserName(String browserName)                  | установка имени браузера                     |
| void                | setJavascriptEnabled(boolean javascriptEnabled)     | установка исполнения скриптов JS             |
| void                | setPlatform(Platform platform)                      | установка платформы                          |
| void                | setVersion(String version)                          | установка версии браузера                    |

[selenium/docs/api : DesiredCapabilities](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/remote/DesiredCapabilities.html)

```java
DesiredCapabilities caps = new DesiredCapabilities()
DesiredCapabilities desiredCapabilities = DesiredCapabilities.firefox();
desiredCapabilities.setCapability(CapabilityType.LOGGING_PREFS, logs);
WebDriver driver = new FirefoxDriver(desiredCapabilities);
```

Для автоматического подбора желаемых свойств можно использовать онлайн ресурс 

[Capabilities Generator](https://www.browserstack.com/automate/capabilities)

### 3.4. Класс AbstractDriverOptions<DO extends AbstractDriverOptions>

**AbstractDriverOptions<DO extends AbstractDriverOptions>** - класс для установки дополнительных свойств браузера.

Данный класс реализует интерфейс **Capabilities**.

Данный класс наследует и расширяет класс **MutableCapabilities**.

Методы класса **AbstractDriverOptions**

| Тип | Метод                                                           | Описание                                | 
|-----|-----------------------------------------------------------------|-----------------------------------------|
| DO  | setAcceptInsecureCerts(boolean acceptInsecureCerts)             | установка                               |
| DO  | setPageLoadStrategy(PageLoadStrategy strategy)                  | установка стратегии загрузки страницы   |
| DO  | setProxy(Proxy proxy)                                           | установка прокси                        |
| DO  | setStrictFileInteractability(boolean strictFileInteractability) | установка                               |
| DO  | setUnhandledPromptBehaviour(UnexpectedAlertBehaviour behaviour) | установка                               |

[selenium/docs/api : AbstractDriverOptions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/remote/AbstractDriverOptions.html)

### 3.5. Интерфейс CapabilityType

***CapabilityType*** - интерфейс для обозначения типов свойств браузера.

С помощью данного интерфейса можно задавать типы свойств браузера при его конфигурировании.

Поля интерфейса **CapabilityType**

| Тип    | Поле                        | Описание                              | 
|--------|-----------------------------|---------------------------------------|
| String | ACCEPT_INSECURE_CERTS       | проверка сертификатов TLS             |
| String | ACCEPT_SSL_CERTS            | проверка сертификатов SSL             |
| String | APPLICATION_NAME            |                                       |
| String | BROWSER_NAME                | наименование браузера                 |
| String | ELEMENT_SCROLL_BEHAVIOR     | поведение при прокрутке элемента      |
| String | ENABLE_PROFILING_CAPABILITY |                                       |
| String | HAS_NATIVE_EVENTS           |                                       |
| String | HAS_TOUCHSCREEN             | поддержка тачскрина                   |
| String | LOGGING_PREFS               | настройки логгирования                |
| String | OVERLAPPING_CHECK_DISABLED  |                                       |
| String | PAGE_LOAD_STRATEGY          | стратегия загрузки страницы           |
| String | PLATFORM_NAME               | наименование платформы                |
| String | PROXY                       | настройки прокси                      |
| String | ROTATABLE                   | поддержка поворота                    |
| String | STRICT_FILE_INTERACTABILITY |                                       |
| String | SUPPORTS_ALERTS             | поддержка алертов                     |
| String | SUPPORTS_APPLICATION_CACHE  | поддержка кеша                        |
| String | SUPPORTS_JAVASCRIPT         | установка стратегии загрузки страницы |
| String | SUPPORTS_LOCATION_CONTEXT   | поддержка местоположения              |
| String | SUPPORTS_NETWORK_CONNECTION | поддержка сетевых соединений          |
| String | SUPPORTS_SQL_DATABASE       | поддержка баз данных SQL              |
| String | SUPPORTS_WEB_STORAGE        | поддержка веь хранилища               |
| String | TAKES_SCREENSHOT            | снятие скриншотов                     |
| String | UNEXPECTED_ALERT_BEHAVIOUR  | поведение при алертах                 |
| String | UNHANDLED_PROMPT_BEHAVIOUR  | установка при промтах                 |
| String | VERSION                     | установка стратегии загрузки страницы |

[selenium/docs/api : CapabilityType](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/remote/CapabilityType.html)

***

## 4. Browser Options

Непосредственно от AbstractDriverOptions наследуются классы Options для управления свойствами конкретных браузеров.

С помощью данных классов можно:

* установить расширения в браузер
* добавить аргументы запуска браузера
* запустить браузер в *безголовом режиме*
* установить стратегию загрузки страницы
* настроить *capabilities*
* и т д

### 4.1. Класс ChromiumOptions<T extends ChromiumOptions>

***ChromiumOptions*** - класс для управления свойствами браузера **Chromium**.

Методы класса **ChromiumOptions**

| Тип | Метод                                            | Описание                                      | 
|-----|--------------------------------------------------|-----------------------------------------------|
| T   | addArguments(String... arguments)                | добавление параметров при запуске Chrome      |
| T   | addArguments(List<String> arguments)             | добавление параметров при запуске Chrome      |
| T   | addEncodedExtensions(String... encoded)          | установка расширений при запуске Chrome       |
| T   | addEncodedExtensions(List<String> encoded)       | установка расширений при запуске Chrome       |
| T   | addExtensions(File... paths)                     | установка расширений при запуске Chrome       |
| T   | addExtensions(List<File> paths)                  | установка расширений при запуске Chrome       |
| T   | setBinary(File path)                             | установка пути до исполняемого файла Chrome   |
| T   | setBinary(String path)                           | установка пути до исполняемого файла Chrome   |
| T   | setExperimentalOption(String name, Object value) | включение экспериментальных функций           |
| T   | setHeadless(boolean headless)                    | запуск в "безголовом режиме"                  |

[selenium/docs/api : ChromiumOptions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/chromium/ChromiumOptions.html)

### 4.2. Класс ChromeOptions

***ChromeOptions*** - класс для управления свойствами браузера **Google Chrome**.

Данный класс наследует и расширяет класс **ChromiumOptions**.

Методы класса **ChromeOptions**

| Тип | Метод                                      | Описание                     | 
|-----|--------------------------------------------|------------------------------|
| T   | getLogLevel()                              | получение уровня логирования |
| T   | setLogLevel(ChromeDriverLogLevel logLevel) | установка уровня логирования |

[selenium/docs/api : ChromeOptions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/chrome/ChromeOptions.html)

Ниже приведен список доступных и наиболее часто используемых аргументов для класса **ChromeOptions**:

| Опция                  | Описание                                         |
|------------------------|--------------------------------------------------|
| start-maximized        | открытие Chrome в режиме максимизации            |
| incognito              | открытие Chrome в режиме инкогнито               |
| headless               | открытие Chrome в headless режиме                |
| disable-notifications  | отключение оповещений в Chrome                   |
| disable-extensions     | отключение существующие расширения в Chrome      |
| disable-popup-blocking | отключение отображения всплывающих окон в Chrome |
| disable-infobars       | отключение отображения уведомлений в Chrome      |
| make-default-browser   | делает браузер Chrome стандартным                |
| version                | печатает версию браузера Chrome                  |

[Chrome Capabilities](https://chromedriver.chromium.org/capabilities)

### 4.3. Класс EdgeOptions

***EdgeOptions*** - класс для управления различными свойствами браузера **Microsoft Edge**.

Данный класс наследует и расширяет класс **ChromiumOptions**.

Методы класса **EdgeOptions**

| Тип | Метод                                      | Описание                     | 
|-----|--------------------------------------------|------------------------------|
| T   | getLogLevel()                              | получение уровня логирования |
| T   | setLogLevel(ChromeDriverLogLevel logLevel) | установка уровня логирования |

[selenium/docs/api : EdgeOptions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/edge/EdgeOptions.html)

### 4.4. Класс FirefoxOptions

***FirefoxOptions*** - класс для управления свойствами браузера **Mozilla Firefox**.

Методы класса **FirefoxOptions**

| Тип            | Метод                                       | Описание                                       | 
|----------------|---------------------------------------------|------------------------------------------------|
| FirefoxOptions | addArguments(String... arguments)           | добавление параметров при запуске Firefox      |
| FirefoxOptions | addArguments(List<String> arguments)        | добавление параметров при запуске Firefox      |
| FirefoxOptions | addPreference(String key, Object value)     | установка preferences при запуске Firefox      |
| FirefoxBinary  | getBinary()                                 | получение двоичных данных от Firefox           |
| FirefoxProfile | getProfile()                                | получения профиля Firefox                      |
| FirefoxOptions | setBinary(String path)                      | установка пути до исполняемого файла           |
| FirefoxOptions | setBinary(Path path)                        | установка пути до исполняемого файла           |
| FirefoxOptions | setBinary(FirefoxBinary binary)             | установка пути до исполняемого файла           |
| void           | setCapability(String key, Object value)     | установка настройки                            |
| FirefoxOptions | setHeadless(boolean headless)               | запуск в "безголовом режиме"                   |
| FirefoxOptions | setLogLevel(FirefoxDriverLogLevel logLevel) | установка уровня логгирования                  |
| FirefoxOptions | setProfile(FirefoxProfile profile)          | установка профиля Firefox                      |

[selenium/docs/api : FirefoxOptions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/firefox/FirefoxOptions.html)

### 4.5. Класс OperaOptions

***OperaOptions*** - класс для управления свойствами браузера **Opera**.

Методы класса **OperaOptions**

| Тип          | Метод                                            | Описание                                    | 
|--------------|--------------------------------------------------|---------------------------------------------|
| OperaOptions | addArguments(String... arguments)                | добавление параметров при запуске Firefox   |
| OperaOptions | addArguments(List<String> arguments)             | добавление параметров при запуске Firefox   |
| OperaOptions | addEncodedExtensions(String... encoded)          | установка расширений при запуске Chrome     |
| OperaOptions | addEncodedExtensions(List<String> encoded)       | установка расширений при запуске Chrome     |
| OperaOptions | addExtensions(File... paths)                     | установка расширений при запуске Chrome     |
| OperaOptions | addExtensions(List<File> paths)                  | установка расширений при запуске Chrome     |
| Object       | getExperimentalOption(String name)               | получение экспериментальных функций         |
| OperaOptions | setBinary(File path)                             | установка пути до исполняемого файла Chrome |
| OperaOptions | setBinary(String path)                           | установка пути до исполняемого файла Chrome |
| OperaOptions | setExperimentalOption(String name, Object value) | включение экспериментальных функций         |

[selenium/docs/api : OperaOptions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/opera/OperaOptions.html)

***

Практика [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](2.%20Практика.md)