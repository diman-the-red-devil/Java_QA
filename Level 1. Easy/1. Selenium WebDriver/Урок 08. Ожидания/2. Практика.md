Java_QA / Level 1. Easy - Основы / 1.1. Selenium WebDriver / Урок 08. Ожидания

[![Назад](https://img.shields.io/badge/-%D0%9D%D0%B0%D0%B7%D0%B0%D0%B4-brightgreen)](1.%20Лекция.md)
[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](3.%20Задание.md)

***

# 1. Открытие предыдущего проекта

Шаги:

1. Запустить IntelliJ IDEA.

2. Открыть проект прошлого урока в IntelliJ IDEA.

![New Maven Project - Open...](./_Files/4.%20New%20Project/01.jpg "New Maven Project - Open...")

3. Удалить все файлы .java из папки **./src/test/java** кроме **WebDriverFactory.java**

***

# 2. Стратегии загрузки страницы (PageLoadStrategy)

## 2.1. Стратегия загрузки страницы NORMAL

Шаги:

1. Создать файл **PageLoadStrategyTest.java** в **./src/test/java**.

![New Maven Project - PageLoadStrategyTest.java](./_Files/4.%20New%20Project/02.jpg "New Maven Project - PageLoadStrategyTest.java")

2. Добавить в файл код.

* метод **pageLoadStrategyNormalTest** - стратегия загрузки страницы **NORMAL**

```java
@Test
public void pageLoadStrategyNormalTest() {
    WebDriverManager.edgedriver().setup();
    logger.info("Драйвер для браузера MS Edge");
    EdgeOptions options = new EdgeOptions();
    options.addArguments("--start-maximized");
    // Устанавливаем стратегию загрузки страницы - NORMAL
    options.setPageLoadStrategy(PageLoadStrategy.NORMAL);
    WebDriver driver = new EdgeDriver(options);

    long start = System.currentTimeMillis();
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница DNS - https://www.dns-shop.ru/");
    WebElement element = driver.findElement(By.xpath("//a[text()=\"Магазины\"]"));
    element.click();
    long finish = System.currentTimeMillis();
    long time = finish - start;
    logger.info("Затраченное время: " + (time / 1000) + " секунд");

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }

    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=PageLoadStrategyTest#pageLoadStrategyNormalTest**.

![New Maven Project - Запуск теста](./_Files/4.%20New%20Project/03.jpg "New Maven Project - Запуск теста")

4. Готово!
   
В результате драйвер дождется полной загрузки страницы 
(то есть, момент, когда свойство **document.readyState** примет значение **complete**), 
прежде чем будет выполнен клик по ссылке. 
На это будет потрачено примерно 12 секунд.

В консоли будет выведен лог запуска. 

![New Maven Project - Лог запуска](./_Files/4.%20New%20Project/04.jpg "New Maven Project - Лог запуска")

## 2.2. Стратегия загрузки страницы EAGER

Шаги:

1. Добавить в файл **PageLoadStrategyTest.java** код.

* метод **pageLoadStrategyEagerTest** - стратегия загрузки страницы **EAGER**

```java
@Test
public void pageLoadStrategyEagerTest() {
    WebDriverManager.edgedriver().setup();
    logger.info("Драйвер для браузера MS Edge");
    EdgeOptions options = new EdgeOptions();
    options.addArguments("--start-maximized");
    // Устанавливаем стратегию загрузки страницы - EAGER
    options.setPageLoadStrategy(PageLoadStrategy.EAGER);
    WebDriver driver = new EdgeDriver(options);

    long start = System.currentTimeMillis();
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница DNS - https://www.dns-shop.ru/");
    WebElement element = driver.findElement(By.xpath("//a[text()=\"Магазины\"]"));
    element.click();
    long finish = System.currentTimeMillis();
    long time = finish - start;
    logger.info("Затраченное время: " + (time / 1000) + " секунд");

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }

    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

2. Запустить тест командой **mvn clean test** с параметром **-Dtest=PageLoadStrategyTest#pageLoadStrategyEagerTest**.

![New Maven Project - Запуск теста](./_Files/4.%20New%20Project/05.jpg "New Maven Project - Запуск теста")

3. Готово!

В результате драйвер дождется частичной загрузки страницы 
(то есть, момент, когда свойство **document.readyState** примет значение **interactive**), 
прежде чем будет выполнен клик по ссылке.
На это будет потрачено примерно 5 секунд. То есть в два раза быстрее, чем при загрузке страницы со стратегией **NORMAL**.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/4.%20New%20Project/06.jpg "New Maven Project - Лог запуска")

## 2.3. Стратегия загрузки страницы NONE

Шаги:

1. Добавить в файл **PageLoadStrategyTest.java** код.

* метод **pageLoadStrategyNoneTest** - стратегия загрузки страницы **EAGER**

```java
@Test
public void pageLoadStrategyNoneTest() {
    WebDriverManager.edgedriver().setup();
    logger.info("Драйвер для браузера MS Edge");
    EdgeOptions options = new EdgeOptions();
    options.addArguments("--start-maximized");
    // Устанавливаем стратегию загрузки страницы - NONE
    options.setPageLoadStrategy(PageLoadStrategy.NONE);
    WebDriver driver = new EdgeDriver(options);

    try {
        long start = System.currentTimeMillis();
        driver.get("https://www.dns-shop.ru/");
        logger.info("Открыта страница DNS - https://www.dns-shop.ru/");
        WebElement element = driver.findElement(By.xpath("//a[text()=\"Магазины\"]"));
        element.click();
        long finish = System.currentTimeMillis();
        long time = finish - start;
        logger.info("Затраченное время: " + (time / 1000) + " секунд");
    } catch (Exception e) {
        logger.info("Возникло исключение: " + e.getClass());
        if(driver != null) {
            driver.quit();
            logger.info("Драйвер остановлен!");
        }
    }
}
```

2. Запустить тест командой **mvn clean test** с параметром **-Dtest=PageLoadStrategyTest#pageLoadStrategyNoneTest**.

![New Maven Project - Запуск теста](./_Files/4.%20New%20Project/07.jpg "New Maven Project - Запуск теста")

3. Готово!

В результате драйвер не будет ждать загрузки страницы вообще, прежде чем будет выполнен клик по ссылке.
Но так как на странице еще нет ссылки, то будет выброшено исключение **NoSuchElementException**.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/4.%20New%20Project/08.jpg "New Maven Project - Лог запуска")

***

# 3. Неявные ожидания (Implicit Waits)

## 3.1. implicitlyWait(Duration duration)

Шаги:

1. Создать файл **ImplicitWaitsTest.java** в **./src/test/java**.

![New Maven Project - ImplicitWaitsTest.java](./_Files/4.%20New%20Project/09.jpg "New Maven Project - ImplicitWaitsTest.java")

2. Добавить в файл код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(ImplicitWaitsTest.class);
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* метод **implicitlyWaitTest** - неявное ожидание появления элемента на странице

```java
@Test
public void implicitlyWaitTest() {
    // Установить неявное ожидание до появления элемента на странице
    driver.manage().timeouts().implicitlyWait(Duration.ofSeconds(10));
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница DNS - https://www.dns-shop.ru/");
    // Нажать на ссылку Магазины
    WebElement linkShops = driver.findElement(By.xpath("//a[text()=\"Магазины\"]"));
    linkShops.click();
    logger.info("Нажата ссылка Магазины");
    // Нажать на выпадашку Каталог
    WebElement spanCatalog = driver.findElement(By.xpath("//span[@class=\"catalog-spoiler \"]"));
    spanCatalog.click();
    logger.info("Нажата выпадашка Каталог");
    // Нажать на ссылку Бытовая техника
    WebElement linkAppliances = driver.findElement(By.xpath("//a[text()=\"Бытовая техника\"]"));
    linkAppliances.click();
    logger.info("Нажата ссылка Бытовая техника");
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ImplicitWaitsTest#implicitlyWaitTest**.

![New Maven Project - Запуск теста](./_Files/4.%20New%20Project/10.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате клик по ссылке в выпадашке выполниться успешно.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/4.%20New%20Project/11.jpg "New Maven Project - Лог запуска")

5. Поменять код теста

* в методе **implicitlyWaitTest** установить неявное ожидание появления элемента в 1 миллисекунду

```java
@Test
public void implicitlyWaitTest() {
    // Установить неявное ожидание до появления элемента на странице
    driver.manage().timeouts().implicitlyWait(Duration.ofMillis(1));
    ...
}
```

6. Запустить тест командой **mvn clean test** с параметром **-Dtest=ImplicitWaitsTest#implicitlyWaitTest**.

7. Готово!

В результате при попытке выполнить клик по ссылке в выпадашке возникнет исключение **NoSuchElementException**.
Так как по истечению 1 миллисекунды ссылка в выпадашке не успела появиться.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/4.%20New%20Project/12.jpg "New Maven Project - Лог запуска")

## 3.2. pageLoadTimeout(Duration duration)

Шаги:

1. Добавить в файл **ImplicitWaitsTest.java** код.

* метод **pageLoadTimeout** - неявное ожидание завершения загрузки страницы

```java
@Test
public void pageLoadTimeoutTest() {
    // Установить неявное ожидание до завершения загрузки страницы
    driver.manage().timeouts().pageLoadTimeout(Duration.ofSeconds(100));
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница DNS - https://www.dns-shop.ru/");
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ImplicitWaitsTest#pageLoadTimeoutTest**.

![New Maven Project - Запуск теста](./_Files/4.%20New%20Project/13.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате клик по ссылке в выпадашке выполниться успешно.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/4.%20New%20Project/14.jpg "New Maven Project - Лог запуска")

5. Поменять код теста

* в метод **pageLoadTimeoutTest** установить неявное ожидание завершения загрузки страницы в 1 секунду

```java
@Test
public void pageLoadTimeoutTest() {
    // Установить неявное ожидание до завершения загрузки страницы
    driver.manage().timeouts().pageLoadTimeout(Duration.ofSeconds(1));
    ...
}
```

6. Запустить тест командой **mvn clean test** с параметром **-Dtest=ImplicitWaitsTest#pageLoadTimeoutTest**.

7. Готово!

В результате при попытке загрузить страницу возникнет исключение **TimeoutException**.
Так как по истечению 1 секунды страница загрузиться не успела.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/4.%20New%20Project/15.jpg "New Maven Project - Лог запуска")

## 3.3. setScriptTimeout(Duration duration)

Шаги:

1. Добавить в файл **ImplicitWaitsTest.java** код.

* метод **setScriptTimeout** - неявное ожидание завершения выполнения асинхронного сценария

```java
@Test
public void setScriptTimeoutTest() {
    // Установить неявное ожидание до завершения выполнения асинхронного сценария
    driver.manage().timeouts().setScriptTimeout(Duration.ofSeconds(1));
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница DNS - https://www.dns-shop.ru/");
    ((JavascriptExecutor) driver).executeAsyncScript("window.setTimeout(arguments[arguments.length - 1], 500);");
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ImplicitWaitsTest#setScriptTimeoutTest**.

![New Maven Project - Запуск теста](./_Files/4.%20New%20Project/16.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скрипт выполниться успешно.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/4.%20New%20Project/17.jpg "New Maven Project - Лог запуска")

5. Поменять код теста

* в метод **setScriptTimeout** установить неявное ожидание завершения выполнения асинхронного сценария в 0 секунд

```java
@Test
public void implicitlyWaitTest() {
    // Установить неявное ожидание до завершения загрузки страницы
    driver.manage().timeouts().setScriptTimeout(Duration.ofSeconds(0));
    ...
}
```

6. Запустить тест командой **mvn clean test** с параметром **-Dtest=ImplicitWaitsTest#setScriptTimeoutTest**.

7. Готово!

В результате при выполнении асинхронного скрипта возникнет исключение **ScriptTimeoutException**.
Так как за 0 секунд асинхронный скрипт не успеет выполниться.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/4.%20New%20Project/18.jpg "New Maven Project - Лог запуска")

***

# 4. Явные ожидания (Explicit Waits)

## 4.1. Атрибуты и свойства элементов

Шаги:

1. Создать файл **ExplicitWaitsTest.java** в **./src/test/java**.

![New Maven Project - ExplicitWaitsTest.java](./_Files/4.%20New%20Project/19.jpg "New Maven Project - ExplicitWaitsTest.java")

2. Добавить в файл код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(ExplicitWaitsTest.class);
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* метод **attributeExpectedConditionTest**

```java
@Test
public void attributeExpectedConditionTest() {

}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ExplicitWaitsTest#attributeExpectedConditionTest**.

![New Maven Project - Запуск теста](./_Files/4.%20New%20Project/10.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате клик по ссылке в выпадашке выполниться успешно.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/4.%20New%20Project/11.jpg "New Maven Project - Лог запуска")

5. Поменять код теста

* в методе **implicitlyWaitTest** установить неявное ожидание появления элемента в 1 миллисекунду

```java
@Test
public void implicitlyWaitTest() {
    // Установить неявное ожидание до появления элемента на странице
    driver.manage().timeouts().implicitlyWait(Duration.ofMillis(1));
    ...
}
```

6. Запустить тест командой **mvn clean test** с параметром **-Dtest=ImplicitWaitsTest#implicitlyWaitTest**.

7. Готово!

В результате при попытке выполнить клик по ссылке в выпадашке возникнет исключение **NoSuchElementException**.
Так как по истечению 1 миллисекунды ссылка в выпадашке не успела появиться.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/4.%20New%20Project/12.jpg "New Maven Project - Лог запуска")

## 4.2. Состояние элементов

## 4.3. Количество элементов

## 4.4. Наличие элементов

## 4.5. Отсутствие элементов

## 4.6. Видимость элементов

## 4.7. Невидимость элементов

## 4.8. Текстовое содержимое элементов

## 4.9. Свойства страницы

## 4.10. Работа JS скрипта

***

Задание [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](3.%20Задание.md)