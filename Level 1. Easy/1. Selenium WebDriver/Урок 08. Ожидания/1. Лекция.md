# Java_QA / Level 1. Easy - Основы / 1.1. Selenium WebDriver / Урок 08. Ожидания

[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](2.%20Практика.md)

***

Когда страница загружена в браузере, элементы на этой странице могут подгружаться с различными временными интервалами. 
Это затрудняет поиск элементов, если элемент не присутствует в DOM, возникает исключение ElementNotVisibleException. 
Используя ожидания, мы можем решить эту проблему. Ожидание дает некий временной интервал между произведенными действиями — поиске элемента или любой другой операции с элементом.

Ожидания - непременный атрибут любых UI тестов для динамических приложений. Нужны они для синхронизации работы AUT и тестового скрипта. Скрипт выполняется намного быстрее реакции приложения на команды, поэтому часто в скриптах необходимо дожидаться определенного состояния приложения для дальнейшего с ним взамодействия.
Ожидания нужны для синхронизации работы тестируемого приложения и тестового скрип

Selenium WebDriver предоставляет два типа ожиданий — неявное (implicit) и явное (explicit). Явное ожидание заставляет WebDriver ожидать возникновение определенного условия до произведения действий. Неявное ожидание заставляет WebDriver опрашивать DOM определенное количество времени, когда пытается найти элемент.

## Implicit Waits Неявные ожидания

Неявные ожидания - Implicit Waits - конфигурируют экземпляр WebDriver делать многократные попытки найти элемент (элементы) на странице в течении заданного периода времени, если элемент не найден сразу. 
Tолько по истечении этого времени WebDriver бросит ElementNotFoundException.

Неявное ожидание указывает WebDriver'у опрашивать DOM определенное количество времени, 
когда пытается найти элемент или элементы, которые недоступны в тот момент. 
Значение по умолчанию равно 0. После установки, неявное ожидание устанавливается для жизни экземпляра WebDriver объекта.

Неявные ожидания обычно настраиваются сразу после создания экземпляра WebDriver и действуют в течении всей жизни этого экземпляра, хотя переопределить их можно в любой момент. К этой группе ожиданий также можно отнести неявное ожидание загрузки страницы:
Implicit Wait можно использовать для:

ожидания полной загрузки страницы — pageLoadTimeout();
ожидания появления элемента на странице — implicitlyWait();
ожидания выполнения асинхронного запроса — setScriptTimeout();
driver.manage().timeouts().pageLoadTimeout(10, TimeUnit.SECONDS);
А также неявное ожидание отработки скриптов:

driver.manage().timeouts().setScriptTimeout(10, TimeUnit.SECONDS);

driver.manage().timeouts().implicitlyWait()

Неявные ожидания Implicitly

driver.manage().timeouts().implicitlyWait(4, SECONDS);
driver.findElement(By.cssSelector("div.super"));
findElement ждёт, пока элемент появится
findElements ждёт, пока хотя бы один элемент появится
Неявные
• На стороне браузера В браузере
• Ожидание появления в DOM
• Работают автоматически Перепроверяет чаще (100)
• NoSuchElementException
• Один сетевой запрос 1 запрос – 1 отвеn

## Explicit Waits Явные ожидания

Явные ожидания - Explicit Waits - это код, который ждет наступления какого-то события (чаще всего на AUT), прежде чем продолжит выполнение команд скрипта. Такое ожидание срабатывает один раз в указанном месте.
Самым худшим вариантом является использование Thread.sleep(1000), в случае с которым скрипт просто будет ждать определенное количество времени. Это не гарантирует наступление нужного события либо будет слишком избыточным и увеличит время выполнения теста.
Explicit wait, или явное ожидание, чаще используется для ожидания определенного условия, которое должно быть выполнено прежде, чем тест пойдет дальше.

Явное ожидание — это код, которым вы определяете какое необходимое условие должно произойти для того, чтобы дальнейший код исполнился. 
Худший пример такого кода — это использование команды time.sleep(), которая устанавливает точное время ожидания. 
Существуют более удобные методы, которые помогут написать вам код, ожидающий ровно столько, сколько необходимо. WebDriverWait в комбинации с ExpectedCondition является одним из таких способов.

WebDriverWait wait = new WebDriverWait()
wait.until()

Явные ожидания Explicitly

WebDriverWait wait = new WebDriverWait(driver, 10L, 125L);
wait.until(drv -> drv.findElements(By.cssSelector("div.super")).size() > 10);
Явные
• На стороне клиента На нашей стороне
• Ждать можно чего угодно Сами решаем
• Надо писать явно Реже (500), но можно менять
• TimeoutException
• Много сетевых запросов N

### Expected Conditions

Ожидаемые условия
Существуют некие условия, которые часто встречаются при автоматизации веб-сайтов. Ниже перечислены реализации каждого.
https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/support/ui/ExpectedConditions.html

ExpectedConditions:
alertIsPresent()
elementSelectionStateToBe()
elementToBeClickable()
elementToBeSelected()
frameToBeAvaliableAndSwitchToIt()
invisibilityOfTheElementLocated()
invisibilityOfElementWithText()
presenceOfAllElementsLocatedBy()
presenceOfElementLocated()
textToBePresentInElement()
textToBePresentInElementLocated()
textToBePresentInElementValue()
titleIs()
titleContains()
visibilityOf()
visibilityOfAllElements()
visibilityOfAllElementsLocatedBy()
visibilityOfElementLocated()

### Fluent Waits

Wait wait = new FluentWait()

Fluent
driver = new ChromeDriver();
FluentWait<WebDriver> wait = new FluentWait<WebDriver>(driver)
.withTimeout(7, TimeUnit.SECONDS)
.pollingEvery(500, TimeUnit.MILLISECONDS)
.ignoring(NoSuchElementException.class);

### Thread.sleep Задержка
#### Таймауты (TimeOut)

**Ожидания** - непременный атрибут любых UI тестов для динамических приложений.
Нужны они для синхронизации работы AUT и тестового скрипта.
Скрипт выполняется намного быстрее реакции приложения на команды,
поэтому часто в скриптах необходимо дожидаться определенного состояния приложения для дальнейшего с ним взамодействия.

##### Интерфейс WebDriver.Options

Методы интерфейса *WebDriver.Options*

| Тип      | Метод      | Описание            | 
|----------|------------|---------------------|
| Timeouts | timeouts() | настройка таймаутов |

[selenium/docs/api : WebDriver.Options](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/WebDriver.Options.html)

##### Интерфейс Timeouts

**Timeouts** - интерфейс представляющий настройки ожиданий.

Методы интерфейса *Timeouts*

| Тип                | Метод                               | Описание                                                                                    | 
|--------------------|-------------------------------------|---------------------------------------------------------------------------------------------|
| WebDriver.Timeouts | implicitlyWait(Duration duration)   | настройка ожидания до появления элемента на странице (неявные ожидания) (document == ready) |
| WebDriver.Timeouts | pageLoadTimeout(Duration duration)  | настройка ожидания до завершения загрузки страница перед появлением ошибки                  |
| WebDriver.Timeouts | setScriptTimeout(Duration duration) | настройка ожидания до завершения выполнения асинхронного сценария перед появлением ошибки   |

[selenium/docs/api : Timeouts](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/WebDriver.Timeouts.html)

##### Пример

```java
WebDriver driver = new FirefoxDriver();
driver.manage().timeouts().implicitlyWait(10, TimeUnit.SECONDS);
driver.get("http://some_url");
WebElement dynamicElement = driver.findElement(By.id("dynamicElement_id"));
```

#### Перечисление PageLoadStrategy

***PageLoadStrategy*** - перечисление определяющее стратегии загрузки страницы.

Константы перечисления *PageLoadStrategy*

| Тип    | Описание         | 
|--------|------------------|
| EAGER  |                  |
| NONE   |                  |
| NORMAL |                  |

[selenium/docs/api : PageLoadStrategy](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/PageLoadStrategy.html)

Как победить staleness?
• Поиск элемента перед использованием
• Выбор подходящего момента для действия
• Повторные попытки после исключения
• А может быть не только staleness?

***

Практика [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](2.%20Практика.md)



