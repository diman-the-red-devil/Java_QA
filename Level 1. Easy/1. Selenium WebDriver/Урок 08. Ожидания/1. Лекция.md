# Java_QA / Level 1. Easy - Основы / 1.1. Selenium WebDriver / Урок 08. Ожидания

[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](2.%20Практика.md)

***

## 1. Что такое ожидания?

***Ожидания*** - некий временной интервал между произведенными действиями (поиск элемента или любой другой вид операции с элементом).

Когда страница приложения загружена в браузере, элементы на этой странице могут подгружаться с различными временными интервалами.
Скрипт выполняется намного быстрее реакции приложения на команды.
Это затрудняет поиск элементов, если элемент не присутствует в **DOM**, возникает исключение **ElementNotVisibleException**.
Поэтому часто в скриптах необходимо дожидаться определенного состояния приложения для дальнейшего с ним взаимодействия.
Используя ожидания, мы можем решить эту проблему. 
Таким образом ожидания нужны для синхронизации работы тестируемого приложения и тестового скрипта.

Selenium WebDriver предоставляет два типа ожиданий — **неявное (implicit)** и **явное (explicit)**. 

* *явное ожидание* заставляет WebDriver ожидать возникновение определенного условия до произведения действий
* *неявное ожидание* заставляет WebDriver опрашивать DOM определенное количество времени, когда пытается найти элемент

***

## 2. Неявные ожидания (Implicit Waits)

***Неявное ожидание (Implicit Waits)*** - ожидание, которое конфигурируют экземпляр WebDriver делать многократные попытки 
найти элемент (элементы) на странице в течении заданного периода времени, если элемент не найден сразу. 

Tолько по истечении этого времени WebDriver бросит **ElementNotFoundException**.
Значение по умолчанию равно 0. 
Неявные ожидания обычно настраиваются сразу после создания экземпляра WebDriver и действуют в течении всей жизни этого экземпляра, 
хотя переопределить их можно в любой момент. 

К этой группе ожиданий также можно отнести неявное ожидание загрузки страницы

Implicit Wait можно использовать для:

* ожидания полной загрузки страницы — pageLoadTimeout();

driver.manage().timeouts().pageLoadTimeout(10, TimeUnit.SECONDS);

* ожидания появления элемента на странице — implicitlyWait();

driver.manage().timeouts().implicitlyWait()

* ожидания выполнения асинхронного запроса — setScriptTimeout();

driver.manage().timeouts().setScriptTimeout(10, TimeUnit.SECONDS);

driver.manage().timeouts().implicitlyWait(4, SECONDS);
driver.findElement(By.cssSelector("div.super"));


Неявные
• На стороне браузера В браузере
• Ожидание появления в DOM
• Работают автоматически Перепроверяет чаще (100)
• NoSuchElementException
• Один сетевой запрос 1 запрос – 1 отвеn

### Таймауты (TimeOut)

**Ожидания** - непременный атрибут любых UI тестов для динамических приложений.
Нужны они для синхронизации работы AUT и тестового скрипта.
Скрипт выполняется намного быстрее реакции приложения на команды,
поэтому часто в скриптах необходимо дожидаться определенного состояния приложения для дальнейшего с ним взамодействия.

#### Интерфейс WebDriver.Options

Методы интерфейса *WebDriver.Options*

| Тип      | Метод      | Описание            | 
|----------|------------|---------------------|
| Timeouts | timeouts() | настройка таймаутов |

[selenium/docs/api : WebDriver.Options](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/WebDriver.Options.html)

#### Интерфейс Timeouts

**Timeouts** - интерфейс представляющий настройки ожиданий.

Методы интерфейса *Timeouts*

| Тип                | Метод                               | Описание                                                                                    | 
|--------------------|-------------------------------------|---------------------------------------------------------------------------------------------|
| WebDriver.Timeouts | implicitlyWait(Duration duration)   | настройка ожидания до появления элемента на странице (неявные ожидания) (document == ready) |
| WebDriver.Timeouts | pageLoadTimeout(Duration duration)  | настройка ожидания до завершения загрузки страница перед появлением ошибки                  |
| WebDriver.Timeouts | setScriptTimeout(Duration duration) | настройка ожидания до завершения выполнения асинхронного сценария перед появлением ошибки   |

[selenium/docs/api : Timeouts](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/WebDriver.Timeouts.html)

```java
WebDriver driver = new FirefoxDriver();
driver.manage().timeouts().implicitlyWait(10, TimeUnit.SECONDS);
driver.get("http://some_url");
WebElement dynamicElement = driver.findElement(By.id("dynamicElement_id"));
```

#### Перечисление PageLoadStrategy

***PageLoadStrategy*** - перечисление определяющее стратегии загрузки страницы.

Константы перечисления *PageLoadStrategy*

| Тип    | Описание         | 
|--------|------------------|
| EAGER  |                  |
| NONE   |                  |
| NORMAL |                  |

[selenium/docs/api : PageLoadStrategy](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/PageLoadStrategy.html)

***

## 3. Явные ожидания (Explicit Waits)

***Явные ожидания (Explicit Waits)*** - ожидание, которое определяет какое необходимое событие должно произойти для того, 
чтобы дальнейший код исполнился. 

Такое ожидание срабатывает один раз в указанном месте.
Самым худшим вариантом является использование Thread.sleep(1000), в
случае с которым скрипт просто будет ждать определенное количество времени. 
Это не гарантирует наступление нужного события либо будет слишком избыточным и увеличит время выполнения теста.

Существуют более удобные методы, которые помогут написать вам код, ожидающий ровно столько, сколько необходимо. 
WebDriverWait в комбинации с ExpectedCondition является одним из таких способов.

WebDriverWait wait = new WebDriverWait()
wait.until()



WebDriverWait wait = new WebDriverWait(driver, 10L, 125L);
wait.until(drv -> drv.findElements(By.cssSelector("div.super")).size() > 10);

Явные
• На стороне клиента На нашей стороне
• Ждать можно чего угодно Сами решаем
• Надо писать явно Реже (500), но можно менять
• TimeoutException
• Много сетевых запросов N

### Ожидаемые условия (Expected Conditions)

Ожидаемые условия
Существуют некие условия, которые часто встречаются при автоматизации веб-сайтов. Ниже перечислены реализации каждого.

https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/support/ui/ExpectedConditions.html

ExpectedConditions:
alertIsPresent()
elementSelectionStateToBe()
elementToBeClickable()
elementToBeSelected()
frameToBeAvaliableAndSwitchToIt()
invisibilityOfTheElementLocated()
invisibilityOfElementWithText()
presenceOfAllElementsLocatedBy()
presenceOfElementLocated()
textToBePresentInElement()
textToBePresentInElementLocated()
textToBePresentInElementValue()
titleIs()
titleContains()
visibilityOf()
visibilityOfAllElements()
visibilityOfAllElementsLocatedBy()
visibilityOfElementLocated()

***

## Fluent Waits


Wait wait = new FluentWait()

Fluent
driver = new ChromeDriver();
FluentWait<WebDriver> wait = new FluentWait<WebDriver>(driver)
.withTimeout(7, TimeUnit.SECONDS)
.pollingEvery(500, TimeUnit.MILLISECONDS)
.ignoring(NoSuchElementException.class);

***

## Thread.sleep Задержка

***

Как победить staleness?
• Поиск элемента перед использованием
• Выбор подходящего момента для действия
• Повторные попытки после исключения
• А может быть не только staleness?

***

Практика [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](2.%20Практика.md)



