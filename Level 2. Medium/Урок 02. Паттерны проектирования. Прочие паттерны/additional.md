# 5. Паттерны данных

***Паттерны данных*** - паттерны, которые разделяют данные и логику тестирования.

а также уменьшить дублирование кода в тестах.
Это должно сделать их более понятными и простыми в обслуживании для всех, кто с ними работает.

## 5.1. Паттерн Data Registry

***Data Registry*** - паттерн,

### 5.1.1. Проблемы, которые решает паттерн

### 5.1.2. До применения паттерна

*Пример*

```java

```

### 5.1.3. После применения паттерна

Интересен следующий паттерн. Основной подход заключается в следующем: мы хотим, чтобы наши тесты были независимыми и
попробуем разделить наши тестовые данные по ним, но в результате мы получим полную противоположность.
Например, в тесте A используются user1, user2 и user3, и они жестко запрограммированы как тестовые данные.
Это может быть проблемой, поскольку нам нужны полностью независимые тесты, верно?
Но мы заставляем другой тест знать, что user1, user2 и user3 уже заняты тестом A.
Другая проблема заключается в том, что разработчик, не знакомый с этим, может использовать этих пользователей в других тестах, и это может вызвать проблемы.

Реестр данных позволяет нам генерировать уникальные данные и избегать дублирования.
В приведенном ниже примере я использую самый простой из возможных подходов:
при каждом вызове getUser статический потокобезопасный счетчик будет увеличиваться на 1,
гарантируя, что каждый раз создается уникальный пользователь.

*Пример*

```java
public static class UserRegistry {
    private static AtomicInteger COUNTER = new AtomicInteger(0);
    
    public static getUser() {
        int index = COUNTER.incrementAndGet();
        return new User("User_" + index, index);
    }
}

```

В вашем случае логика шаблона может быть намного сложнее, например. реестр может брать пользователя из базы данных, файла, предопределенного набора данных и т. д.
Но результат будет таким же: ваши тесты будут по-настоящему независимыми, поскольку каждый раз, когда они используют UserRegistry, они получают эксклюзивного пользователя, избегая проблем с перехватом тестов.

## 5.2. Паттерн Data Provider

***Data Provider*** - паттерн,

### 5.2.1. Проблемы, которые решает паттерн

### 5.2.2. До применения паттерна

*Пример*

```java

```

### 5.2.3. После применения паттерна

Поставщик данных - один из наиболее широко используемых шаблонов данных среди инженеров-тестировщиков.
Если вы хотите реализовать тесты на основе данных и хотите запустить одну и
ту же логику тестирования для нескольких наборов данных,
вы можете загружать данные из внешних источников (таких как Excel или таблица CVS),
удаленных служб или жестко закодировать их на месте.

*Пример*

```java
@DataProvider
private static Object[][] testDataProvider() {
    try {
        return ReadExcelSheet.getTableArray("src/main/resources/TestData.xls");
    } catch (Exception e) {
        return null;
    }
}
```

Это можно сделать так, как я показал выше,
путем чтения из источника и возврата нетипизированных данных (простой массив массивов или строк).
Но современный подход заключался бы в использовании шаблона Value Object,
о котором мы говорили ранее, и предоставлении данных в терминах сущностей.

*Пример*

```java
@DataProvider
private static Iterator<Object[]> devices() {
    return asList(
        new Object[] { new Device("iPhone X", Platform.IOS, "11.2") },
        new Object[] { new Device("iPhone 7 Plus", Platform.IOS, "10.3") },
        new Object[] { new Device("Google Pixel 2", Platform.ANDROID, "8.0") }  
    ).iterator();
}

@Test(dataProvider = "devices")
public void pageShouldBeOpenedOnDevice(Device device) {
    startDevice(device);
    // some test steps
}
```

Вам нужно пометить свой метод аннотацией dataProvider или сделать его параметризованным с помощью JUnit и
заставить его возвращать набор данных для использования в тесте. Остальное (синтаксический анализ и итерация)
будет выполняться фреймворком, все, что вам нужно сделать, - это использовать данные, как в обычном тесте.

Важно, чтобы мы использовали оба шаблона (поставщик данных и объект значения) в одном подходе,
поскольку это помогло нам избежать передачи нескольких параметров методу и сделать код более чистым и читаемым.

Мне нравится использовать шаблоны данных в своей автоматизации,
они помогают мне поддерживать работоспособность кода и максимально оптимизировать управление ресурсами.
Если вас интересуют другие шаблоны, которые могут помочь вам в написании чистых и надежных тестов,
ознакомьтесь с другими моими сообщениями:

https://www.devbridge.com/articles/top-design-pattern-test-automation-frameworks/
https://antony-s-smirnov.medium.com/how-to-use-the-data-provider-pattern-in-the-project-ea12430d9275
