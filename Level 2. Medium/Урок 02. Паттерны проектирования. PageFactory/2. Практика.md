Java_QA / Level 2. Medium - Продвинутые темы / Урок 02. Паттерны проектирования. PageFactory

[![Назад](https://img.shields.io/badge/-%D0%9D%D0%B0%D0%B7%D0%B0%D0%B4-brightgreen)](1.%20Лекция.md)
[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](3.%20Задание.md)

***

# 1. Открытие предыдущего проекта

Шаги:

1. Запустить **IntelliJ IDEA**.

2. Открыть проект прошлого урока в **IntelliJ IDEA**.

![New Maven Project - Open...](./_Files/2.%20New%20Project/01.jpg "New Maven Project - Open...")

***

# 2. Простые классы 

## 2.1. Простой Java Объект (Plain Old Java Object (POJO))

### 2.1.1. Класс SmartphonePOJO

***SmartphonePOJO*** - класс представляющий смартфон, созданный с применением **POJO**.

Шаги:

1. Создать пакет Java **models** в папке **./src/test/java**.

![New Maven Project - helpers](./_Files/2.%20New%20Project/02.jpg "New Project - helpers")

2. Создать файл **SmartphonePOJO.java** в **./src/test/java/models**.

![New Maven Project - SmartphonePOJO.java](./_Files/2.%20New%20Project/03.jpg "New Project - SmartphonePOJO.java")

3. Добавить в файл **SmartphonePOJO.java** код.

* объявление полей класса

```java
// Оперативная память
public int ram;
// Компания
public String company;
```

* конструктор класса

```java
// Конструктор
public SmartphonePOJO(int ram, String company) {
    this.ram = ram;
    this.company = company;
}
```

### 2.1.2. Класс SmartphonesProductPage5_Test

***SmartphonesProductPage5_Test*** - класс содержащий тесты с проверками страницы **Продукт. Смартфон**.

Класс **SmartphonesProductPage5_Test** расширяет класс **BaseTest**.

Шаги:

1. Создать файл **SmartphonesProductPage5_Test.java** в **./src/test/java/tests/smartphones**.

![New Maven Project - SmartphonesProductPage5_Test.java](./_Files/2.%20New%20Project/04.jpg "New Project - SmartphonesProductPage5_Test.java")

2. Добавить в файл **SmartphonesProductPage5_Test.java** код.

* метод **selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite** - тест

```java
@Test
// Проверка
public void selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite() {
    // 1. Arrange
    SmartphonePOJO smartphonePOJO = new SmartphonePOJO( 8, "Samsung");
    // String product = "Samsung"; // производитель
    // String ram = "8 Гб"; // объем ОП

    // 2. Act
    SmartphoneProductPage smartphoneProductPage = getProductPage(smartphonePOJO);

    // 3. Assert
    String expected = "Купить 6.7\" Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый в интернет магазине DNS. Характеристики, цена Samsung Galaxy Z Flip3 | 4845670";
    SmartphoneProductPageAssert smartphoneProductAssert = new SmartphoneProductPageAssert(smartphoneProductPage);
    smartphoneProductAssert.pageTitleEquals(expected);
}
```

* метод **getProductPage** - получение страницы с продуктом

```java
// Получение заголовка страницы с продуктом
public SmartphoneProductPage getProductPage(SmartphonePOJO smartphonePOJO) {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    // ***** Стартовая страница сайта DNS *****
    StartPageWithElements startPage = new StartPageWithElements(driver);
    // Наведение курсора мыши на ссылку "Смартфоны и гаджеты"
    startPage.linkSmartsAndGadgetsMove();
    // Нажатие на ссылку "Смартфоны"
    startPage.linkSmartsClick();

    // ***** Страница "Смартфоны" *****
    SmartphonesPageWithElements smartphonesPage = new SmartphonesPageWithElements(driver);
    // Нажатие на выпадашку "Сортировка"
    smartphonesPage.accordeonSortClick();
    // Установка сортировки "Сначала дорогие"
    smartphonesPage.rbtnExpensiveClick();
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Производитель"
    smartphonesPage.chbxCompanyClick(smartphonePOJO.company);
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на гармошку "Объем оперативной памяти"
    smartphonesPage.accordeonRAMClick();
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Объем оперативной памяти"
    smartphonesPage.chbxRAMClick(smartphonePOJO.ram + " Гб");
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на кнопку "Применить"
    smartphonesPage.btnApplyClick();
    // Прокрутка страницы вверх
    JSExec.scrollBy(0, -500);
    // Нажатие на ссылку первого продукта в списке
    smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый");
    //smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy S20 FE 128 ГБ белый");
    return new SmartphoneProductPage(driver);
}
```

### 2.1.3. Полный код SmartphonesProductPage5_Test.java

[SmartphonesProductPage5_Test.java](_Sample_02/src/test/java/tests/smartphones/SmartphonesProductPage5_Test.java)

### 2.1.4. Запуск автотеста

Шаги:

1. Запустить тест командой **mvn clean test** с параметром **-Dtest=SmartphonesProductPage5_Test**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/05.jpg "New Maven Project - Запуск теста")

2. Готово!

В результате будет выполнен тест.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/06.jpg "New Maven Project - Лог запуска")

### 2.1.5. Что изменилось и какая польза?

Теперь вместо двух переменных примитивных типов используется объект класса **SmartphonePOJO**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/07.jpg "New Maven Project - Запуск теста")

Представьте, что в метод **getProductPage** нужно передать не 2 параметра, а 2 - 10 (заполнить от 2 до 10 разных фильтров).
Тогда нужно будет создавать новые методы и копировать логику по заполнению полей фильтров в них. 
В итоге у нас будет:

* куча дублированного кода по заполнению полей фильтров
* множество параметров с одинаковыми типами, в которых легко запутаться
* анти-паттерн **Телескопический метод** (когда в параметрах более двух аргументов)

## 2.2. Паттерн Java Боб (JavaBean)

### 2.2.1. Класс SmartphoneJB

***SmartphoneJB*** - класс представляющий смартфон, созданный с применением **JavaBeans**.

Шаги:

1. Создать файл **SmartphoneJB.java** в **./src/test/java/models**.

![New Maven Project - SmartphoneJB.java](./_Files/2.%20New%20Project/08.jpg "New Project - SmartphoneJB.java")

2. Добавить в файл **SmartphoneJB.java** код.

* объявление полей класса

```java
// Оперативная память
public int ram;
// Компания
public String company;
```

* конструктор класса по умолчанию

```java
 // Конструктор по умолчанию
public SmartphoneJB() {

}
```

* конструктор класса

```java
// Конструктор
public SmartphonePOJO(int ram, String company) {
    this.ram = ram;
    this.company = company;
}
```

* cеттеры и геттеры

```java
// Сеттеры и геттеры
// Оперативная память
public void setRam(int ram) {
    this.ram = ram;
}

public int getRam() {
    return this.ram;
}
// Компания
public void setCompany(String company) {
    this.company = company;
}

public String getCompany() {
    return this.company;
}
```

### 2.2.2. Класс SmartphonesProductPage6_Test

***SmartphonesProductPage6_Test*** - класс содержащий тесты с проверками страницы **Продукт. Смартфон**.

Класс **SmartphonesProductPage6_Test** расширяет класс **BaseTest**.

Шаги:

1. Создать файл **SmartphonesProductPage6_Test.java** в **./src/test/java/tests/smartphones**.

![New Maven Project - SmartphonesProductPage6_Test.java](./_Files/2.%20New%20Project/04.jpg "New Project - SmartphonesProductPage6_Test.java")

2. Добавить в файл **SmartphonesProductPage6_Test.java** код.

* метод **selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite** - тест

```java
@Test
// Проверка
public void selectedProduct_Is_SamsungGalaxyNote20Ultra256GBWhite() {
    // 1. Arrange
    SmartphoneJB smartphoneJB = new SmartphoneJB( 8, "Samsung");
    // String product = "Samsung"; // производитель
    // String ram = "8 Гб"; // объем ОП

    // 2. Act
    SmartphoneProductPage smartphoneProductPage = getProductPage(smartphonePOJO);

    // 3. Assert
    String expected = "Купить 6.7\" Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый в интернет магазине DNS. Характеристики, цена Samsung Galaxy Z Flip3 | 4845670";
    SmartphoneProductPageAssert smartphoneProductAssert = new SmartphoneProductPageAssert(smartphoneProductPage);
    smartphoneProductAssert.pageTitleEquals(expected);
}
```

* метод **getProductPage** - получение страницы с продуктом

```java
// Получение заголовка страницы с продуктом
public SmartphoneProductPage getProductPage(SmartphonePOJO smartphonePOJO) {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    // ***** Стартовая страница сайта DNS *****
    StartPageWithElements startPage = new StartPageWithElements(driver);
    // Наведение курсора мыши на ссылку "Смартфоны и гаджеты"
    startPage.linkSmartsAndGadgetsMove();
    // Нажатие на ссылку "Смартфоны"
    startPage.linkSmartsClick();

    // ***** Страница "Смартфоны" *****
    SmartphonesPageWithElements smartphonesPage = new SmartphonesPageWithElements(driver);
    // Нажатие на выпадашку "Сортировка"
    smartphonesPage.accordeonSortClick();
    // Установка сортировки "Сначала дорогие"
    smartphonesPage.rbtnExpensiveClick();
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Производитель"
    smartphonesPage.chbxCompanyClick(smartphonePOJO.company);
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на гармошку "Объем оперативной памяти"
    smartphonesPage.accordeonRAMClick();
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Установка фильтра "Объем оперативной памяти"
    smartphonesPage.chbxRAMClick(smartphonePOJO.ram + " Гб");
    // Прокрутка страницы вниз
    JSExec.scrollBy(0, 300);
    // Нажатие на кнопку "Применить"
    smartphonesPage.btnApplyClick();
    // Прокрутка страницы вверх
    JSExec.scrollBy(0, -500);
    // Нажатие на ссылку первого продукта в списке
    smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy Z Flip3 256 ГБ бежевый");
    //smartphonesPage.linkFirstProductClick("Смартфон Samsung Galaxy S20 FE 128 ГБ белый");
    return new SmartphoneProductPage(driver);
}
```

### 2.2.3. Полный код SmartphonesProductPage6_Test.java

[SmartphonesProductPage6_Test.java](_Sample_02/src/test/java/tests/smartphones/SmartphonesProductPage6_Test.java)

### 2.2.4. Запуск автотеста

Шаги:

1. Запустить тест командой **mvn clean test** с параметром **-Dtest=SmartphonesProductPage6_Test**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/05.jpg "New Maven Project - Запуск теста")

2. Готово!

В результате будет выполнен тест.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/06.jpg "New Maven Project - Лог запуска")

### 2.2.5. Что изменилось и какая польза?

Теперь вместо двух переменных примитивных типов используется объект класса **SmartphonePOJO**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/07.jpg "New Maven Project - Запуск теста")



## 2.3. Паттерн Объект Значение (Value Object (VO))

RAM

Company

## 2.4. Паттерн Объект сущность (Entity)

Smartphone

# 3. Порождающие паттерны

## 3.1. Паттерн Простая Фабрика (SimpleFactory)

### 3.1.1. Фабрика веб драйверов (WebDriverFactory)

С паттерном фабрика Вы уже знакомы. Давайте закрепим пройденный материал.

## 2.1. Перечисление BrowserName

***BrowserName*** - перечисление для хранения имен браузеров,
которые будут передаваться в качестве параметров при запуске.

Шаги:

1. Создать пакет Java **webdriverfactory** в папке **./src/test/java**.

![New Maven Project - webdriverfactory](./_Files/2.%20New%20Project/02.jpg "New Project - webdriverfactory")

2. Создать файл **BrowserName.java** в **./src/test/java/webdriverfactory**.

При создании класса выбрать **Enum** (Перечисление).

![New Maven Project - BrowserName.java](./_Files/2.%20New%20Project/03.jpg "New Project - BrowserName.java")

3. Добавить в файл **BrowserName.java** код.

* константы, определяющие названия браузеров

```java
// Имена браузеров
CHROME("chrome"),   // Google Chrome
FIREFOX("firefox"), // Mozilla Firefox
EDGE("edge");       // Microsoft Edge
```

* переменная для хранения строкового значения константы

```java
private String browserName; // Имя браузера
```

* приватный конструктор

```java
// Приватный конструктор
private BrowserName(String browserName) {
    this.browserName = browserName;
}
```

* переопределенный метод **toString**

```java
// Переопределенный метод toString()
@Override
public String toString() {
    return String.valueOf(this.browserName);
}
```

* метод **fromString** - возврат значения константы по строковому значению константы

```java
// Возврат значения константы по строковому значению константы
public static BrowserName fromString(String browserName) {
    if (browserName != null) {
        for(Browser b : Browser.values()) {
            if (browserName.equalsIgnoreCase(b.browserName)) {
                return b;
            }
        }
    }
    return null;
}
```

* метод **getBrowserName** - получение имени браузера

```java
// Получение имени браузера
public String getBrowserName() {
    return this.browserName;
}
```

## 2.2. Полный код BrowserName.java

[BrowserName.java]()

## 2.3. Класс ChromeBrowser

***ChromeBrowser*** - класс для создания и настройки экземпляра веб драйвера **Goggle Chrome**.

Шаги:

1. Создать файл **ChromeBrowser.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - ChromeBrowser.java](./_Files/2.%20New%20Project/04.jpg "New Project - ChromeBrowser.java")

2. Добавить в файл **ChromeBrowser.java** код.

* метод **getDriver** - получение экземпляра драйвера браузера **Google Chrome**

```java
// Получение экземпляра драйвера браузера "Google Chrome"
public WebDriver getDriver() {
    // Настройка исполняемого файла драйвера
    WebDriverManager.chromedriver().setup();
    
    // Опции драйвера:
    ChromeOptions options = new ChromeOptions();
    // - поведение при появлении алертов "Игнорирование"
    options.setCapability(CapabilityType.UNEXPECTED_ALERT_BEHAVIOUR, UnexpectedAlertBehaviour.IGNORE);
    // - стратегия загрузки страницы "NORMAL"
    options.setCapability(CapabilityType.PAGE_LOAD_STRATEGY, PageLoadStrategy.NORMAL);
    // - режим "Инкогнито"
    options.addArguments("--incognito");
    // - режим "Полный экран"
    options.addArguments("--start-fullscreen");
    
    // Новый экземпляр драйвера
    return new ChromeDriver(options);
}
```

## 2.4. Полный код ChromeBrowser.java

[ChromeBrowser.java]()

## 2.5. Класс FirefoxBrowser

***FirefoxBrowser*** - класс для создания и настройки экземпляра веб драйвера **Mozilla Firefox**.

Шаги:

1. Создать файл **FirefoxBrowser.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - FirefoxBrowser.java](./_Files/2.%20New%20Project/05.jpg "New Project - FirefoxBrowser.java")

2. Добавить в файл **FirefoxBrowser.java** код.

* метод **getDriver** - получение экземпляра драйвера браузера **Mozilla Firefox**

```java
// Получение экземпляра драйвера браузера "Mozilla Firefox"
public static WebDriver getDriver() {
    // Настройка исполняемого файла драйвера
    WebDriverManager.firefoxdriver().setup();
    
    // Опции драйвера:
    FirefoxOptions options = new FirefoxOptions();
    // - поведение при появлении алертов "Игнорирование"
    options.setCapability(CapabilityType.UNEXPECTED_ALERT_BEHAVIOUR, UnexpectedAlertBehaviour.IGNORE);
    // - стратегия загрузки страницы "NORMAL"
    options.setCapability(CapabilityType.PAGE_LOAD_STRATEGY, PageLoadStrategy.NORMAL);
    // - режим "Инкогнито"
    options.addArguments("-private");
    // - режим "Полный экран"
    options.addArguments("-kiosk");
    
    // Новый экземпляр драйвера
    return new FirefoxDriver(options);
}
```

## 2.6. Полный код FirefoxBrowser.java

[FirefoxBrowser.java]()

## 2.7. Класс EdgeBrowser

***EdgeBrowser*** - класс для создания и настройки экземпляра веб драйвера **Microsoft Edge**.

Шаги:

1. Создать файл **EdgeBrowser.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - EdgeBrowser.java](./_Files/2.%20New%20Project/06.jpg "New Project - EdgeBrowser.java")

2. Добавить в файл **EdgeBrowser.java** код.

* метод **getDriver** - получение экземпляра драйвера браузера **Microsoft Edge**

```java
// Получение экземпляра драйвера браузера "Microsoft Edge"
public static WebDriver getDriver() {
    // Настройка исполняемого файла драйвера
    WebDriverManager.edgedriver().setup();
    
    // Опции драйвера:
    EdgeOptions options = new EdgeOptions();
    // - поведение при появлении алертов "Игнорирование"
    options.setCapability(CapabilityType.UNEXPECTED_ALERT_BEHAVIOUR, UnexpectedAlertBehaviour.IGNORE);
    // - стратегия загрузки страницы "NORMAL"
    options.setCapability(CapabilityType.PAGE_LOAD_STRATEGY, PageLoadStrategy.NORMAL);
    // - режим "Инкогнито"
    options.addArguments("--incognito");
    // - режим "Полный экран"
    options.addArguments("--start-fullscreen");
    
    // Новый экземпляр драйвера
    return new EdgeDriver(options);
}
```

## 2.8. Полный код EdgeBrowser.java

[EdgeBrowser.java]()

## 2.9. Класс WebDriverFactory

***WebDriverFactory*** - класс реализующий паттерн фабрика, фабрика по созданию экземпляров веб драйверов.

Шаги:

1. Создать файл **WebDriverFactory.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - WebDriverFactory.java](./_Files/2.%20New%20Project/07.jpg "New Project - WebDriverFactory.java")

2. Добавить в файл **WebDriverFactory.java** код.

* объявление логгера

```java
// Логгер
private static Logger logger = LogManager.getLogger(WebDriverFactory.class);
```

* метод **getDriver** - получение экземпляра драйвера по имени

```java
// Получение экземпляра драйвера по имени
public static WebDriver getDriver(String name) {
    switch (BrowserName.fromString(name)) {
        // Драйвер браузера Google Chrome
        case CHROME:
            logger.info("Драйвер браузера Google Chrome");
            ChromeBrowser.getDriver();
        // Драйвер браузера Mozilla Firefox
        case FIREFOX:
            logger.info("Драйвер браузера Mozilla Firefox");
            FirefoxBrowser.getDriver();
        // Драйвер браузера Microsoft Edge
        case EDGE:
            logger.info("Драйвер браузера Microsoft Edge");
            EdgeBrowser.getDriver();
        // По умолчанию
        default:
            throw new RuntimeException("Некорректное наименование браузера");
    }
}
```

## 2.10. Полный код WebDriverFactory.java

[WebDriverFactory.java]()

### 3.1.2. Фабрика страниц (PageFactory)

PageNames
Pages
PageFactory

### 3.1.3. Фабрика элементов (ElementFactory)

ElementNames
Elements
ElementFactory

### 3.1.4. Фабрика тестовых данных

Smartphones
SmartphonesFactory

## 3.2. Паттерн Фабричный метод (Factory Method)

### 3.2.1. 

## 3.3. Паттерн Строитель (Builder)

### 3.3.1. Билдер тестовых данных

WebDriverBuilder
SmartphoneBuilder

##

# 4. Структурные паттерны

## 4.1. Паттерн Декоратор (Decorator)

### 4.1.1. Декоратор драйвера

### 4.1.2. Декоратор тестовых данных

## 4.2. Паттерн Заместитель (Proxy)

### 4.2.3. Заместителя для WebDriver

## 4.3. Паттерн Фасад (Facade)

### Фасад страниц

## 4.3. Паттерн Легковес (Flyweight / Object Pool)

### Пул страниц

***

Задание [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](3.%20Задание.md)