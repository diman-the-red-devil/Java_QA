Java_QA / Level 2. Medium - Продвинутые темы / Урок 04. BDD. Сucumber

[![Назад](https://img.shields.io/badge/-%D0%9D%D0%B0%D0%B7%D0%B0%D0%B4-brightgreen)](1.%20Лекция.md)
[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](3.%20Задание.md)

***

# 1. Открытие предыдущего проекта

Шаги:

1. Запустить **IntelliJ IDEA**.

2. Открыть проект прошлого урока в **IntelliJ IDEA**.

![New Maven Project - Open...](./_Files/2.%20New%20Project/01.jpg "New Maven Project - Open...")

***

# 2. Хуки

## 2.1. Настройка драйвера

Вынесем действия по настройке драйвера в хуки.

### 2.1.1. Класс DriverHooks

***DriverHooks*** - класс, который выполняет действия по настройке драйвера.

Шаги:

1. Создать файл **DriverHooks.java** в **./src/test/java/hooks**.

![New Maven Project - DriverHooks.java](./_Files/2.%20New%20Project/02.jpg "New Project - DriverHooks.java")

2. Добавить в файл **DriverHooks.java** код.

* объявление драйвера браузера

```java
// Драйвер браузера
protected static WebDriver driver;
```

* объявление логгера

```java
// Логгер
private Logger logger = LogManager.getLogger(DriverHooks.class);
```

* метод **setUp** - действия совершаемые перед каждым сценарием

```java
// Действия совершаемые перед каждым сценарием
@Before
public void setUp() {
    // Получаем параметр запуска тестов через Maven -Dbrowser
    String browser = System
        .getProperty("browser", "chrome")
        .toLowerCase();
    // Получаем экземпляр драйвера браузера
    driver = WebDriverFactory.getDriver(BrowserName.fromString(browser));
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown** - действия совершаемые после каждого сценария

```java
// Действия совершаемые после каждого сценария
@After
public void setDown() {
    // Если драйвер еще существует
    if(driver != null) {
        // Закрываем его
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

### 2.1.2. Полный код DriverHooks.java

[DriverHooks.java](_Sample_04/src/test/java/hooks/DriverHooks.java)

### 2.1.3. Класс SmartphoneSteps

Изменим реализацию шагов в **SmartphoneSteps.java**.

Шаги:

1. Открыть файл **SmartphoneSteps.java** в **./src/test/java/steps**.

2. Изменить в файле **SmartphoneSteps.java** код.

* объявление драйвера

```java
// Драйвер браузера
protected static WebDriver driver = WebDriverFactory.getCurrentDriver();
```

* метод **startDriverAndOpenStartPage** - шаг **Дано** *Открыта Главная страница ДНС*

```java
@Дано("Открыта Главная страница ДНС")
public void startDriverAndOpenStartPage() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта Стартовая страница сайта DNS");
}
```

* метод **assertTitle** - шаг **Тогда** *Проверить: В заголовке страницы отображается текст Смартфоны*

```java
@Тогда("Проверить: В заголовке страницы отображается текст Смартфоны")
public void assertTitle() {
    SmartphonesPage smartphonesPage = new SmartphonesPage(driver);
    // Проверка заголовка страницы
    logger.info("Проверка заголовка страницы");
    Assertions.assertTrue(smartphonesPage.getPageTitle().contains("Смартфоны"),
        "В заголовке страницы не отображается текст Смартфоны");
}
```

### 2.1.4. Полный код SmartphoneSteps.java

[SmartphoneSteps.java](_Sample_04/src/test/java/steps/SmartphoneSteps.java)

### 2.1.5. Фича Smartphone

Шаги:

1. Открыть файл **Smartphone.feature** в **./src/test/resources/features**.

2. Изменить сценарий:

* шаг **Дано** *Открыта Главная страница ДНС*

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

  Сценарий: Просмотр страницы Смартфоны
    Дано Открыта Главная страница ДНС
    Когда Выполнен переход на страницу Смартфоны
    Тогда Проверить: В заголовке страницы отображается текст Смартфоны
```

## 2.2. Снятие скриншотов

Добавим снятие скриншотов до и после каждого шага в хуки.

### 2.2.1. Класс ScreenShotHooks

***ScreenShotHooks*** - класс, который выполняет действия по снятию скриншотов.

Шаги:

1. Создать файл **ScreenShotHooks.java** в **./src/test/java/hooks**.

![New Maven Project - ScreenShotHooks.java](./_Files/2.%20New%20Project/03.jpg "New Project - ScreenShotHooks.java")

2. Добавить в файл **ScreenShotHooks.java** код.

* объявление драйвера браузера

```java
// Драйвер браузера
protected static WebDriver driver = WebDriverFactory.getCurrentDriver();
```

* объявление логгера

```java
// Логгер
private Logger logger = LogManager.getLogger(ScreenShotHooks.class);
```

* метод **takeScreenShotBeforeStep** - действия совершаемые перед каждым шагом

```java
// Действия совершаемые перед каждым шагом
@BeforeStep
public void takeScreenShotBeforeStep(Scenario scenario) {
    // Сделать скриншот видимой области веб страницы
    try {
        Screenshot screenshot = new AShot().takeScreenshot(driver);
        ImageIO.write(screenshot.getImage(), "png",
                new File("temp\\" + scenario.getName() + "-" + Timestamp.from(Instant.now()).getTime() + ".png"));
        logger.info("Скриншот сохранен в файле [temp\\ASViewablePage.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

* метод **takeScreenShotAfterStep** - действия совершаемые после каждого шага

```java
// Действия совершаемые после каждого шага
@AfterStep
public void takeScreenShotAfterStep(Scenario scenario) {
    // Сделать скриншот видимой области веб страницы
    try {
        Screenshot screenshot = new AShot().takeScreenshot(driver);
        ImageIO.write(screenshot.getImage(), "png",
                new File("temp\\" + scenario.getName() + "-" + Timestamp.from(Instant.now()).getTime() + ".png"));
        logger.info("Скриншот сохранен в файле [temp\\ASViewablePage.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

### 2.2.2. Полный код ScreenShotHooks.java

[ScreenShotHooks.java](_Sample_04/src/test/java/hooks/ScreenShotHooks.java)

## 2.3. Запуск тестовых сценариев

Шаги:

1. Открыть **.feature** файл **Smartphone.feature**

2. Запустить сценарий **Просмотр страницы Смартфоны**

3. Получить результаты запуска в консоли

![New Maven Project - Результаты запуска сценария](./_Files/2.%20New%20Project/04.jpg "New Project - Результаты запуска сценария")

4. Проверить сохранение скриншотов в **

![New Maven Project - Результаты запуска сценария](./_Files/2.%20New%20Project/04.jpg "New Project - Результаты запуска сценария")

***

# 3. Предыстория

## 3.1. Фича Smartphone

Добавим новый сценарий

Шаги:

1. Открыть файл **Smartphone.feature** в **./src/test/resources/features**.

2. Добавить сценарий **Фильтрация и сортировка смартфонов на странице Смартфоны**:

* заголовок сценария - **Фильтрация и сортировка смартфонов на странице Смартфоны**

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
  ...
  Сценарий: Фильтрация и сортировка смартфонов на странице Смартфоны
```

* шаги сценария

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
  ...
  Сценарий: Фильтрация и сортировка смартфонов на странице Смартфоны
    Дано Открыта Главная страница ДНС
    Когда Выполнен переход на страницу Смартфоны
    И Установлена сортировка "Сначала дорогие"
    И В фильтре "Производитель" выбрано значение "Samsung"
    И В фильтре "Объем оперативной памяти" выбрано значение "10 Гб"
    И Применены выбранные фильтры
    И Выполнен переход на страницу первого товара из списка
    Тогда Проверить: В заголовке страницы отображается текст Samsung
```

## 3.1. Класс SmartphoneSteps

Шаги:

1. Открыть файл **SmartphoneSteps.java** в **./src/test/java/steps**.

2. Добавить в файл **SmartphoneSteps.java** код.

* 
###



***

# 1. Проперти файл





# 4. Структура сценария

# 5. Таблицы




***

Задание [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](3.%20Задание.md)