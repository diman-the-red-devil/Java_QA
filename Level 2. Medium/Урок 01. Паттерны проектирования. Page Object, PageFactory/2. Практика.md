Java_QA / Level 2. Medium - Продвинутые темы / Урок 02. Page Object, PageFactory

[![Назад](https://img.shields.io/badge/-%D0%9D%D0%B0%D0%B7%D0%B0%D0%B4-brightgreen)](1.%20Лекция.md)
[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](3.%20Задание.md)

***

# 1. Создание и настройка нового проекта

Шаги:

1. Создать новый проект **Maven** в **IntelliJ IDEA**.

2. Сконфигурировать файл **POM.xml**
   
* настроить кодировку проекта - **UTF-8**
  
```xml
<!-- Параметры -->
<properties>
    <!-- Кодировка проекта - UTF-8 -->
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
</properties>
```

* настроить версию Java - **15** или на ваше усмотрение

```xml
<!-- Параметры -->
<properties>
    <!-- Кодировка проекта - UTF-8 -->
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
    <!-- Версия Java - 15 -->
    <source>15</source>
    <target>15</target>
</properties>
```

* прописать версии библиотек
  
```xml
<!-- Параметры -->
<properties>
    <!-- Кодировка проекта - UTF-8 -->
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
    <!-- Версия Java - 15 -->
    <source>15</source>
    <target>15</target>
    <!-- Версии зависимостей -->
    <junit-jupiter-engine>5.1.0</junit-jupiter-engine>
    <selenium-java>4.0.0-beta-4</selenium-java>
    <webdrivermanager>4.4.3</webdrivermanager>
    <log4j-api>2.14.0</log4j-api>
    <log4j-core>2.14.0</log4j-core>
</properties>
```

* прописать версии плагинов

```xml
<!-- Параметры -->
<properties>
    <!-- Кодировка проекта - UTF-8 -->
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
    <!-- Версия Java - 15 -->
    <source>15</source>
    <target>15</target>
    <!-- Версии зависимостей -->
    <junit-jupiter-engine>5.1.0</junit-jupiter-engine>
    <selenium-java>4.0.0-beta-4</selenium-java>
    <webdrivermanager>4.2.2</webdrivermanager>
    <log4j-api>2.14.0</log4j-api>
    <log4j-core>2.14.0</log4j-core>
    <ashot>1.5.4</ashot>
    <!-- Версии плагинов -->
    <maven-surefire-plugin>2.22.2</maven-surefire-plugin>
    <maven-compiler-plugin>3.8.1</maven-compiler-plugin>
</properties>
```

* добавить зависимости

```xml
<!-- Зависимости -->
<dependencies>
    <!-- JUnit -->
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-engine</artifactId>
        <version>${junit-jupiter-engine}</version>
        <scope>test</scope>
    </dependency>
    <!-- Selenium WebDriver -->
    <dependency>
        <groupId>org.seleniumhq.selenium</groupId>
        <artifactId>selenium-java</artifactId>
        <version>${selenium-java}</version>
        <scope>test</scope>
    </dependency>
    <!-- WebDriver Manager -->
    <dependency>
        <groupId>io.github.bonigarcia</groupId>
        <artifactId>webdrivermanager</artifactId>
        <version>${webdrivermanager}</version>
        <scope>test</scope>
    </dependency>
    <!-- Log4J -->
    <dependency>
        <groupId>org.apache.logging.log4j</groupId>
        <artifactId>log4j-api</artifactId>
        <version>${log4j-api}</version>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>org.apache.logging.log4j</groupId>
        <artifactId>log4j-core</artifactId>
        <version>${log4j-core}</version>
        <scope>test</scope>
    </dependency>
    <!-- aShot -->
    <dependency>
        <groupId>ru.yandex.qatools.ashot</groupId>
        <artifactId>ashot</artifactId>
        <version>${ashot}</version>
        <scope>test</scope>
    </dependency>
</dependencies>
```

* настроить плагины

```xml
<!-- Сборка -->
<build>
    <!-- Плагины -->
    <plugins>
        <!-- maven-surefire-plugin -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>${maven-surefire-plugin}</version>
        </plugin>
        <!-- maven-compiler-plugin -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-compiler-plugin</artifactId>
            <version>${maven-compiler-plugin}</version>
            <configuration>
                <source>${source}</source>
                <target>${target}</target>
            </configuration>
        </plugin>
    </plugins>
</build>
```

3. Настроить файл **.gitignore** в корне проекта.
   
Не должно быть: 

- файлов *IntelliJ IDEA*
- файлов *VS Code*
- файлов компиляции *Java*

4. Настроить файл для логгирования **log4j2.xml** в папке **./src/main/resources**.

```xml
<Configuration monitorInterval="30">
    <Appenders>
        <Console name="Console" target="SYSTEM_OUT">
            <PatternLayout pattern="%highlight{[%d{HH:mm:ss.SSS}] | %-5p | %-32.42t | %-32.42c{1} | %m%n}{FATAL=red blink, ERROR=red blink, WARN=yellow bold, INFO=black, DEBUG=green bold, TRACE=blue}"/>
        </Console>
        <File name="MyFile" fileName="logs.log">
            <PatternLayout>
                <Pattern>%d %p %c{1.} [%t] %m%n</Pattern>
            </PatternLayout>
        </File>
    </Appenders>
    <Loggers>
        <Root level="info">
            <AppenderRef ref="Console"/>
            <AppenderRef ref="MyFile"/>
        </Root>
    </Loggers>
</Configuration>
```

5. Закоммитить и запушить проект в репозиторий.

***

# 2. WebDriverFactory

Шаги: 

1. Создать пакет Java **webdriverfactory** в папке **./src/test/java**. 

![New Maven Project - webdriverfactory](./_Files/2.%20New%20Project/01.jpg "New Project - webdriverfactory")

2. Создать перечисление **BrowserName.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - BrowserName.java](./_Files/2.%20New%20Project/02.jpg "New Project - BrowserName.java")

3. Добавить в файл **BrowserName.java** код.

* константы, определяющие названия браузеров

```java
CHROME("chrome"),   // Google Chrome
FIREFOX("firefox"), // Mozilla Firefox
EDGE("edge");       // Microsoft Edge
```

* переменная для хранения строкового значения константы

```java
private String browserName; // Имя браузера
```

* приватный конструктор

```java
// Приватный конструктор
private BrowserName(String browserName) {
    this.browserName = browserName;
}
```

* переопределенный метод **toString**

```java
// Переопределенный метод 
@Override
public String toString() {
    return String.valueOf(this.browserName);
}
```

* метод **fromString** - возврат значения константы по строковому значению константы

```java
// Возврат значения константы по строковому значению константы
public static BrowserName fromString(String browserName) {
    if (browserName != null) {
        for(Browser b : Browser.values()) {
            if (browserName.equalsIgnoreCase(b.browserName)) {
                return b;
            }
        }
    }
    return null;
}
```

4. Создать класс **ChromeBrowser.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - ChromeBrowser.java](./_Files/2.%20New%20Project/03.jpg "New Project - ChromeBrowser.java")

5. Добавить в файл **ChromeBrowser.java** код.

* метод **getDriver** - получение экземпляра драйвера браузера **Google Chrome**

```java
// Получение экземпляра драйвера браузера "Google Chrome"
public WebDriver getDriver() {
    // Настройка файла драйвера
    WebDriverManager.chromedriver().setup();
    // Опции драйвера:
    ChromeOptions options = new ChromeOptions();
    // - поведение при появлении алертов "Игнорирование"
    options.setCapability(CapabilityType.UNEXPECTED_ALERT_BEHAVIOUR, UnexpectedAlertBehaviour.IGNORE);
    // - стратегия загрузки страницы "NORMAL"
    options.setCapability(CapabilityType.PAGE_LOAD_STRATEGY, PageLoadStrategy.NORMAL);
    // - режим "Инкогнито"
    options.addArguments("--incognito");
    // - режим "Полный экран"
    options.addArguments("--start-fullscreen");
    // Новый экземпляр драйвера
    return new ChromeDriver(options);
}
```

6. Создать класс **FirefoxBrowser.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - FirefoxBrowser.java](./_Files/2.%20New%20Project/04.jpg "New Project - FirefoxBrowser.java")

7. Добавить в файл **FirefoxBrowser.java** код.

* метод **getDriver** - получение экземпляра драйвера браузера **Mozilla Firefox**

```java
// Получение экземпляра драйвера браузера "Mozilla Firefox"
public static WebDriver getDriver() {
    // Настройка файла драйвера
    WebDriverManager.firefoxdriver().setup();
    // Опции драйвера:
    FirefoxOptions options = new FirefoxOptions();
    // - поведение при появлении алертов "Игнорирование"
    options.setCapability(CapabilityType.UNEXPECTED_ALERT_BEHAVIOUR, UnexpectedAlertBehaviour.IGNORE);
    // - стратегия загрузки страницы "NORMAL"
    options.setCapability(CapabilityType.PAGE_LOAD_STRATEGY, PageLoadStrategy.NORMAL);
    // - режим "Инкогнито"
    options.addArguments("-private");
    // - режим "Полный экран"
    options.addArguments("-kiosk");
    // Новый экземпляр драйвера
    return new FirefoxDriver(options);
}
```

8. Создать класс **EdgeDriver.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - EdgeDriver.java](./_Files/2.%20New%20Project/05.jpg "New Project - EdgeDriver.java")

9. Добавить в файл **EdgeDriver.java** код.

* метод **getDriver** - получение экземпляра драйвера браузера **Microsoft Edge**

```java
// Получение экземпляра драйвера браузера "Microsoft Edge"
public static WebDriver getDriver() {
    // Настройка файла драйвера
    WebDriverManager.firefoxdriver().setup();
    // Опции драйвера:
    EdgeOptions options = new EdgeOptions();
    // - поведение при появлении алертов "Игнорирование"
    options.setCapability(CapabilityType.UNEXPECTED_ALERT_BEHAVIOUR, UnexpectedAlertBehaviour.IGNORE);
    // - стратегия загрузки страницы "NORMAL"
    options.setCapability(CapabilityType.PAGE_LOAD_STRATEGY, PageLoadStrategy.NORMAL);
    // - режим "Инкогнито"
    options.addArguments("--incognito");
    // - режим "Полный экран"
    options.addArguments("--start-fullscreen");
    // Новый экземпляр драйвера
    return new EdgeDriver(options);
}
```

10. Создать класс **WebDriverFactory.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - WebDriverFactory.java](./_Files/2.%20New%20Project/06.jpg "New Project - WebDriverFactory.java")

11. Добавить в файл **WebDriverFactory.java** код.

* метод **create** - получение экземпляра драйвера по имени

```java
// Получение экземпляра драйвера по имени
public static WebDriver create(String name) {
    switch (BrowserName.fromString(name)) {
        // Драйвер браузера Google Chrome
        case CHROME:
            logger.info("Драйвер браузера Google Chrome");
            ChromeBrowser.getDriver();
        // Драйвер браузера Mozilla Firefox
        case FIREFOX:
            logger.info("Драйвер браузера Mozilla Firefox");
            FirefoxBrowser.getDriver();
        // Драйвер браузера Microsoft Edge
        case EDGE:
            logger.info("Драйвер браузера Microsoft Edge");
            EdgeBrowser.getDriver();
        // По умолчанию
        default:
            throw new RuntimeException("Некорректное наименование браузера");
    }
}
```

# 3. Page Object

Шаги:

1. Создать пакет Java **pages** в папке **./src/test/java**.

![New Maven Project - webdriverfactory](./_Files/2.%20New%20Project/01.jpg "New Project - webdriverfactory")



***

Задание [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](3.%20Задание.md)