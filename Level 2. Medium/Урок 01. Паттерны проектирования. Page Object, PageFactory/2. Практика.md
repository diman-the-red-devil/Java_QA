Java_QA / Level 2. Medium - Продвинутые темы / Урок 02. Page Object, PageFactory

[![Назад](https://img.shields.io/badge/-%D0%9D%D0%B0%D0%B7%D0%B0%D0%B4-brightgreen)](1.%20Лекция.md)
[![Содержание](https://img.shields.io/badge/-%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5-purple)](README.md)
[![Вперед](https://img.shields.io/badge/-%D0%92%D0%BF%D0%B5%D1%80%D0%B5%D0%B4-brightgreen)](3.%20Задание.md)

***

# 1. Создание и настройка нового проекта

Шаги:

1. Создать новый проект **Maven** в **IntelliJ IDEA**.

2. Сконфигурировать файл **POM.xml**
   
* настроить кодировку проекта - **UTF-8**
  
```xml
<!-- Параметры -->
<properties>
    <!-- Кодировка проекта - UTF-8 -->
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
</properties>
```

* настроить версию Java - **15** или на ваше усмотрение

```xml
<!-- Параметры -->
<properties>
    <!-- Кодировка проекта - UTF-8 -->
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
    <!-- Версия Java - 15 -->
    <source>15</source>
    <target>15</target>
</properties>
```

* прописать версии библиотек
  
```xml
<!-- Параметры -->
<properties>
    <!-- Кодировка проекта - UTF-8 -->
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
    <!-- Версия Java - 15 -->
    <source>15</source>
    <target>15</target>
    <!-- Версии зависимостей -->
    <junit-jupiter-engine>5.1.0</junit-jupiter-engine>
    <selenium-java>4.0.0-beta-4</selenium-java>
    <webdrivermanager>4.4.3</webdrivermanager>
    <log4j-api>2.14.0</log4j-api>
    <log4j-core>2.14.0</log4j-core>
</properties>
```

* прописать версии плагинов

```xml
<!-- Параметры -->
<properties>
    <!-- Кодировка проекта - UTF-8 -->
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
    <!-- Версия Java - 15 -->
    <source>15</source>
    <target>15</target>
    <!-- Версии зависимостей -->
    <junit-jupiter-engine>5.1.0</junit-jupiter-engine>
    <selenium-java>4.0.0-beta-4</selenium-java>
    <webdrivermanager>4.2.2</webdrivermanager>
    <log4j-api>2.14.0</log4j-api>
    <log4j-core>2.14.0</log4j-core>
    <ashot>1.5.4</ashot>
    <!-- Версии плагинов -->
    <maven-surefire-plugin>2.22.2</maven-surefire-plugin>
    <maven-compiler-plugin>3.8.1</maven-compiler-plugin>
</properties>
```

* добавить зависимости

```xml
<!-- Зависимости -->
<dependencies>
    <!-- JUnit -->
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-engine</artifactId>
        <version>${junit-jupiter-engine}</version>
        <scope>test</scope>
    </dependency>
    <!-- Selenium WebDriver -->
    <dependency>
        <groupId>org.seleniumhq.selenium</groupId>
        <artifactId>selenium-java</artifactId>
        <version>${selenium-java}</version>
        <scope>test</scope>
    </dependency>
    <!-- WebDriver Manager -->
    <dependency>
        <groupId>io.github.bonigarcia</groupId>
        <artifactId>webdrivermanager</artifactId>
        <version>${webdrivermanager}</version>
        <scope>test</scope>
    </dependency>
    <!-- Log4J -->
    <dependency>
        <groupId>org.apache.logging.log4j</groupId>
        <artifactId>log4j-api</artifactId>
        <version>${log4j-api}</version>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>org.apache.logging.log4j</groupId>
        <artifactId>log4j-core</artifactId>
        <version>${log4j-core}</version>
        <scope>test</scope>
    </dependency>
    <!-- aShot -->
    <dependency>
        <groupId>ru.yandex.qatools.ashot</groupId>
        <artifactId>ashot</artifactId>
        <version>${ashot}</version>
        <scope>test</scope>
    </dependency>
</dependencies>
```

* настроить плагины

```xml
<!-- Сборка -->
<build>
    <!-- Плагины -->
    <plugins>
        <!-- maven-surefire-plugin -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>${maven-surefire-plugin}</version>
        </plugin>
        <!-- maven-compiler-plugin -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-compiler-plugin</artifactId>
            <version>${maven-compiler-plugin}</version>
            <configuration>
                <source>${source}</source>
                <target>${target}</target>
            </configuration>
        </plugin>
    </plugins>
</build>
```

3. Настроить файл **.gitignore** в корне проекта.
   
Не должно быть: 

- файлов *IntelliJ IDEA*
- файлов *VS Code*
- файлов компиляции *Java*

4. Настроить файл для логгирования **log4j2.xml** в папке **./src/main/resources**.

```xml
<Configuration monitorInterval="30">
    <Appenders>
        <Console name="Console" target="SYSTEM_OUT">
            <PatternLayout pattern="%highlight{[%d{HH:mm:ss.SSS}] | %-5p | %-32.42t | %-32.42c{1} | %m%n}{FATAL=red blink, ERROR=red blink, WARN=yellow bold, INFO=black, DEBUG=green bold, TRACE=blue}"/>
        </Console>
        <File name="MyFile" fileName="logs.log">
            <PatternLayout>
                <Pattern>%d %p %c{1.} [%t] %m%n</Pattern>
            </PatternLayout>
        </File>
    </Appenders>
    <Loggers>
        <Root level="info">
            <AppenderRef ref="Console"/>
            <AppenderRef ref="MyFile"/>
        </Root>
    </Loggers>
</Configuration>
```

5. Закоммитить и запушить проект в репозиторий.

***

# 2. WebDriverFactory

Шаги: 

1. Создать пакет Java **webdriverfactory** в папке **./src/test/java**. 

![New Maven Project - webdriverfactory](./_Files/2.%20New%20Project/01.jpg "New Project - webdriverfactory")

2. Создать перечисление **BrowserName.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - BrowserName.java](./_Files/2.%20New%20Project/02.jpg "New Project - BrowserName.java")

3. Добавить в файл **BrowserName.java** код.

* константы, определяющие названия браузеров

```java
CHROME("chrome"),   // Google Chrome
FIREFOX("firefox"), // Mozilla Firefox
EDGE("edge");       // Microsoft Edge
```

* переменная для хранения строкового значения константы

```java
private String browserName; // Имя браузера
```

* приватный конструктор

```java
// Приватный конструктор
private BrowserName(String browserName) {
    this.browserName = browserName;
}
```

* переопределенный метод **toString**

```java
// Переопределенный метод 
@Override
public String toString() {
    return String.valueOf(this.browserName);
}
```

* метод **fromString** - возврат значения константы по строковому значению константы

```java
// Возврат значения константы по строковому значению константы
public static BrowserName fromString(String browserName) {
    if (browserName != null) {
        for(Browser b : Browser.values()) {
            if (browserName.equalsIgnoreCase(b.browserName)) {
                return b;
            }
        }
    }
    return null;
}
```

4. Создать класс **ChromeBrowser.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - ChromeBrowser.java](./_Files/2.%20New%20Project/03.jpg "New Project - ChromeBrowser.java")

5. Добавить в файл **ChromeBrowser.java** код.

* метод **getDriver** - получение экземпляра драйвера браузера **Google Chrome**

```java
// Получение экземпляра драйвера браузера "Google Chrome"
public WebDriver getDriver() {
    // Настройка файла драйвера
    WebDriverManager.chromedriver().setup();
    // Опции драйвера:
    ChromeOptions options = new ChromeOptions();
    // - поведение при появлении алертов "Игнорирование"
    options.setCapability(CapabilityType.UNEXPECTED_ALERT_BEHAVIOUR, UnexpectedAlertBehaviour.IGNORE);
    // - стратегия загрузки страницы "NORMAL"
    options.setCapability(CapabilityType.PAGE_LOAD_STRATEGY, PageLoadStrategy.NORMAL);
    // - режим "Инкогнито"
    options.addArguments("--incognito");
    // - режим "Полный экран"
    options.addArguments("--start-fullscreen");
    // Новый экземпляр драйвера
    return new ChromeDriver(options);
}
```

6. Создать класс **FirefoxBrowser.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - FirefoxBrowser.java](./_Files/2.%20New%20Project/04.jpg "New Project - FirefoxBrowser.java")

7. Добавить в файл **FirefoxBrowser.java** код.

* метод **getDriver** - получение экземпляра драйвера браузера **Mozilla Firefox**

```java
// Получение экземпляра драйвера браузера "Mozilla Firefox"
public static WebDriver getDriver() {
    // Настройка файла драйвера
    WebDriverManager.firefoxdriver().setup();
    // Опции драйвера:
    FirefoxOptions options = new FirefoxOptions();
    // - поведение при появлении алертов "Игнорирование"
    options.setCapability(CapabilityType.UNEXPECTED_ALERT_BEHAVIOUR, UnexpectedAlertBehaviour.IGNORE);
    // - стратегия загрузки страницы "NORMAL"
    options.setCapability(CapabilityType.PAGE_LOAD_STRATEGY, PageLoadStrategy.NORMAL);
    // - режим "Инкогнито"
    options.addArguments("-private");
    // - режим "Полный экран"
    options.addArguments("-kiosk");
    // Новый экземпляр драйвера
    return new FirefoxDriver(options);
}
```

8. Создать класс **EdgeBrowser.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - EdgeBrowser.java](./_Files/2.%20New%20Project/05.jpg "New Project - EdgeBrowser.java")

9. Добавить в файл **EdgeBrowser.java** код.

* метод **getDriver** - получение экземпляра драйвера браузера **Microsoft Edge**

```java
// Получение экземпляра драйвера браузера "Microsoft Edge"
public static WebDriver getDriver() {
    // Настройка файла драйвера
    WebDriverManager.edgedriver().setup();
    // Опции драйвера:
    EdgeOptions options = new EdgeOptions();
    // - поведение при появлении алертов "Игнорирование"
    options.setCapability(CapabilityType.UNEXPECTED_ALERT_BEHAVIOUR, UnexpectedAlertBehaviour.IGNORE);
    // - стратегия загрузки страницы "NORMAL"
    options.setCapability(CapabilityType.PAGE_LOAD_STRATEGY, PageLoadStrategy.NORMAL);
    // - режим "Инкогнито"
    options.addArguments("--incognito");
    // - режим "Полный экран"
    options.addArguments("--start-fullscreen");
    // Новый экземпляр драйвера
    return new EdgeDriver(options);
}
```

10. Создать класс **WebDriverFactory.java** в **./src/test/java/webdriverfactory**.

![New Maven Project - WebDriverFactory.java](./_Files/2.%20New%20Project/06.jpg "New Project - WebDriverFactory.java")

11. Добавить в файл **WebDriverFactory.java** код.

* объявление логгера

```java
// Логгер
    private static Logger logger = LogManager.getLogger(WebDriverFactory.class);
```

* метод **getDriver** - получение экземпляра драйвера по имени

```java
// Получение экземпляра драйвера по имени
public static WebDriver getDriver(String name) {
    switch (BrowserName.fromString(name)) {
        // Драйвер браузера Google Chrome
        case CHROME:
            logger.info("Драйвер браузера Google Chrome");
            ChromeBrowser.getDriver();
        // Драйвер браузера Mozilla Firefox
        case FIREFOX:
            logger.info("Драйвер браузера Mozilla Firefox");
            FirefoxBrowser.getDriver();
        // Драйвер браузера Microsoft Edge
        case EDGE:
            logger.info("Драйвер браузера Microsoft Edge");
            EdgeBrowser.getDriver();
        // По умолчанию
        default:
            throw new RuntimeException("Некорректное наименование браузера");
    }
}
```

***

# 3. Page Object

Шаги:

1. Создать пакет Java **pageobjects** в папке **./src/test/java**.

![New Maven Project - pageobjects](./_Files/2.%20New%20Project/07.jpg "New Project - pageobjects")

2. Создать класс **BasePage.java** в **./src/test/java/pageobjects**.

![New Maven Project - BasePage.java](./_Files/2.%20New%20Project/08.jpg "New Project - BasePage.java")

3. Добавить в файл **BasePage.java** код.

* объявление драйвера

```java
// Драйвер браузера
protected static WebDriver driver;
```

* конструктор базового класса

```java
// Конструктор базового класса 
public BasePage(WebDriver driver) {
    this.driver = driver;
}
```

4. Создать класс **WaitFor.java** в **./src/test/java/pageobjects**.

![New Maven Project - WaitFor.java](./_Files/2.%20New%20Project/09.jpg "New Project - WaitFor.java")

5. Добавить в файл **WaitFor.java** код.

* объявление ожидания драйвера браузера

```java
// Ожидание драйвера браузера
protected static WebDriverWait wait;
```

* **initWait** - метод настройки ожидания

```java
// Установка таймаута ожидания и интервала опроса
public static void initWait(WebDriver driver, Duration timeOut, Duration sleep) {
    wait = new WebDriverWait(driver, timeOut, sleep);
}
```

* методы ожиданий

```java
// Ожидание появления текста в элементе
public static void textToBePresentInElement(WebElement webElement, String text) {
    wait.until(ExpectedConditions.textToBePresentInElement(webElement, text));
}

// Ожидание кликабельности элемента
public static void elementToBeClickable(WebElement webElement) {
    wait.until(ExpectedConditions.elementToBeClickable(webElement));
}

// Ожидание кликабельности элемента
public static void elementToBeClickable(By webElement) {
    wait.until(ExpectedConditions.elementToBeClickable(webElement));
}

// Ожидание видимости элемента
public static void visibilityOfElement(WebElement webElement) {
    wait.until(ExpectedConditions.visibilityOf(webElement));
}
```

6. Создать класс **StartPage.java** в **./src/test/java/pageobjects** - объект Стартовой страницы DNS.

![New Maven Project - StartPage.java](./_Files/2.%20New%20Project/09.jpg "New Project - StartPage.java")

7. Добавить в файл **StartPage.java** код.

* объявление логгера

```java
// Логгер
private Logger logger = LogManager.getLogger(StartPage.class);
```

* константа хранящая URL Стартовой страницы DNS

```java
// URL страницы 
private final String URL = "https://www.dns-shop.ru/";
```

* конструктор класса

```java
// Конструктор класса
public StartPage(WebDriver driver) {
    super(driver);
}
```

* **getURL** - метод получения URL страницы

```java
// Получение URL страницы
public String getURL() {
    return this.URL;
}
```

* локаторы веб элементов страницы

```java
// Кнопка "Да" на всплывашке
By linkYesXpath = By.xpath("//a[contains(text(),\"Да\")]");
// Ссылка "Смартфоны и гаджеты"
By linkSmartsAndGadgetsXpath = By.xpath("(//a[contains(text(), \"Смартфоны и гаджеты\")])[1]");
// Ссылка "Смартфоны"
By linkSmartsXpath = By.xpath("(//a[contains(text(), \"Смартфоны и гаджеты\")])[2]/following::div/a");
```

* **openPage** - метод открытия страницы в браузере

```java
// Открытие страницы в браузере
public void openPage() {
    driver.get(this.URL);
}
```

* **linkYesClick** - метод нажатия на кнопку "Да"

```java
// Нажатие на кнопку "Да"
public void linkYesClick() {
    WebElement linkYes = driver.findElement(linkYesXpath);
    linkYes.click();
}
```

* **linkSmartsAndGadgetsClick** - метод нажатия на ссылку "Смартфоны и гаджеты"

```java
// Нажатие на ссылку "Смартфоны и гаджеты"
public void linkSmartsAndGadgetsClick() {
    WebElement linkSmartsAndGadgets = driver.findElement(linkSmartsAndGadgetsXpath);
    linkSmartsAndGadgets.click();
}
```

* **linkSmartsClick** - метод нажатия на ссылку "Смартфоны"

```java
// Нажатие на ссылку "Смартфоны"
public void linkSmartsClick() {
    WebElement linkSmarts = driver.findElement(linkSmartsXpath);
    linkSmarts.click();
}
```

8. Создать класс **SmartphonesPage.java** в **./src/test/java/pageobjects** - объект страницы **Смартфоны**.

![New Maven Project - SmartphonesPage.java](./_Files/2.%20New%20Project/10.jpg "New Project - SmartphonesPage.java")

9. Добавить в файл **SmartphonesPage.java** код.

* объявление логгера

```java
// Логгер
private Logger logger = LogManager.getLogger(SmartphonesPage.class);
```

* конструктор класса

```java
// Конструктор класса
public SmartphonesPage(WebDriver driver) {
    super(driver);
}
```

* локаторы веб элементов страницы

```java
// ***** Фильтры *****
// # Фильтр "Производитель"
// Флажок "Samsung"
By chbxSamsungXpath = By.xpath("//span[contains(text(), \"Samsung\")]");
// # Фильтр "Объем оперативной памяти"
// Гармошка "Объем оперативной памяти"
By showRAMXpath = By.xpath("//div[@class=\"ui-list-controls ui-collapse ui-collapse_list\"]//span[contains(text(), \"Объем оперативной памяти\")]");
// Флажок "8 Гб"
By chbxRAM8GbXpath = By.xpath("//span[contains(text(), \"8 Гб\")]");
// ***** Сортировка *****
// Блок "Сортировка"
By showSortXpath = By.xpath("//span[contains(text(), \"Сортировка:\")]/following::a");
// Переключатель "Сначала дорогие"
By rbtnExpensiveXpath = By.xpath("//span[contains(text(), \"Сначала дорогие\")]");
// ***** Смартфоны *****
// Ссылка на продукт
By linkProductXpath = By.xpath("(//div[@data-id=\"product\"])[1]//a[@class=\"catalog-product__name ui-link ui-link_black\"]");
```

* **chbxSamsungClick** - метод нажатия на флажок "Samsung"

```java
// Нажатие на флажок "Samsung"
public void chbxSamsungClick() {
    WaitFor.presenceOfElementLocated(chbxSamsungXpath);
    WebElement chbxSamsung = driver.findElement(chbxSamsungXpath);
    WaitFor.elementToBeClickable(chbxSamsung);
    chbxSamsung.click();
}
```

* **showRAMClick** - метод нажатия на гармошку "Объем оперативной памяти"

```java
// Нажатие на гармошку "Объем оперативной памяти"
public void showRAMClick() {
    WaitFor.presenceOfElementLocated(showRAMXpath);
    WebElement showRAM = driver.findElement(showRAMXpath);
    WaitFor.elementToBeClickable(showRAM);
    showRAM.click();
}
```

* **chbxRAM8GbClick** - метод нажатия на флажок "8 Гб"

```java
// Нажатие на флажок "8 Гб"
public void chbxRAM8GbClick() {
    WaitFor.presenceOfElementLocated(chbxRAM8GbXpath);
    WebElement chbxRAM8Gb = driver.findElement(chbxRAM8GbXpath);
    WaitFor.elementToBeClickable(chbxRAM8Gb);
    chbxRAM8Gb.click();
}
```

* **showSortClick** - метод нажатия на выпадашку "Сортировка"

```java
// Нажатие на выпадашку "Сортировка"
public void showSortClick() {
    WaitFor.presenceOfElementLocated(showSortXpath);
    WebElement showSort = driver.findElement(showSortXpath);
    WaitFor.elementToBeClickable(showSort);
    showSort.click();
}
```

* **rbtnExpensiveClick** - метод нажатия на переключатель "Сначала дорогие"

```java
// Нажатие на переключатель "Сначала дорогие"
public void rbtnExpensiveClick() {
    WaitFor.presenceOfElementLocated(rbtnExpensiveXpath);
    WebElement rbtnExpensive = driver.findElement(rbtnExpensiveXpath);
    WaitFor.elementToBeClickable(rbtnExpensive);
    rbtnExpensive.click();
}
```

* **linkProductClick** - метод нажатия на ссылку на продукт

```java
// Нажатие на ссылку на продукт
public void linkProductClick() {
    WaitFor.presenceOfElementLocated(linkProductXpath);
    WebElement linkProduct = driver.findElement(linkProductXpath);
    WaitFor.elementToBeClickable(linkProduct);
    linkProduct.click();
}
```

***

# 4. Тесты

Шаги:

1. Создать пакет Java **tests** в папке **./src/test/java**.

![New Maven Project - tests](./_Files/2.%20New%20Project/11.jpg "New Project - tests")

2. Создать класс **BaseTest.java** в **./src/test/java/tests**.

![New Maven Project - BaseTest.java](./_Files/2.%20New%20Project/12.jpg "New Project - BaseTest.java")

3. Добавить в файл **BaseTest.java** код.

* объявление драйвера

```java
// Драйвер браузера
protected static WebDriver driver;
```

* объявление логгера

```java
// Логгер
private Logger logger = LogManager.getLogger(BaseTest.class);
```

* **setUp** - действия перед каждым тестом (аннотация **@BeforeEach**)

```java
// Перед каждым тестом
@BeforeEach
public void setUp() {
    // Получаем параметр запуска тестов через Maven -Dbrowser
    String env = System.getProperty("browser", "chrome");
    // Получаем экзмепляр драйвера браузера
    driver = WebDriverFactory.getDriver(env.toLowerCase());
    logger.info("Драйвер стартовал!");
}
```

* **setUp** - действия после каждого теста (аннотация **@AfterEach**)

```java
// После каждого теста
@AfterEach
public void setDown() {
    // Если драйвер еще существует
    if(driver != null) {
        // Закрываем его
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```


4. Создать класс **SmartphonesTest.java** в **./src/test/java/tests**.

![New Maven Project - SmartphonesTest.java](./_Files/2.%20New%20Project/13.jpg "New Project - SmartphonesTest.java")

5. Добавить в файл **SmartphonesTest.java** код.

* объявление драйвера

```java
// Драйвер браузера
protected static WebDriver driver;
```

***

Задание [![Перейти](https://img.shields.io/badge/-%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8-blue)](3.%20Задание.md)