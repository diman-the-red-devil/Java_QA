Java_QA / 09. Selenium WebDriver. Нестандартные задачи

[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Практика](https://img.shields.io/badge/-Практика-aaffaa)](2.%20Практика.md)

***

# Содержание

* [1. Нестандартные задачи](#1-нестандартные-задачи)
  * [1.1. Какие нестандартные задачи бывают?](#11-какие-нестандартные-задачи-бывают)
  * [1.2. Каким образом можно решить нестандартные задачи?](#12-каким-образом-можно-решить-нестандартные-задачи)
* [2. Классы и интерфейсы Selenium WebDriver](#2-Классы-и-интерфейсы-Selenium-WebDriver)
* [3. Стандартные команды Selenium](#3-стандартные-команды-selenium)
  * [3.1. Класс WebDriver](#31-класс-webdriver)
    * [3.1.1. Авторизация BasicAuth](#311-авторизация-basicauth)
  * [3.2. Класс WebElement](#32-класс-webelement)
    * [3.2.1. Отправление файла](#321-отправление-файла)
* [4. Цвета](#4-цвета)
  * [4.1. Класс Color](#41-класс-color)
    * [4.1.1. Проверка цвета веб элемента](#411-проверка-цвета-веб-элемента)
  * [4.2. Перечисление Colors](#42-перечисление-colors)
* [5. Печать страницы в PDF](#5-печать-страницы-в-pdf)
  * [5.1. Интерфейс PrintsPage](#51-интерфейс-printspage)
    * [5.1.1. Печать страницы в PDF в формате Base64](#511-печать-страницы-в-pdf-в-формате-base64)
    * [5.1.2. Печать страницы в PDF в файл](#512-печать-страницы-в-pdf-в-файл)
  * [5.2. Интерфейс Pdf](#52-интерфейс-pdf)
  * [5.3. Класс PrintOptions](#53-класс-printoptions)
  * [5.4. Перечисление PrintOptions.Orientation](#54-перечисление-printoptionsorientation)
  * [5.5. Класс PageMargin](#55-класс-pagemargin)
  * [5.6. Класс PageSize](#56-класс-pagesize)
* [6. Веб хранилище](#6-веб-хранилище)
  * [6.1. Интерфейс WebStorage](#61-интерфейс-webstorage)
  * [6.2. Интерфейс LocalStorage](#62-интерфейс-localstorage)
    * [6.2.1. Работа с локальным хранилищем](#621-работа-с-локальным-хранилищем)
  * [6.3. Интерфейс SessionStorage](#63-интерфейс-sessionstorage)
    * [6.3.1. Работа с сессионным хранилищем](#631-работа-с-сессионным-хранилищем)
* [7. Выполнение JS скрипта](#7-выполнение-js-скрипта)
  * [7.1. Интерфейс JavascriptExecutor](#71-интерфейс-javascriptexecutor)
    * [7.1.1. Клик на веб элемент](#711-клик-на-веб-элемент)
    * [7.1.2. Получение текста веб элемента](#712-получение-текста-веб-элемента)
    * [7.1.3. Скроллинг страницы](#713-скроллинг-страницы)
    * [7.1.4. Отображение скрытых элементов](#714-отображение-скрытых-элементов)
    * [7.1.5. Задание цвета](#715-задание-цвета)
  * [7.2. Исключения](#72-исключения)
    * [7.2.1. JavascriptException](#721-javascriptexception)
      * [7.2.1.1. Причины](#7211-причины)
      * [7.2.1.2. Решения](#7212-решения)
* [8. Использование DevTools](#8-использование-devtools)
  * [8.1. Класс DevTools](#81-класс-devtools)
  * [8.2. Chrome DevTools Protocol](#82-chrome-devtools-protocol)
  * [8.3. Browser](#83-browser)
    * [8.3.1. Предоставление прав браузеру на выполнение операций](#831-предоставление-прав-браузеру-на-выполнение-операций)
    * [8.3.2. Получение данных о браузере](#832-получение-данных-о-браузере)
  * [8.4. Emulation](#84-emulation)
    * [8.4.1. Установка параметров эмулируемого устройства](#841-установка-параметров-эмулируемого-устройства)
    * [8.4.2. Установка геолокации](#842-установка-геолокации)
  * [8.5. Log](#85-log)
    * [8.5.1. Вывод логов](#851-вывод-логов)
  * [8.6. Performance](#86-performance)
    * [8.6.1. Сбор метрик](#861-сбор-метрик)
  * [8.7. Fetch](#87-fetch)
    * [8.7.1. Перехват и модификация запросов](#871-перехват-и-модификация-запросов)
  * [8.8. Network](#88-network)
    * [8.8.1. Эмуляция интернет соединения](#881-эмуляция-интернет-соединения)
    * [8.8.2. Добавление заголовков в запросы](#882-добавление-заголовков-в-запросы)
    * [8.8.3. Перехват HTTP запроса](#883-перехват-http-запроса)
    * [8.8.4. Авторизация Basic Authentication](#884-авторизация-basic-authentication)
* [9. Сторонние либы](#9-сторонние-либы)
* [10. Работа с файлами формата PDF](#10-работа-с-файлами-формата-pdf)
  * [10.1. Библиотека Apache PdfBox](#101-библиотека-apache-pdfbox)
    * [10.1.1. Извлечение текста из документа PDF](#1011-извлечение-текста-из-документа-pdf)
  * [10.2. Библиотека iText](#102-библиотека-itext)
    * [10.2.1. Извлечение текста из документа PDF](#1021-извлечение-текста-из-документа-pdf)
* [11. Работа с файлами формата Excel](#11-работа-с-файлами-формата-excel)
  * [11.1. Библиотека Apache POI для работы с файлами Excel](#111-библиотека-apache-poi-для-работы-с-файлами-excel)

***

# 1. Нестандартные задачи

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

## 1.1. Какие нестандартные задачи бывают?

Кроме обычного взаимодействия с UI (нажатие кнопок, переход по ссылкам и т д) 
в автоматизации тестирования встречаются много других интересных задач.

К ним можно отнести:

* отправка и сохранение файла
* авторизация BasicAuth
* отображение скрытых веб элементов страницы
* изменение параметров веб элементов страницы
* сравнение изображений страницы
* работа с разного типа файлами (.pdf, .xls)
* работа с веб хранилищем  
* эмуляция геолокации

и т д

## 1.2. Каким образом можно решить нестандартные задачи?

Нестандартные задачи можно решить несколькими способами:

* с помощью классов и интерфейсов **Selenium WebDriver**
* c помощью выполнения скрипта на **JavaScript**
* c помощью возможностей предоставляемых **DevTools**
* с помощью сторонних либ

***

# 2. Классы и интерфейсы Selenium WebDriver

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

В **Selenium WebDriver** существуют классы для

* представления цветов
* печати страницы в PDF
* работы с веб хранилищем
* представления геолокации

***

# 3. Стандартные команды Selenium

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

## 3.1. Класс WebDriver

### 3.1.1. Авторизация BasicAuth

***BasicAuth (Basic авторизация)*** - самый простой способ ограничения доступа к веб-приложениям и документам,
предусмотренный стандартом протокола HTTP. При попытке обращения к таким ресурсам браузер формирует диалоговое окно,
в котором предлагается ввести свой логин и пароль,
после чего запрос выполняется повторно с предоставлением серверу данных для идентификации.

Cайты, использующие **BasicAuth**, встречаются нечасто, чаще это веб-приложения,
используемые для административных или корпоративных целей.

Основная проблема при тестировании таких приложений это нативные диалоговые окна, при появлении которых,
также как и алертов, дальнейшее управление браузером с помощью Selenium становится просто невозможным.

Одним из способов избежать появления диалогового окна может быть использование
специального URL формата **http://username:password@example.com/** для передачи учетных данных.
Эта конструкция все еще поддерживается некоторыми браузерами, однако такое решение является официально устаревшим и
иногда может отрицательно влиять на корректное выполнение дальнейших запросов на странице.

*Пример*

```java
driver.get("https://<username>:<password>@www.example.com/index.html");
```

## 3.2. Класс WebElement

### 3.2.1. Отправление файла

Отправление (upload) файла обычно является довольно простой задачей.
Она сводится к нахождению input элемента с атрибутом **type = "file"**.
Далее нужно ввести путь к файлу и нажать кнопку **submit**.

*Пример*

```java
WebElement element = driver.findElement(By.id("upload"));
element.sendKeys("/image.png");
```

***

# 4. Цвета

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

***Цветовая модель*** — математическая модель описания представления цветов в виде кортежей чисел 
(обычно из трёх, реже — четырёх значений), называемых цветовыми компонентами или цветовыми координатами. 
Все возможные значения цветов, задаваемые моделью, определяют **цветовое пространство**.

***RGB (red, green, blue — красный, зелёный, синий) или КЗС*** — аддитивная цветовая модель, 
описывающая способ кодирования цвета для цветовоспроизведения с помощью трёх цветов, которые принято называть основными. 
Выбор основных цветов обусловлен особенностями физиологии восприятия цвета сетчаткой человеческого глаза.

**RGB**-модель является аддитивной, где цвета получаются путём добавления к чёрному цвету. 
При отсутствии излучения — нет никакого цвета — чёрный, смешение всех трёх в определённой пропорции — даёт белый.

Изображение в данной цветовой модели состоит из трёх каналов. 
При смешении основных излучений, например, 
* синего (B) и красного (R), получается пурпурный (M, magenta), 
* зелёного (G) и красного (R) — жёлтый (Y, yellow), 
* зелёного (G) и синего (B) — циановый (С, cyan). 
При смешении всех трёх основных излучений получается белый цвет (W, white).

*Пример*

```text
255,255,255
0,0,0
```

***RGBA (red, green, blue, alpha — красный, зеленый, синий + альфа-канал)*** - трехканальная цветовая модель **RGB**,
дополненная четвертым альфа-каналом. Альфа указывает, насколько непрозрачен каждый пиксель, и позволяет комбинировать изображение с другими,
используя альфа-композицию, с прозрачными областями и сглаживанием краев непрозрачных областей.

*Пример*

```text
255,255,255,0
0,0,0,1
```

***HEX*** - представление цвета в виде трёх пар шестнадцатеричных цифр, где каждая пара отвечает за свой цвет:
* две первые цифры — *красный*
* две в середине — *зелёный*
* две последние цифры — *синий*

*Пример*

```text
#FFFFFF
#000000
```

## 4.1. Класс Color

***Color*** - класс представляющий цвет.

Методы класса **Color**:

| Тип          | Метод                      | Описание                           | 
|--------------|----------------------------|------------------------------------|
| String       | asHex()                    | Представление цвета в HEX системе  |
| String       | asRgb()                    | Представление цвета в RGB системе  |
| String       | asRgba()                   | Представление цвета в RGBa системе |
| static Color | fromString(String value)   | Создание объекта из строки         |
| Color        | getColor()                 | Получение объекта                  |
| void         | setOpacity(double alpha)   | Установка прозрачности             |

[selenium/docs/api : Color](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/support/Color.html)

*Пример*

```java
private final Color HEX_COLOUR = Color.fromString("#2F7ED8");
private final Color RGB_COLOUR = Color.fromString("rgb(255, 255, 255)");
private final Color RGB_COLOUR = Color.fromString("rgb(40%, 20%, 40%)");
private final Color RGBA_COLOUR = Color.fromString("rgba(255, 255, 255, 0.5)");
private final Color RGBA_COLOUR = Color.fromString("rgba(40%, 20%, 40%, 0.5)");
private final Color HSL_COLOUR = Color.fromString("hsl(100, 0%, 50%)");
private final Color HSLA_COLOUR = Color.fromString("hsla(100, 0%, 50%, 0.5)");
private final Color TRANSPARENT = Color.fromString("transparent");
```

### 4.1.1. Проверка цвета веб элемента

*Пример*

```java
private final Color BLACK = Color.fromString("black");
private final Color CHOCOLATE = Color.fromString("chocolate");
private final Color HOTPINK = Color.fromString("hotpink");

Color loginButtonColour = Color
        .fromString(driver.findElement(By.id("login"))
        .getCssValue("color"));
Color loginButtonBackgroundColour = Color
        .fromString(driver.findElement(By.id("login"))
        .getCssValue("background-color"));

Assertions.assertTrue(loginButtonBackgroundColour.equals(HOTPINK));
Assertions.assertTrue(loginButtonBackgroundColour.asHex().equals("#ff69b4");
Assertions.assertTrue(loginButtonBackgroundColour.asRgba().equals("rgba(255, 105, 180, 1)");
Assertions.assertTrue(loginButtonBackgroundColour.asRgb().equals("rgb(255, 105, 180)");        
```

## 4.2. Перечисление Colors

***Colors*** - перечисление представляющее значения цветов.

Константы перечисления **Colors**:

| Константа      | Константа       | Константа   | Константа            | Константа         | Константа     | Константа   | Константа   |
|----------------|-----------------|-------------|----------------------|-------------------|---------------|-------------|-------------|
| ALICEBLUE      | CYAN            | DEEPPINK    | INDIGO               | LIGHTSTEELBLUE    | NAVAJOWHITE   | RED         | TOMATO      |
| ANTIQUEWHITE   | DARKBLUE        | DEEPSKYBLUE | IVORY                | LIGHTYELLOW       | NAVY          | ROSYBROWN   | TRANSPARENT |
| AQUA           | DARKCYAN        | DIMGRAY     | KHAKI                | LIMEGREEN         | OLDLACE       | ROYALBLUE   | TURQUOISE   |
| AQUAMARINE     | DARKGOLDENROD   | DIMGREY     | LAVENDER             | LIME              | OLIVE         | SADDLEBROWN | VIOLET      |
| AZURE          | DARKGRAY        | DODGERBLUE  | LAVENDERBLUSH        | LINEN             | OLIVEDRAB     | SALMON      | WHEAT       |
| BEIGE          | DARKGREEN       | FIREBRICK   | LAWNGREEN            | MAGENTA           | ORANGE        | SANDYBROWN  | WHITE       |
| BISQUE         | DARKGREY        | FLORALWHITE | LEMONCHIFFON         | MAROON            | ORANGERED     | SEAGREEN    | WHITESMOKE  |
| BLACK          | DARKKHAKI       | FORESTGREEN | LIGHTBLUE            | MEDIUMAQUAMARINE  | ORCHID        | SEASHELL    | YELLOW      |
| BLANCHEDALMOND | DARKMAGENTA     | FUCHSIA     | LIGHTCORAL           | MEDIUMBLUE        | PALEGOLDENROD | SIENNA      | YELLOWGREEN |
| BLUE           | DARKOLIVEGREEN  | GAINSBORO   | LIGHTCYAN            | MEDIUMORCHID      | PALEGREEN     | SILVER      |             |
| BLUEVIOLET     | DARKORANGE      | GHOSTWHITE  | LIGHTGOLDENRODYELLOW | MEDIUMPURPLE      | PALETURQUOISE | SKYBLUE     |             |
| BROWN          | DARKORCHID      | GOLD        | LIGHTGRAY            | MEDIUMSEAGREEN    | PALEVIOLETRED | SLATEBLUE   |             |
| BURLYWOOD      | DARKRED         | GOLDENROD   | LIGHTGREEN           | MEDIUMSLATEBLUE   | PAPAYAWHIP    | SLATEGRAY   |             |
| CADETBLUE      | DARKSALMON      | GRAY        | LIGHTGREY            | MEDIUMSPRINGGREEN | PEACHPUFF     | SLATEGREY   |             |
| CHARTREUS      | DARKSEAGREEN    | GREEN       | LIGHTPINK            | MEDIUMTURQUOISE   | PERU          | SNOW        |             |
| CHOCOLATE      | DARKSLATEBLUE   | GREENYELLOW | LIGHTSALMON          | MEDIUMVIOLETRED   | PINK          | SPRINGGREEN |             |
| CORAL          | DARKSLATEGRAY   | GREY        | LIGHTSEAGREEN        | MIDNIGHTBLUE      | PLUM          | STEELBLUE   |             |
| CORNFLOWERBLUE | DARKSLATEGREY   | HONEYDEW    | LIGHTSKYBLUE         | MINTCREAM         | POWDERBLUE    | TAN         |             |
| CORNSILK       | DARKTURQUOISE   | HOTPINK     | LIGHTSLATEGRAY       | MISTYROSE         | PURPLE        | TEAL        |             |
| CRIMSON        | DARKVIOLET      | INDIANRED   | LIGHTSLATEGREY       | MOCCASIN          | REBECCAPURPLE | THISTLE     |             |

Методы перечисления **Colors**:

| Тип             | Метод                | Описание                      | 
|-----------------|----------------------|-------------------------------|
| Color           | getColorValue()      | Получение значение цвета      | 
| static Colors   | valueOf(String name) | Получение константы из строки | 
| static Colors[] | values()             | Получение констант            | 

[selenium/docs/api : Colors](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/support/Colors.html)

***

# 5. Печать страницы в PDF

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

## 5.1. Интерфейс PrintsPage

***PrintsPage*** - интерфейс для сохранения страницы в **PDF**.

Методы интерфейса **Platform**:

| Тип | Метод                            | Описание                  | 
|-----|----------------------------------|---------------------------|
| Pdf | print(PrintOptions printOptions) | Сохранение страницы в PDF |

[selenium/docs/api : PrintsPage](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/PrintsPage.html)

### 5.1.1. Печать страницы в PDF в формате Base64 

*Пример*

```java
driver.get("https://www.selenium.dev");
PrintsPage printer = (PrintsPage) driver;
PrintOptions printOptions = new PrintOptions();
printOptions.setPageRanges("1-2");
Pdf pdf = printer.print(printOptions);
String content = pdf.getContent();
```

### 5.1.2. Печать страницы в PDF в файл

*Пример*

```java
driver.get("https://www.selenium.dev");
PrintsPage printer = (PrintsPage) driver;
PrintOptions printOptions = new PrintOptions();
printOptions.setPageRanges("1-2");
Pdf pdf = printer.print(printOptions);
byte[] decoded = java.util.Base64.getDecoder().decode(pdf.getContent());
try {
  FileOutputStream fos = new FileOutputStream("pdf.pdf");
  fos.write(decoded);
  fos.flush();
  fos.close();
} catch (IOException e) {
    e.printStackTrace();
}
```

## 5.2. Интерфейс Pdf

***Pdf*** - интерфейс для получения файла **PDF** в формате Base64.

Методы интерфейса **Pdf**:

| Тип    | Метод        | Описание                             | 
|--------|--------------|--------------------------------------|
| String | getContent() | Получение файла PDF в формате Base64 |

[selenium/docs/api : Pdf](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Pdf.html)

## 5.3. Класс PrintOptions

***PrintOptions*** - класс представляющий опции **PDF** при сохранении файла.

Методы класса **PrintOptions**:

| Тип                      | Метод                                                | Описание                      | 
|--------------------------|------------------------------------------------------|-------------------------------|
| boolean                  | getBackground()                                      | Получение фона страницы       |
| PrintOptions.Orientation | getOrientation()                                     | Получение ориентации страницы |
| PageMargin               | getPageMargin()                                      | Получение отступов страницы   |
| String[]                 | getPageRanges()                                      | Получение номеров страницы    |
| PageSize                 | getPageSize()                                        | Получение размеров страницы   |
| double                   | getScale()                                           | Получение масштаба страницы   |
| boolean                  | getShrinkToFit()                                     |                               |
| void                     | setBackground(boolean background)                    | Установка фона страницы       |
| void                     | setOrientation(PrintOptions.Orientation orientation) | Установка ориентации страницы |
| void                     | setPageMargin(PageMargin margin)                     | Установка отступов страницы   |
| void                     | setPageRanges(String firstRange, String... ranges)   | Установка номеров страницы    |
| void                     | setPageSize(PageSize pageSize)                       | Установка размеров страницы   |
| void                     | setScale(double scale)                               | Установка масштаба страницв   |
| void                     | setShrinkToFit(boolean value)                        |                               |

[selenium/docs/api : PrintOptions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/print/PrintOptions.html)

*Пример*

```java
driver.get("https://www.selenium.dev");
PrintsPage printer = (PrintsPage) driver;
PrintOptions printOptions = new PrintOptions();
printOptions.setBackground(true);
printOptions.setPageRanges("1-2");
printOptions.setScale(2.0);
Pdf pdf = printer.print(printOptions);
pdf.getContent();
```

## 5.4. Перечисление PrintOptions.Orientation

***PrintOptions.Orientation*** - перечисление представляющее ориентацию страницы.

Константы перечисления **PrintOptions.Orientation**:

| Тип           | Описание   | 
|---------------|------------|
| LANDSCAPE     | Альбомная  |
| PORTRAIT      | Портретная |

Методы перечисления **PrintOptions.Orientation**:

| Тип                                | Метод                | Описание                              |
|------------------------------------|----------------------|---------------------------------------|
| static PrintOptions.Orientation    | valueOf(String name) | Константа из строкового представления |
| static PrintOptions.Orientation[]  | values()             | Массив констант                       |

[selenium/docs/api : PrintOptions.Orientation](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/print/PrintOptions.Orientation.html)

## 5.5. Класс PageMargin

***PageMargin*** - класс представляющий отступы страницы.

Методы класса *PrintOptions.Orientation*

| Тип    | Метод       | Описание            |
|--------|-------------|---------------------|
| double | getBottom() | От нижней границы   |
| double | getLeft()   | От левой границы    |
| double | getRight()  | От правой границы   |
| double | getTop()    | От верхней границы  |

[selenium/docs/api : PageMargin](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/print/PageMargin.html)

## 5.6. Класс PageSize

***PageSize*** - класс представляющий размеры страницы.

Методы класса **PrintOptions.Orientation**

| Тип    | Метод       | Описание | 
|--------|-------------|----------|
| double | getHeight() | Высота   | 
| double | getWidth()  | Ширина   | 

[selenium/docs/api : PageSize](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/print/PageSize.html)

***

# 6. Веб хранилище

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

***Веб-хранилище (Web Storage, DOM-хранилище)*** - набор механизмов, которые используются для хранения данных локально
в веб-браузере пользователя в виде пары ключ/значение. Другими словами, это специально отведенное место в браузере
(похоже на небольшую базу данных), в котором мы можем работать с данными - записывать, читать и удалять их.

Существуют два основных типа веб-хранилища:

* *сессионное хранилище (sessionStorage)*

***Сессионное хранилище*** - это объект sessionStorage, который позволяет хранить данные для каждого домена, 
доступные на протяжении сессии, пока открыт браузер, и даже в том случае, если была осуществлена перезагрузка страницы. 
Однако закрытие вкладки браузера, самого браузера или перезагрузка компьютера приводит к удалению данных из sessionStorage.

Объект sessionStorage используется гораздо реже, чем localStorage.

* *локальное хранилище (localStorage)*
  
***Локальное хранилище*** - это объект localStorage, который позволяет хранить данные для каждого домена 
в течение неограниченного времени (после закрытия вкладки браузера, самого браузера, перезагрузки компьютера), 
а точнее пока пользователь самостоятельно не удалит данные.

Каждый домен имеет доступ к своему хранилищу данных localStorage. 
Например, localStorage, используемый для, https://osipenkov.ru является отдельным от localStorage, 
используемым для https://coobiq.com. 

Субдомены (поддомены) и различные протоколы HTTP (HTTP и HTTPS) имеют независимые друг от друга хранилища данных. 
Например, localStorage https://gtm.osipenkov.ru используется полностью отдельно от https://osipenkov.ru. 
Точно так же localStorage https://osipenkov.ru используется отдельно от http://osipenkov.ru.

Некоторые браузеры блокируют localStorage в режиме инкогнито. localStorage работает даже с отключенными cookie.

Объекты веб-хранилища **localStorage** и **sessionStorage** позволяют хранить пары ключ/значение в браузере.

Что в них важно – данные, которые в них записаны, сохраняются

* после обновления страницы (в случае sessionStorage)
* после перезапуска браузера (при использовании localStorage).

Преимущества веб хранилища перед куки:

* больший объем хранимых данных (между 5 и 10 МБайт на каждый домен)
* данные хранятся между загрузками страницы и посещениями сайта (даже после выключения и включения компьютера)
* объекты веб-хранилища не отправляются на сервер при каждом запросе.
* сервер не может манипулировать объектами хранилища через HTTP-заголовки
* хранилище привязано к источнику (домен/протокол/порт) 
* разные протоколы или поддомены определяют разные объекты хранилища, и они не могут получить доступ к данным друг друга

Объекты хранилища localStorage и sessionStorage предоставляют одинаковые методы и свойства:

* *setItem(key, value)* – сохранить пару ключ/значение.
* *getItem(key)* – получить данные по ключу key.
* *removeItem(key)* – удалить данные с ключом key.
* *clear()* – удалить всё.
* *key(index)* – получить ключ на заданной позиции.
* *length* – количество элементов в хранилище.

## 6.1. Интерфейс WebStorage

***WebStorage*** - интерфейс представляющее доступ к веб хранилищу.

Методы интерфейса **WebStorage**:

| Тип            | Метод               | Описание                       | 
|----------------|---------------------|--------------------------------|
| LocalStorage   | getLocalStorage()   | Доступ к локальному хранилищу  |
| SessionStorage | getSessionStorage() | Доступ к сессионному хранилищу |

[selenium/docs/api : WebStorage](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/html5/WebStorage.html)

## 6.2. Интерфейс LocalStorage

***LocalStorage*** - интерфейс представляющий локальное хранилище.

Методы интерфейса **LocalStorage**:

| Тип         | Метод                             | Описание                      | 
|-------------|-----------------------------------|-------------------------------|
| void        | clear()                           | Очистка локального хранилища  |
| String      | getItem(String key)               | Получение элемента по ключу   |
| Set<String> | keySet()                          | Получение набора ключей       |
| String      | removeItem(String key)            | Удаление элемента по ключу    |
| void        | setItem(String key, String value) | Добавление элемента           |
| int         | size()                            | Получение размера             |

[selenium/docs/api : LocalStorage](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/html5/LocalStorage.html)

### 6.2.1. Работа с локальным хранилищем

*Пример*

```java
// Получить доступ к локальному хранилищу
WebStorage webStorage = (WebStorage) driver;
LocalStorage localStorage = webStorage.getLocalStorage();
// Получить данные локального хранилища
Set<String> keySet = localStorage.keySet();
// Добавить данные в локальное хранилище
localStorage.setItem("item1", "item1");
// Удалить данные из локального хранилища
localStorage.removeItem("item1");
```

## 6.3. Интерфейс SessionStorage

***SessionStorage*** - интерфейс представляющий сессионное хранилище.

Методы интерфейса **SessionStorage**:

| Тип         | Метод                             | Описание                      | 
|-------------|-----------------------------------|-------------------------------|
| void        | clear()                           | Очистка сессионного хранилища |
| String      | getItem(String key)               | Получение элемента по ключу   |
| Set<String> | keySet()                          | Получение набора ключей       |
| String      | removeItem(String key)            | Удаление элемента по ключу    |
| void        | setItem(String key, String value) | Добавление элемента           |
| int         | size()                            | Получение размера             |

[selenium/docs/api : SessionStorage](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/html5/SessionStorage.html)

### 6.3.1. Работа с сессионным хранилищем

*Пример*

```java
// Получить доступ к сессионному хранилищу
WebStorage webStorage = (WebStorage) driver;
SessionStorage sessionStorage = webStorage.getSessionStorage();
// Получить данные сессионного хранилища
Set<String> keySet = sessionStorage.keySet();
// Добавить данные в сессионное хранилище
sessionStorage.setItem("item1", "item1");
// Удалить данные из локального хранилища
sessionStorage.removeItem("item1");
```

***

# 7. Выполнение JS скрипта

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

## 7.1. Интерфейс JavascriptExecutor

***JavascriptExecutor*** - интерфейс позволяющий **Selenium WebDriver** выполнять **JS** скрипт в браузере.

Методы интерфейса **JavascriptExecutor**:

| Тип                    | Метод                                             | Описание                            | 
|------------------------|---------------------------------------------------|-------------------------------------|
| Object                 | executeAsyncScript(String script, Object... args) | Выполнение асинхронного скрипта     | 
| Object                 | executeScript(String script, Object... args)      | Выполнение синхронного скрипта      | 
| default Object         | executeScript(ScriptKey key, Object... args)      | Выполнение сохраненного скрипта     | 
| default Set<ScriptKey> | getPinnedScripts()                                | Получение сохраненных скриптов      | 
| default ScriptKey      | pin(String script)                                | Сохранение скрипта в текущей сессии |
| default void           | unpin(ScriptKey key)                              | Удаление скрипта из текущий сессии  | 

[selenium/docs/api : JavascriptExecutor](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/JavascriptExecutor.html)

### 7.1.1. Клик на веб элемент

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor)driver;
WebElement button = driver.findElement(By.name("btnLogin"));
js.executeScript("arguments[0].click();", button);
```

### 7.1.2. Получение текста веб элемента

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor)driver;
WebElement button = driver.findElement(By.name("btnLogin"));
String text = (String) js.executeScript("return arguments[0].innerText", button);
```

### 7.1.3. Скроллинг страницы

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor)driver;		
js.executeScript("window.scrollBy(0,600)");
```

### 7.1.4. Отображение скрытых элементов

Изменение прозрачности элемента.

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor) driver;	
WebElement element = driver.findElement("//input[@type='button']");
String script = "arguments[0].style.opacity=1;" +
        "arguments[0].style['transform']='translate(0px, 0px) scale(1)';" +
        "arguments[0].style['MozTransform']='translate(0px, 0px) scale(1)';" +
        "arguments[0].style['WebkitTransform']='translate(0px, 0px) scale(1)';" +
        "arguments[0].style['msTransform']='translate(0px, 0px) scale(1)';" +
        "arguments[0].style['OTransform']='translate(0px, 0px) scale(1)';" +
        "return true;";
js.executeScript(script, element);
```

Изменение видимости элемента.

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor) driver;
String script = "arguments[0].style.visibility='visible';";
js.executeScript(script, divVisibilityHidden);
```

Изменение отображения элемента.

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor) driver;
String script = "arguments[0].style.display='block';";
js.executeScript(script, divDisplayNone);
```

### 7.1.5. Задание цвета

*Пример*

```java
JavascriptExecutor js = (JavascriptExecutor) driver;
String script = "document.getElementById('button1').style.backgroundColor = 'HotPink';";
js.executeScript(script, divDisplayNone);
```

## 7.2. Исключения

### 7.2.1. JavascriptException

***JavascriptException*** — исключение, которое вызывается, когда невозможно выполнить JS скрипт.

[selenium/docs/api : JavascriptException](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/JavascriptException.html)

#### 7.2.1.1. Причины

* Наличие ошибки в JS скрипте

*Пример*

В примере ниже в скрипте опечатка - вместо **return document.title;** выполняется **return dcoument.title;**

```java
@Test
public void test() {
    driver.get("https://www.dns-shop.ru/");
    JavascriptExecutor js =(JavascriptExecutor) driver;
    String title = js.executeScript("return dcoument.title;").toString();
    logger.info(title);
}
```

В результате вызывается исключение **JavascriptException**

```text
org.openqa.selenium.JavascriptException: javascript error: dcoument is not defined
```

#### 7.2.1.2. Решения

* Проверка работы JS скрипта в консоле браузера

*Пример*

```java
@Test
public void test() {
    driver.get("https://www.dns-shop.ru/");
    JavascriptExecutor js =(JavascriptExecutor) driver;
    String title = js.executeScript("return document.title;").toString();
    logger.info(title);
}
```

Ниже пример перехвата исключения.

*Пример*

```java
@Test
public void test() {
    driver.get("https://www.dns-shop.ru/");
    try {
        JavascriptExecutor js =(JavascriptExecutor) driver;
        String title = js.executeScript("return dcoument.title;").toString();
        logger.info(title);
    } catch (JavascriptException e) {
        logger.info("JavascriptException: " + e.getRawMessage());
    }
}
```

***

# 8. Использование DevTools

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

***Инструменты разработчика (Development Tools или сокращённо DevTools)*** ─ программы, позволяющие создавать, 
тестировать и отлаживать (debug) программное обеспечение.

Современные браузеры, Safari, Firefox, Microsoft Edge, Chrome, Яндекс 
и другие, имеют встроенные инструменты разработчика, 
позволяющие просмотреть исходный код сайта. Отдельно устанавливать их не требуется. 
С их помощью можно просматривать и отлаживать HTML сайта, его CSS и Javascript. 
Также можно проверить сетевой трафик, потребляемый сайтом, его быстродействие и много других параметров.

***Chrome DevTools*** - набор инструментов веб-разработчика, встроенных непосредственно в браузер **Google Chrome**.

## 8.1. Класс DevTools

***DevTools*** - класс представляющий возможности **DevTools**. 

Методы класса **DevTools**:

| Тип         | Метод                                            | Описание                      | 
|-------------|--------------------------------------------------|-------------------------------|
| <X> void    | addListener(Event<X> event, Consumer<X> handler) | Добавление слушателя события  |
| void        | clearListeners()                                 | Удаление слушателей событий   |
| void        | close()                                          | Закрытие сессии DevTools      |
| void        | createSession()                                  | Открытие сессии DevTools      |
| void        | createSessionIfThereIsNotOne()                   | Открытие сессии DevTools      |
| SessionID   | getCdpSession()                                  | Получение сессии DevTools     |
| <X> X       | send(Command<X> command)                         | Отправка команды DevTools     |

[selenium/docs/api : DevTools](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/devtools/DevTools.html)

*Пример*

```java
ChromeDriver driver = new ChromeDriver();
DevTools devTools = driver.getDevTools();
devTools.createSession();
devTools.send(Performance.enable(Optional.empty()));
List<Metric> metricList = devTools.send(Performance.getMetrics());

driver.get("https://google.com");
driver.quit();

for(Metric m : metricList) {
    System.out.println(m.getName() + " = " + m.getValue());
}
```

## 8.2. Chrome DevTools Protocol

***Chrome DevTools Protocol*** - протокол, который позволяет использовать инструменты для проверки, 
отладки и профилирования **Chromium**, **Chrome** и других браузеров на основе **Blink**. 
Многие существующие проекты в настоящее время используют этот протокол.

В **Selenium 4** добавили долгожданную встроенную поддержку протокола **Chrome DevTools Protocol** через интерфейс **DevTools**.

Инструментарий разделен на несколько доменов (**DOM**, **Debugger**, **Network** и т.д.). 
Каждый домен определяет ряд поддерживаемых им команд и генерируемых событий. 
И команды, и события представляют собой сериализованные объекты JSON фиксированной структуры.

Некоторые наиболее часто используемые домены:

| Домен       | Описание           |
|-------------|--------------------|
| Browser     | Браузер            |
| Emulation   | Эмуляция           |
| Log         | Журнал             |
| Performance | Производительность |
| Fetch       | Перехват запросов  |
| Network     | Сетевая активность |

[Chrome DevTools Protocol](https://chromedevtools.github.io/devtools-protocol/)

## 8.3. Browser

### 8.3.1. Предоставление прав браузеру на выполнение операций

*Пример*

```java
// Доступ к DevTools
ChromeDriver chrome =  (ChromeDriver) driver;
DevTools devTools = chrome.getDevTools();
// Открытие сессии DevTools
devTools.createSession();
// Предоставление прав браузеру на выполнение операций
// Browser.grantPermissions - предоставление прав браузеру        
// Список предоставляемых прав         
List<PermissionType> permissions = new ArrayList<>();
permissions.add(PermissionType.AUDIOCAPTURE);
permissions.add(PermissionType.VIDEOCAPTURE);
permissions.add(PermissionType.GEOLOCATION);
devTools.send(Browser.grantPermissions(permissions, Optional.empty(), Optional.empty()));

// Открыть страницу yandex.ru
chrome.get("https://yandex.ru");
logger.info("Открыта страница yandex.ru - " + "https://yandex.ru");

// Закрытие сессии DevTools
devTools.close();
```

### 8.3.2. Получение данных о браузере

*Пример*

```java
// Доступ к DevTools
ChromeDriver chrome =  (ChromeDriver) driver;
DevTools devTools = chrome.getDevTools();
// Открытие сессии DevTools
devTools.createSession();
// Получение версии браузера
// Browser.getVersion - получение данных о версии
Browser.GetVersionResponse version = devTools.send(Browser.getVersion());
// Вывод данных о браузере
logger.info("Browser: " + version.getProduct());
logger.info("User Agent: " + version.getUserAgent());
logger.info("JS: " + version.getJsVersion());
logger.info("Protocol: " + version.getProtocolVersion());

// Открыть страницу yandex.ru
chrome.get("https://yandex.ru");
logger.info("Открыта страница yandex.ru - " + "https://yandex.ru");

// Закрытие сессии DevTools
devTools.close();
```

## 8.4. Emulation

### 8.4.1. Установка параметров эмулируемого устройства

*Пример*

```java
// Доступ к DevTools
ChromeDriver chrome =  (ChromeDriver) driver;
DevTools devTools = chrome.getDevTools();
// Открытие сессии DevTools
devTools.createSession();
// Установка параметров эмулируемого устройства
// Emulation.setDeviceMetricsOverride - установка параметров        
// Параметры эмулируемого устройства     
int width = 600;            // Ширина
int height = 1000;          // Высота    
int deviceScaleFactor = 50; //  
boolean mobile = true;      // Мобильное устройства
devTools.send(Emulation.setDeviceMetricsOverride(
    width, height, deviceScaleFactor, mobile,
    Optional.empty(), Optional.empty(), Optional.empty(),
    Optional.empty(), Optional.empty(), Optional.empty(),
    Optional.empty(), Optional.empty(), Optional.empty())
);

// Открыть страницу yandex.ru
chrome.get("https://yandex.ru");
logger.info("Открыта страница yandex.ru - " + "https://yandex.ru");

// Закрытие сессии DevTools
devTools.close();
```

### 8.4.2. Установка геолокации

*Пример*

```java
// Доступ к DevTools
ChromeDriver chrome =  (ChromeDriver) driver;
DevTools devTools = chrome.getDevTools();
// Открытие сессии DevTools
devTools.createSession();
// Установка геолокации
// Emulation.setGeolocationOverride - установка геолокации        
// Параметры геолокации
Optional<Number> latitude = Optional.of(50.52930);  // Широта
Optional<Number> longitude = Optional.of(42.68620); // Долгота
Optional<Number> accuracy = Optional.of(10);        // Точность 
devTools.send(Emulation.setGeolocationOverride(latitude, longitude, accuracy));

// Открыть страницу mycurrentlocation.net
chrome.get("https://mycurrentlocation.net/");
logger.info("Открыта страница mycurrentlocation.net - " + "https://mycurrentlocation.net/");

// Закрытие сессии DevTools
devTools.close();
```

## 8.5. Log

### 8.5.1. Вывод логов

*Пример*

```java
// Доступ к DevTools
ChromeDriver chrome =  (ChromeDriver) driver;
DevTools devTools = chrome.getDevTools();
// Открытие сессии DevTools
devTools.createSession();
// Вывод логов
// Log.enable - включение доступа к логам
devTools.send(Log.enable());
// Слушатель
devTools.addListener(Log.entryAdded(),
    // Вывод логов
    logEntry -> {
        logger.info("Log: " + logEntry.getText());
        logger.info("Level: " + logEntry.getLevel());
    }
);

// Открыть страницу yandex.ru
chrome.get("https://yandex.ru");
logger.info("Открыта страница yandex.ru - " + "https://yandex.ru");
// Ввести в строку поиска текст - Selenium
WebElement input = chrome.findElement(By.xpath("//input[@class=\"input__control input__input mini-suggest__input\"]"));
input.sendKeys("Selenium");
// Нажать на кнопку "Найти"
WebElement button = chrome.findElement(By.xpath("//button[@class=\"button mini-suggest__button button_theme_search button_size_search i-bem button_js_inited\"]"));
button.click();

// Закрытие сессии DevTools
devTools.close();
```

## 8.6. Performance

### 8.6.1. Сбор метрик

*Пример*

```java
// Доступ к DevTools
ChromeDriver chrome =  (ChromeDriver) driver;
DevTools devTools = chrome.getDevTools();
// Открытие сессии DevTools
devTools.createSession();
// Сбор метрик
// Performance.enable - включение сбора метрик
devTools.send(Performance.enable(Optional.of(Performance.EnableTimeDomain.TIMETICKS)));

// Открыть страницу yandex.ru
chrome.get("https://yandex.ru");
logger.info("Открыта страница yandex.ru - " + "https://yandex.ru");
// Ввести в строку поиска текст - Selenium
WebElement input = chrome.findElement(By.xpath("//input[@class=\"input__control input__input mini-suggest__input\"]"));
input.sendKeys("Selenium");
// Нажать на кнопку "Найти"
WebElement button = chrome.findElement(By.xpath("//button[@class=\"button mini-suggest__button button_theme_search button_size_search i-bem button_js_inited\"]"));
button.click();

// Получение метрик
List<Metric> metrics = devTools.send(Performance.getMetrics());
List<String> metricNames = metrics.stream()
    .map(o -> o.getName())
    .collect(Collectors.toList()
);
// Performance.disable - выключение сбора метрик
devTools.send(Performance.disable());
// Список метрик для проверки
List<String> metricsToCheck = Arrays.asList(
    "Timestamp",
    "Documents",
    "Frames",
    "JSEventListeners",
    "LayoutObjects",
    "MediaKeySessions",
    "Nodes",
    "Resources",
    "DomContentLoaded",
    "NavigationStart"
);
// Вывод метрик
metricsToCheck.forEach(metric ->
    logger.info(metric + " is : " + metrics.get(metricNames.indexOf(metric)).getValue())
);

// Закрытие сессии DevTools
devTools.close();
```

## 8.7. Fetch

### 8.7.1. Перехват и модификация запросов

*Пример*

```java
// Доступ к DevTools
ChromeDriver chrome =  (ChromeDriver) driver;
DevTools devTools = chrome.getDevTools();
// Открытие сессии DevTools
devTools.createSession();
// Перехват запроса
// Fetch.enable - включение перехвата запроса
devTools.send(Fetch.enable(Optional.empty(), Optional.empty()));
// Слушатель
devTools.addListener(
    // Fetch.requestPaused - остановка запроса   
    Fetch.requestPaused(),
    // Обработка запроса
    request -> {
        // Новый URL запроса (подставляем в Fetch.continueRequest)
        String newUrl = request.getRequest().getUrl().contains("yandex.ru")
                      ? request.getRequest().getUrl().replace("yandex.ru", "ya.ru")
                      : request.getRequest().getUrl();
        // Fetch.continueRequest - продолжение запроса
        // Параметры запроса
        RequestId requestId = request.getRequestId();                            // ID запроса
        Optional<String> url = Optional.of(request.getRequest().getUrl());       // URL запроса
        Optional<String> method = Optional.of(request.getRequest().getMethod()); // Метод запроса
        Optional<String> postData = request.getRequest().getPostData();          // Данные POST запроса
        Optional<List<HeaderEntry>> headers = request.getResponseHeaders();      // Заголовки запроса
        devTools.send(Fetch.continueRequest(requestId, url, method, postData, headers));
    }
);

// Открыть страницу yandex.ru
chrome.get("https://yandex.ru");
logger.info("Открыта страница yandex.ru - " + "https://yandex.ru");
// Ввести в строку поиска текст - Selenium
WebElement input = chrome.findElement(By.xpath("//input[@class=\"input__control input__input mini-suggest__input\"]"));
input.sendKeys("Selenium");
// Нажать на кнопку "Найти"
WebElement button = chrome.findElement(By.xpath("//button[@class=\"button mini-suggest__button button_theme_search button_size_search i-bem button_js_inited\"]"));
button.click();

// Закрытие сессии DevTools
devTools.close();
```

## 8.8. Network

### 8.8.1. Эмуляция интернет соединения

*Пример*

```java
// Доступ к DevTools
ChromeDriver chrome = (ChromeDriver) driver;
DevTools devTools = chrome.getDevTools();
// Открытие сессии DevTools
devTools.createSession();
// Эмуляция интернет соединения
// Network.enable - включение сетевых возможностей
devTools.send(Network.enable(Optional.empty(), Optional.empty(), Optional.empty()));
// Network.emulateNetworkConditions - эмуляция интернет соединения
// Параметры соединения
Boolean offline = false;           // Оффлайн режим
Number latency = 2;                // Задержка
Number downloadThroughput = 80000; // Пропускная способность скачивания
Number uploadThroughput = 200000;  // Пропускная способность загрузки
Optional<ConnectionType> connectionType = Optional.of(ConnectionType.CELLULAR2G); // Тип соединения
devTools.send(Network.emulateNetworkConditions(offline, latency, downloadThroughput, uploadThroughput, connectionType));

// Открыть страницу yandex.ru
chrome.get("https://yandex.ru");
logger.info("Открыта страница yandex.ru - " + "https://yandex.ru");
// Ввести в строку поиска текст - Selenium
WebElement input = chrome.findElement(By.xpath("//input[@class=\"input__control input__input mini-suggest__input\"]"));
input.sendKeys("Selenium");
// Нажать на кнопку "Найти"
WebElement button = chrome.findElement(By.xpath("//button[@class=\"button mini-suggest__button button_theme_search button_size_search i-bem button_js_inited\"]"));
button.click();

// Закрытие сессии DevTools
devTools.close();
```

### 8.8.2. Добавление заголовков в запросы

*Пример*

```java
// Доступ к DevTools
ChromeDriver chrome = (ChromeDriver) driver;
DevTools devTools = chrome.getDevTools();
// Открытие сессии DevTools
devTools.createSession();
// Добавление заголовков в запросы
// Network.enable - включение сетевых возможностей
devTools.send(Network.enable(Optional.empty(), Optional.empty(), Optional.empty()));
// Network.setExtraHTTPHeaders - отправка заголовков запроса
// Заголовки
Map<String, Object> headers = new HashMap<>();
headers.put("headername1", "headervalue1");
devTools.send(Network.setExtraHTTPHeaders(new Headers(headers)));
devTools.addListener(Network.requestWillBeSent(),
    requestWillBeSent -> {
        Assertions.assertEquals(requestWillBeSent.getRequest().getHeaders().get("headername1"), "headervalue1");
    }
);

// Открыть страницу yandex.ru
chrome.get("https://yandex.ru");
logger.info("Открыта страница yandex.ru - " + "https://yandex.ru");

// Закрытие сессии DevTools
devTools.close();
```

### 8.8.3. Перехват HTTP запроса

*Пример*

```java
// Доступ к DevTools
ChromeDriver chrome = (ChromeDriver) driver;
DevTools devTools = chrome.getDevTools();
// Открытие сессии DevTools
devTools.createSession();
// Перехват HTTP запроса
// Network.enable - включение сетевых возможностей
devTools.send(Network.enable(Optional.empty(), Optional.empty(), Optional.empty()));
// Слушатель
devTools.addListener(
    // Network.requestWillBeSent - перехват запроса    
    Network.requestWillBeSent(),
    // Обработка запроса
    request -> {
        logger.info(request.getRequest().getMethod() + " " + request.getRequest().getUrl());
    }
);

// Открыть страницу yandex.ru
chrome.get("https://yandex.ru");
logger.info("Открыта страница yandex.ru - " + "https://yandex.ru");

// Закрытие сессии DevTools
devTools.close();
```

### 8.8.4. Авторизация Basic Authentication

*Пример*

```java
// Доступ к DevTools
ChromeDriver chrome = (ChromeDriver) driver;
DevTools devTools = chrome.getDevTools();
// Открытие сессии DevTools
devTools.createSession();
// Авторизация BasicAuth
// Network.enable - включение сетевых возможностей
devTools.send(Network.enable(Optional.empty(), Optional.empty(), Optional.empty()));

// Открыть страницу jigsaw.w3.org/HTTP/
driver.get("https://jigsaw.w3.org/HTTP/");
logger.info("Открыта страница jigsaw.w3.org/HTTP/ - " + "https://jigsaw.w3.org/HTTP/");
        
// Отправка заголовков
// Network.setExtraHTTPHeaders - отправка заголовков запроса
final String USERNAME = "guest"; // Имя пользователя
final String PASSWORD = "guest"; // Пароль пользователя
byte[] encodedUserPass = new Base64().encode(String.format("%s:%s", USERNAME, PASSWORD).getBytes());
String basicAuth = "Basic " + new String(encodedUserPass);
Map<String, Object> headers = new HashMap<>(); // Заголовки
headers.put("Authorization", basicAuth);
devTools.send(Network.setExtraHTTPHeaders(new Headers(headers)));

// Нажать на ссылку "Basic Authentication test"
WebElement link = driver.findElement(By.linkText("Basic Authentication test"));
link.click();

String loginSuccessMsg = driver.findElement(By.tagName("html")).getText();
if (loginSuccessMsg.contains("Your browser made it!")) {
    logger.info("Успех!");
}
else {
    logger.info("Неудача!");
}
        
// Закрытие сессии DevTools
devTools.close();
```

***

# 9. Сторонние либы

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

Есть ряд задач для решения которых нужны сторонние библиотеки:

* файлы PDF
  * Apache PdfBox
  * iText
* файлы Excel
  * Apache POI

***

# 10. Работа с файлами формата PDF

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

## 10.1. Библиотека Apache PdfBox

***Apache PDFBox*** - библиотека **Java** с открытым исходным кодом для работы с документами **PDF**.

Возможности:

* создание новых документов **PDF**
* создание документов **PDF** из текстового файла
* редактирование существующих документов **PDF**
* печатать **PDF**
* извлечение контента (текста) из документов **PDF**
* объединение документов **PDF**
* шифрование / дешифрование документов **PDF**
  и т д.

Apache PDFBox также включает в себя несколько утилит командной строки.

[Apache PDFBox](https://pdfbox.apache.org/)

[PDFBox API](https://pdfbox.apache.org/docs/2.0.13/javadocs/)

### 10.1.1. Извлечение текста из документа PDF

*Пример*

```java
// Открытие файла PDF
File file = new File("C:/new.pdf");
PDDocument document = PDDocument.load(file);
// Извлечение текста из документа PDF
PDFTextStripper pdfStripper = new PDFTextStripper();
String text = pdfStripper.getText(document);
System.out.println(text);
// Закрытие файла PDF
document.close();
````

## 10.2. Библиотека iText

***iText*** - библиотека на **Java**, предназначенная для работы с **pdf**.

Начиная с версии 5.0.0 свободно распространяется по лицензии **AGPL**
(обязывающая предоставлять пользователям возможность получения исходного кода), но также есть и коммерческая версия.

[iText PDF](https://itextpdf.com/en)

[iText API](https://itextpdf.com/en/resources/api-documentation)

### 10.2.1. Извлечение текста из документа PDF

*Пример*

```java
// Открытие файла PDF
PdfReader reader = new PdfReader("C:/new.pdf");
// Извлечение текста из документа PDF (нумерация страниц в PDF начинается с единицы)
for (int i = 1; i <= reader.getNumberOfPages(); ++i) {
    TextExtractionStrategy strategy = new SimpleTextExtractionStrategy();
    String text = PdfTextExtractor.getTextFromPage(reader, i, strategy);
    System.out.println(text);
}
// Закрытие файла PDF
reader.close();
````

***

# 11. Работа с файлами формата Excel

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

## 11.1. Библиотека Apache POI для работы с файлами Excel

***Apache POI*** - проект **Apache Software Foundation**, который предоставляет библиотеки **Java** 
для чтения и записи файлов в форматах **Microsoft Office**, таких как **Word**, **PowerPoint** и **Excel**.

[Apache POI](https://poi.apache.org/)

[Apache POI API](https://poi.apache.org/components/index.html)

**Компоненты Apache POI** - набор библиотек, каждая из которых отвечает за работу с файлами определенного формата.

| Компонент                                 | Описание                                                      |
|-------------------------------------------|---------------------------------------------------------------|
| **HSSF** - Horrible Spreadsheet Format    | Компонент чтения и записи файлов MS-Excel, формат **XLS**     |
| **XSSF** - XML Spreadsheet Format         | Компонент чтения и записи файлов MS-Excel, формат **XLSX**    |
| **HPSF** - Horrible Property Set Format   | Компонент получения наборов свойств файлов **MS-Office**      |
| **HWPF** - Horrible Word Processor Format | Компонент чтения и записи файлов MS-Word, формат **DOC**      |
| **XWPF** - XML Word Processor Format      | Компонент чтения и записи файлов MS-Word, формат **DOCX**     |
| **HSLF** - Horrible Slide Layout Format   | Компонент чтения и записи файлов PowerPoint, формат **PPT**   |
| **XSLF** - XML Slide Layout Format        | Компонент чтения и записи файлов PowerPoint, формат **PPTX**  |
| **HDGF** - Horrible DiaGram Format        | Компонент работы с файлами MS-Visio, формат **VSD**           |
| **XDGF** - XML DiaGram Format             | Компонент работы с файлами MS-Visio, формат **VSDX**          |

***

[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Практика](https://img.shields.io/badge/-Практика-aaffaa)](2.%20Практика.md)