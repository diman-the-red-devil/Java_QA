Java_QA / 08. Selenium WebDriver. Протоколирование

[![Лекция](https://img.shields.io/badge/-Лекция-ee99ff)](1.%20Лекция.md)
[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Задание](https://img.shields.io/badge/-Задание-99ffee)](3.%20Задание.md)

***

# Содержание

* [1. Открытие предыдущего проекта](#1-открытие-предыдущего-проекта)
* [2. Чтение логов](#2-чтение-логов)
  * [2.1. Доступные типы логов](#21-доступные-типы-логов)
  * [2.2. Получение логов заданного типа](#22-получение-логов-заданного-типа)
  * [2.3. Получение логов заданного типа и уровня](#23-получение-логов-заданного-типа-и-уровня)
  * [2.4. Полный код LogsTest.java](#24-полный-код-logstestjava)
* [3. Снятие скриншотов](#3-снятие-скриншотов)
  * [3.1. Снятие скриншотов с помощью TakeScreenshot](#31-снятие-скриншотов-с-помощью-takescreenshot)
    * [3.1.1. Скриншот видимой области веб страницы](#311-скриншот-видимой-области-веб-страницы)
    * [3.1.2. Скриншот веб элемента](#312-скриншот-веб-элемента)
    * [3.1.3. Скриншот веб элемента вырезанный из видимой области веб страницы](#313-скриншот-веб-элемента-вырезанный-из-видимой-области-веб-страницы)
  * [3.2. Снятие скриншотов с помощью AShot](#32-снятие-скриншотов-с-помощью-ashot)
    * [3.2.1. Утилита Яндекса для захвата скриншотов - AShot](#321-утилита-яндекса-для-захвата-скриншотов---ashot)
    * [3.2.2. Скриншот видимой области веб страницы](#322-скриншот-видимой-области-веб-страницы)
    * [3.2.3. Скриншот всей веб страницы](#323-скриншот-всей-веб-страницы)
    * [3.2.4. Скриншот веб элемента](#324-скриншот-веб-элемента)
    * [3.2.5. Сравнение скриншота с образцом](#325-сравнение-скриншота-с-образцом)
    * [3.2.6. Скриншот с эффектом](#326-скриншот-с-эффектом)
  * [3.3. Полный код ScreenShotsTest.java](#33-полный-код-screenshotstestjava)
* [4. Запись видео](#4-запись-видео)
  * [4.1. Запись видео с помощью Monte](#41-запись-видео-с-помощью-monte)
    * [4.1.1. Библиотека для записи видео - Monte](#411-библиотека-для-записи-видео---monte)
    * [4.1.2. Запись видео](#412-запись-видео)
  * [4.2. Полный код VideoRecordsTest.java](#42-полный-код-videorecordstestjava)
* [5. Перехват трафика](#5-перехват-трафика)
  * [5.1. Перехват трафика с помощью BrowserMob Proxy](#51-перехват-трафика-с-помощью-browsermob-proxy)
    * [5.1.1. Библиотека прокси для перехвата трафика - BrowserMob Proxy](#511-библиотека-прокси-для-перехвата-трафика---browsermob-proxy)
    * [5.1.2. Перехват трафика](#512-перехват-трафика)
  * [5.2. Полный код HttpCaptureTest.java](#52-полный-код-httpcapturetestjava)
* [6. Отслеживание событий](#6-отслеживание-событий)
  * [6.1. Отслеживание событий в Selenium 3](#61-отслеживание-событий-в-selenium-3)
  * [6.2. Полный код Selenium3Listener.java](#62-полный-код-selenium3listenerjava)
  * [6.3. Отслеживание событий в Selenium 4](#63-отслеживание-событий-в-selenium-4)
  * [6.4. Полный код Selenium4Listener.java](#64-полный-код-selenium4listenerjava)
  * [6.5. Полный код ListenersTest.java](#65-полный-код-listenerstestjava)

***

# 1. Открытие предыдущего проекта

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

Шаги:

1. Запустить **IntelliJ IDEA**.

2. Открыть проект прошлого урока в **IntelliJ IDEA**.

![New Maven Project - Open...](./_Files/2.%20New%20Project/1.%20Open%20Project/01.jpg "New Maven Project - Open...")

3. Удалить все файлы .java из папки **./src/test/java** кроме **WebDriverFactory.java**

***

# 2. Чтение логов

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

Шаги:

1. Создать файл **LogsTest.java** в **./src/test/java**.

![New Maven Project - LogsTest.java](./_Files/2.%20New%20Project/2.%20Logs/01.jpg "New Maven Project - LogsTest.java")

2. Добавить в файл **LogsTest.java** код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(LogsTest.class);
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

## 2.1. Доступные типы логов

Шаги:

1. Открыть файл **LogsTest.java** в **./src/test/java**.

2. Добавить в файл **LogsTest.java** код.

* метод **availableLogTypesTest** - получение доступных типов логов

```java
@Test
public void availableLogTypesTest() {
    // Получение доступных типов логов
    Set<String> availableLogTypes = driver.manage().logs().getAvailableLogTypes();
    for (String s : availableLogTypes)
        logger.info("Log Type:  " + s);
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=LogsTest#availableLogTypesTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/2.%20Logs/02.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет выведен список доступных типов логов.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/2.%20Logs/03.jpg "New Maven Project - Лог запуска")

## 2.2. Получение логов заданного типа

Шаги:

1. Открыть файл **LogsTest.java** в **./src/test/java**.
   
2. Добавить в файл **LogsTest.java** код.

* метод **logsByTypeTest** - получение логов заданного типа (BROWSER)

```java
@Test
public void logsByTypeTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на кнопку "Всё верно"
    By btnYesXPath = By.xpath("(//span[text()=\"Всё верно\"])[1]");
    WebElement btnYes = driver.findElement(btnYesXPath);
    btnYes.click();
    logger.info("Нажата кнопка \"Всё верно\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Получить логи
    Logs logs = driver.manage().logs();
    LogEntries logsEntries = logs.get(LogType.BROWSER);
    List<LogEntry> logsEntriesList = logsEntries.getAll();
    for (LogEntry logsEntry : logsEntriesList) {
        logger.info(Date.from(Instant.ofEpochSecond(logsEntry.getTimestamp())) + " " +
            logsEntry.getLevel() + " " + logsEntry.getMessage());
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=LogsTest#logsByTypeTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/2.%20Logs/04.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будут получены логи заданного типа (BROWSER).

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/2.%20Logs/05.jpg "New Maven Project - Лог запуска")

## 2.3. Получение логов заданного типа и уровня

Шаги:

1. Открыть файл **LogsTest.java** в **./src/test/java**.

2. Добавить в файл **LogsTest.java** код.

* метод **logsByTypeAndLevelTest** - получение логов заданного типа (BROWSER) и уровня (SEVERE)

```java
@Test
public void logsByTypeAndLevelTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на кнопку "Всё верно"
    By btnYesXPath = By.xpath("(//span[text()=\"Всё верно\"])[1]");
    WebElement btnYes = driver.findElement(btnYesXPath);
    btnYes.click();
    logger.info("Нажата кнопка \"Всё верно\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Получить логи
    Logs logs = driver.manage().logs();
    LogEntries logsEntries = logs.get(LogType.BROWSER);
    List<LogEntry> logsEntriesList = logsEntries.getAll().stream()
        .filter(a -> a.getLevel() == Level.SEVERE)
        .collect(Collectors.toList());
    for (LogEntry logsEntry : logsEntriesList) {
        logger.info(Date.from(Instant.ofEpochMilli(logsEntry.getTimestamp())) + " " +
            logsEntry.getLevel() + " " + logsEntry.getMessage());
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=LogsTest#logsByTypeAndLevelTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/2.%20Logs/06.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будут получены логи заданного типа (BROWSER) и уровня (SEVERE).

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/2.%20Logs/07.jpg "New Maven Project - Лог запуска")

## 2.4. Полный код LogsTest.java

[LogsTest.java](_Sample/src/test/java/LogsTest.java)

***

# 3. Снятие скриншотов

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

Шаги:

1. Создать файл **ScreenShotsTest.java** в **./src/test/java**.

![New Maven Project - ScreenShotsTest.java](./_Files/2.%20New%20Project/3.%20Screen%20Shots/01.jpg "New Maven Project - ScreenShotsTest.java")

2. Добавить в файл **ScreenShotsTest.java** код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(ScreenShotsTest.class);
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

## 3.1. Снятие скриншотов с помощью TakeScreenshot

### 3.1.1. Скриншот видимой области веб страницы

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **takesScreenshotViewablePageTest** - скриншот видимой области веб страницы

```java
@Test
public void takesScreenshotViewablePageTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на кнопку "Всё верно"
    By btnYesXPath = By.xpath("(//span[text()=\"Всё верно\"])[1]");
    WebElement btnYes = driver.findElement(btnYesXPath);
    btnYes.click();
    logger.info("Нажата кнопка \"Всё верно\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сделать скриншот видимой области веб страницы
    try {
        File file = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);
        BufferedImage linkYesImage = ImageIO.read(file);
        ImageIO.write(linkYesImage, "png", new File("temp\\TSViewablePage.png"));
        logger.info("Скриншот сохранен в файле [temp\\TSViewablePage.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#takesScreenshotViewablePageTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.1.%20Selenium%20WebDriver/01.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот видимой области веб страницы будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.1.%20Selenium%20WebDriver/02.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.1.%20Selenium%20WebDriver/03.jpg "New Maven Project - Лог запуска")

### 3.1.2. Скриншот веб элемента

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **takesScreenshotElementTest** - скриншот веб элемента

```java
@Test
public void takesScreenshotElementTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на кнопку "Всё верно"
    By btnYesXPath = By.xpath("(//span[text()=\"Всё верно\"])[1]");
    WebElement btnYes = driver.findElement(btnYesXPath);
    btnYes.click();
    logger.info("Нажата кнопка \"Всё верно\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сделать скриншот веб элемента
    try {
        By divSubcategoryXPath = By.xpath("//div[@class=\"subcategory__item-container \"]");
        WebElement divSubcategory = driver.findElement(divSubcategoryXPath);
        File file = divSubcategory.getScreenshotAs(OutputType.FILE);
        BufferedImage viewablePageImage = ImageIO.read(file);
        ImageIO.write(viewablePageImage, "png", new File("temp\\TSElement.png"));
        logger.info("Скриншот сохранен в файле [temp\\TSElement.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#takesScreenshotElementTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.1.%20Selenium%20WebDriver/04.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот веб элемента будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.1.%20Selenium%20WebDriver/05.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.1.%20Selenium%20WebDriver/06.jpg "New Maven Project - Лог запуска")

### 3.1.3. Скриншот веб элемента вырезанный из видимой области веб страницы

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **takesScreenshotElementFromViewablePageTest** - скриншот веб элемента вырезанный из видимой области веб страницы

```java
@Test
public void takesScreenshotElementFromViewablePageTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на кнопку "Всё верно"
    By btnYesXPath = By.xpath("(//span[text()=\"Всё верно\"])[1]");
    WebElement btnYes = driver.findElement(btnYesXPath);
    btnYes.click();
    logger.info("Нажата кнопка \"Всё верно\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сделать скриншот веб элемента вырезанный из видимой области веб страницы
    try {
        By divSubcategoryXPath = By.xpath("//div[@class=\"subcategory__item-container \"]");
        WebElement divSubcategory = driver.findElement(divSubcategoryXPath);
        Point location = divSubcategory.getLocation();
        Dimension size = divSubcategory.getSize();
        File file = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);
        BufferedImage viewablePageImage = ImageIO.read(file);
        BufferedImage linkYesImage = viewablePageImage.getSubimage(
            location.getX() - 50, location.getY() - 50,
            size.getWidth() + 200, size.getHeight() + 100);
        ImageIO.write(linkYesImage, "png", new File("temp\\TSElementFromViewablePage.png"));
        logger.info("Скриншот сохранен в файле [temp\\TSElementFromViewablePage.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#takesScreenshotElementFromViewablePageTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.1.%20Selenium%20WebDriver/07.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот веб элемента вырезанный из видимой области веб страницы будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.1.%20Selenium%20WebDriver/08.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.1.%20Selenium%20WebDriver/09.jpg "New Maven Project - Лог запуска")

## 3.2. Снятие скриншотов с помощью AShot

### 3.2.1. Утилита Яндекса для захвата скриншотов - AShot

В **POM.xml** добавить следующую зависимость в раздел **dependencies**

```xml
<dependency>
    <groupId>ru.yandex.qatools.ashot</groupId>
    <artifactId>ashot</artifactId>
    <version>1.5.4</version>
    <scope>test</scope>
</dependency>
```

### 3.2.2. Скриншот видимой области веб страницы

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **aShotViewablePageTest** - скриншот видимой области веб страницы

```java
@Test
public void aShotViewablePageTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на кнопку "Всё верно"
    By btnYesXPath = By.xpath("(//span[text()=\"Всё верно\"])[1]");
    WebElement btnYes = driver.findElement(btnYesXPath);
    btnYes.click();
    logger.info("Нажата кнопка \"Всё верно\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сделать скриншот видимой области веб страницы
    try {
        Screenshot screenshot = new AShot().takeScreenshot(driver);
        ImageIO.write(screenshot.getImage(), "png", new File("temp\\ASViewablePage.png"));
        logger.info("Скриншот сохранен в файле [temp\\ASViewablePage.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#aShotViewablePageTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.2.%20AShot/01.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот видимой области веб страницы будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.2.%20AShot/02.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.2.%20AShot/03.jpg "New Maven Project - Лог запуска")

### 3.2.3. Скриншот всей веб страницы

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **aShotFullPageTest** - скриншот всей веб страницы

```java
@Test
public void aShotFullPageTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    // Нажать на кнопку "Всё верно"
    By btnYesXPath = By.xpath("(//span[text()=\"Всё верно\"])[1]");
    WebElement btnYes = driver.findElement(btnYesXPath);
    btnYes.click();
    logger.info("Нажата кнопка \"Всё верно\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сделать скриншот всей веб страницы
    try {
        Screenshot screenshot = new AShot()
            .shootingStrategy(ShootingStrategies.viewportPasting(100))
            .takeScreenshot(driver);
        ImageIO.write(screenshot.getImage(), "png", new File("temp\\ASFullPage.png"));
        logger.info("Скриншот сохранен в файле [temp\\ASFullPage.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#aShotFullPageTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.2.%20AShot/04.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот всей веб страницы будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.2.%20AShot/05.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.2.%20AShot/06.jpg "New Maven Project - Лог запуска")

### 3.2.4. Скриншот веб элемента

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **aShotElementTest** - скриншот веб элемента

```java
@Test
public void aShotElementTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на кнопку "Всё верно"
    By btnYesXPath = By.xpath("(//span[text()=\"Всё верно\"])[1]");
    WebElement btnYes = driver.findElement(btnYesXPath);
    btnYes.click();
    logger.info("Нажата кнопка \"Всё верно\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сделать скриншот веб элемента
    try {
        By divSubcategoryXPath = By.xpath("//div[@class=\"subcategory__item-container \"]");
        WebElement divSubcategory = driver.findElement(divSubcategoryXPath);
        Screenshot screenshot = new AShot()
            .coordsProvider(new WebDriverCoordsProvider())
            .takeScreenshot(driver, divSubcategory);
        ImageIO.write(screenshot.getImage(), "png", new File("temp\\ASElement.png"));
        logger.info("Скриншот сохранен в файле [temp\\ASElement.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#aShotElementTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.2.%20AShot/07.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот веб элемента будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.2.%20AShot/08.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.2.%20AShot/09.jpg "New Maven Project - Лог запуска")

### 3.2.5. Сравнение скриншота с образцом

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **aShotCompareImagesTest** - сравнение скриншота с образцом

```java
@Test
public void aShotCompareImagesTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на кнопку "Всё верно"
    By btnYesXPath = By.xpath("(//span[text()=\"Всё верно\"])[1]");
    WebElement btnYes = driver.findElement(btnYesXPath);
    btnYes.click();
    logger.info("Нажата кнопка \"Всё верно\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сравнить скриншот с образцом
    try {
        BufferedImage actualImage = new AShot().takeScreenshot(driver).getImage();
        BufferedImage expectedImage = ImageIO.read(new File("temp\\ASCompareImagesExpectedImage.png"));
        ImageDiffer imageDiffer = new ImageDiffer();
        ImageDiff diff = imageDiffer.makeDiff(actualImage, expectedImage);
        if (diff.hasDiff()) {
            logger.info("Изображения одинаковые");
        } else {
            logger.info("Изображения разные");
        }
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#aShotCompareImagesTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.2.%20AShot/10.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате будет выполнено сравнение скриншота с образцом.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.2.%20AShot/11.jpg "New Maven Project - Лог запуска")

### 3.2.6. Скриншот с эффектом

Шаги:

1. Открыть файл **ScreenShotsTest.java** в **./src/test/java**.

2. Добавить в файл **ScreenShotsTest.java** код.

* метод **aShotPrettifyTest** - скриншот веб элемента с эффектом

```java
@Test
public void aShotPrettifyTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на кнопку "Всё верно"
    By btnYesXPath = By.xpath("(//span[text()=\"Всё верно\"])[1]");
    WebElement btnYes = driver.findElement(btnYesXPath);
    btnYes.click();
    logger.info("Нажата кнопка \"Всё верно\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Сделать скриншот с эффектом
    try {
        By divSubcategoryXPath = By.xpath("//div[@class=\"subcategory__item-container \"]");
        WebElement divSubcategory = driver.findElement(divSubcategoryXPath);
        Screenshot screenshot = new AShot()
            .imageCropper(new IndentCropper()
                .addIndentFilter(new BlurFilter()))
            .takeScreenshot(driver, divSubcategory);
        ImageIO.write(screenshot.getImage(), "png", new File("temp\\ASPrettify.png"));
        logger.info("Скриншот сохранен в файле [temp\\ASPrettify.png]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=ScreenShotsTest#aShotPrettifyTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.2.%20AShot/12.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот с эффектом будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.2.%20AShot/13.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/3.%20Screen%20Shots/3.2.%20AShot/14.jpg "New Maven Project - Лог запуска")

## 3.3. Полный код ScreenShotsTest.java

[ScreenShotsTest.java](_Sample/src/test/java/ScreenShotsTest.java)

***

# 4. Запись видео

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

## 4.1. Запись видео с помощью Monte

### 4.1.1. Библиотека для записи видео - Monte 

В POM.xml добавить следующую зависимость в раздел **dependencies**

```xml
<dependency>
    <groupId>com.github.stephenc.monte</groupId>
    <artifactId>monte-screen-recorder</artifactId>
    <version>0.7.7.0</version>
    <scope>test</scope>
</dependency>
```

### 4.1.2. Запись видео

Шаги:

1. Создать файл **VideoRecordsTest.java** в **./src/test/java**.

![New Maven Project - VideoRecordsTest.java](./_Files/2.%20New%20Project/4.%20Video%20Records/01.jpg "New Maven Project - VideoRecordsTest.java")

2. Добавить в файл **VideoRecordsTest.java** код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(VideoRecordsTest.class);
```

* объявление рекордера, конфигуратора графики и путь к файлу

```java
private ScreenRecorder screenRecorder;              // Рекордер видео
private final String RECORD_DIRECTORY = "temp\\";   // Путь до каталога с выходным файлом
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
    // Конфигурация графики
    GraphicsConfiguration gc = GraphicsEnvironment
        .getLocalGraphicsEnvironment()
        .getDefaultScreenDevice()
        .getDefaultConfiguration();

    try {
        File dir = new File(RECORD_DIRECTORY);
        screenRecorder = new ScreenRecorder(
            // Конфигурация графики
            gc,
            // Формат выходного файла
            new Format(
                MediaTypeKey, MediaType.FILE,
                MimeTypeKey, MIME_AVI),
            // Формат видео кадра
            new Format(
                MediaTypeKey, MediaType.VIDEO,
                EncodingKey, ENCODING_AVI_TECHSMITH_SCREEN_CAPTURE,
                CompressorNameKey, ENCODING_AVI_TECHSMITH_SCREEN_CAPTURE,
                DepthKey, 24,
                FrameRateKey, Rational.valueOf(15),
                QualityKey, 1.0f,
                KeyFrameIntervalKey, 15 * 60),
            // Формат курсора мыши
            new Format(
                MediaTypeKey, MediaType.VIDEO,
                EncodingKey, "black",
                FrameRateKey, Rational.valueOf(30)),
            // Формат аудио
            null);
        screenRecorder.start(); // Старт записи видео
    } catch (Exception e) {
        e.printStackTrace();
    }
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    try {
        screenRecorder.stop(); // Стоп записи видео
        // Сохранение файла под заданным именем
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd HH.mm.ss");
        File newFileName = new File(String.format("%s%s.avi", RECORD_DIRECTORY, dateFormat.format(new Date())));
        screenRecorder.getCreatedMovieFiles().get(0).renameTo(newFileName);
    } catch (Exception e) {
        System.out.println(e);
    }
    
    if (driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* метод **monteVideoRecorderTest** - запись видео

```java
@Test
public void monteVideoRecorderTest() {
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на кнопку "Всё верно"
    By btnYesXPath = By.xpath("(//span[text()=\"Всё верно\"])[1]");
    WebElement btnYes = driver.findElement(btnYesXPath);
    btnYes.click();
    logger.info("Нажата кнопка \"Всё верно\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//div/a[text()=\"Бытовая техника\"]");
    WebElement linkBT = driver.findElement(linkBTXPath);
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=VideoRecordsTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/4.%20Video%20Records/4.1.%20Monte%20Screen%20Recorder/02.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате скриншот с эффектом будет сохранен в указанном каталоге.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/4.%20Video%20Records/4.1.%20Monte%20Screen%20Recorder/03.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/4.%20Video%20Records/4.1.%20Monte%20Screen%20Recorder/04.jpg "New Maven Project - Лог запуска")

## 4.2. Полный код VideoRecordsTest.java

[VideoRecordsTest.java](_Sample/src/test/java/VideoRecordsTest.java)

***

# 5. Перехват трафика

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

## 5.1. Перехват трафика с помощью BrowserMob Proxy

### 5.1.1. Библиотека прокси для перехвата трафика - BrowserMob Proxy

В POM.xml добавить следующие зависимости в раздел **dependencies**

```xml
<dependency>
    <groupId>net.lightbody.bmp</groupId>
    <artifactId>browsermob-core</artifactId>
    <version>2.1.5</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>com.google.guava</groupId>
    <artifactId>guava</artifactId>
    <version>30.1.1-jre</version>
</dependency>
```

### 5.1.2. Перехват трафика

Шаги:

1. Создать файл **HttpCaptureTest.java** в **./src/test/java**.

![New Maven Project - HttpCaptureTest.java](./_Files/2.%20New%20Project/5.%20Http%20Capture/5.1.%20BrowserMob%20Proxy/01.jpg "New Maven Project - HttpCaptureTest.java")

2. Добавить в файл **HttpCaptureTest.java** код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(HttpCaptureTest.class);
```

* объявление прокси

```java
private static BrowserMobProxyServer proxy;
private static Proxy seleniumProxy;
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    // Запуск прокси BrowserMob Proxy
    proxy = new BrowserMobProxyServer();
    proxy.setTrustAllServers(true);
    proxy.setHarCaptureTypes(CaptureType.REQUEST_CONTENT, CaptureType.RESPONSE_CONTENT);
    proxy.enableHarCaptureTypes(CaptureType.REQUEST_CONTENT, CaptureType.RESPONSE_CONTENT);
    proxy.start(8080);

    // Настройка прокси Selenium
    seleniumProxy = ClientUtil.createSeleniumProxy(proxy);
    try {
        String hostIp = Inet4Address.getLocalHost().getHostAddress();
        seleniumProxy.setHttpProxy(hostIp + ":" + proxy.getPort());
        seleniumProxy.setSslProxy(hostIp + ":" + proxy.getPort());
    } catch (UnknownHostException e) {
        e.printStackTrace();
    }

    // Конфигурирование драйвера Selenium WebDriver для прокси
    WebDriverManager.chromedriver().setup();
    logger.info("Драйвер для браузера Google Chrome");
    DesiredCapabilities capabilities = new DesiredCapabilities();
    capabilities.setCapability(CapabilityType.PROXY, seleniumProxy);
    capabilities.setCapability(CapabilityType.ACCEPT_SSL_CERTS, true);
    ChromeOptions chromeOptions = new ChromeOptions();
    chromeOptions.merge(capabilities);
    chromeOptions.addArguments("--start-maximized");
    chromeOptions.addArguments("--disable-web-security");
    chromeOptions.addArguments("--allow-insecure-localhost");
    chromeOptions.addArguments("--ignore-urlfetcher-cert-requests");
    chromeOptions.addArguments("--ignore-certificate-errors");
    driver = new ChromeDriver(chromeOptions);
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        proxy.stop();
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

* метод **httpCaptureTest** - перехват трафика

```java
@Test
public void httpCaptureTest() {
    proxy.newHar("dns-shop.ru");
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на кнопку "Всё верно"
    By btnYesXPath = By.xpath("(//span[text()=\"Всё верно\"])[1]");
    WebElement btnYes = driver.findElement(btnYesXPath);
    btnYes.click();
    logger.info("Нажата кнопка \"Всё верно\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Чтение данных прокси
    Har har = proxy.getHar();
    File harFile = new File("dns-shop.har");
    try {
        har.writeTo(harFile);
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

3. Запустить тест командой **mvn clean test** с параметром **-Dtest=HttpCaptureTest**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/5.%20Http%20Capture/5.1.%20BrowserMob%20Proxy/02.jpg "New Maven Project - Запуск теста")

4. Готово!

В результате файл с расширением **.har** будет сохранен в указанном каталоге.
Однако логов в данном файле не будет, так как последние версии **Selenium WebDriver** работают немного подругому с **BrowserMob Proxy**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/5.%20Http%20Capture/5.1.%20BrowserMob%20Proxy/03.jpg "New Maven Project - Сохраненный файл")

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/5.%20Http%20Capture/5.1.%20BrowserMob%20Proxy/04.jpg "New Maven Project - Лог запуска")

## 5.2. Полный код HttpCaptureTest.java

[HttpCaptureTest.java](_Sample/src/test/java/HttpCaptureTest.java)

***

# 6. Отслеживание событий

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

Шаги:

1. Создать файл **ListenersTest.java** в **./src/test/java**.

![New Maven Project - ListenersTest.java](./_Files/2.%20New%20Project/6.%20Selenium%20Listeners/01.jpg "New Maven Project - ListenersTest.java")

2. Добавить в файл **ListenersTest.java** код.

* объявление драйвера и логгера

```java
protected static WebDriver driver;
private Logger logger = LogManager.getLogger(ListenersTest.class);
```

* метод **setUp**

```java
@BeforeEach
public void setUp() {
    driver = WebDriverFactory.getDriver("chrome");
    logger.info("Драйвер стартовал!");
}
```

* метод **setDown**

```java
@AfterEach
public void setDown() {
    if(driver != null) {
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

## 6.1. Отслеживание событий в Selenium 3

Так как уже есть 4 версия библиотеки **Selenium WebDriver**, то 6.1 и 6.2 можно пропустить.
Но если очень интересно, то можете пройти эти шаги.

Шаги:

1. Создать файл **Selenium3Listener.java** в **./src/test/java**.

![New Maven Project - Selenium3Listener.java](./_Files/2.%20New%20Project/6.%20Selenium%20Listeners/6.1.%20Selenium%203/01.jpg "New Maven Project - Selenium3Listener.java")

2. Наследовать абстрактный класс **AbstractWebDriverEventListener**.

```java
public class Selenium3Listener extends AbstractWebDriverEventListener {

}
```

3. Добавить в файл **Selenium3Listener.java** код.

* объявление логгера

```java
private Logger logger = LogManager.getLogger(Selenium3Listener.class);
```

* переопределение методов абстрактного класса **AbstractWebDriverEventListener**
                                                       
```java
// До поиска веб элемента
@Override
public void beforeFindBy(By locator, WebElement element, WebDriver driver) {
    logger.info("До поиска веб элемента: Сделать что-то, например записать в лог локатор веб элемента");
}

// После поиска веб элемента
@Override
public void afterFindBy(By locator, WebElement element, WebDriver driver) {
    logger.info("После поиска веб элемента: Сделать что-то, например записать в лог тег веб элемента");
}

// До нажатия на веб элемент
@Override
public void beforeClickOn(WebElement element, WebDriver driver) {
    logger.info("До нажатия на веб элемент: Сделать что-то, например снять скриншот");
}

// После нажатия на веб элемент
@Override
public void afterClickOn(WebElement element, WebDriver driver) {
    logger.info("После нажатия на веб элемент: Сделать что-то, например снять скриншот");
}
```

4. Открыть файл **ListenersTest.java** в **./src/test/java**.

5. Добавить в файл **ListenersTest.java** код.

* метод **listenerSelenium3Test** - слушатель **Selenium 3**

```java
@Test
public void listenerSelenium3Test() {
    // Регистрация слушателя событий
    Selenium3Listener listener = new Selenium3Listener();
    EventFiringWebDriver eventFiringWebDriver = new EventFiringWebDriver(driver);
    eventFiringWebDriver.register(listener);
    // Открыть страницу https://www.dns-shop.ru/
    eventFiringWebDriver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на кнопку "Всё верно"
    By btnYesXPath = By.xpath("(//span[text()=\"Всё верно\"])[1]");
    WebElement btnYes = eventFiringWebDriver.findElement(btnYesXPath);
    logger.info("Найдена кнопка \"Всё верно\"");
    btnYes.click();
    logger.info("Нажата кнопка \"Всё верно\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//a[text()=\"Бытовая техника\"]");
    WebElement linkBT = eventFiringWebDriver.findElement(linkBTXPath);
    logger.info("Найдена ссылка \"Бытовая техника\"");
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Нажать на ссылку "Техника для кухни"
    By linkTKXPath = By.xpath("//span[text()=\"Техника для кухни\"]/ancestor::a");
    WebElement linkTK = eventFiringWebDriver.findElement(linkTKXPath);
    logger.info("Найдена ссылка \"Техника для кухни\"");
    linkTK.click();
    logger.info("Нажата ссылка \"Техника для кухни\"");
}
```

6. Запустить тест командой **mvn clean test** с параметром **-Dtest=ListenersTest#listenerSelenium3Test**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/6.%20Selenium%20Listeners/6.1.%20Selenium%203/02.jpg "New Maven Project - Запуск теста")

7. Готово!

В результате до и после выполнения каждой команды поиска и нажатия на элемент будет выводиться лог.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/6.%20Selenium%20Listeners/6.1.%20Selenium%203/03.png "New Maven Project - Лог запуска")

## 6.2. Полный код Selenium3Listener.java

[Selenium3Listener.java](_Sample/src/test/java/Selenium3Listener.java)

## 6.3. Отслеживание событий в Selenium 4

Шаги:

1. Создать файл **Selenium4Listener.java** в **./src/test/java**.

![New Maven Project - Selenium4Listener.java](./_Files/2.%20New%20Project/6.%20Selenium%20Listeners/6.2.%20Selenium%204/01.jpg "New Maven Project - Selenium4Listener.java")

2. Реализовать интерфейс **WebDriverListener**

```java
public class Selenium4Listener implements WebDriverListener {
    
}
```

3. Добавить в файл **Selenium4Listener.java** код.

* объявление логгера

```java
private Logger logger = LogManager.getLogger(Selenium4Listener.class);
```

* переопределение методов интерфейса **WebDriverListener**

```java
// До поиска веб элемента
@Override
public void beforeFindElement(WebDriver driver, By locator) {
    logger.info("До поиска веб элемента: Сделать что-то, например записать в лог локатор веб элемента");
}

// После поиска веб элемента
@Override
public void afterFindElement(WebDriver driver, By locator, WebElement result) {
    logger.info("После поиска веб элемента: Сделать что-то, например записать в лог тег веб элемента");
}

// До нажатия на веб элемент
@Override
public void beforeClick(WebElement element) {
    logger.info("До нажатия на веб элемент: Сделать что-то, например снять скриншот");
}

// После нажатия на веб элемент
@Override
public void afterClick(WebElement element) {
    logger.info("После нажатия на веб элемент: Сделать что-то, например снять скриншот");
}
```

4. Открыть файл **ListenersTest.java** в **./src/test/java**.

5. Добавить в файл **ListenersTest.java** код.

* метод **listenerSelenium4Test** - слушатель **Selenium 4**

```java
@Test
public void listenerSelenium4Test() {
    // Регистрация слушателя событий
    Selenium4Listener listener = new Selenium4Listener();
    WebDriver eventFiringWebDriver = new EventFiringDecorator<>(listener).decorate(driver);
    // Открыть страницу https://www.dns-shop.ru/
    eventFiringWebDriver.get("https://www.dns-shop.ru/");
    logger.info("Открыта страница dns-shop.ru - https://www.dns-shop.ru/");
    // Нажать на кнопку "Всё верно"
    By btnYesXPath = By.xpath("(//span[text()=\"Всё верно\"])[1]");
    WebElement btnYes = eventFiringWebDriver.findElement(btnYesXPath);
    logger.info("Найдена кнопка \"Всё верно\"");
    btnYes.click();
    logger.info("Нажата кнопка \"Всё верно\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Нажать на ссылку "Бытовая техника"
    By linkBTXPath = By.xpath("//a[text()=\"Бытовая техника\"]");
    WebElement linkBT = eventFiringWebDriver.findElement(linkBTXPath);
    logger.info("Найдена ссылка \"Бытовая техника\"");
    linkBT.click();
    logger.info("Нажата ссылка \"Бытовая техника\"");
    // Ожидание обновления страницы
    try {
        Sleeper.SYSTEM_SLEEPER.sleep(Duration.ofSeconds(5));
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    // Нажать на ссылку "Техника для кухни"
    By linkTKXPath = By.xpath("//span[text()=\"Техника для кухни\"]/ancestor::a");
    WebElement linkTK = eventFiringWebDriver.findElement(linkTKXPath);
    logger.info("Найдена ссылка \"Техника для кухни\"");
    linkTK.click();
    logger.info("Нажата ссылка \"Техника для кухни\"");
}
```

6. Запустить тест командой **mvn clean test** с параметром **-Dtest=ListenersTest#listenerSelenium4Test**.

![New Maven Project - Запуск теста](./_Files/2.%20New%20Project/6.%20Selenium%20Listeners/6.2.%20Selenium%204/02.jpg "New Maven Project - Запуск теста")

7. Готово!

В результате до и после выполнения каждой команды поиска и нажатия на элемент будет выводиться лог.

В консоли будет выведен лог запуска.

![New Maven Project - Лог запуска](./_Files/2.%20New%20Project/6.%20Selenium%20Listeners/6.2.%20Selenium%204/03.png "New Maven Project - Лог запуска")

## 6.4. Полный код Selenium4Listener.java

[Selenium4Listener.java](_Sample/src/test/java/Selenium4Listener.java)

## 6.5. Полный код ListenersTest.java

[ListenersTest.java](_Sample/src/test/java/ListenersTest.java)

***

[![Лекция](https://img.shields.io/badge/-Лекция-ee99ff)](1.%20Лекция.md)
[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Задание](https://img.shields.io/badge/-Задание-99ffee)](3.%20Задание.md)