Java_QA / 05. Selenium WebDriver. Веб элементы

[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Практика](https://img.shields.io/badge/-Практика-aaffaa)](2.%20Практика.md)

***

# Содержание

* [1. Что такое веб элементы?](#1-что-такое-веб-элементы)
* [2. Свойства](#2-свойства)
  * [2.1. Интерфейс WebElement](#21-интерфейс-webelement)
    * [2.1.1. Атрибуты и свойства](#211-атрибуты-и-свойства)
    * [2.1.2. Размер и положение](#212-размер-и-положение)
    * [2.1.3. Видимость и доступность](#213-видимость-и-доступность)
    * [2.1.4. Текст](#214-текст)
    * [2.1.5. Стили](#215-стили)
  * [2.2. Класс Dimension](#22-класс-dimension)
  * [2.3. Класс Point](#23-класс-point)
  * [2.4. Класс Rectangle](#24-класс-rectangle)
* [3. Простые действия](#3-простые-действия)
  * [3.1. Интерфейс WebElement](#31-интерфейс-webelement)
    * [3.1.1. Нажатие на элемент](#311-нажатие-на-элемент)
    * [3.1.2. Ввод текста в поле ввода](#312-ввод-текста-в-поле-ввода)
    * [3.1.3. Удаление текста из поля ввода](#313-удаление-текста-из-поля-ввода)
    * [3.1.4. Отправка данных формы](#314-отправка-данных-формы)
  * [3.2. Исключения](#32-исключения)
    * [3.2.1. StaleElementReferenceException](#321-staleelementreferenceexception)
      * [3.2.1.1. Причины](#3211-причины)
      * [3.2.1.2. Решения](#3212-решения)
    * [3.2.2. ElementClickInterceptedException](#322-elementclickinterceptedexception)
      * [3.2.2.1. Причины](#3221-причины)
      * [3.2.2.2. Решения](#3222-решения)
    * [3.2.3. ElementNotInteractableException](#323-elementnotinteractableexception)
      * [3.2.3.1. Причины](#3231-причины)
      * [3.2.3.2. Решения](#3232-решения)
    * [3.2.4. InvalidElementStateException](#324-invalidelementstateexception)
      * [3.2.4.1. Причины](#3241-причины)
      * [3.2.4.2. Решения](#3242-решения)
    * [3.2.5. TimeoutException](#325-timeoutexception)
* [4. Сложные действия](#4-сложные-действия)
  * [4.1. Интерфейс Action](#41-интерфейс-action)
  * [4.2. Класс Actions](#42-класс-actions)
    * [4.2.1. Левый клик мышью](#421-левый-клик-мышью)
    * [4.2.2. Левый клик мышью c удержанием](#422-левый-клик-мышью-c-удержанием)
    * [4.2.3. Правый клик мышью](#423-правый-клик-мышью)
    * [4.2.4. Двойной клик мышью](#424-двойной-клик-мышью)
    * [4.2.5. Перетаскивание объекта](#425-перетаскивание-объекта)
    * [4.2.6. Нажатие и отпускание клавиши клавиатуры](#426-нажатие-и-отпускание-клавиши-клавиатуры)
    * [4.2.7. Смещение мыши](#427-смещение-мыши)
    * [4.2.8. Перемещение мыши на элемент](#428-перемещение-мыши-на-элемент)
    * [4.2.9. Отпускание левой кнопки мыши](#429-отпускание-левой-кнопки-мыши)
  * [4.3. Перечисление Keys](#43-перечисление-keys)
  * [4.4. Исключения](#44-исключения)
    * [4.4.1. MoveTargetOutOfBoundsException](#441-movetargetoutofboundsexception)
      * [4.4.1.1. Причины](#4411-причины)
      * [4.4.1.2. Решения](#4412-решения)

***

# 1. Что такое веб элементы?

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

***Веб элементы*** – **DOM** объекты, находящиеся на веб странице, то, что пользователь видит (а иногда и не видит) 
на странице – заголовки, кнопка **ОК**, поля ввода, текстовые блоки и т д.

![Веб элементы](_Files/1.%20Web%20Elements/01.jpg "Веб элементы")

Веб элементы представляет собой элементы **HTML**.

Каждый элемент **HTML** состоит из:

* *тегов* (открывающий и закрывающий)
* *атрибутов* (необязательно)
* *текстового содержимого* (необязательно)

![Веб элементы](_Files/1.%20Web%20Elements/02.png "Веб элементы")

***

# 2. Свойства 

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

У каждого веб элемента **Selenium WebDriver** позволяет получить свойства:

* *тег элемента*
* *значение CSS параметра элемента*
* *значение атрибута элемента*
* *расположение элемента*
* *размеры элемента*
* *текстовое содержимое*
и т д

## 2.1. Интерфейс WebElement

***WebElement*** - интерфейс реализующий взаимодействие с веб элементами.

Методы интерфейса **WebElement**:

| Тип       | Метод                        | Описание                                                              |
|-----------|------------------------------|-----------------------------------------------------------------------|
| String    | getTagName()                 | Получение имени тега элемента                                         |
| String    | getCssValue(String name)     | Получение значения CSS параметра элемента                             |
| String    | getAttribute(String name)    | Получение значения атрибута элемента                                  |
| String    | getAccessibleName()          | Получение имени                                                       |
| String    | getDomProperty(String name)  | Получение значения DOM параметра элемента                             |
| String    | getDomAttribute(String name) | Получение значения DOM атрибута элемента                              |
| Dimension | getSize()                    | Получение значения размеров (ширины и высоты) элемента                |
| Point     | getLocation()                | Получение значения координат (x и y) верхнего левого угла элемента    |
| Rectangle | getRect()                    | Получение значения размеров и координат верхнего левого угла элемента |
| String    | getText()                    | Получение текстового содержимого элемента                             |
| boolean   | isDisplayed()                | Проверка видимости элемента                                           |
| boolean   | isEnabled()                  | Проверка доступности элемента                                         |
| boolean   | isSelected()                 | Проверка выбора элемента                                              |

[selenium/docs/api : WebDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/WebDriver.html)

### 2.1.1. Атрибуты и свойства

Для получения имени тега применяется команда **getTagName**.

*Пример*

```java
WebElement element = driver.findElement(By.id("email"));
String tagName = element.getTagName();
```

Для получения значения атрибута применяется команда **getAttribute**.

*Пример*

```java
WebElement element = driver.findElement(By.id("email"));
String tagName = element.getAttribute();
```

### 2.1.2. Размер и положение

Для получения размеров (значения ширины и высоты) элемента применяется команда **getSize**.

*Пример*

```java
WebElement element = driver.findElement(By.id("email"));
Dimension size = element.getSize();
int height = size.getHeight();
int width = size.getWidth();
```

Для получения положения верхнего левого угла (значения координат x, y) элемента применяется команда **getLocation**.

*Пример*

```java
WebElement element = driver.findElement(By.id("email"));
Point location = element.getLocation();
int x = location.getX();
int y = location.getY();
```

Для получения размеров и положения верхнего левого угла элемента применяется команда **getRect**.

*Пример*

```java
WebElement element = driver.findElement(By.id("email"));
Rectangle rect = element.getRect();
Dimension size = rect.getDimension();
int height = size.getHeight();
int width = size.getWidth();
Point location = rect.getPoint();
int x = location.getX();
int y = location.getY();
```

### 2.1.3. Видимость и доступность

Для проверки видимости элемента применяется команда **isDisplayed**.

*Пример*

```java
WebElement element = driver.findElement(By.id("email"));
boolean isDisplayed = element.isDisplayed();
```

Для проверки доступности элемента применяется команда **isEnabled**.

*Пример*

```java
WebElement element = driver.findElement(By.id("email"));
boolean isEnabled = element.isEnabled();
```

Для проверки выбора элемента применяется команда **isSelected**.

*Пример*

```java
WebElement element = driver.findElement(By.id("email"));
boolean isSelected = element.isSelected();
```

### 2.1.4. Текст

Для получения текстового содержимого элемента применяется команда **getText**.

*Пример*

```java
WebElement element = driver.findElement(By.tagName("h1"));
String text = element.getText();
```

### 2.1.5. Стили

Для получения значения CSS применяется команда **getCssValue(String name)**.

*Пример*

```java
WebElement element = driver.findElement(By.id("email"));
String tagName = element.getCssValue();
```

## 2.2. Класс Dimension

***Dimension*** - класс представляющий размеры (ширина и высота).

Методы класса **Dimension**:

| Тип | Метод       | Описание         | 
|-----|-------------|------------------|
| int | getHeight() | Получение высоты |
| int | getWidth()  | Получение ширины |

[selenium/docs/api : Dimension](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Dimension.html)

## 2.3. Класс Point

***Point*** - класс представляющий положение точки (координаты x, y).

Методы класса **Point**:

| Тип    | Метод                            | Описание                                | 
|--------|----------------------------------|-----------------------------------------|
| int    | getX()                           | Получение координаты x                  |
| int    | getY()                           | Получение координаты y                  |
| Point  | moveBy(int xOffset, int yOffset) | Перемещение в точку с координатами x, y |

[selenium/docs/api : Point](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Point.html)

## 2.4. Класс Rectangle

***Rectangle*** - класс представляющий положение верхнего левого угла и размеры элемента.

Методы класса **Rectangle**:

| Тип       | Метод          | Описание                                              | 
|-----------|----------------|-------------------------------------------------------|
| Dimension | getDimension() | Получение размеров элемента                           |
| int       | getHeight()    | Получение высоты элемента                             |
| int       | getWidth()     | Получение ширины элемента                             |
| Point     | getPoint()     | Получение положения верхнего левого угла элемента     |
| int       | getX()         | Получение координаты x верхнего левого угла элемента  |
| int       | getY()         | Получение координаты y верхнего левого угла элемента  |

[selenium/docs/api : Rectangle](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Rectangle.html)

***

# 3. Простые действия

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

С каждым элементом **Selenium WebDriver** может выполнить простые действия:

* кликнуть на элемент
* передать значения (поля ввода)
* удалить значение (поля ввода)
* найти элементы внутри элемента

## 3.1. Интерфейс WebElement

***WebElement*** - интерфейс реализующий взаимодействие с веб элементами.

Методы интерфейса **WebElement**:

| Тип  | Метод                                | Описание                        | 
|------|--------------------------------------|---------------------------------|
| void | click()                              | Нажатие на элемент              |
| void | sendKeys(CharSequence... keysToSend) | Ввод текста в поле ввода        |
| void | clear()                              | Очистка поля ввода              |
| void | submit()                             | Отправка данных формы           |
| void | findElement(By by)                   | Поиск элемента внутри элемента  |
| void | findElements(By by)                  | Поиск элементов внутри элемента |

[selenium/docs/api : WebDriver](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/WebDriver.html)

### 3.1.1. Нажатие на элемент

Для выполнения нажатия на элемент применяется команда **click**.

*Пример*

```java
WebElement element = driver.findElement(By.name("send"));
element.click();
```

### 3.1.2. Ввод текста в поле ввода

Для ввода текста в поля ввода применяется команда **sendKeys**.

*Пример*

```java
WebElement element = driver.findElement(By.name("email"));
element.sendKeys("fake@fake.fake");
```

### 3.1.3. Удаление текста из поля ввода

Для удаления текста из поля ввода применяется команда **clear()**

*Пример*

```java
WebElement element = driver.findElement(By.name("email"));
element.clear();
```

### 3.1.4. Отправка данных формы

Для отправки данных формы применяется команда **submit()**

*Пример*

```java
WebElement element = driver.findElement(By.name("email"));
element.submit();
```

## 3.2. Исключения

### 3.2.1. StaleElementReferenceException

***StaleElementReferenceException*** — исключение, которое вызывается, когда ссылка на элемент больше не действительна.
То есть, если элемент доступен в **DOM** на момент поиска, но спустя время, в момент его вызова, в **DOM** его больше нет.

[selenium/docs/api : StaleElementReferenceException](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/StaleElementReferenceException.html)

#### 3.2.1.1. Причины

* Страница с искомым веб элементом, была обновлена

*Пример*

В примере ниже сначала веб элемент был найден на странице.
Затем веб страница была обновлена.
Найденный веб элемент был полностью удален со страницы.

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    String xpath = "//a[text()=\"Офис и сеть\"]";
    WebElement element = driver.findElement(By.xpath(xpath));
    driver.navigate().refresh();
    element.click();
}
```

В результате вызывается исключение **StaleElementReferenceException**.

```text
org.openqa.selenium.StaleElementReferenceException: stale element reference: 
element is not attached to the page document
```

* Переход на другую страницу / вкладку / окно

*Пример*

В примере ниже сначала веб элемент был найден на странице.
Далее был выполнен переход на новую вкладку и открыта та же страница.
На данной странице уже нет найденного раннее веб элемента.

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    String xpath = "//a[text()=\"Офис и сеть\"]";
    WebElement element = driver.findElement(By.xpath(xpath));
    driver.switchTo().newWindow(WindowType.TAB);
    driver.get("https://www.dns-shop.ru/");
    element.click();
}
```

В результате вызывается исключение **StaleElementReferenceException**.

```text
org.openqa.selenium.StaleElementReferenceException: stale element reference: 
element is not attached to the page document
```

* Библиотека **JS** удалила веб элемент и заменила его веб элементом с таким же ID или атрибутами

Несмотря на то, что замененные веб элементы могут выглядеть похожими на оригиналы, они отличаются.
**Selenium Driver** не может определить, что замененный веб элемент на самом деле тот же, что и ожидался.

В результате вызывается исключение **StaleElementReferenceException**.

* Веб элемент больше не подключен к **DOM** модели

Общей техникой, используемой для имитации вкладок интерфейса в веб-приложениях,
является подготовка нескольких элементов **div** для каждой вкладки,
но прикреплен к **DOM** в один момент времени только один из них, остальные же сохранены в переменные.
Код может иметь ссылку на веб элемент, который больше не прикреплен к **DOM**
(то есть его предком является **.documentElement**).

В результате вызывается исключение **StaleElementReferenceException**.

#### 3.2.1.2. Решения

* Поиск веб элемента и получение актуальной ссылки на него перед выполнением действия

*Пример*

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    String xpath = "//a[text()=\"Офис и сеть\"]";
    WebElement element;
    // Перый поиск веб элемента
    element = driver.findElement(By.xpath(xpath));
    // Обновление страницы
    driver.navigate().refresh();
    // Второй поиск веб элемента
    element = driver.findElement(By.xpath(xpath));
    element.click();
}
```

* Проверка открытия актуальной страницы / вкладки / окна с искомым веб элементом
* Проверка корректности локатора

Ниже пример перехвата исключения.

*Пример*

```java
@Test
public void test() {
    try {
        driver.manage().window().maximize();
        driver.get("https://www.dns-shop.ru/");
        String xpath = "//a[text()=\"Офис и сеть\"]";
        WebElement element = driver.findElement(By.xpath(xpath));
        driver.switchTo().newWindow(WindowType.TAB);
        driver.get("https://www.dns-shop.ru/");
        element.click();
    } catch (StaleElementReferenceException e) {
        logger.info("StaleElementReferenceException: " + e.getRawMessage());
    }
}
```

[selenium/docs/api : StaleElementReferenceException](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/StaleElementReferenceException.html)

### 3.2.2. ElementClickInterceptedException

***ElementClickInterceptedException*** — исключение, которое вызывается, когда команда не может быть завершена,
поскольку веб элемент, получающий событие, скрывает целевой элемент.

[selenium/docs/api : ElementClickInterceptedException](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/ElementClickInterceptedException.html)

#### 3.2.2.1. Причины

* Веб элемент скрыт другим веб элементом

*Пример*

В примере ниже найденный веб элемент скрывается за другим веб элементом.
Клик получает тот веб элемент, который скрывает искомый.

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    String xpath = "//a[text()=\"Бытовая техника\"]";
    WebElement element = driver.findElement(By.xpath(xpath));
    element.click();
}
```

В результате вызывается исключение **ElementClickInterceptedException**

```text
org.openqa.selenium.ElementClickInterceptedException: 
element click intercepted: Element 
<a class="ui-link menu-desktop__root-title" href="/catalog/17a8e9b716404e77/bytovaya-texnika/">...</a> 
is not clickable at point (490, 142). 
Other element would receive the click: 
<button data-v-2858c94f="" class="base-ui-button-v2 base-ui-button-v2_medium base-ui-button-v2_grey 
```

* Другой веб элемент получил клик во время прокрутки / обновления страницы

*Пример*

В примере ниже найден веб элемент, далее выполнена прокрутка страницы до другого веб элемента.
После прокрутки выполнена попытка нажатия на первый веб элемент.

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
    driver.findElement(By.xpath("//a[text()=\"Смартфоны и гаджеты\"]")).click();
    driver.findElement(By.xpath("//span[text()=\"Смартфоны и гаджеты\"]/ancestor::a")).click();
    driver.findElement(By.xpath("//span[text()=\"Смартфоны\"]/ancestor::a")).click();
    WebElement element = driver.findElement(By.xpath("//a[text()=\"На Android\"]"));
    JavascriptExecutor js = (JavascriptExecutor) driver;
    js.executeScript("window.scrollBy(0,1000);");
    wait.until(
        ExpectedConditions.presenceOfElementLocated(
            By.xpath("//span[text()=\"Объем встроенной памяти (ГБ)\"]")));
    element.click();
}
```

В результате вызывается исключение **ElementClickInterceptedException**.

```text
org.openqa.selenium.ElementClickInterceptedException: 
element click intercepted: Element 
<a class="receipts__item ui-link" href="/catalog/recipe/3adda287f4d807eb/na-android/" data-receipt="3adda287f4d807eb">...</a> 
is not clickable at point (725, 16). 
Other element would receive the click: 
<input class="ui-input-search__input ui-input-search__input_presearch" name="q" value="" type="search" placeholder="Поиск по сайту" autocomplete="off">
```

#### 3.2.2.2. Решения

* Скрытие перекрывающего веб элемента

*Пример*

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    // Скрытие веб элемента - нажатие на кнопку
    driver.findElement(By.xpath("//span[text()=\"Всё верно\"]")).click();
    driver.findElement(By.xpath("//a[text()=\"Бытовая техника\"]")).click();
}
```

* Ожидание завершения прокрутки / обновления страницы

*Пример*

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
    driver.findElement(By.xpath("//a[text()=\"Смартфоны и гаджеты\"]")).click();
    driver.findElement(By.xpath("//span[text()=\"Смартфоны и гаджеты\"]/ancestor::a")).click();
    driver.findElement(By.xpath("//span[text()=\"Смартфоны\"]/ancestor::a")).click();
    WebElement element = driver.findElement(By.xpath("//a[text()=\"На Android\"]"));
    JavascriptExecutor js = (JavascriptExecutor) driver;
    // Прокрутка страницы
    js.executeScript("window.scrollBy(0,1000);");
    // Явное ожидание события
    wait.until(ExpectedConditions.presenceOfElementLocated(
    By.xpath("//span[text()=\"Объем встроенной памяти (ГБ)\"]")));
    // Прокрутка страницы
    js.executeScript("window.scrollBy(0,-1000);");
    // Явное ожидание события
    wait.until(ExpectedConditions.presenceOfElementLocated(
    By.xpath("//a[text()=\"На Android\"]")));
    element.click();
}
```

* Изменение размера окна

Ниже пример перехвата исключения.

*Пример*

```java
@Test
public void test() {
    try {
        driver.manage().window().maximize();
        driver.get("https://www.dns-shop.ru/");
        String xpath = "//a[text()=\"Бытовая техника\"]";
        WebElement element = driver.findElement(By.xpath(xpath));
        element.click();
    } catch (ElementClickInterceptedException e) {
        logger.info("ElementClickInterceptedException: " + e.getRawMessage());
    }
}
```

### 3.2.3. ElementNotInteractableException

***ElementNotInteractableException*** — исключение, которое вызывается, когда веб элемент присутствует в **DOM**,
но с таким веб элементом невозможно взаимодействовать.

[selenium/docs/api : ElementNotInteractableException](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/ElementNotInteractableException.html)

#### 3.2.3.1. Причины

* Веб элемент не виден

*Пример*

В примере ниже выполняется попытка нажатия на веб элемент, который был скрыт другим веб элементом.

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
    driver.findElement(By.xpath("//a[text()=\"Смартфоны и гаджеты\"]")).click();
    driver.findElement(By.xpath("//span[text()=\"Смартфоны и гаджеты\"]/ancestor::a")).click();
    driver.findElement(By.xpath("//span[text()=\"Смартфоны\"]/ancestor::a")).click();
    JavascriptExecutor js = (JavascriptExecutor) driver;
    js.executeScript("window.scrollBy(0,1000);");
    wait.until(
        ExpectedConditions.presenceOfElementLocated(
            By.xpath("//span[text()=\"Объем встроенной памяти (ГБ)\"]")));
    driver.findElement(By.xpath("//span[text()=\"Объем встроенной памяти (ГБ)\"]")).click();
    WebElement element = driver.findElement(
        By.xpath("//span[text()=\"Объем встроенной памяти (ГБ)\"]/parent::a/following-sibling::div//span[text()=\"8 ГБ  \"]"));
    driver.findElement(By.xpath("//span[text()=\"Объем встроенной памяти (ГБ)\"]")).click();
    element.click();
}
```

В результате вызывается исключение **ElementNotInteractableException**.

```text
org.openqa.selenium.ElementNotInteractableException: element not interactable
```

* Поиск веб элементов по локатору выдал больше одного веб элемента

*Пример*

В примере ниже было найдено множество веб элемент по заданному локатору.
Далее была попытка клика на веб элемент.

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    driver.findElement(By.xpath("//a")).click();
}
```

В результате вызывается исключение **ElementNotInteractableException**.

```text
org.openqa.selenium.ElementNotInteractableException: element not interactable
```

* У веб элемента установлено свойство **disabled = true**

*Пример*

В примере ниже у строки поиска установлено свойство **disabled = true**.
Далее была попытка с ней взаимодействовать.

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    JavascriptExecutor js = (JavascriptExecutor) driver;
    js.executeScript("document.getElementsByName(\"q\")[1].disabled = true;");
    driver.findElement(By.xpath("(//input[@name=\"q\"])[2]")).sendKeys("Samsung");
}
```

В результате вызывается исключение **ElementNotInteractableException**.

```text
org.openqa.selenium.ElementNotInteractableException: element not interactable
```

* У веб элемента установлено свойство **style.visibility = "hidden"**

*Пример*

В примере ниже у строки поиска установлено свойство **style.visibility = "hidden"**.
Далее была попытка с ней взаимодействовать.

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    JavascriptExecutor js = (JavascriptExecutor) driver;
        js.executeScript("document.getElementsByName(\"q\")[1].style.visibility = \"hidden\";");
    driver.findElement(By.xpath("(//input[@name=\"q\"])[2]")).sendKeys("Samsung");
}
```

В результате вызывается исключение **ElementNotInteractableException**.

```text
org.openqa.selenium.ElementNotInteractableException: element not interactable
```

* У веб элемента установлено свойство **style.display = "none"**

*Пример*

В примере ниже у строки поиска установлено свойство **style.display = "none"**.
Далее была попытка с ней взаимодействовать.

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    JavascriptExecutor js = (JavascriptExecutor) driver;
        js.executeScript("document.getElementsByName(\"q\")[1].style.display = \"none\";");
    driver.findElement(By.xpath("(//input[@name=\"q\"])[2]")).sendKeys("Samsung");
}
```

В результате вызывается исключение **ElementNotInteractableException**.

```text
org.openqa.selenium.ElementNotInteractableException: element not interactable
```

#### 3.2.3.2. Решения

* Отображение веб элемента

*Пример*

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
    driver.findElement(By.xpath("//a[text()=\"Смартфоны и гаджеты\"]")).click();
    driver.findElement(By.xpath("//span[text()=\"Смартфоны и гаджеты\"]/ancestor::a")).click();
    driver.findElement(By.xpath("//span[text()=\"Смартфоны\"]/ancestor::a")).click();
    JavascriptExecutor js = (JavascriptExecutor) driver;
    js.executeScript("window.scrollBy(0,1000);");
    wait.until(
        ExpectedConditions.presenceOfElementLocated(
            By.xpath("//span[text()=\"Объем встроенной памяти (ГБ)\"]")));
    driver.findElement(By.xpath("//span[text()=\"Объем встроенной памяти (ГБ)\"]")).click();
    WebElement element = driver.findElement(
        By.xpath("//span[text()=\"Объем встроенной памяти (ГБ)\"]/parent::a/following-sibling::div//span[text()=\"8 ГБ  \"]"));
    element.click();
}
```

* Установка свойства веб элемента **disabled = false**

*Пример*

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    JavascriptExecutor js = (JavascriptExecutor) driver;
    // Установка свойства веб элемента disabled = false
    js.executeScript("document.getElementsByName(\"q\")[1].disabled = false;");
    driver.findElement(By.xpath("(//input[@name=\"q\"])[2]")).sendKeys("Samsung");
}
```

* Установка свойства веб элемента **style.visibility = "visible"**

*Пример*

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    JavascriptExecutor js = (JavascriptExecutor) driver;
    // Установка свойства веб элемента style.visibility = "visible"
    js.executeScript("document.getElementsByName(\"q\")[1].style.visibility = \"visible\";");
    driver.findElement(By.xpath("(//input[@name=\"q\"])[2]")).sendKeys("Samsung");
}
```

* Установка свойства веб элемента **style.display = ""**

*Пример*

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    JavascriptExecutor js = (JavascriptExecutor) driver;
    // Установка свойства веб элемента style.display = ""
    js.executeScript("document.getElementsByName(\"q\")[1].style.display = \"\";");
    driver.findElement(By.xpath("(//input[@name=\"q\"])[2]")).sendKeys("Samsung");
}
```

Ниже пример перехвата исключения.

*Пример*

```java
@Test
public void ttest() {
    try {
        driver.manage().window().maximize();
        driver.get("https://www.dns-shop.ru/");
        WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
        driver.findElement(By.xpath("//a[text()=\"Смартфоны и гаджеты\"]")).click();
        driver.findElement(By.xpath("//span[text()=\"Смартфоны и гаджеты\"]/ancestor::a")).click();
        driver.findElement(By.xpath("//span[text()=\"Смартфоны\"]/ancestor::a")).click();
        JavascriptExecutor js = (JavascriptExecutor) driver;
        js.executeScript("window.scrollBy(0,1000);");
        wait.until(
            ExpectedConditions.presenceOfElementLocated(
                By.xpath("//span[text()=\"Объем встроенной памяти (ГБ)\"]")));
        driver.findElement(By.xpath("//span[text()=\"Объем встроенной памяти (ГБ)\"]")).click();
        WebElement element = driver.findElement(
            By.xpath("//span[text()=\"Объем встроенной памяти (ГБ)\"]/parent::a/following-sibling::div//span[text()=\"8 ГБ  \"]"));
        driver.findElement(By.xpath("//span[text()=\"Объем встроенной памяти (ГБ)\"]")).click();
        element.click();
    } catch (ElementNotInteractableException e) {
        logger.info("ElementNotInteractableException: " + e.getRawMessage());
    }
}
```

### 3.2.4. InvalidElementStateException

***InvalidElementStateException*** — исключение, которое вызывается, когда веб элемент не находится в состоянии,
необходимом **Selenium WebDriver** для выполнения операции.

[selenium/docs/api : InvalidElementStateException](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/InvalidElementStateException.html)

#### 3.2.4.1. Причины

* Выполнение операции, над веб элементом, к которому ее нельзя применить.

*Пример*

В примере ниже выполняется попытка применить к ссылке операцию очистки поля.
Однако состояние веб элемента не соответствует желаемому действию.

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    driver.findElement(By.xpath("//a[text()=\"Смартфоны и гаджеты\"]")).clear();
}
```

В результате вызывается исключение **InvalidElementStateException**.

```text
org.openqa.selenium.InvalidElementStateException: invalid element state
```
#### 3.2.4.2. Решения

* Проверка допустимости выполнения требуемой операции над веб элементом
* Ожидание желаемого состояния веб элемента посредством явного ожидания

Ниже пример перехвата исключения.

*Пример*

```java
    @Test
public void ttest() {
    try {
        driver.manage().window().maximize();
        driver.get("https://www.dns-shop.ru/");
        driver.findElement(By.xpath("//a[text()=\"Смартфоны и гаджеты\"]")).clear();
    } catch (InvalidElementStateException e) {
        logger.info("InvalidElementStateException: " + e.getRawMessage());
    }
}
```

***

# 4. Сложные действия

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

**Selenium WebDriver** позволяет имитировать действия пользователя, 
начиная от простых движений мыши до сложных, перетягивание объекта.
Все это позволяет реализовать класс **Actions**. Так же разработчики позаботились о том, 
чтобы мы могли создавать цепочку действий, используя этот класс.

## 4.1. Интерфейс Action

***Action*** - интерфейс реализующий сложные взаимодействия.

Методы интерфейса **Action**:

| Тип  | Метод     | Описание            | 
|------|-----------|---------------------|
| void | perform() | Выполнение действия |

[selenium/docs/api : Action](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/interactions/Action.html)

## 4.2. Класс Actions

***Actions*** - класс предоставляющий команды реализующие сложные взаимодействия.

Данный класс реализует интерфейс **Actions**.

Методы класса **Actions**:

| Тип     | Метод                                                      | Описание                                        |
|---------|------------------------------------------------------------|-------------------------------------------------|
| Actions | click()                                                    | Левый клик мышью в текущей позиции              |
| Actions | click(WebElement target)                                   | Левый клик мышью в центре элемента              |
| Actions | clickAndHold()                                             | Левый клик мышью c удержанием в текущей позиции |
| Actions | clickAndHold(WebElement target)                            | Левый клик мышью c удержанием в центре элемента |
| Actions | contextClick()                                             | Правый клик мышью в текущей позиции             |
| Actions | contextClick(WebElement target)                            | Правый клик мышью в центре элемента             |
| Actions | doubleClick()                                              | Двойной клик мышью в текущей позиции            |
| Actions | doubleClick(WebElement target)                             | Двойной клик мышью в центре элемента            |
| Actions | dragAndDrop(WebElement source, WebElement target)          | Перетаскивание объекта                          |
| Actions | dragAndDropBy(WebElement source, int xOffset, int yOffset) | Перетаскивание объекта со смещением             |
| Actions | keyDown(CharSequence key)                                  | Нажатие клавиши клавиатуры                      |
| Actions | keyDown(WebElement target, CharSequence key)               | Нажатие клавиши клавиатуры в элементе           |
| Actions | keyUp(CharSequence key)                                    | Отпускание клавиши клавиатуры                   |
| Actions | keyUp(WebElement target, CharSequence key)                 | Отпускание клавиши клавиатуры в элементе        |
| Actions | moveByOffset(int xOffset, int yOffset)                     | Смещение мыши                                   |
| Actions | moveToElement(WebElement target)                           | Перемещение мыши в центр элемента               |
| Actions | moveToElement(WebElement target, int xOffset, int yOffset) | Перемещение мыши в центр элемента со смещением  |
| Actions | release()                                                  | Отпускание левой кнопки мыши                    |
| Actions | release(WebElement target)                                 | Отпускание левой кнопки мыши в центре элемента  |
| Actions | sendKeys(CharSequence... keys)                             | Ввод текста в текущей позиции                   |
| Actions | sendKeys(WebElement target, CharSequence... keys)          | Ввод текста в элементе                          |
| Actions | pause(long pause)                                          | Пауза                                           |
| Actions | pause(Duration duration)                                   | Пауза                                           |
| Action  | build()                                                    | Построение цепочки действий                     |
| Actions | perform()                                                  | Выполнение построенной цепочки действий         |
| Actions | tick(Action action)                                        |                                                 |
| Actions | tick(Interaction... actions)                               |                                                 |

[selenium/docs/api : Actions](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/interactions/Actions.html)

### 4.2.1. Левый клик мышью

Для выполнения клика левой кнопкой мыши применяются команды:

* **click()**

*Пример*

```java
WebElement element = driver.findElement(By.id("button"));
Actions actions = new Actions(driver);
actions
    .moveToElement(element)
    .click()
    .perform();
```

* **click(WebElement target)**

*Пример*

```java
WebElement element = driver.findElement(By.id("button"));
Actions actions = new Actions(driver);
actions
    .click(element)
    .perform();
```

### 4.2.2. Левый клик мышью c удержанием

Для выполнения клика левой кнопкой мыши c удержанием применяются команды:

* **clickAndHold()**

*Пример*

```java
WebElement element = driver.findElement(By.id("button"));
Actions actions = new Actions(driver);
actions
    .moveToElement(element)
    .clickAndHold()
    .perform();
```

* **clickAndHold(WebElement target)**

*Пример*

```java
WebElement element = driver.findElement(By.id("button"));
Actions actions = new Actions(driver);
actions
    .clickAndHold(element)
    .perform();
```

### 4.2.3. Правый клик мышью

Для выполнения клика правой кнопкой мыши применяются команды:

* **contextClick()**

*Пример*

```java
WebElement element = driver.findElement(By.id("button"));
Actions actions = new Actions(driver);
actions
    .moveToElement(element)
    .contextClick()
    .perform();
```

* **contextClick(WebElement target)**

*Пример*

```java
WebElement element = driver.findElement(By.id("button"));
Actions actions = new Actions(driver);
actions
    .contextClick(element)
    .perform();
```

### 4.2.4. Двойной клик мышью

Для выполнения двойного клика левой кнопкой мыши применяются команды:

* **doubleClick()** 

*Пример*

```java
WebElement element = driver.findElement(By.id("button"));
Actions actions = new Actions(driver);
actions
    .moveToElement(element)
    .doubleClick()
    .perform();
```

* **doubleClick(WebElement target)**

*Пример*

```java
WebElement element = driver.findElement(By.id("button"));
Actions actions = new Actions(driver);
actions
    .doubleClick(element)
    .perform();
```

### 4.2.5. Перетаскивание объекта

Для выполнения перетаскивания применяются команды: 

* **dragAndDrop(WebElement source, WebElement target)** 

*Пример*

```java
WebElement source = driver.findElement(By.id("draggable"));
WebElement target = driver.findElement(By.id("droppable"));
Actions actions = new Actions(driver);
actions
    .dragAndDrop(source, target)
    .perform();
```

* **dragAndDropBy(WebElement source, int xOffset, int yOffset)**

*Пример*

```java
WebElement source = driver.findElement(By.id("draggable"));
WebElement target = driver.findElement(By.id("droppable"));
Actions actions = new Actions(driver);
actions
    .dragAndDropBy(source, 80, 80)
    .perform();
```

### 4.2.6. Нажатие и отпускание клавиши клавиатуры

Для выполнения нажатия клавиши клавиатуры применяются команды:

* **keyDown(Keys key)**
* **keyDown(WebElement target, Keys key)**.

*Пример*

```java
WebElement element = driver.findElement(By.id("input"));
Actions actions = new Actions(driver);
actions
    .moveToElement(element)
    .keyDown(Keys.SHIFT)
    .sendKeys("kiwi")
    .keyUp(Keys.SHIFT)
    .perform();
```

Для выполнения отпускания клавиши клавиатуры применяются команды:

* **keyUp(Keys key)**
* **keyUp(WebElement target, Keys key)**.

*Пример*

```java
WebElement element = driver.findElement(By.id("input"));
Actions actions = new Actions(driver);
actions
    .keyDown(element, Keys.SHIFT)
    .sendKeys(element, "kiwi")
    .keyUp(element, Keys.SHIFT)
    .perform();
```

### 4.2.7. Смещение мыши

Для смещения мыши применяется команда:

* **moveByOffset(int xOffset, int yOffset)**

*Пример*

```java
WebElement element = driver.findElement(By.id("dropdownlist"));
Actions actions = new Actions(driver);
actions
    .moveToElement(element)
    .moveByOffset(0, 30)
    .click()
    .perform();
```

### 4.2.8. Перемещение мыши на элемент

Для перемещения мыши на элемент применяется команда:

* **moveToElement(WebElement toElement)**

*Пример*

```java
WebElement element = driver.findElement(By.id("dropdownlist"));
Actions actions = new Actions(driver);
actions
    .moveToElement(element)
    .perform();
```

Для перемещения мыши на элемент со смещением применяется команда:

* **moveToElement(WebElement toElement, int xOffset, int yOffset)**

*Пример*

```java
WebElement element = driver.findElement(By.id("dropdownlist"));
Actions actions = new Actions(driver);
actions
    .moveToElement(element, 0, 10)
    .perform();
```

### 4.2.9. Отпускание левой кнопки мыши

Для выполнения отпускания левой кнопки мыши применяются команды:

* **release()**

*Пример*

```java
WebElement element = driver.findElement(By.id("button"));
Actions actions = new Actions(driver);
actions
    .clickAndHold(element)
    .pause(600)
    .release()
    .perform();
```

* **release(WebElement onElement)**

*Пример*

```java
WebElement element = driver.findElement(By.id("button"));
Actions actions = new Actions(driver);
actions
    .moveToElement(element)
    .clickAndHold()
    .pause(600)
    .release(element)
    .perform();
```

## 4.3. Перечисление Keys

***Keys*** - перечисление определяющее коды клавиш клавиатуры.

Константы перечисления **Keys**:

* *основные клавиши*

| Константа  | Описание    | 
|------------|-------------|
| ENTER      | Enter       | 
| ESCAPE     | Esc         | 
| SPACE      | Пробел      | 
| TAB        | Табуляция   |
| BACK_SPACE | Удаление    | 
| COMMAND    | Cmd         | 
| SEMICOLON  | ;           | 
| SEPARATOR  | Разделитель |
| DELETE     | Delete      | 
| INSERT     | Insert      | 
| HOME       | Home        | 
| END        | End         | 
| PAGE_DOWN  | Page Down   | 
| PAGE_UP    | Page Up     | 
| PAUSE      | Pause       | 
| RETURN     | Return      |

* *модификационные клавиши*

| Константа    | Описание     | 
|--------------|--------------|
| ALT          | Правый Аlt   |
| CONTROL      | Правый Ctrl  |
| SHIFT        | Правый Shift |
| LEFT_ALT     | Левый  Аlt   |
| LEFT_CONTROL | Левый  Ctrl  | 	 
| LEFT_SHIFT   | Левый  Shift |

* *арифметические клавиши*

| Константа | Описание  | 
|-----------|-----------|
| NUMPAD0   | 0         |
| NUMPAD1   | 1         |	 
| NUMPAD2   | 2         |
| NUMPAD3   | 3         |
| NUMPAD4   | 4         |
| NUMPAD5   | 5         |
| NUMPAD6   | 6         |
| NUMPAD7   | 7         |
| NUMPAD8   | 8         |
| NUMPAD9   | 9         |
| ADD       | +         |
| SUBTRACT  | -         |
| DIVIDE    | /         |
| MULTIPLY  | *         |
| EQUALS    | =         |

* *клавиши направления*

| Константа   | Описание       | 
|-------------|----------------|
| ARROW_DOWN  | Стрелка Вниз   | 
| ARROW_UP    | Стрелка Вверх  | 
| ARROW_LEFT  | Стрелка Влево  | 
| ARROW_RIGHT | Стрелка Вправо | 
| DOWN        | Вниз           | 
| UP          | Вверх          | 
| LEFT        | Влево          | 
| RIGHT       | Вправо         | 

* *функциональные клавиши*

| Константа | Описание  |
|-----------|-----------|
| F1        | F1        |
| F2        | F2        |
| F3        | F3        |
| F4        | F4        |
| F5        | F5        |
| F6        | F6        |
| F7        | F7        |
| F8        | F8        |
| F9        | F9        |
| F10       | F10       |
| F11       | F11       |
| F12       | F12       |

* *прочие клавиши*

| Константа       | Описание  |
|-----------------|-----------|
| DECIMAL         |           |
| HELP            |           |
| CANCEL          |           |
| CLEAR           |           |
| META            |           |
| NULL            |           |
| ZENKAKU_HANKAKU |           |

[selenium/docs/api : Keys](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/Keys.html)

## 4.4. Исключения

Все те же исключения, что и для простых действий с веб элементами.
Плюс исключение **MoveTargetOutOfBoundsException**.

### 4.4.1. MoveTargetOutOfBoundsException

***MoveTargetOutOfBoundsException*** — исключение, которое вызывается, когда местоположение,
передаваемое методу перемещения, выходит за границы страницы.

[selenium/docs/api : MoveTargetOutOfBoundsException](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/interactions/MoveTargetOutOfBoundsException.html)

#### 4.4.1.1. Причины

* Некорректные координаты

*Пример*

В примере ниже в команду **moveByOffset** переданы некорректные координаты, которые указывают на точку за пределами страницы.

```java
@Test
public void test() {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    Actions actions = new Actions(driver);
    actions
        .moveToElement(driver.findElement(By.xpath("//a[text()=\"Смартфоны и гаджеты\"]")))
        .moveByOffset(-1000, -1000)
        .click()
        .perform();
}
```

В результате вызывается исключение **MoveTargetOutOfBoundsException**

```text
org.openqa.selenium.interactions.MoveTargetOutOfBoundsException: move target out of bounds
```

#### 4.4.1.2. Решения

* Проверка местоположения передаваемого команде перемещения

Ниже пример перехвата исключения.

*Пример*

```java
@Test
public void ttest() {
    try {
    driver.manage().window().maximize();
    driver.get("https://www.dns-shop.ru/");
    Actions actions = new Actions(driver);
    actions
        .moveToElement(
            driver.findElement(
                 By.xpath("//a[text()=\"Смартфоны и гаджеты\"]")))
        .moveByOffset(-1000, -1000)
        .click()
        .perform();
    } catch (MoveTargetOutOfBoundsException e) {
        logger.info("MoveTargetOutOfBoundsException: " + e.getRawMessage());
    }
}
```

***

[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Практика](https://img.shields.io/badge/-Практика-aaffaa)](2.%20Практика.md)