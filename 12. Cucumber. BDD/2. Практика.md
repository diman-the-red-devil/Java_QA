Java_QA / 12. Cucumber. BDD

[![Лекция](https://img.shields.io/badge/-Лекция-ee99ff)](1.%20Лекция.md)
[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Задание](https://img.shields.io/badge/-Задание-99ffee)](3.%20Задание.md)

***

# Содержание

* []()
* []()
* []()
* []()

***

# 1. Открытие предыдущего проекта

[![Содержание](https://img.shields.io/badge/-Содержание-66eeff)](#содержание)

Шаги:

1. Запустить **IntelliJ IDEA**.

2. Открыть проект прошлого урока в **IntelliJ IDEA**.

![New Maven Project - Open...](./_Files/2.%20New%20Project/1.%20Open%20Project/01.jpg "New Maven Project - Open...")

***

# 2. Файл POM

Для начала нужно прописать необходимые зависимости.

![New Maven Project - POM.xml](./_Files/2.%20New%20Project/2.%20POM/01.png "New Project - POM.xml")

## 2.1. Раздел \<properties\>

Раздел **<properties>**

```xml
<!-- Параметры -->
<properties>
    Добавлять вот сюда
</properties>
```

Шаги:

1. Открыть файл **POM.xml**.

2. Добавить в раздел **\<properties\>** версии библиотек / зависимостей (**dependencies**):

* фреймворк **BDD** **Cucumber**

```xml
...
<!-- Версии зависимостей: -->
<!-- Cucumber -->
<cucumber>7.8.1</cucumber>
```

* фреймворк тестирования **JUnit**

```xml
...
<!-- JUnit -->
<junit-jupiter-engine>5.9.0</junit-jupiter-engine>
<junit-vintage-engine>5.9.0</junit-vintage-engine>
<!--junit-jupiter-api>5.9.0</junit-jupiter-api>
<junit-platform-commons>1.9.0</junit-platform-commons>
<junit-platform-launcher>1.9.0</junit-platform-launcher-->
```

* драйвер браузера **Selenium WebDriver**

```xml
...
<!-- Selenium WebDriver -->
<selenium-java>4.5.3</selenium-java>
```

* менеджер драйверов **WebDriver Manager**

```xml
...
<!-- WebDriver Manager -->
<webdrivermanager>5.3.0</webdrivermanager>
```

* логгер **Log4J**

```xml
...
<!-- Log4J -->
<log4j-api>2.19.0</log4j-api>
<log4j-core>2.19.0</log4j-core>
```

* скриншотер **aShot**

```xml
...
<!-- aShot -->
<ashot>1.5.4</ashot>
```

## 2.2. Раздел \<dependencies\>

Раздел **<dependencies>**

```xml
<!-- Зависимости -->
<dependencies>
    Добавлять вот сюда
</dependencies>
```  

Шаги:

1. Открыть файл **POM.xml**.

2. Добавить в раздел **\<dependencies\>** зависимости / библиотеки:

* фреймворк **BDD** **Cucumber**

```xml
<!-- Cucumber -->
<dependency>
    <groupId>io.cucumber</groupId>
    <artifactId>cucumber-java</artifactId>
    <version>${cucumber}</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>io.cucumber</groupId>
    <artifactId>cucumber-junit</artifactId>
    <version>${cucumber}</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>io.cucumber</groupId>
    <artifactId>cucumber-junit-platform-engine</artifactId>
    <version>${cucumber}</version>
    <scope>test</scope>
</dependency>
```

* фреймворк тестирования **JUnit**

**junit-jupiter-engine** -

**junit-vintage-engine** -

**junit-jupiter-api** -

**junit-platform-commons** -

**junit-platform-launcher** -

```xml
<!-- JUnit -->
<dependency>
    <groupId>org.junit.jupiter</groupId>
    <artifactId>junit-jupiter-engine</artifactId>
    <version>${junit-jupiter-engine}</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>org.junit.vintage</groupId>
    <artifactId>junit-vintage-engine</artifactId>
    <version>${junit-vintage-engine}</version>
    <scope>test</scope>
</dependency>
<!--dependency>
    <groupId>org.junit.jupiter</groupId>
    <artifactId>junit-jupiter-api</artifactId>
    <version>${junit-jupiter-api}</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>org.junit.platform</groupId>
    <artifactId>junit-platform-commons</artifactId>
    <version>${junit-platform-commons}</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>org.junit.platform</groupId>
    <artifactId>junit-platform-launcher</artifactId>
    <version>${junit-platform-launcher}</version>
    <scope>test</scope>
</dependency-->
```    

* драйвер браузера **Selenium WebDriver**

```xml
<!-- Selenium WebDriver -->
<dependency>
    <groupId>org.seleniumhq.selenium</groupId>
    <artifactId>selenium-java</artifactId>
    <version>${selenium-java}</version>
    <scope>test</scope>
</dependency>
```

* менеджер драйверов **WebDriver Manager**

```xml
<!-- WebDriver Manager -->
<dependency>
    <groupId>io.github.bonigarcia</groupId>
    <artifactId>webdrivermanager</artifactId>
    <version>${webdrivermanager}</version>
    <scope>test</scope>
</dependency>
```

* логгер **Log4J**

```xml
<!-- Log4J -->
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-api</artifactId>
    <version>${log4j-api}</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-core</artifactId>
    <version>${log4j-core}</version>
    <scope>test</scope>
</dependency>
```

* скриншотер **aShot**

```xml
<!-- aShot -->
<dependency>
    <groupId>ru.yandex.qatools.ashot</groupId>
    <artifactId>ashot</artifactId>
    <version>${ashot}</version>
    <scope>test</scope>
</dependency>
```

## 2.3. Полный код POM.xml

[POM.xml](_Sample/pom.xml)

***

# 3. Структура папок и файлов проекта

Для дальнейшей работы с фреймворком **Cucumber** необходимо настроить структуру папок проекта.

В общем случае может быть любая конфигурация пакетов и папок с файлами.

## 3.1. Структура папок ДО

Изначально все выглядит так:

![New Maven Project - ./src/test](./_Files/2.%20New%20Project/3.%20Project%20Structure/01.png "New Project - ./src/test")

## 3.2. Папки и пакеты

### 3.2.1. Пакеты с .java файлами

Шаги:

1. Создать пакет Java **web** в папке **./src/test/java**.

В данном пакете будут находиться пакеты с **.java** файлами, в которых описаны классы и
методы для взаимодействия с тестируемой системой - сайтом **DNS** в веб браузере.

![New Maven Project - ./src/test/java/web](./_Files/2.%20New%20Project/3.%20Project%20Structure/02.png "New Project - ./src/test/java/web")

2. Перенести в **./src/test/java/web** следующие пакеты:

* **drivers**
* **helpers**
* **elements**
* **pages**

![New Maven Project - ./src/test/java/web](./_Files/2.%20New%20Project/3.%20Project%20Structure/03.png "New Project - ./src/test/java/web")

3. Создать пакет Java **hooks** в папке **./src/test/java**.

В данном пакете будут находиться **.java** файлы c действиями,
выполняемыми до и после исполнения сценариев / шагов описанных в **.feature** файлах.

![New Maven Project - ./src/test/java/hooks](./_Files/2.%20New%20Project/3.%20Project%20Structure/04.png "New Project - ./src/test/java/hooks")

4. Остальные пакеты Java оставить в папке **./src/text/java**

* **models** 
* **steps**

5. В итоге должна получиться такая структура пакетов Java

![New Maven Project - ./src/test/java/steps](./_Files/2.%20New%20Project/3.%20Project%20Structure/05.png "New Project - ./src/test/java/steps")

### 3.2.2. Папка с .feature файлами

Шаги:

1. Создать папку **resources** в папке **./src/test**.

![New Maven Project - ./src/test/resources](./_Files/2.%20New%20Project/3.%20Project%20Structure/06.png "New Project - ./src/test/resources")

2. Создать папку **features** в папке **./src/test/resources**.

В данной папке будут находиться **.feature** файлы.
Вообще можно разместить папку с данными файлами в любом другом месте, 
но в Java принято размещать любые файлы не содержащие исходный код в папку **resources**.

![New Maven Project - ./src/test/resources/features](./_Files/2.%20New%20Project/3.%20Project%20Structure/07.png "New Project - ./src/test/resources/features")

## 3.3. Файлы

### 3.3.1. Удаление и переименование файлов пакета models

Шаги:

1. Перейти в пакет **./src/test/java/models**

2. Удалить следующие файлы:

* **SmartphonePOJO.java**
* **SmartphoneJB.java**
* **SmartphoneVO.java**

3. Переименовать следующие файлы:

* **SmartphoneBL.java** -> **Smartphone.java**
* **SmartphoneBLBuilder.java** -> **SmartphoneBuilder.java**

4. В итоге должно получиться вот так 

![New Maven Project - ./src/test/java/models](./_Files/2.%20New%20Project/3.%20Project%20Structure/08.png "New Project - ./src/test/java/models")

### 3.3.2. Удаление и переименование файлов пакета pages

Шаги:

1. Перейти в пакет **./src/test/java/web/pages**

2. Удалить следующие файлы:

* **StartPage.java**
* **StartPagePF.java**
* **SmartphonesPage.java**
* **SmartphonesPagePF.java**
* **SmartphoneProductPage.java**
* **SmartphoneProductPagePF.java**

3. Переименовать следующие файлы:

* **StartPagePFPE.java** -> **StartPage.java**
* **SmartphonesPagePFPE.java** -> **SmartphonesPage.java**
* **SmartphoneProductPagePFPE.java** -> **SmartphoneProductPage.java**

4. В итоге должно получиться вот так

![New Maven Project - ./src/test/java/web/pages](./_Files/2.%20New%20Project/3.%20Project%20Structure/09.png "New Project - ./src/test/java/web/pages")

### 3.3.3. Удаление пакета tests

Шаги:

1. Удалить пакет **./src/test/java/tests**

## 3.4. Структура папок ДО

В результате все выглядит так:

![New Maven Project - ./src/test](./_Files/2.%20New%20Project/3.%20Project%20Structure/10.png "New Project - ./src/test")

***

# 4. Фабрика драйверов 

## 4.1. Класс WebDriverFactory

Необходимо немного изменить класс **WebDriverFactory**.

Шаги:

1. Открыть файл **WebDriverFactory.java** в **./src/test/java/web/drivers**.

2. Добавить в файл **WebDriverFactory.java** код.

* объявление драйвера

```java
// Драйвер
private static WebDriver driver;
```

* метод **getCurrentDriver** - получение уже созданного экземпляра драйвера

```java
// Получение уже созданного экземпляра драйвера
public static WebDriver getCurrentDriver() {
    return driver;
}
```

3. Изменить в файле **WebDriverFactory.java** код.

* метод **getDriver** - получение экземпляра драйвера по имени

```java
// Получение экземпляра драйвера по имени
public static WebDriver getDriver(BrowserName name) {
    switch (name) {
        // Драйвер браузера Google Chrome
        case CHROME:
            logger.info("Драйвер браузера Google Chrome");
            driver = ChromeBrowser.getDriver();
            break;
        // Драйвер браузера Mozilla Firefox
        case FIREFOX:
            logger.info("Драйвер браузера Mozilla Firefox");
            driver = FirefoxBrowser.getDriver();
            break;
        // Драйвер браузера Microsoft Edge
        case EDGE:
            logger.info("Драйвер браузера Microsoft Edge");
            driver = EdgeBrowser.getDriver();
            break;
        // По умолчанию
        default:
            throw new RuntimeException("Некорректное наименование браузера");
    }
    return driver;
}
```
## 4.2. Полный код WebDriverFactory.java

[WebDriverFactory.java](_Sample/src/test/java/web/drivers/WebDriverFactory.java)

***

# 5. Хуки

## 5.1. Класс DriverHooks

***DriverHooks*** - класс, который выполняет действия по настройке драйвера.

Шаги:

1. Создать файл **DriverHooks.java** в **./src/test/java/models**.

![New Maven Project - DriverHooks.java](./_Files/2.%20New%20Project/5.%20Hooks/01.png "New Project - DriverHooks.java")

2. Добавить в файл **DriverHooks.java** код.

* объявление драйвера

```java
// Драйвер 
protected static WebDriver driver;
```

* объявление логгера

```java
// Логгер
private Logger logger = LogManager.getLogger(DriverHooks.class);
```

* метод **startDriverBeforeScenario** - действия совершаемые перед каждым сценарием

```java
// Действия совершаемые перед каждым сценарием
@Before
public void startDriverBeforeScenario() {
    // Получаем параметр запуска тестов через Maven -Dbrowser
    String browser = System
        .getProperty("browser", "chrome")
        .toLowerCase();
    // Получаем экземпляр драйвера браузера
    driver = WebDriverFactory.getDriver(BrowserName.fromString(browser));
    logger.info("Драйвер стартовал!");
}
```

* метод **stopDriverAfterScenario** - действия совершаемые после каждого сценария

```java
// Действия совершаемые после каждого сценария
@After
public void stopDriverAfterScenario() {
    // Если драйвер еще существует
    if(driver != null) {
        // Закрываем его
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```
## 5.2. Полный код DriverHooks.java

[DriverHooks.java](_Sample/src/test/java/hooks/DriverHooks.java)

## 5.3. Класс ScreenShotHooks

***ScreenShotHooks*** - класс, который снимает скриншоты.

Шаги:

1. Создать файл **ScreenShotHooks.java** в **./src/test/java/models**.

![New Maven Project - ScreenShotHooks.java](./_Files/2.%20New%20Project/5.%20Hooks/02.png "New Project - ScreenShotHooks.java")

2. Добавить в файл **ScreenShotHooks.java** код.

* объявление логгера

```java
// Логгер
private Logger logger = LogManager.getLogger(ScreenShotHooks.class);
```

* метод **takeScreenShotBeforeStep** - действия совершаемые перед каждым шагом

```java

// Действия совершаемые перед каждым шагом
@BeforeStep
public void takeScreenShotBeforeStep(Scenario scenario) {
    // Сделать скриншот видимой области веб страницы
    try {
        Screenshot screenshot = new AShot().takeScreenshot(
            WebDriverFactory.getCurrentDriver());
        String name = scenario.getName() + "-" + Timestamp.from(Instant.now()).getTime() + ".png";
        ImageIO.write(screenshot.getImage(), "png",
            new File("temp\\" + name));
        logger.info("Скриншот сохранен в файле [temp\\" + name + "]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

* метод **takeScreenShotAfterStep** - действия совершаемые после каждого шага

```java
// Действия совершаемые после каждого шага
@AfterStep
public void takeScreenShotAfterStep(Scenario scenario) {
    // Сделать скриншот видимой области веб страницы
    try {
        Screenshot screenshot = new AShot().takeScreenshot(
            WebDriverFactory.getCurrentDriver());
        String name = scenario.getName() + "-" + Timestamp.from(Instant.now()).getTime() + ".png";
        ImageIO.write(screenshot.getImage(), "png",
            new File("temp\\" + name));
        logger.info("Скриншот сохранен в файле [temp\\" + name + "]");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

## 5.4. Полный код ScreenShotHooks.java

[DriverHooks.java](_Sample/src/test/java/hooks/ScreenShotHooks.java)

***

# 6. Фичи и сценарии

Приступим к написанию BDD сценариев.

## 6.1. Фича smartphone

***smartphone*** - **.feature** файл, содержащий сценарии.

Шаги:

1. Создать файл **smartphone.feature** в **./src/test/resources/features**.

![New Maven Project - smartphone.feature](./_Files/2.%20New%20Project/6.%20Features/01.png "New Project - smartphone.feature")

2. Добавить в файл **smartphone.feature**:

* язык сценариев - **русский**

```gherkin
# language: ru
```

* кодировка - **utf-8**

```gherkin
# encoding: utf-8
```

* заголовок фичи - **Смартфоны**

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
```

* описание (пользовательская история)

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

```

### 6.1.1. Сценарий Просмотр страницы Смартфоны

***Просмотр страницы Смартфоны*** - сценарий просмотра страницы "Смартфоны".

Шаги:

1. Открыть файл **smartphone.feature** в **./src/test/resources/features**.

2. Добавить сценарий:

* заголовок сценария - **Просмотр страницы Смартфоны**

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

  Сценарий: Просмотр страницы Смартфоны
```

* шаги

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

  Сценарий: Просмотр страницы Смартфоны
    Дано Открыта страница "Стартовая страница сайта DNS"
    Когда Выполнен переход на страницу "Смартфоны"
    И Открыта страница "Смартфоны"
    И Установлена сортировка "Сначала дорогие"
    И В фильтре "Производитель" выбрано значение "Samsung"
    И В фильтре "Объем оперативной памяти" выбрано значение "8 Гб"
    И Применены фильтры
    И Выполнен переход на страницу первого продукта в списке
    И Открыта страница "Продукт. Смартфон"
    Тогда Проверка: Заголовок страницы соответствует ожидаемому
```

## 6.2. Полный код smartphone.feature

[Smartphone.feature](_Sample/src/test/resources/features/smartphone.feature)

***

# 7. Шаги

Теперь напишем реализацию шагов BDD сценариев.

## 7.1. Класс StartPageSteps

Перепишем код класса **StartPageSteps**.

Шаги:

1. Открыть файл **StartPageSteps** в **./src/test/java/steps**.

2. Удалить в файле **StartPageSteps.java** код

3. Добавить в файл **StartPageSteps.java** код

* объявление логгера

```java
// Логгер
private static Logger logger = LogManager.getLogger(StartPageSteps.class);
```

* объявление ссылки на объект класса **StartPage** (Страница "Стартовая страница сайта DNS")

```java
// Ссылка на объект класса StartPage
// Страница "Стартовая страница сайта DNS"
private StartPage startPage;
```

* метод **openStartPage** - шаг **Открыта "Стартовая страница сайта DNS"**

```java
// Шаг: Открыта "Стартовая страница сайта DNS"
@Дано("Открыта \"Стартовая страница сайта DNS\"")
public void openStartPage() {
    startPage = new StartPage(WebDriverFactory.getCurrentDriver());
    // Открыть сайт https://www.dns-shop.ru/
    startPage.openPage();
    logger.info("Страница [Стартовая страница DNS]: Открыта \"Стартовая страница сайта DNS\"");
}
```

* метод **goToSmartphonesPage** - шаг **Выполнен переход на страницу "Смартфоны"**

```java
// Шаг: Выполнен переход на страницу "Смартфоны"
@Когда("Выполнен переход на страницу \"Смартфоны\"")
public void goToSmartphonesPage() {
    // Наведение курсора мыши на ссылку "Смартфоны и гаджеты"
    startPage.linkSmartsAndGadgets().focusOnLink();
    // Нажатие на ссылку "Смартфоны"
    startPage.linkSmarts().click();
    logger.info("Страница [Стартовая страница DNS]: Выполнен переход на страницу \"Смартфоны\"");
}
```

## 7.2. Полный код SmartphoneSteps.java

[SmartphoneSteps.java](_Sample/src/test/java/steps/SmartphoneSteps.java)

## 7.3. Класс SmartphonesPageSteps

Перепишем код класса **SmartphonesPageSteps**.

Шаги:

1. Открыть файл **SmartphonesPageSteps** в **./src/test/java/steps**.

2. Удалить в файле **SmartphonesPageSteps.java** код

3. Добавить в файл **SmartphonesPageSteps.java** код

* объявление логгера

```java
// Логгер
private static Logger logger = LogManager.getLogger(SmartphonesPageSteps.class);
```

* объявление ссылки на объект класса **SmartphonesPage** (Страница "Смартфоны")

```java
// Ссылка на объект класса SmartphonesPage
// Страница "Смартфоны"
private SmartphonesPage smartphonesPage;
```

* метод **openSmartphonesPage** - шаг **Открыта страница "Смартфоны"**

```java
// Шаг: Открыта страница "Смартфоны"
@Дано("Открыта страница \"Смартфоны\"")
public void openSmartphonesPage() {
    smartphonesPage = new SmartphonesPage(WebDriverFactory.getCurrentDriver());
    logger.info("Страница [Смартфоны]: Открыта страница \"Смартфоны\"");
}
```

* метод **orderBy** - шаг **Установлена сортировка "Сначала дорогие"**

```java
// Шаг: Установлена сортировка "Сначала дорогие"
@Когда("Установлена сортировка \"Сначала дорогие\"")
public void orderBy() {
    // Отображение сортировки
    smartphonesPage.accordeonSort().show();
    // Установка сортировки
    smartphonesPage.radiobuttonSort("Сначала дорогие").setSelected(true);
    logger.info("Страница [Смартфоны]: Установлена сортировка \"Сначала дорогие\"");
}
```

* метод **filterByCompany** - шаг **В фильтре "Производитель" выбрано значение "Samsung"**

```java
// Шаг: В фильтре "Производитель" выбрано значение "Samsung"
@Когда("В фильтре \"Производитель\" выбрано значение \"Samsung\"")
public void filterByCompany() {
    // Прокрутка страницы вниз
    JavaScriptHelper.scrollBy(0, 600);
    // Установка фильтра "Производитель"
    smartphonesPage.checkboxCompany("Samsung").setChecked(true);
    logger.info("Страница [Смартфоны]: В фильтре \"Производитель\" выбрано значение \"Samsung\"");
}
```

* метод **filterByRAM** - шаг **В фильтре "Объем оперативной памяти" выбрано значение "8 Гб"**

```java
// Шаг: В фильтре "Объем оперативной памяти" выбрано значение "8 Гб"
@Когда("В фильтре \"Объем оперативной памяти\" выбрано значение \"8 Гб\"")
public void filterByRAM() {
    // Прокрутка страницы вниз
    JavaScriptHelper.scrollBy(0, 400);
    // Отображение фильтра "Объем оперативной памяти"
    smartphonesPage.accordeonRAM().show();
    // Прокрутка страницы вниз
    JavaScriptHelper.scrollBy(0, 400);
    // Установка фильтра "Объем оперативной памяти"
    smartphonesPage.checkboxRAM("8 Гб").setChecked(true);
    logger.info("Страница [Смартфоны]: В фильтре \"Объем оперативной памяти\" выбрано значение \"8 Гб\"");
}
```

* метод **applyFilters** - шаг **Применены фильтры**

```java
// Шаг: Применены фильтры
@Когда("Применены фильтры")
public void applyFilters() {
    // Прокрутка страницы вниз
    JavaScriptHelper.scrollBy(0, 600);
    // Нажатие на кнопку "Применить"
    smartphonesPage.buttonApply().click();
    logger.info("Страница [Смартфоны]: Применены фильтры");
}
```

* метод **goToFirstProduct** - шаг **Выполнен переход на страницу первого продукта в списке**

```java
// Шаг: Выполнен переход на страницу первого продукта в списке
@Когда("Выполнен переход на страницу первого продукта в списке")
public void goToFirstProduct() {
    // Прокрутка страницы вверх
    JavaScriptHelper.scrollBy(0, -2000);
    // Нажатие на ссылку первого продукта в списке
    smartphonesPage.linkFirstProduct().openInNewWindow();
    logger.info("Страница [Смартфоны]: Выполнен переход на страницу первого продукта в списке");
}
```

## 7.4. Полный код SmartphoneProductPageSteps.java

[SmartphoneProductPageSteps.java](_Sample/src/test/java/steps/SmartphoneProductPageSteps.java)

## 7.5. Класс SmartphoneProductPageSteps

Перепишем код класса **SmartphoneProductPageSteps**.

Шаги:

1. Открыть файл **SmartphoneProductPageSteps** в **./src/test/java/steps**.

2. Удалить в файле **SmartphoneProductPageSteps.java** код

3. Добавить в файл **SmartphoneProductPageSteps.java** код

* объявление логгера

```java
// Логгер
private static Logger logger = LogManager.getLogger(SmartphoneProductPageSteps.class);
```

* объявление ссылки на объект класса **SmartphoneProductPageSteps** (Страница "Продукт. Смартфон")

```java
// Ссылка на объект класса SmartphoneProductPage
// Страница "Продукт. Смартфон"
private SmartphoneProductPage smartphoneProductPage;
```

* метод **openSmartphoneProductPage** - шаг **Открыта страница "Продукт. Смартфон"**

```java
// Шаг: Открыта страница "Продукт. Смартфон"
@Дано("Открыта страница \"Продукт. Смартфон\"")
public void openSmartphoneProductPage() {
    smartphoneProductPage = new SmartphoneProductPage(WebDriverFactory.getCurrentDriver());
    logger.info("Страница [Продукт. Смартфон]: Открыта страница \"Продукт. Смартфон\"");
}
```

* метод **assertPageTitle** - проверка **Проверка: Заголовок страницы соответствует ожидаемому"**

```java
// Проверка: Заголовок страницы соответствует ожидаемому
@Тогда("Проверка: Заголовок страницы соответствует ожидаемому")
public void assertPageTitle() {
    String expected = "Купить 6.8\" Смартфон Samsung Galaxy S22 Ultra 128 ГБ белый в интернет магазине DNS. Характеристики, цена Samsung Galaxy S22 Ultra | 4900422";
    String actual = smartphoneProductPage.getPageTitle();
    Assertions.assertEquals(expected, actual, "Страница [Продукт. Смартфон]: Ошибка! Заголовок страницы не соответствует ожидаемому!");
    logger.info("Страница [Продукт. Смартфон]: Заголовок страницы соответствует ожидаемому");
}
```

## 7.6. Полный код SmartphoneProductPageSteps.java

[SmartphoneProductPageSteps.java](_Sample/src/test/java/steps/SmartphoneProductPageSteps.java)

***

# 8. Раннер

***RunCucumberTest*** - класс для запуска сценариев.

Шаги:

1. Создать файл **RunCucumberTest.java** в **./src/test/java**.

![New Maven Project - RunCucumberTest.java](./_Files/2.%20New%20Project/40.jpg "New Project - RunCucumberTest.java")

2. Добавить в файл **RunCucumberTest.java** код.

* указание класса для запуска тестов

```java
// @RunWith
// Указание класса для запуска тестов
@RunWith(Cucumber.class)
```

* указание опций для запуска сценариев

```java
// @CucumberOptions
// Указание опции для запуска сценариев
@CucumberOptions(
    // Список папок с feature файлами - фичи/сценарии
    features = {"src/test/resources/features"},
    // Спиcок пакетов с steps файлами - шаги
    glue = {"steps"}
)
```

***

# 9. Запуск тестовых сценариев

## 9.1. С помощью IntelliJ IDEA

Шаги:

1. Открыть **.feature** файл **Smartphone.feature**

2. Запустить только один сценария

![New Maven Project - Запуск 1 сценария](./_Files/2.%20New%20Project/41.jpg "New Project - Запуск 1 сценария")

![New Maven Project - Запуск 1 сценария](./_Files/2.%20New%20Project/42.jpg "New Project - Запуск 1 сценария")

3. Запустить все сценарии функции

![New Maven Project - Запуск всех сценариев](./_Files/2.%20New%20Project/43.jpg "New Project - Запуск всех сценариев")

![New Maven Project - Запуск всех сценариев](./_Files/2.%20New%20Project/44.jpg "New Project - Запуск всех сценариев")

4. Получить результаты запуска в консоли

![New Maven Project - Результаты запуска сценария](./_Files/2.%20New%20Project/45.jpg "New Project - Результаты запуска сценария")

## 9.2. С помощью раннер класса

Шаги:

1. Открыть файл **RunCucumberTest.java**

2. Проверить, что в **@CucumberOptions** заданы верные пути до **.feature** файлов и реализации шагов сценариев

3. Запустить сценарии

![New Maven Project - Запуск всех сценариев](./_Files/2.%20New%20Project/46.jpg "New Project - Запуск всех сценариев")

4. Получить результаты запуска в консоли

![New Maven Project - Результаты запуска сценария](./_Files/2.%20New%20Project/47.jpg "New Project - Результаты запуска сценария")

## 9.3. С помощью Maven

Шаги:

1. Проверить, что модуль **JUnit Vintage** подключен к проекту

**Cucumber** основан на **JUnit 4**.
Поэтому для запуска через **Maven** сценариев **Cucumber** с **JUnit5** обязательно нужно подключить
модуль **JUnit Vintage**.

В отличие от предыдущих версий **JUnit**, **JUnit 5** состоит из нескольких разных модулей.
Модуль **JUnit Vintage** предоставляет возможности для запуска тестов на основе **JUnit 3** и **JUnit 4**.

2. Запустить выполнение сценариев через команду **Maven**

При запуске считываются параметры (по приоритету) из:

* переменных среды 
* **-D** параметров 
* **@CucumberOptions**
* **junit-platform.properties**

* запуск всех сценариев

```shell
mvn clean test -Dtest=RunCucumberTest
```

или

```shell
mvn clean test
```

* запуск файла с фичами

```shell
mvn clean test -Dcucumber.features=src/test/resources/features/Smartphone.feature
```

3. Получить результаты запуска в консоли

![New Maven Project - Результаты запуска сценария](./_Files/2.%20New%20Project/48.jpg "New Project - Результаты запуска сценария")

***

[![Лекция](https://img.shields.io/badge/-Лекция-ee99ff)](1.%20Лекция.md)
[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Задание](https://img.shields.io/badge/-Задание-99ffee)](3.%20Задание.md)