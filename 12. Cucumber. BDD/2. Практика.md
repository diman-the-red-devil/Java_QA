Java_QA / 12. Cucumber. BDD

[![Лекция](https://img.shields.io/badge/-Лекция-ee99ff)](1.%20Лекция.md)
[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Задание](https://img.shields.io/badge/-Задание-99ffee)](3.%20Задание.md)

***

# Содержание

* []()
* []()
* []()
* []()

***

# 1. Структура папок проекта

Для дальнейшей работы с фреймворком необходимо настроить структуру папок проекта.

Изначально все выглядит так:

![New Maven Project - Project](./_Files/2.%20New%20Project/02.jpg "New Project - Project")

В общем случае может быть любая конфигурация пакетов и папок с файлами.

## 2.1. Папка с .feature файлами

Шаги:

1. Создать папку Java **resources** в папке **./src/test**.

![New Maven Project - ./src/test/resources](./_Files/2.%20New%20Project/03.jpg "New Project - ./src/test/resources")

2. Создать папку **features** в папке **./src/test/resources**.

В данной папке будут находиться **.feature** файлы.
Вообще можно разместить папку с данными файлами в любом другом месте, 
но в Java принято размещать любые файлы не содержащие исходный код в папку **resources**.

![New Maven Project - ./src/test/resources/features](./_Files/2.%20New%20Project/04.jpg "New Project - ./src/test/resources/features")

## 2.2. Пакеты с .java файлами

Шаги:

1. Создать пакет Java **steps** в папке **./src/test/java**.

В данном пакете будут находиться **.java** файлы c реализацией шагов тестовых сценариев описанных **.feature** файлах.

![New Maven Project - ./src/test/java/steps](./_Files/2.%20New%20Project/05.jpg "New Project - ./src/test/java/steps")

2. Создать пакет Java **hooks** в папке **./src/test/java**.

В данном пакете будут находиться **.java** файлы c действиями, 
выполняемыми до и после исполнения сценариев / шагов описанных в **.feature** файлах.

![New Maven Project - ./src/test/java/hooks](./_Files/2.%20New%20Project/06.jpg "New Project - ./src/test/java/hooks")

3. Создать пакет Java **web** в папке **./src/test/java**.

В данном пакете будут находиться пакеты с **.java** файлами, в которых описаны классы и 
методы для взаимодействия с тестируемой системой - сайтом **DNS** в веб браузере.

![New Maven Project - ./src/test/java/web](./_Files/2.%20New%20Project/07.jpg "New Project - ./src/test/java/web")

* Создать пакет Java **drivers** в папке **./src/test/java/web**.

В данном пакете будут находиться **.java** файлы для настройки Selenium драйвера.

* Создать пакет Java **helpers** в папке **./src/test/java/web**.

В данном пакете будут находиться **.java** файлы для настройки ожиданий и выполнения скриптом на JS.

* Создать пакет Java **elements** в папке **./src/test/java/web**.

В данном пакете будут находиться **.java** файлы с веб элементами.

* Создать пакет Java **pages** в папке **./src/test/java/web**.

В данном пакете будут находиться **.java** файлы с пейдж обджектами.

![New Maven Project - ./src/test/java/web](./_Files/2.%20New%20Project/08.jpg "New Project - ./src/test/java/web")

4. Создать пакет Java **models** в папке **./src/text/java**.

В данном пакете будут находиться **.java** файлы с моделями тестовых данных.

![New Maven Project - ./src/test/java/models](./_Files/2.%20New%20Project/09.jpg "New Project - ./src/test/java/models")

* Создать пакет **valueobjects** в папке **./src/text/java/models**.

В данном пакете будут находиться **.java** файлы с объектами-значениями.

* Создать пакет **testobjects** в папке **./src/text/java/models**.

В данном пакете будут находиться **.java** файлы с объектами.

![New Maven Project - ./src/test/java/models](./_Files/2.%20New%20Project/10.jpg "New Project - ./src/test/java/models")

***


## 5.17. Класс Table

***Table*** - класс моделирующий элемент интерфейса **Таблица**.

Класс **Table** расширяет класс **BaseElement**.

Шаги:

1. Создать файл **Table.java** в **./src/test/java/web/elements**.

![New Maven Project - Table.java](./_Files/2.%20New%20Project/30.jpg "New Project - Table.java")

2. Добавить в файл **Table.java** код.

* конструктор класса

```java
// Конструктор
public Table(WebElement webElement) {
    super(webElement);
}
```

* метод **getDataValue** - получение значения ячеек таблицы

```java
// Получение значения ячеек таблицы
public String getDataValue(String dataName) {
    String xpath = "//table//td//span[contains(text(), \"" + dataName +
        "\")]/ancestor::td/following-sibling::td//span";
    return webElement.findElement(By.xpath(xpath)).getText();
}
```

## 5.18. Полный код Table.java

[Table.java](_Sample_03/src/test/java/web/elements/Table.java)

***

# 6. Страницы

## 6.7. Класс SmartphoneProductPage (Страница "Продукт. Смартфон")

***SmartphoneProductPage*** - класс моделирующий объекты страницы **Продукт. Смартфон**.

Класс **SmartphoneProductPage** расширяет класс **BasePage**.

Шаги:

1. Создать файл **SmartphoneProductPage.java** в **./src/test/java/web/pages**.

![New Maven Project - SmartphoneProductPage.java](./_Files/2.%20New%20Project/34.jpg "New Project - SmartphoneProductPage.java")

2. Добавить в файл **SmartphoneProductPage.java** код.

* объявление логгера

```java
// Логгер
private Logger logger = LogManager.getLogger(SmartphoneProductPage.class);
```

* объявление списка веб элементов

```java
// ***** Веб элементы *****
// Ссылка "Характеристики"
@FindBy(xpath = "//a[text()=\"Характеристики\"]")
private WebElement linkCharacteristics;
// Таблица "Характеристики"
@FindBy(xpath = "//table")
private WebElement tableCharacteristics;
```

* конструктор класса

```java
// Конструктор класса
public SmartphoneProductPage(WebDriver driver) {
    // Вызов родительского конструктора
    super(driver);
    // Инициализация веб элементов
    PageFactory.initElements(driver, this);
}
```

* получение обернутых веб элементов

```java
// ***** Получение обернутых веб элементов *****
// Ссылка "Характеристики"
public Link linkCharacteristics() {
    WaitHelper.visibilityOfElement(linkCharacteristics);
    return new Link(linkCharacteristics);
}
// Таблица "Характеристики"
public Table tableCharacteristics() {
    WaitHelper.visibilityOfElement(tableCharacteristics);
    return new Table(tableCharacteristics);
}
```

## 6.8. Полный код SmartphoneProductPage.java

[SmartphoneProductPage.java](_Sample_03/src/test/java/web/pages/SmartphoneProductPage.java)

***


***

# 9. Фичи и сценарии

## 9.1. Фича Smartphone

***Smartphone*** - **.feature** файл, содержащий сценарии.

Шаги:

1. Создать файл **Smartphone.feature** в **./src/test/resources/features**.

![New Maven Project - Smartphone.feature](./_Files/2.%20New%20Project/38.jpg "New Project - Smartphone.feature")

2. Добавить в файл **Smartphone.feature**:

* язык сценариев - **русский**

```gherkin
# language: ru
```

* кодировка - **utf-8**

```gherkin
# encoding: utf-8
```

* заголовок фичи - **Смартфоны**

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны
```

* описание (пользовательская история)

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

```

### 9.1.1. Сценарий Просмотр страницы Смартфоны

***Просмотр страницы Смартфоны*** - сценарий просмотра страницы "Смартфоны".

Шаги:

1. Открыть файл **Smartphone.feature** в **./src/test/resources/features**.

2. Добавить сценарий:

* заголовок сценария - **Просмотр страницы Смартфоны**

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

  Сценарий: Просмотр страницы Смартфоны
```

* шаг **Дано** *Запущен браузер и открыта Главная страница ДНС*

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

  Сценарий: Просмотр страницы Смартфоны
    Дано Запущен браузер и открыта Главная страница ДНС
```

* шаг **Когда** *Выполнен переход на страницу Смартфоны*

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

  Сценарий: Просмотр страницы Смартфоны
    Дано Запущен браузер и открыта Главная страница ДНС
    Когда Выполнен переход на страницу Смартфоны
```

* шаг **Тогда** *Проверить: В заголовке страницы отображется текст Смартфоны*

```gherkin
# language: ru
# encoding: utf-8
Функция: Смартфоны

  Я как посетитель сайта ДНС хочу просматривать раздел со смартфонами.
  Это позволит мне выбрать понравившийся смартфон и просмотреть его характеристики.

  Сценарий: Просмотр страницы Смартфоны
    Дано Запущен браузер и открыта Главная страница ДНС
    Когда Выполнен переход на страницу Смартфоны
    Тогда Проверить: В заголовке страницы отображется текст Смартфоны
```

## 9.2. Полный код Smartphone.feature

[Smartphone.feature](_Sample_03/src/test/resources/features/Smartphone.feature)

***

# 10. Шаги

## 10.1. Класс SmartphoneSteps 

***SmartphoneSteps*** - класс с реализацией шагов сценариев.

Шаги:

1. Создать файл **SmartphoneSteps.java** в **./src/test/java/steps**.

![New Maven Project - SmartphoneSteps.java](./_Files/2.%20New%20Project/39.jpg "New Project - SmartphoneSteps.java")

2. Добавить в файл **SmartphoneSteps.java** код.

* объявление драйвера браузера

```java
// Драйвер браузера
protected static WebDriver driver;
```
* объявление логгера

```java
// Логгер
private Logger logger = LogManager.getLogger(SmartphoneSteps.class);
```

* метод **startDriverAndOpenStartPage** - шаг **Дано** *Запущен браузер и открыта Главная страница ДНС*

```java
@Дано("Запущен браузер и открыта Главная страница ДНС")
public void startDriverAndOpenStartPage() {
    // Запустить драйвер
    driver = WebDriverFactory.getDriver(BrowserName.fromString("Chrome"));
    logger.info("Драйвер стартовал!");
    // Открыть страницу https://www.dns-shop.ru/
    driver.get("https://www.dns-shop.ru/");
    logger.info("Открыта Стартовая страница сайта DNS");
}
```

* метод **openSmartphonesPage** - шаг **Когда** *Выполнен переход на страницу Смартфоны*

```java
@Когда("Выполнен переход на страницу Смартфоны")
public void openSmatphonesPage() {
    StartPage startPage = new StartPage(driver);
    startPage.linkYes().click();
    startPage.linkSmartsAndGadget().focusOnLink();
    startPage.linkSmarts().click();
    logger.info("Выполнен переход на страницу Смартфоны");
}
```

* метод **assertTitle** - шаг **Тогда** *Проверить: В заголовке страницы отображается текст Смартфоны*


```java
@Тогда("Проверить: В заголовке страницы отображается текст Смартфоны")
public void assertTitle() {
    SmartphonesPage smartphonesPage = new SmartphonesPage(driver);
    // Проверка заголовка страницы
    Assertions.assertTrue(smartphonesPage.getPageTitle().contains("Смартфоны"));
    // Если драйвер еще существует
    if(driver != null) {
        // Закрываем его
        driver.quit();
        logger.info("Драйвер остановлен!");
    }
}
```

## 10.2. Полный код SmartphoneSteps.java

[SmartphoneSteps.java](_Sample_03/src/test/java/steps/SmartphoneSteps.java)

***

# 11. Раннер

***RunCucumberTest*** - класс для запуска сценариев.

Шаги:

1. Создать файл **RunCucumberTest.java** в **./src/test/java**.

![New Maven Project - RunCucumberTest.java](./_Files/2.%20New%20Project/40.jpg "New Project - RunCucumberTest.java")

2. Добавить в файл **RunCucumberTest.java** код.

* указание класса для запуска тестов

```java
// @RunWith
// Указание класса для запуска тестов
@RunWith(Cucumber.class)
```

* указание опций для запуска сценариев

```java
// @CucumberOptions
// Указание опции для запуска сценариев
@CucumberOptions(
    // Список папок с feature файлами - фичи/сценарии
    features = {"src/test/resources/features"},
    // Спиcок пакетов с steps файлами - шаги
    glue = {"steps"}
)
```

***

# 12. Запуск тестовых сценариев

## 12.1. С помощью IntelliJ IDEA

Шаги:

1. Открыть **.feature** файл **Smartphone.feature**

2. Запустить только один сценария

![New Maven Project - Запуск 1 сценария](./_Files/2.%20New%20Project/41.jpg "New Project - Запуск 1 сценария")

![New Maven Project - Запуск 1 сценария](./_Files/2.%20New%20Project/42.jpg "New Project - Запуск 1 сценария")

3. Запустить все сценарии функции

![New Maven Project - Запуск всех сценариев](./_Files/2.%20New%20Project/43.jpg "New Project - Запуск всех сценариев")

![New Maven Project - Запуск всех сценариев](./_Files/2.%20New%20Project/44.jpg "New Project - Запуск всех сценариев")

4. Получить результаты запуска в консоли

![New Maven Project - Результаты запуска сценария](./_Files/2.%20New%20Project/45.jpg "New Project - Результаты запуска сценария")

## 12.2. С помощью раннер класса

Шаги:

1. Открыть файл **RunCucumberTest.java**

2. Проверить, что в **@CucumberOptions** заданы верные пути до **.feature** файлов и реализации шагов сценариев

3. Запустить сценарии

![New Maven Project - Запуск всех сценариев](./_Files/2.%20New%20Project/46.jpg "New Project - Запуск всех сценариев")

4. Получить результаты запуска в консоли

![New Maven Project - Результаты запуска сценария](./_Files/2.%20New%20Project/47.jpg "New Project - Результаты запуска сценария")

## 12.3. С помощью Maven

Шаги:

1. Проверить, что модуль **JUnit Vintage** подключен к проекту

**Cucumber** основан на **JUnit 4**.
Поэтому для запуска через **Maven** сценариев **Cucumber** с **JUnit5** обязательно нужно подключить
модуль **JUnit Vintage**.

В отличие от предыдущих версий **JUnit**, **JUnit 5** состоит из нескольких разных модулей.
Модуль **JUnit Vintage** предоставляет возможности для запуска тестов на основе **JUnit 3** и **JUnit 4**.

2. Запустить выполнение сценариев через команду **Maven**

При запуске считываются параметры (по приоритету) из:

* переменных среды 
* **-D** параметров 
* **@CucumberOptions**
* **junit-platform.properties**

* запуск всех сценариев

```shell
mvn clean test -Dtest=RunCucumberTest
```

или

```shell
mvn clean test
```

* запуск файла с фичами

```shell
mvn clean test -Dcucumber.features=src/test/resources/features/Smartphone.feature
```

3. Получить результаты запуска в консоли

![New Maven Project - Результаты запуска сценария](./_Files/2.%20New%20Project/48.jpg "New Project - Результаты запуска сценария")

***

[![Лекция](https://img.shields.io/badge/-Лекция-ee99ff)](1.%20Лекция.md)
[![Главная](https://img.shields.io/badge/-Главная-aaccee)](README.md)
[![Задание](https://img.shields.io/badge/-Задание-99ffee)](3.%20Задание.md)